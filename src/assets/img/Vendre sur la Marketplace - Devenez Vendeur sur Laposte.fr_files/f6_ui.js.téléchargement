// DETECTS IF NAMESPACE OF THE APP EXISTS, CREATES THE NAMESPACE OF THE APP.
if (!F6)
	var F6 = {};
else if (F6 && typeof (F6) != "object")
	throw new Error("F6 is not an Object type");

/*
 * F6.UI All user inteface under this class name
 */
F6.namespace('F6.UI');


function displayKnowMoreLink() {
	$("#weightListId option:selected").each(function() {

		if ($(this).attr("modulo") == 'true') {

			$("#knowMore").css("display", "block");
		} else {
			$("#knowMore").css("display", "none");
		}
	});
}

function adjustHeightAddress() {
	// To adjust second border of address list
	var heightDefaultAddress = $("#addressList").children('li').eq(0).height();
	var heightSecondAddress = $("#addressList").children('li').eq(1).height();
	if (heightDefaultAddress && heightSecondAddress) {
		if (heightDefaultAddress > heightSecondAddress) {
			$("#addressList").children('li').eq(1).height(heightDefaultAddress);
		}
	}
}

function removeAddressFormByType(form, idx_max,isPro)
{
	$('#etiquetteAddressForm_' + idx_max + '_').html('');
}

function createAddressFormByType(form, idx_max,isPro)
{
	if(isPro)
	{
		$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".raisonSociale' value=''>");
		$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".service' value=''>");
	}
	else
	{
        $('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".appartement' value=''>");
	}
    $('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".addressId' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".titleCode' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".lastName' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".firstName' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".numLibelle' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".codePostal' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".localite' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".batiment' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".lieuDit' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".phone' value=''>");
	$('#etiquetteAddressForm_' + idx_max + '_').append("<input type='hidden' name='labels[" + (idx_max - 1) + "]." + form + ".email' value=''>");

}

$(document).ready(function() {

					$("input[name='poidsMaxEnvoiTimbre']").click(
									function() {
										if ($(this).next().html().toLowerCase()
												.indexOf(
														$("#rangSelectionne").val()
																.toLowerCase()) >= 0
												&& !(!$("#rangSelectionne")
														.val() || 0 === $(
														"#rangSelectionne")
														.val().length)) {
											return false;
										} else {
											$(this).closest("form").submit();
										}
									});

					$("#weightListId").change(function() {
						displayKnowMoreLink();
					});

					if ( $('#knowMore').length) {
						$("#knowMore").fancybox({
                            src  : URLS.updatePath( $(this).attr('href') ),
                            type: 'image',
                            touch: false,
                            momentum: false,
                            smallBtn: false,
                            clickOutside: "close",
                            baseTpl : Popup.template(),
                            afterShow: function(){
                                $('.fancybox-image-wrap').removeAttr('style');
                            }
                        });
					}

					$(".paiementTemplateValider")
							.click(
									function(e) {
										if (!$("input[name=modePaiement]:checked")
												.val()) {
											submitForm();
										} else {
											if ($('#obligationPayer').prop('checked')) {
												var $form = $(this);
												if ($form.data('submitted') === true) {
													// Previously submitted -
													// don't submit again
													e.preventDefault();
													return false;
												} else {
													// Mark it so that the next
													// submit can be ignored
													$form.data('submitted',
															true);
													submitForm();
													return true;
												}
											} else {
												$('#errorObligation').html($('#conditionsGeneralesDeVente').val());
												$('#errorObligation').addClass("error");
												return false;
											}
										}
									});

					$('#cart').on('hide.bs.dropdown', function() {
						$('#cartLayer').css('display', 'none');
					});
					var divs = $('.product-push');
					for (var i = 0; i < divs.length; i++) {
						var titles = divs[i].getElementsByTagName('h3');
						for (var j = 0; j < titles.length; j++) {
							var title = titles[j].firstChild.nodeValue;

							if (title == 'Les dernières émissions') {
								var secondDivs = divs[i]
										.getElementsByClassName('product-push-bottom-wrap');
								secondDivs[0].style.cssText = 'width: 669px !important';
							}
						}
					}
					adjustHeightAddress();
				});

function getSubstring(val, count) {
	if (val == "00") {
		return 0;
	}
	if (val.length > count) {
		return val.substring(0, count);
	}
	return val.substring(0, val.length);
}

// change caractères speciaux && spaces
function changeSpacesAndAcentedCaracters(str) {
	str = str.replace("<br>", "_");
	str = str.replace(/\s|\,|\\|\/|\'/g, "");
	str = str.replace(new RegExp("[àáâãäå]", 'g'), "a");
	str = str.replace(new RegExp("æ", 'g'), "ae");
	str = str.replace(new RegExp("ç", 'g'), "c");
	str = str.replace(new RegExp("[èéêë]", 'g'), "e");
	str = str.replace(new RegExp("[ìíîï]", 'g'), "i");
	str = str.replace(new RegExp("ñ", 'g'), "n");
	str = str.replace(new RegExp("[òóôõö]", 'g'), "o");
	str = str.replace(new RegExp("œ", 'g'), "oe");
	str = str.replace(new RegExp("[ùúûü]", 'g'), "u");
	str = str.replace(new RegExp("[ýÿ]", 'g'), "y");
	str = str.replace(new RegExp("\\W", 'g'), "");

	return str;
}

// change caractères speciaux && spaces
function changeSpacesUSAndAcentedCaracters(str) {
	str = str.replace("<br>", "_");
	str = str.replace(/\s|\,|\\|\/|\'/g, "_");
	str = str.replace(new RegExp("[àáâãäå]", 'g'), "a");
	str = str.replace(new RegExp("æ", 'g'), "ae");
	str = str.replace(new RegExp("ç", 'g'), "c");
	str = str.replace(new RegExp("[èéêë]", 'g'), "e");
	str = str.replace(new RegExp("[ìíîï]", 'g'), "i");
	str = str.replace(new RegExp("ñ", 'g'), "n");
	str = str.replace(new RegExp("[òóôõö]", 'g'), "o");
	str = str.replace(new RegExp("œ", 'g'), "oe");
	str = str.replace(new RegExp("[ùúûü]", 'g'), "u");
	str = str.replace(new RegExp("[ýÿ]", 'g'), "y");
	str = str.replace(new RegExp("\\W", 'g'), "");

	return str;
}

function Autotab(nextChamp, longueurMax, texteValue) {
	if (texteValue.length > longueurMax - 1) {
		document.getElementById(nextChamp).focus();
	}
}

function displayCarnetAdressePart(link) {
	$.ajax({
		type : "GET",
		cache : false,
		url : link,
		data : $('#coordonneesParticulier').serialize(),
		success : function(data) {
			Popup.popinHTML(data);
		}
	});
	return false;
}

function displayCarnetAdressePro(link) {
	$.ajax({
		type : "GET",
		cache : false,
		url : link,
		data : $('#coordonneesProfessionnel').serialize(),
		success : function(data) {
			Popup.popinHTML(data);
		}
	});
	return false;
}

function displayAddExpediteur(link, flag) {
	$.ajax({
		type : "GET",
		cache : false,
		url : link,
		data : null,
		success : function(data) {
            if(flag){
                var instance = $.fancybox.getInstance();

                instance.current.$slide.trigger("onReset");

                instance.setContent( instance.current, data );
                // F6.UI.executeVRELPopinLink(instance.current);
                F6.UI.executeLrelPopinLink(instance.current);
                F6.MAIN.initSelectBoxParent();

                F6.UI.activeUniform();


            }else{
                Popup.popinHTML(data);
                F6.UI.activeUniform();
            }
		}
	});
	return false;
}

function displayCarnetAdresseDest(link) {
	if ($("#formProSelected").val() == "true") {
		$.ajax({
			type : "GET",
			cache : false,
			url : link,
			data : $('#coordonneesProfessionnel').serialize(),
			success : function(data) {
				Popup.popinHTML(data);
			}
		});
	} else {
		$.ajax({
			type : "GET",
			cache : false,
			url : link,
			data : $('#coordonneesParticulier').serialize(),
			success : function(data) {
				Popup.popinHTML(data);
			}
		});
	}
	return false;
}

function displayAddDestinataire(link) {
	$.ajax({
		type : "GET",
		cache : false,
		url : link,
		data : null,
		success : function(data) {
			Popup.popinHTML(data);
		}
	});
	return false;
}

// submit pre-payment
function submitForm() {
	var displayPopinSepa = $("#display_popin_abscence_mandat").val();
	if ($('input[id=prelevement]').is(':checked')
			&& $('input[id=prelevement]').is(':enabled')
			&& displayPopinSepa == "true") {
		displayPopupAbscenceMandatSepa();
		$(".paiementTemplateValider").data('submitted',false);
	} else {
		$("#formModePaiement").attr("action", EBK.config.contextPath + "/pre-payment");
		$("#formModePaiement").submit();
	}
}

function displayPopupAbscenceMandatSepa() {
	//$.fancybox.showActivity()
	$.ajax({
		type : "GET",
		cache : false,
		url : EBK.config.contextPath+"/prelevement-payment",
		data : null,
		success : function(data) {
			Popup.popinHTML(data);
		}
	});
	return false;
}
// Afficher formulaire SEPA si un Colis existe && aucun mandant recurrent
function displayFormulaireSepa() {
	if (!$('input[id=choisirAutreMoyen]').is(':checked')
			&& !$('input[id=remplirFormulaireSEPA]').is(':checked')) {
		$("#errorMessage").css("display", "block");
		return false;
	} else if ($('input[id=choisirAutreMoyen]').is(':checked')) {
		$('input[id=prelevement]').prop('checked', false);
		jQuery.fancybox.close();
		return false;
	} else {
		$('input[id=prelevement]').prop('checked', false);
		//$.fancybox.showActivity()
		$.ajax({
			type : "GET",
			cache : false,
			url : EBK.config.contextPath+"/prelevement-payment/remplir-formulaire-sepa",
			data : null,
			success : function(data) {
				Popup.popinHTML(data);
			}
		});
	}
	return false;
}

// Valider formulaire SEPA a partir de la popin
function validatedFormulaire() {
	//$.fancybox.showActivity()
	$.ajax({
		type : "POST",
		cache : false,
		url : EBK.config.contextPath+"/prelevement-payment/submit-prelevement?validation=validation",
		data : $('#popinFormulaireSepa').serialize(),
		success : function(data) {
			$("#popupYt").html(data);
			if ($("#popupYt #errorMessage").length == 0) {
				jQuery.fancybox.close();
				/*
				 * $('#paiementSepaTemplateValider').hide();
				 * $('#validatedPaiement').show();
				 */
				$("#paiementSepaTemplateValider").removeAttr("id");
				document.getElementById("prelevement").disabled = true;
			} else {
				Popup.popinHTML(data);
			}
			$("#popupYt").html("");
		}
	});
	return false;
}

// generer PDF SEPA a partir de la popin
function generateSepaPdf() {
	var pdf = "pdf";
	var validatedForm = "validatedForm";
	//$.fancybox.showActivity()
	$.ajax({
		type : "POST",
		cache : false,
		url : EBK.config.contextPath+"/prelevement-payment/submit-prelevement?pdf=pdf",
		data : $('#popinFormulaireSepa').serialize(),
		success : function(data) {

			$("#popupYt").html(data);
			if ($("#popupYt #errorMessage").length != 0) {
				Popup.popinHTML(data);
			} else {
				$("#popinFormulaireSepa").attr(
						"action",
						"prelevement-payment/submit-prelevement?validatedForm="
								+ validatedForm + "&pdf=" + pdf);
				$("#popinFormulaireSepa").submit();
			}
			$("#popupYt").html("");

		}
	});
	return false;
}
/** *************Popin de modification du vignette au niveau du panier******** */
// Fermer la popine de modification des colis
function closePopineVignettesUpdate() {
	$('.dlbi-popin--updateVignettes').removeClass('visible');
}
// Aller à la page correspondante au choix de l'utilisateur
function goToUpdateVignettesPage() {
	if (!$("input[@name='updateVignettes']:checked").val()) {
		$('.error').attr("style", "display:block");
		return false;
	}
	if ($("input[@name='updateVignettes']:checked").val() == "ALL") {
		F6.UI
				.redirect(EBK.config.contextPath+'/vignette-recommandee-en-ligne/recapitulatif');
	} else {
		F6.UI
				.redirect(EBK.config.contextPath+'/vignette-recommandee-en-ligne/depot');
	}
	return false;
}

/** *************Popine de modification du colis au niveau du panier******** */
// Fermer la popine de modification des colis
function closePopineParcelsUpdate() {
	$('.dlbi-popin--updateParcels').removeClass('visible');
}
// Aller à la page correspondante au choix de l'utilisateur
function goToUpdateParcelsPage() {
	if (!$("input[@name='updateParcels']:checked").val()) {
		$('.error').attr("style", "display:block");
		return false;
	}
	if ($("input[@name='updateParcels']:checked").val() == "ALL") {
		F6.UI.redirect(F6.UTILS.getColissimoLink() + '/recapitulatif');
	} else {
		F6.UI.redirect(F6.UTILS.getColissimoLink() + '/votre-envoi');
	}
	return false;
}
/** ************************************************************************** */
// Fermer la popine de modification des colis
function closePopineindemnites() {
	$('.dlbi-popin').removeClass('visible');
}
// Ajouter le boutton supprimer
function diplayCloseButtonFancyBox() {
	var elem = document.getElementById('fancybox-close');
	if (typeof (elem) == 'undefined' || elem == null) {
		$("#fancybox-outer")
				.append(
						'<a id="fancybox-close" style="display: inline;" onClick="closeFancyBox()"></a>');
	}
}

function closeFancyBox() {
	hideRemoveButton();
	$.fancybox.close();
	return false;
}
// Supprimer le boutton supprimer
function hideRemoveButton() {
	var elem = document.getElementById('fancybox-close');
	if (typeof (elem) != 'undefined' && elem != null) {
		elem.parentNode.removeChild(elem);
	}
}
// verifier si au mois un checkbox est coché dans un group
function atLeastOneCheckboxChecked(group) {
	var atLeastOneChecked = false;
	var i = 0;

	while (document.getElementById(group + "[" + i + "]")) {
		if (document.getElementById(group + "[" + i + "]").checked) {
			atLeastOneChecked = true;
			break;
		}
		i++;
	}

	if (atLeastOneChecked == true) {
		return true;
	} else {
		return false;
	}
}
// Afficher ou cachée un element avec id
function showHideElement(id, show) {
	if ($("#" + id).hasClass("hideLink") == false && show == false) {
		$("#" + id).addClass('hideLink');
	} else if ($("#" + id).hasClass("hideLink") == true && show == true) {
		$("#" + id).removeClass('hideLink');
	}

}
/* Enable/Disable button 'Enregistrer colis' Step1 colissimo. */
$(document).ready(function() {
	// Append a change event listener to you inputs
	$('#dlbi-colis input[type="radio"]').change(function() {
		var validatedPoids = true;
		if (parseFloat($('#poids').val().replace(',', '.')) == 0) {
			validatedPoids = false;
		}
		checkConditionsToEnableButton(validatedPoids);
	});

	$('#dlbi-slider-weight').on('mouseup', function() {
		var validatedPoids = true;
		if (parseFloat($('#poids').val().replace(',', '.')) == 0) {
			validatedPoids = false;
		}
		checkConditionsToEnableButton(validatedPoids);
	});

	$('.slider-modifier-minus-weight').on("click", function() {
		var validatedPoids = true;
		if (parseFloat($('#poids').val().replace(',', '.')) <= 0.25) {
			validatedPoids = false;
		}
		checkConditionsToEnableButton(validatedPoids);
	});

	$('.slider-modifier-plus-weight').on("click", function() {
		checkConditionsToEnableButton(true);
	});

});

function checkConditionsToEnableButton(validatedPoids) {
	var validatedTypeColis = false;
	var validatedServiceOptionnels = false;

	isColisEnregistre();
	if (document.getElementById('colis-standard').checked
			|| document.getElementById('colis-volumineux').checked
			|| document.getElementById('colis-rouleau').checked)
		validatedTypeColis = true;

	if (document.getElementById('reco-simple').checked
			|| document.getElementById('reco-signed').checked)
		validatedServiceOptionnels = true;

	// If form is validated enable form
	if (validatedPoids && validatedTypeColis && validatedServiceOptionnels) {
		$("#popupEnregistrerColis").removeAttr("disabled");
		$("#popupEnregistrerColis").addClass('btn-md').removeClass(
				'btn-disable');
		$("#popupEnregistrerColis").addClass('btn-orange').removeClass(
				'btn-grey');
	} else {
		$("#popupEnregistrerColis").attr("disabled", "disabled");
		$("#popupEnregistrerColis").addClass('btn-disable').removeClass(
				'btn-md');
		$("#popupEnregistrerColis").addClass('btn-grey').removeClass(
				'btn-orange');

	}
}

function isColisEnregistre() {
	var enregisterColisButton = $('#popupEnregistrerColis').html();
	if (enregisterColisButton === 'Colis enregistré') {
		$("#popupEnregistrerColis").html(
				'Enregistrer ce colis pour une prochaine commande');
		$("#popupEnregistrerColis").addClass('btn-disable').removeClass(
				'btn-md');
	}
}

function changeButtonName() {
	$("#popupEnregistrerColis").html('Colis enregistré');
	$("#popupEnregistrerColis").attr("disabled", "disabled");
}

// Mise à jours l'affichage des liens de remboursement et de suivi
function showHideRefundFollowLink(refund, follow) {
	if ((refund == false) && (follow == false)) {
		showHideElement("links_refund", false);
	}
	if ((refund == true) || (follow == true)) {
		showHideElement("links_refund", true);
	}
	if (refund == false) {
		showHideElement("refund_link", false);
	} else {
		showHideElement("refund_link", true);
	}
	if (follow == false) {
		showHideElement("follow_link", false);
	} else {
		showHideElement("follow_link", true);
	}
}

function isMonComptePage() {
    var compteContainer = document.getElementsByClassName("moncompte-container");
    if (compteContainer[0]) {
        return true;
    }
}

/*
 * init Closure for namespace safety
 */
(function($, jsface) {
	var nombreDeCaracteresDansUnePageA4 = 1700;
	var nombreDeLignesDansUnePageA4 = 60;
	var Class = jsface.Class;
	var globalFancybox;
	var previousProduct;

	/*
	 * F6.UI.menuNavWidth this function adds equal distance in top menu
	 */
	F6.UI.menuNavWidth = function() {
		var elNav = $('.nav_main ul'), elNavLi = elNav.find('li'), iLiLength = elNavLi.length - 1, iHome = 46, // width
		// of
		// the
		// home
		// icon
		iSiteWidth = 964, // width of the nav menu
		iMenuWidth = iSiteWidth - iHome, iNewLiWidth = iMenuWidth / iLiLength, iLiSize = 0;

		elNavLi.find('a:not(.home)').css('padding', '0');

		elNavLi
				.each(function() {
					var el = $(this), bIsHome = el.find('.home').length, elSpan = el
							.find('span.text'), iSpanHeight = elSpan.height(), iElWidth = el
							.width();

					if (!bIsHome) {
						if (iSpanHeight < 29) {
							el.addClass('singleLine');
						}
						iLiSize += iElWidth;
					}
				});

		var iDiff = iMenuWidth - iLiSize, iLiPadDouble = iLiLength * 2, iLiPad = iDiff
				/ iLiPadDouble;

		elNavLi.filter(':not(:first-child)').find('a').css({
			"padding-left" : iLiPad,
			"padding-right" : iLiPad
		});
	};

	/*
	 * F6.UI.hpCarousel this function inits homepage caroucel, arrows, pager,
	 * auto slideshow.
	 */
	F6.UI.hpCarousel = function() {
		/*
		 * $('.wrapCaroucel .row').cycle( { fx: 'fade', speed: 1500, timeout:
		 * 5000, //timeout: 0, pause: 1, pager: '.blockHpCarousel .pager', next:
		 * '.blockHpCarousel .next', prev: '.blockHpCarousel .prev',
		 * pagerAnchorBuilder:function(index, DOMelement) { index++; return '<a
		 * title="Afficher la diapositive ' + index + '" href="#'+ index+'">
		 * <span class="invisible"> Diapositive </span> '+ index +'</a>'; } } );
		 *
		 * $('.playPause').bind('click', function(e){ var el = $(this); if(
		 * el.hasClass('pause') ){
		 *
		 * $('.wrapCaroucel .row').cycle('resume'); el.removeClass('pause');
		 *
		 * }else{
		 *
		 * $('.wrapCaroucel .row').cycle('pause'); el.addClass('pause'); }
		 * F6.stop(e); });
		 */
		$(".blockCarNav li").each(function(index, value) {
			// console.log(index + ":" + value);
			// $(this).attr("id", "link" + n);
		});
	};

	F6.UI.displayErrorFormMessage = function(element, message) {
		$(element).html(
				'<label class="error" for="txtTrackCourrier">' + message
						+ '</label>').css('display', 'block');
		$('.wrapCourrier .error').css('display', 'block');
	};

	/*
	 * F6.UI.courrierData this function validates courrier tracking
	 */
	F6.UI.courrierData = function() {
		var elData = $('.wrapCourrier'), elForm = elData.find('#courrierData'), elTxt = elForm
				.find('#txtTrackCourrier'), elDataMain = $('.showResults tbody'), sError = Globalize
				.localize("Le numéro saisi est incorrect.", "fr_FR");

		elForm.bind('submit', function(e) {
							var el = $(this), elTrack = el
									.find('#txtTrackCourrier'), elError = el
									.find('div.error'), elMsgInfo = el
									.parents('.wrapTrackOrder')
									.find(
											'.trackRight .courrierData .blockNumberInfo'), sElVal = elTrack
									.val();
							if (sElVal.length != 13) {
								elDataMain.find('.showResults tbody').hide();
								elForm.find('.blockNumberInfo').show();
								elError.text(sError).addClass('error');
								document.location.href = "#trackError";
								e.preventDefault();
							}
						});
		elTxt.bind('focus', function() {
			var el = $(this), sVal = el.val();

			if (sVal === sError) {
				el.val('').removeClass('error');
			}
		});
	};

	// place F6.UI. functions here.

	/*
	 * F6.UI.accordion this function inits accordion Menu in T_editorial page
	 */

	F6.UI.accordion = function() {
		$('#accordion').dcAccordion({
			eventType : 'click',
			autoClose : false,
			saveState : true,
			disableLink : true,
			speed : 'fast',
			classActive : 'test',
			showCount : true
		});

	};

	F6.UI.accordion_csuivi = function() {

		$("div.expand").toggler({
			initShow : "div.collapse:first"
		});

	};

	/*
	 * F6.UI.player this function inits jwPlayer for T_editorial page
	 */

	F6.UI.player = function(where, videoImage, video, sizeX, sizeY) {

		/*
		 * if (where == 'player3' ){ var sBtn = '<a class="linkClose"
		 * href="#">Fermer</a>'; $('.boxVideoContainerVisit').prepend(sBtn);
		 *
		 * $('.linkClose').bind('click', function(e){ window.history.back();
		 * F6.stop(e); }); }
		 */

		jwplayer(where).setup({
			autostart : 'false',
			width : sizeX,
			height : sizeY,
			file : '/_ui/eboutique/videos/' + video + '.mp4',
			image : '/_ui/eboutique/images/media/' + videoImage + '.jpg',
			stretching : 'fill',
			'plugins' : 'viral',
			'viral.onpause' : 'false',
			plugins : {
				captions : {
					file : '/_ui/eboutique/video/subtitles.srt'
				}
			},
			modes : [ {
				type : 'html5',
				config : {
					skin : "/_ui/eboutique/images/glow/glow.xml"
				}
			},

			{
				type : 'flash',
				src : "/_ui/eboutique/videos/player.swf",
				config : {
					skin : "/_ui/eboutique/images/glow/glow.xml"
				}

			} ]
		});
	};

	/*
	 * F6.UI.formCourrier this function inits input spaces for Courrier Suivi
	 */

	F6.UI.formCourrier = function() {
		$('input.input_ref').setMask(
				'**    ********    ***   **    *******    ******');
	};

	F6.UI.jNice = function() {
		$('checkbox')
	};

	F6.UI.tooltipGlobal = function(el, elHtmlWrapper, cssTop, cssLeft, animTop,
			animLeft, mouseAnimTop, mouseAnimLeft) {

		var elTooptip = el, elHtml = elHtmlWrapper, cssHtmlTop = cssTop, cssHtmlLeft = cssLeft, htmlAnimTop = animTop, htmlAnimLeft = animLeft, elMouseAnimtTop = mouseAnimTop, elMouseAnimtLeft = mouseAnimLeft;

		$(elTooptip).bind('mouseenter focusin', function() {

			$("a", this).attr('title', '');

			/*
			 * if ($(elHtml, this).css("display") == "block") { return false; }
			 */

			os = $(this).offset();

			if (elHtmlWrapper == '.lselEtatEnvoi') {
				$(elHtml, this).css({
					bottom : cssHtmlTop,
					left : cssHtmlLeft
				}).show();
			} else {
				$(elHtml, this).css({
					top : cssHtmlTop,
					left : cssHtmlLeft
				}).show();
			}
			/*
			 * $(elHtml, this).css({ top: cssHtmlTop, left: cssHtmlLeft
			 * }).animate({ top: htmlAnimTop, left: htmlAnimLeft, opacity:
			 * "show" }, 750);
			 */
		})

		.bind('mouseleave focusout', function() {
			$(elHtml, this).hide();
			/*
			 * $(elHtml, this).animate({ top: elMouseAnimtTop, left:
			 * elMouseAnimtLeft, opacity: "hide" }, 500);
			 */
		});

	};

	// ajuster le css de la info bulle sur le detail de lSEL
	F6.UI.ajusterLselInfoBulleCss = function() {
		var h = $("#lelDeliveryAddress").height();
		var top = 33 - (h - 45);
		if (top > 0) {
			var toppx = top + 'px';
			if ($('.etatEnvoi_part').length)
				$('.etatEnvoi_part').css('padding-top', toppx);
			if ($('.etatEnvoi').length)
				$('.etatEnvoi').css('padding-top', toppx);
		} else {
			var toppx = top + 'px';
			if ($('.etatEnvoi').length) {
				top = -387 + top;
				toppx = top + 'px';
				$('.etatEnvoi').css('padding-top', '0px');
				$('.etatEnvoi').css('top', toppx);
			}
			if ($('.etatEnvoi_part').length) {
				top = -384 + top;
				toppx = top + 'px';
				$('.etatEnvoi_part').css('padding-top', '0px');
				$('.etatEnvoi_part').css('top', toppx);
			}
		}
	}

	F6.UI.tableShowHide = function() {
		var elLinkTable = $('th.identifiant_num a.hideData'), // link
		elTrTable = $("th.identifiant_num").parent("th"); // td containing
		// link
		$('tbody').find('tr:first-child').find('th:first-child').find('a')
				.find('img').attr("src",
						"images/icons/table_collapse_close.gif"); // set
		// picto
		// get first tr
		var elFirst = $('tbody').find('tr:first-child');
		// hide all but first tr
		$('.resultat_rech_table tbody').find('tr').each(function() {
			$(this).hide();
		});

		elLinkTable.click(function() {
			var elThis = $(this), elThisTrLink = elThis.parents("tr");

			if (elThis.hasClass("show")) {
				alt_label = elThis.find('img').attr('alt');
				new_label = alt_label.replace(Globalize.localize("(ouvert)",
						"fr_FR"), Globalize.localize("(fermé)", "fr_FR"));

				elLinkTable.find('img').attr('alt', alt_label);
				// elThis.parents("tr").next("tr").hide();
				elThis.parents('tr').nextUntil('tr.tableHeader', "tr").each(
						function() {
							$(this).hide();
						});
				elThis.find("img").attr("src",
						"images/icons/table_collapse_close.gif");
				elThis.removeClass("show");
				// $('tbody').parent().removeClass('openTable');
				elThis.addClass("hideTr");

			} else {
				alt_label = elThis.find('img').attr('alt');
				new_label = alt_label.replace(Globalize.localize("(fermé)",
						"fr_FR"), Globalize.localize("(ouvert)", "fr_FR"));
				elThis.find('img').attr('alt', new_label);

				elThis.removeClass("hideTr");
				elThis.addClass("show");
				// elThis.parents("tr").next("tr").show();
				elThis.parents('tr').nextUntil('tr.tableHeader', "tr").each(
						function() {
							$(this).show();
						});
				// $('tbody').parent().addClass('openTable');
				elThis.find("img").attr("src",
						"images/icons/table_collapse.gif");
			}
			return false;
		});
	};

	F6.UI.hideTableResults = function() {
		var elTableResult = $('.hide_table_result');
		elTableResult.hide();

	};

	F6.UI.hideBlockPartenaires = function() {
		$(".collapseBox").hide();
		$(".smallButton").show();

		var sHtml = '<div class="smallButton"><span><a href="#">'
				+ Globalize.localize("En savoir plus", "fr_FR")
				+ '</a></span></div>';

		$('.partenaire2').each(function() {
			var el = $(this);
			el.find('.collapseBox').before(sHtml);
		});

		$(".smallButton span a").click(
				function() {
					$(this).parents(".smallButton").next(".collapseBox")
							.toggle();
					$(this).text(
							$(this).text() == Globalize.localize(
									"En savoir plus", "fr_FR") ? Globalize
									.localize("Refermer", "fr_FR") : Globalize
									.localize("En savoir plus", "fr_FR"));
					return false;
				});
	};

	F6.UI.collapseQuestions = function() {

		$(".collapseQuestions").hide();

		$(".articleLinks").click(function(e) {
			var el = $(this), elNext = el.next(".collapseQuestions");

			if (el.hasClass('selected')) {
				el.removeClass('selected');
				elNext.hide();
			} else {
				/*
				 * $(".articleLinks").removeClass('selected');
				 * $(".collapseQuestions").hide();
				 */

				el.addClass('selected');
				elNext.show();
			}

			e.preventDefault();
			e.stopPropagation();
		});

	};

	F6.UI.windowPopup = function(param) {

		var elParamQuery = param, elContent = '';
		if (elParamQuery == 1) {
			elContent = '?param=1';
		} else {
			elContent = '';
		}

		var width = 575, height = 360, left = ($(window).width() - width) / 2, top = ($(
				window).height() - height) / 2, url = "popup_authentication.html"
				+ elContent, elBtn = $('.openpopup'), elBtn2 = $('ul li.icon_letre'), opts = 'status=1'
				+ ',width='
				+ width
				+ ',height='
				+ height
				+ ',top='
				+ top
				+ ',left=' + left;

		elBtn.click(function() {
			window.open(url, 'popup_authentication', opts);
			return false;
		});

		elBtn2.click(function() {
			window.open(url, 'popup_authentication', opts);
			return false;
		});
	};

	/*
	 * Query string javascript
	 */
	F6.UI.queryString = function(name) {
		name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		var regexS = "[\\?&]" + name + "=([^&#]*)";
		var regex = new RegExp(regexS);
		var results = regex.exec(window.location.search);
		if (results == null)
			return "";
		else
			return decodeURIComponent(results[1].replace(/\+/g, " "));
	};

	/** ***************************************************** */
	/** ************************ V2 ************************* */
	/** ***************************************************** */
	/*
	 * Nomenclature : - active = ajoute un comportement / add behavior - execute =
	 * ajoute une fonctionnalit? / add a feature
	 */

	/**
	 * Active le skin des formulaires : selectBoc, radio, checkbox, text
	 */
	F6.UI.activeUniform = function() {
        console.log("%%%%%%%%%%%%%%%%%% F6.UI.activeUniform ")
		if (!$('body').hasClass('stamps-online-step1')
				&& !$('body').hasClass('stamps-online-step2')) {
			var flagUniformed = false;
			var parent_elem;
			if (F6.UTILS.isCssActivate()) {
				if ($('body').hasClass('use-uniform')) {
					var elem = $('input[type="file"], select');
					for (var i = 0, n = elem.length; i < n; i++) {
						flagUniformed = false;
						parent_elem = elem[i].parentNode;
						if (!$(parent_elem).hasClass("selector")) {
							$(elem[i]).uniform(
									{
										fileDefaultText : Globalize.localize(
												"Aucun fichier sélectionné",
												"fr_FR"),
										fileBtnText : Globalize.localize(
												"Parcourir", "fr_FR")
									});
						}
					}
				}
			}
		}

	};

	/**
	 * Active le JS sur les pages
	 */
	F6.UI.activeBodyFullJS = function() {
		$('body').removeClass('js-noactive');
		$('body').find('.js-noactive').each(function() {
			$(this).removeClass('js-noactive');
		})
		$('body').addClass('js-active');
		// begin QC 1434 : the click must work for left area of the button
		$('form span input[type="submit"]').each(function() {
					$(this).parent('span').unbind('click');
					$(this).parent('span').bind('click', function(e) {
						mouseX = e.pageX;
						inputX = $(this).children('input[type="submit"]').offset().left;
						spanX = $(this).offset().left;
						if (mouseX >= spanX && mouseX < inputX) {
							$(this).children('input[type="submit"]').get(0).click();
						}
					});
		});
		// end QC 1434 : the click must work for left area of the button
	};
	/**
	 * Active le panier en JS
	 */
	F6.UI.activeBasketFullJS = function() {
		$('ul.panier_info').superfish({
			autoArrows : false,
			delay : 0,
			speed : 'fast'
		}); // active
		// les effets sur le panier
	};

	/**
	 * Active le menu principal en JS, de base il est en no-js
	 */
	F6.UI.activeMainMenuFullJS = function() {
		$('#main-menu').addClass('scriptNav'); // masque le menu no-js
		// $('.menuMain').superfish({autoArrows: false, delay: 200, speed:
		// 'fast'}); // active les effets sur le menu

		$('#nav_main ul.menuMain').superfish({
			autoArrows : false,
			delay : 200, // the delay in milliseconds that the mouse can
			// remain outside a submenu without it closing
			speed : 'fast', // speed of the animation. Equivalent to second
			// parameter of jQuery’s .animate() method
			disableHI : true, // set to true to disable hoverIntent detection
			onInit : function() {
				$('.list-product').show().css('visibility', 'visible');
				$('.list-product ul').show().css('visibility', 'visible');
				$('.list-product .do-not-bind').unbind();
				$('.product_all a:eq(0)').bind('hover, focus', function() {
					$('.product_all .submenu').show();
					$('.product_all .submenu').css('visibility', 'visible');
					$('.do-not-bind ul').show();
					$('.do-not-bind ul').css('visibility', 'visible');
				});
				$('.list-product .do-not-bind a').unbind('focus, blur');

				$('.list-product .do-not-bind a').click(function() {
					$('.list-product ul').show().css('visibility', 'visible');
					$('.list-product .do-not-bind').unbind();
					document.location.href = $(this).attr('href');
				});
			}
		// animation: {opacity:'show',height:'show'}
		}); // active les effets sur le menu
	};

	/**
	 * Active le menu secondaire de mon compte en JS, de base il est en no-js
	 */
	/*F6.UI.activeMenuSecondaireFullJS = function() {
		$('#menuSecondaire').addClass('scriptNav'); // masque le menu no-js
		$('#menuListe').superfish({
			autoArrows : false,
			delay : 50,
			speed : 'fast'
		}); // active
		// les effets sur le menu
	};*/
	/**
	 * Masquer le Separator du menu secondaire
	 */
	F6.UI.MenuSecondaireSeparator = function() {
		$('.menuItem').hover(function() {
			$(this).next().addClass('no-separator');
		}, function() {
			$(this).next().removeClass('no-separator');
		})
	};

	/**
	 * valide le formulaire de selection du nombre de r?sultat par page
	 */
	F6.UI.activeChangeResultPerPage = function() {
		$('#changeResultPerPage select').change(function() {
			$('form#changeResultPerPage').submit();
		});
	};

	/* NAV MON COMPTE */
	F6.UI.PopUpstep1 = function() {
		$('#formPro').hide();
		$("[name=destinataire]").click(function() {
			$('#formPro').toggle();
			$('#formPart').toggle();
		});

	};
	F6.UI.PopUpstep2 = function() {
		$(".adress-index > li > a:first").addClass('selected');
		$(".adress-index > li > a").click(function() {
			$(".adress-index a").removeClass('selected');
			$(this).addClass('selected');
		});
	};

	/**
	 * START CHOIX DE L'IMAGE | fichier : MTEL_Perso_Carac_select_mois_themes *
	 */
	F6.UI.executeSelectStampThumbnail = function(directory_input) {

		$('.stamp-thumbs li label').each(function() {

			$(this).bind('mouseover', F6.UI.highlightStampThumb);

			$(this).bind('mouseout', F6.UI.unHighlightStampThumb);
			$(this).bind('click', F6.UI.selectStampThumb);
		});
		$('.stamp-thumbs li input').each(function() {
			$(this).bind('focus', F6.UI.highlightFocusStampThumb);
			$(this).bind('focusout', F6.UI.unHighlightFocusStampThumb);
			$(this).bind('change', F6.UI.selectTabStampThumb);
		});

	};

	F6.UI.removehigHlightedStampThumb = function() {
		$('.stamp-thumbs li label').each(function() {
			$(this).removeClass('selected');
			$(this).find('img').css('border-color', '#F5F5F2');
		});
	};

	F6.UI.lelAutoSubmitSelect = function() {
		$('#formTrier').change(function() {
			$('#form_compte_commandes_lel').submit();
		});
	};

	F6.UI.mtelAutoSubmitSelect = function() {
		$('#formTrier').change(function() {
			$('#form_compte_commandes_mtel').submit();
		});
	};

	F6.UI.mnaAutoSubmitSelect = function() {
		$('#formTrier').change(function() {
			$('#form_compte_commandes_mna').submit();
		});
	};

	F6.UI.favorisAutoSubmitSelect = function() {
		$('#formTrier').change(function() {
			$('#form_listFavorisForm').submit();
		});
		$('#pageSize').change(function() {
			$('#form_listFavorisForm').submit();
		});
	};

	/*
	 * dir_path est une variable initialis?e dans la page stamp-thumbs
	 */
	F6.UI.highlightStampThumb = function(e) {
		$(this).find('img').css('border-color', '#5b8900');

	};
	F6.UI.unHighlightStampThumb = function(e) {
		if (!$(this).hasClass('selected'))
			$(this).find('img').css('border-color', '#F5F5F2');

	};

	F6.UI.highlightFocusStampThumb = function(e) {
		li_elem = $(this).parent('li');
		$(li_elem).find('label img').css('border-color', '#5b8900');
	};
	F6.UI.unHighlightFocusStampThumb = function(e) {
		li_elem = $(this).parent('li');

		if (!$(li_elem).find('label').hasClass('selected'))
			$(li_elem).find('label img').css('border-color', '#F5F5F2');
	};

	F6.UI.selectTabStampThumb = function(e) {

		li_elem = $(this).parent('li');
		F6.UI.removehigHlightedStampThumb();

		$(li_elem).find('label img').css('border-color', '#5b8900');
		$(li_elem).find('label').addClass('selected');
		img_src = $(li_elem).find('label').attr('data-image');
		image = document.getElementById('stamp-demo-thumb');
		image.src = '/_ui/eboutique/images/emplacement/' + img_src;
		$(image).load();
	};

	F6.UI.selectStampThumb = function(e) {
		F6.UI.removehigHlightedStampThumb();
		$(this).addClass('selected');
		$(this).next('input').attr('checked', 'checked')
		$(this).find('img').css('border-color', '#5b8900');
		img_src = $(this).attr('data-image');
		offline_date = $(this).attr('data-offline-date');

		image = document.getElementById('stamp-demo-thumb');
		// image.src = '/_ui/eboutique/images/emplacement/' + img_src;
		image.src = img_src;
		$(image).load();
		$('#stamp-date-max').html(offline_date);

		return false;
	};
	/** END CHOIX DE L'IMAGE * */

	/**
	 * START GESTION DE LA PLANCHE | fichier :
	 * MTEL_Supportd_impression_Etiquettes *
	 */

F6.UI.SheetstampPicker = Class({

		constructor : function() {
			this.global_sheet = $('#sheetpicker-planche .sheetstamp-body');
			this.select_element = $('#dimensionPlanche');
			this.grid_element = $('#sheet-stamp-list');
			this.ref_stamp_cell = $('#sheet-stamp-list li:eq(0)');
			this.slots_per_page = 0;
			this.rows = 0;
			this.cols = 0;
			this.selected_option = null;
			this.caption = '';
			this.captionurl = '';
			this.defineSelectedOption();
			this.current_page = 1;
			this.max_page = 1;
			this.stamps = window.nbTotalStamps + 1;
			// this.displayGrid();
			this.position = 1;
			// On récupère le tableau décrivant le contenu de la grille de timbres pour mettre à jour le nombre réel de timbre à chaque modification
			this.listVisuel = new Array();
			this.nbStampsWithoutBarcodes = 0;
			this.label_num_slots = Globalize.localize(
					"Planche de XX étiquettes", "fr_FR");
			this.pagination = false;
			this.array_slots = new Array();
			this.defineArraySlot();

			this.defineTextSheetNumber();
			// $('.complement a.code-planche').attr('href',
			// this.captionurl).text(this.caption);
		},
		defineSelectedOption : function() {
			selObj = document.getElementById('dimensionPlanche');
			selIndex = selObj.selectedIndex;
			this.selected_option = this.select_element.find('option:eq('
					+ selIndex + ')');
			this.setRows(this.selected_option.attr('data-rows'));
			this.setCols(this.selected_option.attr('data-cols'));
			this.caption = this.selected_option.attr('data-caption');
			this.captionurl = this.selected_option.attr('data-captionurl');
			this.setRows(this.selected_option.attr('data-rows'));

			this.slots_per_page = this.selected_option.attr('data-rows')
					* this.selected_option.attr('data-cols');
			this.slots_stamp = this.stamps + this.position - 1;

		},

		// Call for every Display
		defineArraySlot : function() {
			this.array_slots = new Array();

			for (n = 0; n < (this.slots_per_page * this.max_page); n++) {
				if (n >= this.position - 1
						&& n < this.stamps/* ListStamps */+ this.position - 1) {
					this.array_slots.push('stamp');// push URL
				} else {
					this.array_slots.push('empty');
				}
			}

		},
		setRows : function(input) {
			tmp = Math.round(input * 1);
			if (tmp == 8 || tmp == 6 || tmp == 7)
				this.rows = tmp;
		},
		getRows : function() {
			return this.rows;
		},
		setCols : function(input) {
			tmp = Math.round(input * 1);
			if (tmp == 3 || tmp == 2)
				this.cols = tmp;
		},
		getCols : function() {
			return this.cols;
		},
		setAjaxUrl : function(input) {
			this.ajax_url = input;
		},
		getAjaxUrl : function() {
			return this.ajax_url;
		},
		setAjaxFormId : function(input) {
			this.form_id = input;
		},
		getAjaxFormId : function() {
			return this.form_id;
		},
		setAjaxCallback : function(input) {
			this.callback = input;
		},
		getAjaxCallback : function() {
			return this.callback;
		},
		debug : function() {
			// znouaoui -> Watch out IE bug with console.log(this.getRows() + '
			// ' +
			// this.getCols() )
		},

		// Updated by : ZNouaoui

		displayGrid : function(isPageNavigation) {
			this.grid_element.find('li').remove();
			this.grid_element.removeClass('cols-num-3');
			this.grid_element.removeClass('cols-num-2');
			$('.specimen').removeClass('cols-num-3');
			$('.specimen').removeClass('cols-num-2');

			this.grid_element.addClass('cols-num-' + this.getCols());
			$('.specimen').addClass('cols-num-' + this.getCols());

			// Mise en place message d'erreur qui apparaîtrai si la limite du nombre de timbres est atteinte
			$('.mtel-error').html('Vous devez limiter votre achat à 120 timbres par commande.<br>');

			$('#nombreTimbre').on('change', function(event) {
				// ATTENTION : parseInt n'est pas suffisant pour contrôler la validité d'une saisie numérique, d'où le contrôle renforcé ci-dessous
				var tmpval = parseInt($(this).val());
				var tmpdef = '1';
				if (typeof tmpval === "number") {
					if (tmpval < 1) {
						$(this).val(tmpdef);
					} else {
						if (window.isNaN(tmpval)) {
							$(this).val(tmpdef);
						}
					}
				} else {
					$(this).val(tmpdef);
				}
				return false;
			});

			$('#positionPremierTimbre').on('change', function(event) {
				// ATTENTION : parseInt n'est pas suffisant pour contrôler la validité d'une saisie numérique, d'où le contrôle renforcé ci-dessous
				var tmpval = parseInt($(this).val());
				var tmpdef = '1';
				if (typeof tmpval === "number") {
					if (tmpval < 1) {
						$(this).val(tmpdef);
					} else {
						if (window.isNaN(tmpval)) {
							$(this).val(tmpdef);
						}
					}
				} else {
					$(this).val(tmpdef);
				}
				return false;
			});

			$('#nombreTimbre').keydown(function(event) {
				if (event.which == 13) {
					$(this).change();
					$(this).next("a").focus();
					return false;
				}
			});
			$('#positionPremierTimbre').keydown(function(event) {
				if (event.which == 13) {
					$(this).change();
					$(this).next("a").focus();
					return false;
				}
			});

			// Updated by: JAlonet

			// Znouaoui : Algo Display Etiquettes
			var occuppedPlaces = (parseInt($('#nombreTimbre').val())
					+ parseInt($('#positionPremierTimbre').val()) + parseInt(window.nbTotalStamps)) - 2;
			if (window.currentVisuel.productType == 'LETTRE_SUIVIE'
					|| window.currentVisuel.productType == 'LETTRE_SUIVIE_INTERNATIONALE'
					|| window.currentVisuel.productType == 'LPIAS'
					|| window.currentVisuel.productType == 'PPIAS'
					|| isWithSuivi || isWithStickerDouane) {
				occuppedPlaces = (parseInt($('#nombreTimbre').val() * 2)
						+ parseInt($('#positionPremierTimbre').val()) + parseInt(window.nbTotalStamps)) - 2;
			}
			// 1 : bascule a la derniere page non vide !
			if ((occuppedPlaces <= (this.slots_per_page * (this.current_page - 1)))) {
				this.current_page = this.current_page - 1;
				// znouaoui -> Watch out IE bug with console.log("Go Back To
				// Page :
				// "+this.current_page);
			}
			// 2 : bascule vers la page sur laquelle on modifier le visuel
			// actuel
			if (isPageNavigation == false) {
				var stampNbrBeforCurrentStamp = 0;
				// 2.1 Cas 1 : ajout du premier timbre
				if (window.currentVisuel.visuelCode == 'null') {
					stampNbrBeforCurrentStamp = occuppedPlaces;
				} else {
					// Cas 2 : modification d'un timbre
					for ( var codeVisuel in window.listVisuel) {
						stampNbrBeforCurrentStamp += parseInt(window.listVisuel[codeVisuel].visuelNumber);

						if (window.currentVisuel.visuelCode == codeVisuel) {
							// znouaoui -> Watch out IE bug with
							// console.log("stampNbrBeforCurrentStamp :
							// "+stampNbrBeforCurrentStamp);
							break;
						}
					}
					;
				}
				stampNbrBeforCurrentStamp = stampNbrBeforCurrentStamp
						+ parseInt($('#positionPremierTimbre').val()) - 1;

				// znouaoui -> Watch out IE bug with
				// console.log("stampNbrBeforCurrentStamp :
				// "+stampNbrBeforCurrentStamp);
				if ((stampNbrBeforCurrentStamp) > (this.slots_per_page * (this.current_page))) {
					this.current_page++;
					// znouaoui -> Watch out IE bug with : console.log("Go To
					// Next
					// Page : "+this.current_page);
					this.displayPagination();
				}
			}
			var currentPos = 0;
			var logosHaveBeenAdded = false;
			var startPos = window.startPosition;
			var nombreEtiquettes = 120;// this.getRows() * this.getCols();
			if (window.currentVisuel.productType == 'LETTRE_SUIVIE'
					|| window.currentVisuel.productType == 'LETTRE_SUIVIE_INTERNATIONALE'
					|| window.currentVisuel.productType == 'LPIAS'
					|| window.currentVisuel.productType == 'PPIAS'
					|| isWithSuivi || isWithStickerDouane) {
				nombreEtiquettes = 240;
			}
			var posOfUpdate = null;

			var listVisuel2 = new Array();

			// 1 : Transform list (1) to (2) Array[pos][visuelUrl]
			/*
			 * Récap sur les classes CSS affectées à la planche courante : (
			 * modif GJ du 14/02/2017 ) - classe "emptyBefore" affectée aux
			 * cases qui se trouvent avant le premier timbre - classe "active"
			 * sur les cases contenant des timbres - classe "empty" sur les
			 * cases qui se trouvent après le dernier timbre
			 */
			var classeEmpty = 'emptyBefore';
			while (currentPos < nombreEtiquettes/* To replace by format size */) {
				if (logosHaveBeenAdded == false && currentPos >= (startPos - 1)) {
					if (classeEmpty == 'emptyBefore') {
						classeEmpty = 'empty';
					}
					for ( var codeVisuel in window.listVisuel) {
						var toPos2 = (currentPos + parseInt(window.listVisuel[codeVisuel].visuelNumber));

						while (currentPos < toPos2) {
							// znouaoui -> Watch out IE bug with
							// console.log("Add
							// visuel Stamp on pos : "+currentPos);
							listVisuel2[currentPos] = window.listVisuel[codeVisuel].visuelUrl;
							currentPos++;

							if (window.listVisuel[codeVisuel].productType == 'LETTRE_SUIVIE'
									|| window.listVisuel[codeVisuel].productType == 'LETTRE_SUIVIE_INTERNATIONALE'
									|| window.listVisuel[codeVisuel].productType == 'PPIAS'
									|| window.listVisuel[codeVisuel].productType == 'LPIAS'
									|| window.listVisuel[codeVisuel].hasSuivi == 'true'
                                    || window.listVisuel[codeVisuel].hasStickerDouane == 'true'

									|| ((window.currentVisuel.productType == 'LETTRE_SUIVIE'
									        || isWithSuivi || isWithStickerDouane
											|| window.currentVisuel.productType == 'LETTRE_SUIVIE_INTERNATIONALE'
											|| window.currentVisuel.productType == 'PPIAS' || window.currentVisuel.productType == 'LPIAS') && window.currentVisuel.visuelCode == codeVisuel )) {
								listVisuel2[currentPos] = '/_ui/eboutique/images/media/cab.jpg';
								currentPos++;

							}
						}

					}
					;// end For
					// Add Chosen Visuen (When Add || none mode)
					// var posTT = currentPos+1;
					// if(window.isUpdateMode == false)
					// {
					// //znouaoui -> Watch out IE bug with console.log("Add
					// visuel Stamp on pos :
					// "+currentPos);
					// listVisuel2[currentPos] = window.currentVisuel.visuelUrl;
					// currentPos++;
					// }
					logosHaveBeenAdded = true;
				} else {
					// znouaoui -> Watch out IE bug with console.log("Add empty
					// Stamp on pos : "+currentPos);
					listVisuel2[currentPos] = classeEmpty;
					currentPos++;
				}
			}

			//Mise à jour du nombre de timbres (codes barre exclus)
			this.listVisuel = listVisuel2;
			this.nbStampsWithoutBarcodes = 0;
			for (i = 0; i < this.listVisuel.length; i++) {
			    if (this.listVisuel[i] != '/_ui/eboutique/images/media/cab.jpg' && this.listVisuel[i] != 'empty' && this.listVisuel[i] != 'emptyBefore') {
			        this.nbStampsWithoutBarcodes += 1;
			    }
			}
			var counterLoads;
			if(counterLoads == 0){
                if (this.nbStampsWithoutBarcodes >= 120) {
                    $('.mtel-error').show();
                } else {
                    $('.mtel-error').hide();
                }
            }
            else counterLoads++;

			// 2 : Display list
			if (this.current_page > this.max_page) {
				this.current_page = this.max_page
			}
			// modif GJ du 14/02/2017
			// ajout prise en compte classe "emptyBefore" lors de la génération
			// de la liste des timbres
			var GridElement = $('<div></div>');
			var li, span, image;
			var listvisuel_length = listVisuel2.length - 1;

			// récupération du dernier visuel (pour affecter la classe inactive aux visuels précédents)
			var dernier_visuel = '';
			var tmp_i = 0;
			var tmp_max = listVisuel2.length ;
			while (listVisuel2[tmp_i] != 'empty' && tmp_i < tmp_max) {
				dernier_visuel = listVisuel2[tmp_i] ;
				tmp_i++;
			}

			for (n = ((this.current_page - 1) * this.slots_per_page); n < ((this.current_page - 1) * this.slots_per_page)
					+ this.slots_per_page; n++) {
				if (listVisuel2[n] == 'empty'
						|| listVisuel2[n] == 'emptyBefore'
						|| n >= listVisuel2.length) {
					if (listVisuel2[n] == 'emptyBefore') {
						span = $('<span></span>').addClass('nolabel').text(
								n + 1);
					} else {
						span = $('<span></span>').addClass('label').text(n + 1);
					}
					li = $('<li></li>').attr({
						'data-index' : n + 1,
						'data-target' : 'number'
					}).addClass(listVisuel2[n]);
					li.append(span);
					GridElement.append(li);
				} else {
					image = $('<img></img>').attr({
						src : listVisuel2[n],
						width : 92,
						height : 52,
						alt : 'Aperçu du timbre pour impression'
					});
					li = $('<li></li>').attr("data-index", n + 1).addClass(
							'active');
					if (listVisuel2[n] != dernier_visuel) {
						// les visuels qui ne correspondent pas au tout dernier se voient attribuer la classe inactive
						li.addClass('inactive');
					}
					li.append(image);
					GridElement.append(li);
				}
			}// end for
			this.grid_element.append(GridElement.html());
		},
		updatePriceByAjax : function() {
			if (this.getAjaxCallback() && this.getAjaxUrl()
					&& this.getAjaxFormId()) {
				F6.UTILS.sendAjaxForm(this.getAjaxFormId(), {
					url : this.getAjaxUrl()
				}, '', this.getAjaxCallback(), '');
			}
		},
		displayPagination : function() {
			var barrePagination = $('.sheetstamps-pagination');
			barrePagination.html('');
			if (this.pagination) {
				barrePagination
						.append('<ol class="horinaja_pagination"></ol></div>');
				var horinajaPagination = $('.horinaja_pagination');
				for (var i = 1; i <= this.max_page; i++) {
					if (i == this.current_page) {
						horinajaPagination.append('<li><span>' + i
								+ '</span></li>')
					} else {
						horinajaPagination.append('<li><a href="#" title="'
								+ Globalize
										.localize("aller à la page", "fr_FR")
								+ '">' + i + '</a></li>')
					}
				}
				$('.horinaja_pagination a').click({
					that : this
				}, function(event) {
					event.preventDefault();
					event.data.that.changePagination($(this).text());
					return false;
				});

			}
		},
		defineTextSheetNumber : function() {
			txt_planche = this.max_page == 1 ? this.max_page + ' '
					+ Globalize.localize("planche", "fr_FR") : this.max_page
					+ ' ' + Globalize.localize("planches", "fr_FR");
			$('.sheetstamp-description').text(
					this.label_num_slots.replace('XX', this.slots_per_page)
							.replace(Globalize.localize("Planche", "fr_FR"),
									txt_planche));
		},
		// Fonction de survol de la grille avec changement de couleur pour les
		// cases vides (qui sont les seules cliquables)
		// modif GJ du 14/02/2017
		mouseHoverGrid : function() {
			/*
			 * Gestion du clic de souris sur cases vides autorisé uniquement sur
			 * cases vides situées après la dernière case contenant un timbre
			 */
			$('#sheet-stamp-list li.empty')
					.mouseenter(function() {
						$(this).addClass('mtel-label-default');
						$(this).prevAll().addClass('mtel-label-default');
					})
					.mouseleave(function() {
						$(this).removeClass('mtel-label-default');
						$(this).prevAll().removeClass('mtel-label-default');
					})
					.click(
							function(event) {
								event.preventDefault();

								var clickTarget = parseInt($(this).attr(
										'data-index'));

								var ptLastActive = $(
										'#sheet-stamp-list li.active').last();
								var idLastActive = parseInt($(ptLastActive)
										.attr('data-index'));

								if (idLastActive < clickTarget) {
									var diffToFill = clickTarget - idLastActive;
									var tmpNombreTimbre = $("#nombreTimbre");
									var newValNbTimbre = parseInt(tmpNombreTimbre
											.val())
											+ diffToFill;
									// déclenchement de l'évènement relatif au
									// nombre de timbres, pour forcer le
									// rafraîchissement de la planche
									tmpNombreTimbre.val(newValNbTimbre)
											.change();
								}
							});
			/*
			 * Gestion du clic de souris sur cases avec timbre autorisé
			 * uniquement sur la dernière page de timbres (en cas de pagination
			 * sur les pages précédentes, pas le clic possible sur les timbres)
			 */
			if (this.current_page == this.max_page) {
				$('#sheet-stamp-list li.active').mouseenter(function() {
					$(this).addClass('cliquable');
					$(this).prevAll().addClass('cliquable');
				}).mouseleave(function() {
					$(this).removeClass('cliquable');
					$(this).prevAll().removeClass('cliquable');
				}).click(
						function(event) {
							event.preventDefault();

							var clickTarget = parseInt($(this).attr(
									'data-index'));

							var ptLastActive = $('#sheet-stamp-list li.active')
									.last();
							var idLastActive = parseInt($(ptLastActive).attr(
									'data-index'));

							if (idLastActive > clickTarget) {
								var diffToFill = idLastActive - clickTarget;
								var tmpNombreTimbre = $("#nombreTimbre");
								var newValNbTimbre = parseInt(tmpNombreTimbre
										.val())
										- diffToFill;
								// déclenchement de l'évènement relatif au
								// nombre de timbres, pour forcer le
								// rafraîchissement de la planche
								if (newValNbTimbre < 1) {
									newValNbTimbre = 1;
								}
								tmpNombreTimbre.val(newValNbTimbre).change();
							}
						});
			}
		},
		commitChanges : function() {
			this.defineSelectedOption();
			this.calculePager();
			this.displayGrid(false);
			this.mouseHoverGrid();
			this.defineTextSheetNumber();
			// $('.complement a.code-planche').attr('href',
			// this.captionurl).text(this.caption);
			$('.complement a.code-planche').text(this.caption);

		},
		setStamps : function(input) {
			// znouaoui
			this.stamps = parseInt(input) + parseInt(window.nbTotalStamps) - 1;
			this.calculePager();
		},
		getStamps : function() {
			return this.stamps;
		},
		setPosition : function(input) {
			this.position = input;
			this.calculePager();
		},
		calculePager : function() {
			this.slots_stamp = this.stamps + this.position - 1;

			// znouaoui -> Watch out IE bug with console.log('calculePager >>
			// this.slots_stamp : ' + this.slots_stamp);

			this.max_page = Math.ceil(this.slots_stamp / this.slots_per_page);
			if (this.slots_per_page <= 0) {
				this.max_page = 24;
			}
			if (this.max_page > 1) {
				this.pagination = true;
			} else {
				this.pagination = false;
			}
			// Affichage message d'erreur si limite du nombre de timbres dépassée
			this.defineTextSheetNumber();
			this.defineArraySlot();
			this.displayPagination();
		},
		getPosition : function() {
			return this.position;
		},
		getSlots : function() {
			return this.slots_per_page;
		},
		getCurrentPage : function() {
			return this.current_page;
		},
		setCurrentPage : function() {
			return this.current_page;
		},
		setPage : function(input) {
			this.current_page = input;
		},
		changePagination : function(input) {
			this.setPage(input);
			this.displayGrid(true);
			this.mouseHoverGrid();
			this.displayPagination();
		}
	});// end F6.UI.SheetstampPicker

	F6.UI.executeSheetstampPicker = function() {

		var Sheetstamp = new F6.UI.SheetstampPicker();// element,
		// initial_value,
		// max_value, tt_inc,
		// tt_dec
		Sheetstamp = F6.AJAX.executeSheetstampPicker(Sheetstamp);
		var counterTimbre = new F6.UI.executeCounterIncremental({
			element : '.counter',
			initial_value : 1,
			max_value : 120,
			tt_inc : Globalize.localize(
					"Augmente le nombre de timbres (XX sur YY actuellement)",
					"fr_FR"),
			tt_dec : Globalize.localize(
					"Diminue le nombre de timbres (XX sur YY actuellement)",
					"fr_FR"),
			link_classes : 'aebk counter-modifier',
			content_link_dec : '-',
			content_link_inc : '+',
			input_position : 'center'

		});
		var counterPosition = new F6.UI.executeCounterIncremental({
			element : '.counter-position',
			initial_value : 1,
			max_value : 24,
			tt_inc : Globalize.localize(
					"Avance le point de départ (XX sur YY actuellement)",
					"fr_FR"),
			tt_dec : Globalize.localize(
					"Recule le point de départ (XX sur YY actuellement)",
					"fr_FR"),
			link_classes : '',
			content_link_dec : '',
			content_link_inc : '',
			input_position : 'center'
		});

		counterPosition.setMaxValue(Sheetstamp.getSlots());
		Sheetstamp.setStamps(counterTimbre.getValue());

		Sheetstamp.setPosition(counterPosition.getValue());
		Sheetstamp.displayGrid(false);
		Sheetstamp.mouseHoverGrid();
		Sheetstamp.updatePriceByAjax();

		Sheetstamp.select_element.bind('change', function(event) {
			event.preventDefault();
			Sheetstamp.commitChanges();
			counterPosition.setMaxValue(Sheetstamp.getSlots());
		});

		counterTimbre.btn_increment
				.bind(
						'click',
						function(event) {
							// znouaoui
							var nbTimbreCurrentVisuel = counterTimbre
									.getValue();
							// if(window.isUpdateMode == true)
							// {
							// nbTimbreCurrentVisuel = nbTimbreCurrentVisuel +
							// 1;
							// }

							if (window.currentVisuel.productType == 'LETTRE_SUIVIE'
									|| window.currentVisuel.productType == 'LETTRE_SUIVIE_INTERNATIONALE'
									|| window.currentVisuel.productType == 'LPIAS'
									|| window.currentVisuel.productType == 'PPIAS'
									|| isWithSuivi || isWithStickerDouane) {
								window.listVisuel[window.currentVisuel.visuelCode] = {
									visuelNumber : (nbTimbreCurrentVisuel * 2),
									visuelUrl : window.currentVisuel.visuelUrl,
									productType : window.currentVisuel.productType
								};
								Sheetstamp
										.setStamps(counterTimbre.getValue() * 2);
							} else {
								window.listVisuel[window.currentVisuel.visuelCode] = {
									visuelNumber : (nbTimbreCurrentVisuel),
									visuelUrl : window.currentVisuel.visuelUrl,
									productType : window.currentVisuel.productType
								};
								Sheetstamp.setStamps(counterTimbre.getValue());
							}
							Sheetstamp.displayGrid(false);
							Sheetstamp.mouseHoverGrid();
							Sheetstamp.updatePriceByAjax();
						});

		counterTimbre.btn_decrement
				.bind(
						'click',
						function(event) {
							// znouaoui
							var nbTimbreCurrentVisuel = counterTimbre
									.getValue();
							// if(window.isUpdateMode == true)
							// {
							// nbTimbreCurrentVisuel = nbTimbreCurrentVisuel +
							// 1;
							// }

							if (window.currentVisuel.productType == 'LETTRE_SUIVIE'
									|| window.currentVisuel.productType == 'LETTRE_SUIVIE_INTERNATIONALE'
									|| window.currentVisuel.productType == 'LPIAS'
									|| window.currentVisuel.productType == 'PPIAS'
									|| isWithSuivi || isWithStickerDouane) {
								window.listVisuel[window.currentVisuel.visuelCode].visuelNumber = nbTimbreCurrentVisuel * 2;
								Sheetstamp
										.setStamps(counterTimbre.getValue() * 2);
							} else {
								window.listVisuel[window.currentVisuel.visuelCode].visuelNumber = nbTimbreCurrentVisuel;
								Sheetstamp.setStamps(counterTimbre.getValue());
							}
							Sheetstamp.displayGrid(false);
							Sheetstamp.mouseHoverGrid();
							Sheetstamp.updatePriceByAjax();
						});

		counterTimbre.input_counter
				.bind(
						'change',
						function(event) {
							// znouaoui
							var nbTimbreCurrentVisuel = counterTimbre
									.getValue();
							if (window.currentVisuel.productType == 'LETTRE_SUIVIE'
									|| window.currentVisuel.productType == 'LETTRE_SUIVIE_INTERNATIONALE'
									|| window.currentVisuel.productType == 'LPIAS'
									|| window.currentVisuel.productType == 'PPIAS'
									|| isWithSuivi || isWithStickerDouane) {
								window.listVisuel[window.currentVisuel.visuelCode] = {
									visuelNumber : (nbTimbreCurrentVisuel * 2),
									visuelUrl : window.currentVisuel.visuelUrl
								};
								Sheetstamp
										.setStamps(counterTimbre.getValue() * 2);
							} else {
								window.listVisuel[window.currentVisuel.visuelCode] = {
									visuelNumber : (nbTimbreCurrentVisuel),
									visuelUrl : window.currentVisuel.visuelUrl
								};
								Sheetstamp.setStamps(counterTimbre.getValue());
							}

							Sheetstamp.displayGrid(false);
							Sheetstamp.mouseHoverGrid();
							Sheetstamp.updatePriceByAjax();
						});

		counterPosition.btn_increment.bind('click', function(event) {
			// znouaoui
			window.startPosition = counterPosition.getValue();

			Sheetstamp.setPosition(counterPosition.getValue());
			Sheetstamp.displayGrid(false);
			Sheetstamp.mouseHoverGrid();
		});

		counterPosition.btn_decrement.bind('click', function(event) {
			// znouaoui
			window.startPosition = counterPosition.getValue();
			Sheetstamp.setPosition(counterPosition.getValue());
			Sheetstamp.displayGrid(false);
			Sheetstamp.mouseHoverGrid();
		});

		counterPosition.input_counter
				.bind(
						'change',
						function(event) {
							// znouaoui
							window.startPosition = counterPosition.getValue();

							if (counterPosition.input_counter.val() > counterPosition.value_max) {
								counterPosition.input_counter
										.val(counterPosition.value_max);
							}

							Sheetstamp.setPosition(counterPosition.getValue());
							Sheetstamp.displayGrid(false);
							Sheetstamp.mouseHoverGrid();
						});

	}

	F6.UI.executeSheetstampPickerData = function(datas) {
		$('.value-total').text(datas.price).append(' &euro;');
		$('.value-total').attr( "content", datas.price + '€' );
	}

	F6.UI.executeCounterIncremental = Class({

		constructor : function(opts) {
			var maxCommandable = 9999;
			var champHidden = document.getElementById("maxCommandable");
			if (champHidden) {
				maxCommandable = champHidden.value;
			}

			this.options = opts;
			this.counter_element = $(this.options['element']);
			this.input_counter = this.counter_element.find('input');

			this.title_decrement = this.options['tt_dec'] ? this.options['tt_dec']
					: Globalize.localize("(XX sur YY actuellement)", "fr_FR");
			this.title_increment = this.options['tt_inc'] ? this.options['tt_inc']
					: Globalize.localize("(XX sur YY actuellement)", "fr_FR");

			this.value = (typeof (this.options['initial_value']) != 'undefined' && this.options['initial_value'] > 1) ? this.options['initial_value']
					: 1;

			this.value_max = (typeof (this.options['max_value']) != 'undefined' && this.options['max_value'] < maxCommandable) ? this.options['max_value']
					: maxCommandable;
			this.input_counter.attr('max_length', this.value_max.length);

			this.reloadValue();

			this.addButton();
			this.btn_decrement = this.counter_element.find('.decrement');
			this.btn_increment = this.counter_element.find('.increment');
			this.defineTitle();

			this.input_counter.keydown($.proxy(this.updateTitle, this));

			this.btn_basket = this.counter_element.parent().find(
					'.btn-basket,.ebkBtnBuyProduct');
			this.btn_basket.bind('click', {
				counter : this
			}, function(event) {
				c = event.data.counter;
				c.initValue();
			});
			this.btn_increment.bind('click', {
				counter : this
			}, function(event) {
				F6.stop(event);
				c = event.data.counter;
				c.incrementValue();
				// if (!$('a.increment').hasClass("counter-modifier")) {
				// $('a.increment').hide();
				// $('a.increment').after("<span class='btn increment'
				// id='incrementTemp'><img
				// src='/_ui/eboutique/images/bg/bg_transverse-circle-inc.png'
				// alt='Augmenter la quantité' width='19' height='19'></span>");
				// setTimeout(function() {
				// $('a.increment').show();
				// $('span#incrementTemp').hide();
				// }, 500);
				// }
			});
			this.btn_decrement.bind('click', {
				counter : this
			}, function(event) {
				F6.stop(event);
				c = event.data.counter;
				c.decrementValue();
				// if (!$('a.increment').hasClass("counter-modifier")) {
				// $('a.decrement').hide();
				// $('a.decrement').after("<span class='btn decrement'
				// id='decrementTemp'><img height='19' width='19' alt='Diminuer
				// la quantité'
				// src='/_ui/eboutique/images/bg/bg_transverse-circle-dec.png'></span>");
				// setTimeout(function() {
				// $('a.decrement').show();
				// $('span#decrementTemp').hide();
				// }, 500);
				// }

			});
			this.input_counter.bind('change', {
				counter : this
			}, function(event) {
				F6.stop(event);
				c = event.data.counter;
				c.reloadValue();
			});
			this.input_counter.keyup({
				counter : this
			}, function(event) {
				F6.stop(event);
				c = event.data.counter;
				c.reloadValue();
			});

			if (typeof (this.options['input_form_id']) != 'undefined') {
				this.setAjaxUrl()
			}
			if (typeof (this.options['input_ajax_url']) != 'undefined') {
				this.setAjaxUrl()
			}
			if (typeof (this.options['input_ajax_callback']) != 'undefined') {
				this.setAjaxUrl()
			}

		},
		updateTitle : function(e) {
			code = e.keyCode;

			if (((code >= 96 && code <= 105) || (code >= 48 && code <= 57))
					|| (code == 9 || code == 8 || code == 36 || code == 37
							|| code == 38 || code == 39 || code == 46)) {
				this.setValue(parseInt(this.input_counter.val()));
				// this.input_counter.val(this.getValue());
				this.defineTitle();
				return true;
			} else {
				return false;
			}
		},
		addButton : function() {
			parent_input = this.input_counter.parent();
			dec_elm = $('<a href="#"></a>').addClass(
					this.options['link_classes']).addClass(
					'decrement').html(
					this.options['content_link_dec']);
			inc_elm = $('<a href="#"></a>').addClass(
					this.options['link_classes']).addClass(
					'increment').html(
					this.options['content_link_inc']);

			if (document.getElementsByClassName('mtel-tab').length > 0) {
					$(dec_elm).addClass('mtel-counter-position');
					$(inc_elm).addClass('mtel-counter-position');
			}

			if (this.options['input_position'] == 'left')
				parent_input.append(dec_elm)
			if (this.options['input_position'] == 'center')
				parent_input.prepend(dec_elm)

			if (this.options['input_position'] == 'rigth') {
				parent_input.prepend(dec_elm);
				parent_input.prepend(inc_elm);
			} else {
				parent_input.append(inc_elm);
			}

		},

		getValue : function() {
			return this.value;
		},
		setValue : function(input) {
			if (input < 1)
				this.value = 1;
			if (input > this.value_max)
				this.value = this.value_max;
			if (input >= 1 && input <= this.value_max)
				this.value = input;
		},
		reloadValue : function() {
			this.setValue(Math.round(this.input_counter.val() * 1));
		},
		debug : function() {
			// znouaoui -> Watch out IE bug with console.log(this.getValue());
		},
		initValue : function() {
			this.setValue(1);
		},
		incrementValue : function() {
			this.setValue(this.value + 1);
			this.input_counter.val(this.getValue());
			this.defineTitle();
		},
		decrementValue : function() {
			this.setValue(this.value - 1);
			this.input_counter.val(this.getValue());
			this.defineTitle();
		},
		defineTitle : function() {
			text_dec = this.title_decrement.replace('XX', this.getValue());
			text_inc = this.title_increment.replace('XX', this.getValue());
			this.btn_decrement.attr('title', text_dec.replace('YY', this
					.getMaxValue()));
			this.btn_increment.attr('title', text_inc.replace('YY', this
					.getMaxValue()));
		},
		setMaxValue : function(input) {
			this.value_max = input * 1;
		},
		getMaxValue : function() {
			return this.value_max;
		}
	});

	F6.UI.counterOptions = Class({
		setOptions : function(opts) {
			this.opts = opts;
		}
	});

	F6.UI.counterEvents = Class({
		bind : function(event, fn) {
			return true;
		},
		unbind : function(event, fn) {
			return false;
		}
	});

	F6.UI.popinVotreAdresse = function() {

		$('.openPopinAdress').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()
            }
        });
	};

	F6.UI.draftData = function(data) {
		var $parent = $('#draftForm').parent();

		$('#draftForm fieldset').animate(
				{
					opacity : 0
				},
				500,
				function() {
					$(this).remove();
					var successMessage = Globalize.localize(
							'brouillon_creation_success', "fr_FR");
					$('<div>' + successMessage + '</div>').prependTo(
							"#draftForm .formContent");
					$('#draftForm .btn-cancel').hide();
					var btnTitle = Globalize.localize("Fermer la fenètre",
							"fr_FR");
					$('#draftForm .btn-send input').val(btnTitle).attr('title',
							btnTitle).unbind('click').click(function(e) {
						e.preventDefault();
						$.fancybox.close();
					});
				});
	}

	F6.UI.popinEnregistrerBrouillons = function() {
		$('#enregistrer-brouillons').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### P');
                $('#draftForm #draft_name').focus();
                F6.VALIDATIONS.enregistrerBrouillon();
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()
            }
        });
	};

	F6.UI.popStampzoom = function() {};

	F6.UI.callbackSpecimenData = function(data) {
	};

	F6.UI.executeDymoSelector = function() {
		var counterTimbre = new F6.UI.executeCounterIncremental(
				{
					element : '.counter',
					initial_value : 1,
					max_value : 120,
					tt_inc : Globalize.localize(
							"Augmente le nombre de timbres (XX actuellement)",
							"fr_FR"),
					tt_dec : Globalize.localize(
							"Diminue le nombre de timbres (XX actuellement)",
							"fr_FR"),
					link_classes : 'aebk counter-modifier',
					content_link_dec : '-',
					content_link_inc : '+',
					input_position : 'center'
				});
		F6.AJAX.DymoSelectorAjax();
		counterTimbre.btn_increment.bind('click', function(event) {
			F6.AJAX.DymoSelectorAjax();
		});
		counterTimbre.btn_decrement.bind('click', function(event) {
			F6.AJAX.DymoSelectorAjax();
		});
		$('#nombreTimbre').bind('change', function(event) {
			F6.AJAX.DymoSelectorAjax();
		});
	}

	F6.UI.DymoSelectorData = function(datas) {
		$('.remote-attribute-price .value-total').text(datas.price).append(' &euro;');
	};
	// remove hourglass from PostPayment page
	F6.UI.postPaymentPageCallback = function(data) {
		if (data != undefined) {
			if (data.state == 'noDataFind'
					|| data.state == 'ErrorWileCallingCsNotification') {
				$('#postPaymentProgressBar').addClass("noneDisplayToutDeatil");
				$('#sendNotificationsError').css('display', 'block');
			}
			if (data.state == 'success') {
				if (data.lsNumber <= data.index) {
					var text = "Inscription au suivi par<br/>email en cours...<br/>"
							+ data.index + "/" + data.lsNumber;
					$('#postPaymentProgressBar span.pbText').html(text);
					setTimeout(function() {
						$('#postPaymentProgressBar').addClass(
								"noneDisplayToutDeatil")
					}, 1000);
					return;
				} else {
					var text = "Inscription au suivi par<br/>email en cours...<br/>"
							+ data.index + "/" + data.lsNumber;
					$('#postPaymentProgressBar span.pbText').html(text);
					F6.AJAX.getPostPaymentPageAjax(data.orderCode, data.index);
				}
			}
		}
	};
	/**
	 * znouaoui Inserer expeditaire MTEL
	 */
	F6.UI.executeMTELInsererExpeditaire = function() {

		// lancement de la fancybox pour l'adresse exp
		$('#inserer-votre-adresse').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### Q');
                F6.UI.executeMTELPopinLinks2(instance);
                // N?cessit? d'accessiblit?
                $('#fancybox-frame').attr('title', Globalize.localize("Ajouter des destinataires","fr_FR"));
            },
            baseTpl : Popup.template(),
            touch: false,
            momentum: false,
            smallBtn: false,
            clickOutside: false
        });
	}

	// iomari fusion steps
	F6.UI.executeLrelInsererExpeditaire = function() {
		// lancement de la fancybox pour l'adresse exp
		$('#inserer-votre-adresse').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### R');
                $('.fancybox-slide').unbind('mousewheel.fb');
                $(".fancybox-container .blockPopin form label:first").focus();
                F6.UI.executeLrelPopinLink($.fancybox);
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template(),
                afterShow : function(instance) { console.log('### R!');
                    $('.fancybox-slide').unbind('mousewheel.fb');
                    $(".fancybox-container .blockPopin form label:first").focus();
                    F6.UI.executeLrelPopinLink($.fancybox);
                }
            }
        });
	}

	// znouaoui
	F6.UI.executeMTELPopinLinks2 = function(fancybox) {

		// re-initalisation des ?l?ments html
		F6.UI.activeBodyFullJS();
		F6.UI.mtelDestinataireTabsRemove();
		F6.UI.activeUniform();

		var actionSubmitHandler = function(form) {
            console.log('actionSubmitHandler');
			if ($('input[name=lastName]').val()) {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.MTELAddPartExp(form);
				$('.btn-send input').removeAttr('disabled');
			} else {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.MTELAddProExp(form);
				$('.btn-send input').removeAttr('disabled');
			}

		};
		if ($('#coordonneesParticulier').length > 0) {

			var particuliers_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
			// F6.UI.hideAndShowAddressPartAndProForm();
		}
		if ($('#coordonneesProfessionnel').length > 0) {
			var professionnel_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
		}
	}

    F6.UI.executeMultiColisPopinLink = function(fancybox) {
        // re-initalisation des éléments html
        // F6.UI.activeBodyFullJS();
        // F6.UI.mtelDestinataireTabsRemove();
        // F6.UI.activeUniform();

        var envTgt = $("#refontecolissimo #envTarget").val();

        var actionSubmitHandler = function(form) {

        	if (envTgt == 'pro') {
        		F6.AJAX.MultiColisAddPartExp(form,true);
        	}else{
        		F6.AJAX.MultiColisAddPartExp(form,false);
        	}

        };
        if (envTgt == 'pro') {

            var  professionnel_form = F6.VALIDATIONS
                .formCoordonneesExpediteurPro($('#addAddressForm'));
            professionnel_form.settings.submitHandler = actionSubmitHandler;
            // F6.UI.activeSelectDestinataireForms();
            // F6.UI.hideAndShowAddressPartAndProForm();
        }
        else {
            var particuliers_form = F6.VALIDATIONS
                .formCoordonneesExpediteurPart($('#addAddressForm'));
            particuliers_form.settings.submitHandler = actionSubmitHandler;
            // F6.UI.activeSelectDestinataireForms();
        }
    }

    F6.UI.executeMultiColisPopinLinkDest = function(fancybox, index) {

        // re-initalisation des éléments html
        // F6.UI.activeBodyFullJS();
        // F6.UI.mtelDestinataireTabsRemove();
        // F6.UI.activeUniform();

        var envTgt = $("#refontecolissimo #envTarget").val();
        if (envTgt == 'pro') {
            $("#proAddressDiv").show();
            $("#partAddressDiv").hide();
            $('#destinatairepro').prop('checked', true);
            isProDestinataireMC("proAddressDiv", false);
            isProDestinataireMC("partAddressDiv", true);
        }
        else {
            $("#proAddressDiv").hide();
            $("#partAddressDiv").show();
            isProDestinataireMC("proAddressDiv", true);
            isProDestinataireMC("partAddressDiv", false)
		}


        var actionSubmitHandler = function(form) {

            F6.AJAX.MultiColisAddDest(form, index);

        };
        // if (envTgt == 'pro') {

        var professionnel_form = F6.VALIDATIONS
            .formCoordonneesExpediteurPro($('#proAddressDiv #addAddressForm'));
        professionnel_form.settings.submitHandler = actionSubmitHandler;
        // F6.UI.activeSelectDestinataireForms();
        // F6.UI.hideAndShowAddressPartAndProForm();
        // }
        // else {
        var particuliers_form = F6.VALIDATIONS
            .formCoordonneesExpediteurPart($('#partAddressDiv #addAddressForm'));
        particuliers_form.settings.submitHandler = actionSubmitHandler;
        // F6.UI.activeSelectDestinataireForms();
        // }
    }

    F6.UI.executeMultiColisPopinLinkEditDest = function(fancybox, index) {

        // re-initalisation des éléments html
//        F6.UI.activeBodyFullJS();
//        F6.UI.mtelDestinataireTabsRemove();
//        F6.UI.activeUniform();

        var envTgt = $("#refontecolissimo #envTarget").val();

        var isPro = Datamap.Colis.detail[index].get("isProDest");

        if (isPro == 'true') {


            $("#proAddressDiv").show();
            $("#partAddressDiv").hide();
            $('#destinatairepro').prop('checked', true);
            isProDestinataireMC("proAddressDiv", false);
            isProDestinataireMC("partAddressDiv", true);

            if(Datamap.Colis.detail[index].get("titleDest") == 'mrs')
            {
                $('#civiliteMme').prop( "checked", true );
            }
            else
            {
                $('#civiliteMr').prop( "checked", true );
            }
            $('#addAddressForm').find("input[name='raisonSociale']").val(Datamap.Colis.detail[index].get("nomdest"));
            $('#addAddressForm').find("input[name='service']").val(Datamap.Colis.detail[index].get("serviceDest"));
            $('#addAddressForm').find("input[name='firstName']").val(Datamap.Colis.detail[index].get("prenomDest"));
            $('#addAddressForm').find("input[name='lastName']").val(Datamap.Colis.detail[index].get("nomDest"));

        }
        else
		{
        	$("#proAddressDiv").hide();
            $("#partAddressDiv").show();
            $('#destinatairepro').prop('checked', false);
            isProDestinataireMC("proAddressDiv", true);
            isProDestinataireMC("partAddressDiv", false);

            if(Datamap.Colis.detail[index].get("titleDest") == 'mrs')
            {
                $('#partciviliteMme').prop( "checked", true );
                $('#civiliteMme').prop( "checked", true );
            }
            else
            {
                $('#partciviliteMr').prop( "checked", true );
                $('#civiliteMr').prop( "checked", true );
            }

            $('#addAddressForm').find("input[name='firstName']").val(Datamap.Colis.detail[index].get("prenomDest"));
            $('#addAddressForm').find("input[name='lastName']").val(Datamap.Colis.detail[index].get("nomDest"));
            $('#addAddressForm').find("input[name='appartement']").val(Datamap.Colis.detail[index].get("etagedest"));
		}


        $('#addAddressForm').find("input[name='addressId']").val(Datamap.Colis.detail[index].get("addressIdDest"));
        $('#addAddressForm').find("input[name='batiment']").val(Datamap.Colis.detail[index].get("batimentdest"));
        $('#addAddressForm').find("input[name='numLibelle']").val(Datamap.Colis.detail[index].get("ruedest"));
        $('#addAddressForm').find("input[name='lieuDit']").val(Datamap.Colis.detail[index].get("lieuditdest"));
        $('#addAddressForm').find("input[name='codePostal']").val(Datamap.Colis.detail[index].get("cpdest"));
        $('#addAddressForm').find("input[name='localite']").val(Datamap.Colis.detail[index].get("villedest"));
        $('#addAddressForm').find("input[name='phone']").val(Datamap.Colis.detail[index].get("teldest"));
        $('#addAddressForm').find("input[name='email']").val(Datamap.Colis.detail[index].get("maildest"));


        var msgNonValid = $("#addDestNoValid_" + index + "_").find("span").text();

        if( msgNonValid != "")
        {
			if(Datamap.Colis.detail[index].get("cpdest") != "")
			{
				var masgError = "L’adresse que vous avez saisie n’a pas été reconnue. Veuillez corriger votre adresse";
				$("#error-coordonnees").show();
                $("#error-coordonnees").html(masgError);
                $('#addAddressForm').find("input[name='numLibelle']").parent().parent().parent().addClass("error-contener");
                $('#addAddressForm').find("input[name='codePostal']").parent().parent().parent().addClass("error-contener");
                $('#addAddressForm').find("input[name='localite']").parent().parent().parent().addClass("error-contener");
			}
			else
			{
				var msgError = "<p for=\"codePostal\" generated=\"true\" class=\"error\">Le code postal est obligatoire</p>";
                $('#addAddressForm').find("input[name='codePostal']").parent().parent().parent().before(msgError);
                $('#addAddressForm').find("input[name='codePostal']").parent().parent().parent().addClass("error-contener");
			}
        }



        var actionSubmitHandler = function(form) {

            F6.AJAX.MultiColisEditDest(form, index);

        };
        // if (envTgt == 'pro') {

            var professionnel_form = F6.VALIDATIONS
                .formCoordonneesExpediteurPro($('#proAddressDiv #addAddressForm'));
        professionnel_form.settings.submitHandler = actionSubmitHandler;
            // F6.UI.activeSelectDestinataireForms();
            // F6.UI.hideAndShowAddressPartAndProForm();
        // }
        // else {
            var particuliers_form = F6.VALIDATIONS
                .formCoordonneesExpediteurPart($('#partAddressDiv #addAddressForm'));
        particuliers_form.settings.submitHandler = actionSubmitHandler;
            // F6.UI.activeSelectDestinataireForms();
        // }
    }

	F6.UI.executeAELPopinLink = function(fancybox) {

		// re-initalisation des éléments html
		F6.UI.activeBodyFullJS();
		F6.UI.mtelDestinataireTabsRemove();
		F6.UI.activeUniform();

		var actionSubmitHandler = function(form) {

			if ($('input[name=isPro]').val() == "false") {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.AELAddPartExp(form);
				$('.btn-send input').removeAttr('disabled');
			} else {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.AELAddProExp(form);
				$('.btn-send input').removeAttr('disabled');
			}

		};
		if ($('#coordonneesParticulier').length > 0) {

			var particuliers_form = F6.VALIDATIONS
					.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
			// F6.UI.hideAndShowAddressPartAndProForm();
		}
		if ($('#coordonneesProfessionnel').length > 0) {
			var professionnel_form = F6.VALIDATIONS
					.formCoordonneesDestinataireProfessionnel();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
		}
	}
	F6.UI.executeAELDestinatairePopinLink = function(fancybox) {

		// re-initalisation des ?l?ments html
		F6.UI.activeBodyFullJS();
		F6.UI.mtelDestinataireTabsRemove();
		F6.UI.activeUniform();

		var actionSubmitHandler = function(form) {

			if ($('input[name=formProSelected]').val() == "true") {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.AELAddProDES(form);
				$('.btn-send input').removeAttr('disabled');
			} else {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.AELAddPartDES(form);
				$('.btn-send input').removeAttr('disabled');
			}

		};
		if ($('#coordonneesParticulier').length > 0) {

			var particuliers_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
			// F6.UI.hideAndShowAddressPartAndProForm();
		}
		if ($('#coordonneesProfessionnel').length > 0) {
			var professionnel_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
		}
	}

	// znouaoui :: Callback
	F6.UI.MTELUpdateExpeditaire = function(data) {
		var error = false;
		// Mascadia Control !!
		if (data.addressData != null
				&& data.addressData.mascadiaResponse != null
				&& (data.addressData.mascadiaResponse.ligne6Flag || data.addressData.mascadiaResponse.ligne4Flag)) {
			F6.UI.mascadiaError(data.addressData.mascadiaResponse, data.form);
			isMascadiaError = true;
			error = true;
		}

		if (error == false) {
			if (data != null && data.addressData != null
					&& data.addressData !== undefined) {
				$('#expediteur-address-2').empty();
				$('#expediteur-address-2')
						.html(
								"<p class='mtel-step2-exp-address spBottom-xxsmall'>"
										+ data.addressData.addressName
										+ " <br/><br/>"
										+ data.addressData.streetNumber
										+ " <br/><br/>"
										+ data.addressData.town
										+ "<em> </em>"
										+ data.addressData.postalCode
										+ "</p>"
										+ "<a href='"+EBK.config.contextPath+"/mon-timbre-en-ligne/support-impression/enveloppes/inserer-expeditaire?isAjax=true' id='inserer-votre-adresse' class='mtel-step2-specimen-link' title='Afficher le formulaire : Modifier votre adresse'><i class='mtel-icon-specimen-link'></i>Modifier</a>");
				F6.UI.executeMTELInsererExpeditaire();
				$.fancybox.close();
			}

			if (data.error != null && data.error != undefined && data.error) {

				var errorLabel = '<label class="error">' + data.message
						+ '</label>';
				if (data.pro) {
					$('#error-coordonnees-pro').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-pro').show();
				} else {
					$('#error-coordonnees-part').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-part').show();
				}
				return;
			}
		}
	}

	// controle multicolis : callback
    F6.UI.MultiColisAddExp = function(data) {
        var error = false;
        var isRangeError = false;
        var isMascadiaError = false;
        // Mascadia Control !!
        if (data.addressData != null
            && data.addressData.mascadiaResponse != null
            && (data.addressData.mascadiaResponse.ligne6Flag || data.addressData.mascadiaResponse.ligne4Flag)) {
            // F6.UI.mascadiaError(data.addressData.mascadiaResponse, data.form);
            isMascadiaError = true;
            error = true;
        }

        // Range Control !!
        if (data.addressData != null
            && data.addressData.warnImportAddress != null
			&& data.addressData.warnImportAddress != false) {
            isRangeError = true;
            error = true;
        }

        if(data.error != null && data.error)
		{
            // var errorMessage = "<span>error 38.</span>";
            // $('#error-coordonnees').show();
            // $('#errorBindingUL').html(data.message);
            // $("input[name='titleCode'").parent().parent().parent().addClass(
            //     'error-contener');
            $("#error38").html(data.addressData.msgErrorForColis);
            $('#firstName').parent().parent().parent().addClass(
                'error-contener');
            $('#lastName').parent().parent().parent().addClass(
                'error-contener');
			error = true;
            isMascadiaError = false;
            isRangeError = false;
		}
		else {
            $("#error38").html("");
		}

        // if (error == false) {
            if (error == false && data != null && data.addressData != null
                && data.addressData !== undefined && data.message == null) {
                 // window.location.href = F6.UTILS.getColissimoLink()
                 //     + "/creez-vos-etiquettes-envois-multiples-de-colis";

                var parentDocument = window.parent.document;

                $("#nomprenomexp").html("");
                $("#batimentexp").html("");
                $("#rueexp").html("");
                $("#lieuditexp").html("");
                $("#cpvilleexp").html("");
                $("#paysexp").html("");
                $("#telexp").html("");

                if($("#multicolisuninfoscommunes").data('is-customer-sign-up'))
				{
                    $('#toIsoCode option[value=Ajouter]', parentDocument).attr('selected','selected');
                    $(".ajouterAdresseExpLinkOne").show();
                    $(".ajouterAdresseLink").hide();

                    $(".alertcolis").hide();
                    $("#addressExpIsConnect").show();

				}
				else
				{

					$("#addressExp").show();
					$("#ajouterAdresseExpLinkDiv").show();
					$("#addAddressExpLinkDiv").hide();

				}

                if(data.addressData.pro)
                {
                    $("#raisonsocialeexp").html(data.addressData.companyName);
                    $("#serviceexp").html(data.addressData.service);
                    if(data.addressData.firstName != undefined && data.addressData.firstName != ""
                        && data.addressData.lastName != undefined && data.addressData.lastName != "")
                    {
                        $("#nomprenomexp").html((data.addressData.titleCode === 'mr' ? 'M.' : 'MME') + " "+ data.addressData.firstName + " "+ data.addressData.lastName );
                    }

                    $("input[name='addressFormExpPro.titleCode']").val(data.addressData.titleCode);
                    $("input[name='addressFormExpPro.raisonSociale']").val(data.addressData.companyName);
                    $("input[name='addressFormExpPro.lastName']").val(data.addressData.lastName);
                    $("input[name='addressFormExpPro.firstName']").val(data.addressData.firstName);
                    $("input[name='addressFormExpPro.numLibelle']").val(data.addressData.streetNumber);
                    $("input[name='addressFormExpPro.codePostal']").val(data.addressData.postalCode);
                    $("input[name='addressFormExpPro.service']").val(data.addressData.service);
                    $("input[name='addressFormExpPro.batiment']").val(data.addressData.building);
                    $("input[name='addressFormExpPro.lieuDit']").val(data.addressData.pobox);
                    $("input[name='addressFormExpPro.phone']").val(data.addressData.phone);
                    $("input[name='addressFormExpPro.localite']").val(data.addressData.town);
                }
                else {
                    $("#etageexp").html(data.addressData.appartment);
                    $("#nomprenomexp").html((data.addressData.titleCode === 'mr' ? 'M.' : 'MME') + " "+ data.addressData.firstName + " "+ data.addressData.lastName );

                    $("input[name='addressFormExpPart.titleCode']").val(data.addressData.titleCode);
                    $("input[name='addressFormExpPart.lastName']").val(data.addressData.lastName);
                    $("input[name='addressFormExpPart.firstName']").val(data.addressData.firstName);
                    $("input[name='addressFormExpPart.numLibelle']").val(data.addressData.streetNumber);
                    $("input[name='addressFormExpPart.codePostal']").val(data.addressData.postalCode);
                    $("input[name='addressFormExpPart.appartement']").val(data.addressData.appartment);
                    $("input[name='addressFormExpPart.batiment']").val(data.addressData.building);
                    $("input[name='addressFormExpPart.lieuDit']").val(data.addressData.pobox);
                    $("input[name='addressFormExpPart.phone']").val(data.addressData.phone);
                    $("input[name='addressFormExpPart.localite']").val(data.addressData.town);
                }

                $("#batimentexp", parentDocument).html(data.addressData.building);
                $("#rueexp", parentDocument).html(data.addressData.streetNumber);
                $("#lieuditexp", parentDocument).html(data.addressData.pobox);
                $("#cpvilleexp", parentDocument).html(data.addressData.postalCode + " " + data.addressData.town);
                $("#paysexp", parentDocument).html(data.addressData.country.name);
                $("#telexp", parentDocument).html(data.addressData.phone);

                $('#isExpAddressFilled',parentDocument).val(true);
                $('#noExpAddressDefinedErrorMessage',parentDocument).hide();
                $.fancybox.close();
            }

            if (error) {

                var errorLabel = data.addressData.msgErrorForColis;
                // var errorMessage = "<span>Les informations que vous avez fournies ne vous permettent pas <br>d’accéder à l’étape suivante.<br\>" +
                //     "Merci de modifier votre saisie à partir des indications de couleur rouge, <br>positionnées près des erreurs correspondantes.</span>";

                if (data.addressData != null) {
                    $("#errorBindingUL").html(errorLabel);
                    $('#error-coordonnees').show();
                    $('#error-coordonnees').html(errorLabel);


                    if (isRangeError) {
                        $('#codePostal').parent().parent().parent().addClass(
                            'error-contener');
                    }
                    if (isMascadiaError) {
                        $('#codePostal').parent().parent().parent().addClass(
                            'error-contener');
                        $('#numLibelle').parent().parent().parent().addClass(
                            'error-contener');
                        $('#localite').parent().parent().parent().addClass(
                            'error-contener');
                    }

                }
                return;
            }
        // }
    }

    // controle multicolis : callback
    F6.UI.MultiColisAddDest = function(data) {
        var error = false;
        // var data = data.data;
        var isRangeError = false;
        var isMascadiaError = false;
        // Mascadia Control !!
        if (data.data.addressData != null
            && data.data.addressData.mascadiaResponse != null
            && (data.data.addressData.mascadiaResponse.ligne6Flag || data.data.addressData.mascadiaResponse.ligne4Flag)) {
            // F6.UI.mascadiaError(data.addressData.mascadiaResponse, data.form);
            isMascadiaError = true;
            error = true;
        }

        // Range Control !!
        if (data.data.addressData != null
            && data.data.addressData.warnImportAddress != null
            && data.data.addressData.warnImportAddress != false) {
            isRangeError = true;
            error = true;
        }

        if(data.data.error != null && data.data.error)
        {
            // var errorMessage = "<span>error 38.</span>";
            // $('#error-coordonnees').show();
            // $('#errorBindingUL').html(data.message);
            // $("input[name='titleCode'").parent().parent().parent().addClass(
            //     'error-contener');
            $("#error38").html(data.data.addressData.msgErrorForColis);
            $('#firstName').parent().parent().parent().addClass(
                'error-contener');
            $('#lastName').parent().parent().parent().addClass(
                'error-contener');
            error = true;
            isMascadiaError = false;
            isRangeError = false;
        }
        else {
            $("#error38").html("");
        }

        // if (error == false) {
        if (error == false && data.data != null && data.data.addressData != null
            && data.data.addressData !== undefined && data.data.message == null) {

            var address = data.data.addressData;
            var idx_max = data.information;
            var form = "addressFormDestPart";

            Datamap.Colis.detail[idx_max].set("addressIdDest",address.id);
            if(address.companyName != undefined)
            {
            	form = "addressFormDestPro";
            	removeAddressFormByType("addressFormDestPart", idx_max,false)
            	createAddressFormByType(form, idx_max,true);

                Datamap.Colis.detail[idx_max].set("nomdest",address.companyName.toUpperCase());
                var title = '';
                if(address.titleCode == 'mr')
				{
                    title = "M. ";
				}
				else if(address.titleCode =='mrs')
				{
                    title = "MME ";
				}
				if(address.firstName != undefined && address.firstName != ""
						&& address.lastName != undefined && address.lastName != "")
				{
                    Datamap.Colis.detail[idx_max].set("nomPrenomProDest", title +address.firstName+" "+address.lastName);
				}
                Datamap.Colis.detail[idx_max].set("serviceDest",address.service);
                Datamap.Colis.detail[idx_max].set("etagedest","");
                Datamap.Colis.detail[idx_max].set("isProDest","true");

                $("input[name='labels[" + (idx_max - 1) + "]." + form + ".raisonSociale']").val(address.companyName);
                $("input[name='labels[" + (idx_max - 1) + "]." + form + ".service']").val(address.service);

            }else
            {
            	removeAddressFormByType("addressFormDestPro", idx_max,true)
            	createAddressFormByType(form, idx_max,false);
                var title = '';
                if(address.titleCode == 'mr')
                {
                    title = "M. ";
                }
                else if(address.titleCode =='mrs')
                {
                    title = "MME ";
                }
                Datamap.Colis.detail[idx_max].set("nomdest",title+address.firstName+" "+address.lastName);
                Datamap.Colis.detail[idx_max].set("isProDest","false");

                Datamap.Colis.detail[idx_max].set("nomPrenomProDest", "");
                Datamap.Colis.detail[idx_max].set("serviceDest","");
                Datamap.Colis.detail[idx_max].set("etagedest",address.appartment);
                $("input[name='labels[" + (idx_max - 1) + "]." + form + ".appartement']").val(address.appartment);
            }

            Datamap.Colis.detail[idx_max].set("batimentdest",address.building);
            Datamap.Colis.detail[idx_max].set("ruedest",address.streetNumber);
            Datamap.Colis.detail[idx_max].set("lieuditdest",address.pobox);
            Datamap.Colis.detail[idx_max].set("cpvilledest",address.postalCode +" "+address.town);

            Datamap.Colis.detail[idx_max].set("paysdest",address.country.name ? address.country.name : 'FRANCE MÉTROPOLITAINE' );
            Datamap.Colis.detail[idx_max].set("teldest",address.phone);
            Datamap.Colis.detail[idx_max].set("maildest",address.email);

            // champs hidden
            Datamap.Colis.detail[idx_max].set("titleDest",address.titleCode);
            Datamap.Colis.detail[idx_max].set("nomDest",address.lastName);
            Datamap.Colis.detail[idx_max].set("prenomDest",address.firstName);
            Datamap.Colis.detail[idx_max].set("ldDest",address.pobox);
            Datamap.Colis.detail[idx_max].set("villedest",address.town);
            Datamap.Colis.detail[idx_max].set("cpdest",address.postalCode);


            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".titleCode']").val(address.titleCode);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".lastName']").val(address.lastName);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".firstName']").val(address.firstName);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".numLibelle']").val(address.streetNumber);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".codePostal']").val(address.postalCode);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".localite']").val(address.town);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".batiment']").val(address.building);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".lieuDit']").val(address.pobox);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".phone']").val(address.phone);
            $("input[name='labels[" + (idx_max - 1) + "]." + form + ".email']").val(address.email);

            if(address.email != undefined && address.email != "")
			{
                $("#infoEmailDest_" + idx_max + "_").show();
                $("#preventEmail_" + idx_max + "_").prop("checked", true);
                $("#preventEmail_" + idx_max + "_").prop("value", true);
			}
			else
			{
                $("#infoEmailDest_" + idx_max + "_").hide();
                $("#preventEmail_" + idx_max + "_").prop("checked", false);
                $("#preventEmail_" + idx_max + "_").prop("value", false);
			}



            // supression msg adresse destination non valide
            $('#addDestNoValid_' + idx_max + '_').remove();
            // suppression msg adresse destination non renseigné
            $('#addDestNotDefined_' + idx_max + '_').remove();
            if(Datamap.Colis.detail[idx_max].get("addressIdDest") != undefined && Datamap.Colis.detail[idx_max].get("addressIdDest") != "" )
			{
                $("#adresseEnregistree_" + idx_max + "_").show();
                $("#enregistrerCarnetAdresse_" + idx_max + "_").hide();
                $("#saveDestAddress_" + idx_max + "_").removeAttr("checked");
                $("#saveDestAddress_" + idx_max + "_").prop("value", false);
                $("#enregistrerCarnetAdresse_" + idx_max + "_").data("is-new-address", false);
			}
			else
			{
                $("#adresseEnregistree_" + idx_max + "_").hide();
                $("#enregistrerCarnetAdresse_" + idx_max + "_").show();
                $("#saveDestAddress_" + idx_max + "_").removeAttr("checked");
                $("#saveDestAddress_" + idx_max + "_").prop("value", false);
			}

            $("#multiColisAddressDestPopin_" + idx_max + "_").attr("onclick", $("#multiColisAddressDestPopin_" + idx_max + "_").attr("onclick").replace('openMultiColisAddNewAddressDestPopin','openMultiColisEditAddressDestPopin'));

            $.fancybox.close();
        }

        if (error) {

            var errorLabel = data.data.addressData.msgErrorForColis;
            // var errorMessage = "<span>Les informations que vous avez fournies ne vous permettent pas <br>d’accéder à l’étape suivante.<br\>" +
            //     "Merci de modifier votre saisie à partir des indications de couleur rouge, <br>positionnées près des erreurs correspondantes.</span>";

            if (data.data.addressData != null) {
                $("#errorBindingUL").html(errorLabel);
                $('#error-coordonnees').show();
                $('#error-coordonnees').html(errorLabel);

                var blocForm = "#partAddressDiv";
                if(data.data.addressData.pro)
				{
					blocForm = "#proAddressDiv";
				}


                if (isRangeError) {
                    $(blocForm + ' #codePostal').parent().parent().parent().addClass('error-contener');
                }
                if (isMascadiaError) {
                    $(blocForm + ' #codePostal').parent().parent().parent().addClass('error-contener');
                    $(blocForm + ' #numLibelle').parent().parent().parent().addClass('error-contener');
                    $(blocForm + ' #localite').parent().parent().parent().addClass('error-contener');
                }

            }
            return;
        }
        // }
    }

	F6.UI.AelAddressUpdate = function(data) {
		var error = false;
		// Mascadia Control !!
		if (data.addressData != null
				&& data.addressData.mascadiaResponse != null
				&& (data.addressData.mascadiaResponse.ligne6Flag || data.addressData.mascadiaResponse.ligne4Flag)) {
			F6.UI.mascadiaError(data.addressData.mascadiaResponse, data.form);
			isMascadiaError = true;
			error = true;
		}

		if (error == false) {
			if (data != null && data.addressData != null
					&& data.addressData !== undefined && data.message == null) {
				window.location.href = F6.UTILS.getColissimoLink()
						+ "/votre-envoi";
				$.fancybox.close();
			}

			if (data.error != null && data.error != undefined && data.error) {

				var errorLabel = '<label class="error">' + data.message
						+ '</label>';
				if (data.addressData != null && data.addressData.pro) {
					$('#error-coordonnees-pro').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-pro').show();
					if (data.addressData != null) {
						if (data.addressData.phone === 'error') {
							$('#phonee').parent().parent().addClass(
									'error-contener');
						}
					}
					if (data.message.indexOf("postal") != -1) {
						$('#codePostalPro').parent().parent().addClass(
								'error-contener');
					}

				} else {
					$('#error-coordonnees-part').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-part').show();
					if (data.addressData != null) {
						if (data.addressData.phone === 'error') {
							$('#phoneee').parent().parent().addClass(
									'error-contener');
						}
					}
					if (data.message.indexOf("postal") != -1) {
						$('#codePostal').parent().parent().addClass(
								'error-contener');
					}

				}
				return;
			}
		}
	}

	/** *************************************** */
	/** Vignette recommandée en ligne VREL * */
	/** *************************************** */
	// 1 : On change depart
	F6.UI.updateWeightForVrel = function() {

		F6.AJAX.getVignetteWeight();

		$('#formDepartVignette').change(function() {
			// $('#formPoids').html("");
			if ($.uniform.update) {
				$.uniform.update();
			}
			F6.AJAX.getVignetteWeight();
		});
		// 2 : On change Destination
		$('#formDestinationVignette').change(function() {
			// $('#formPoids').html("");
			if ($.uniform.update) {
				$.uniform.update();
			}
			F6.AJAX.getVignetteWeight();

		});
	};

	// VREL : call back get weights

	F6.UI.callbackWeightsVRELProductsData = function(data) {
		var valueSelected = null;
		if ($("#formPoids").val() != undefined) {
			valueSelected = $("#formPoids").val().split('_')[2]
					.replace("g", "");
		}
		$('#formPoids').html("");
		if ($.uniform.update) {
			$.uniform.update();
		}

		if (data.listOfWeight != undefined) {
			for (i = 0; i < data.listOfWeight.length; i++) {
				if (data.listOfWeight[i].code == data.selectedWeightCode
						|| data.listOfWeight[i].max == valueSelected) {
					$('#formPoids').append(
							'<option modulo=' + data.listOfWeight[i].modulo
									+ ' value="' + data.listOfWeight[i].code
									+ '" selected="selected">'
									+ data.listOfWeight[i].label + '</option>');
				} else {
					$('#formPoids').append(
							'<option modulo=' + data.listOfWeight[i].modulo
									+ ' value="' + data.listOfWeight[i].code
									+ '">' + data.listOfWeight[i].label
									+ '</option>');
				}

			}
			displayKnowMoreLink();
			if ($.uniform.update) {
				$.uniform.update();
			}
		}

	}

	F6.UI.executeVRELPopinLink = function(fancybox) {
		// re-initalisation des ?l?ments html
		F6.UI.activeBodyFullJS();
		F6.UI.mtelDestinataireTabsRemove();
		F6.UI.activeUniform();

		var actionSubmitHandler = function(form) {
			$('.btn-send input').attr('disabled', 'disabled');
			F6.AJAX.VRELAddPartExp(form);
			$('.btn-send input').removeAttr('disabled');
		};

		if ($('#coordonneesParticulier').length > 0) {

			var particuliers_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
			// F6.UI.hideAndShowAddressPartAndProForm();
		}
		if ($('#coordonneesProfessionnel').length > 0) {
			var professionnel_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
		}

        $("#ajouter-destinataire").submit(function( event ) {
            var table = document.getElementsByName("contacts[]");
            for(var i = 0; i < table.length; i++){
                if(table[i].checked){
                    F6.AJAX.VRELAddBookDES($("#ajouter-destinataire"));
                    return false;
                }
            }
            $("#addressBookErrorMessage").html("Veuillez s\351lectionner un contact.");
            return false;
        });
	}

	/**
	 * iomari ouverture de la popin LREL expediteur.
	 */
	F6.UI.executeLrelPopinLink = function(fancybox) {
		// re-initalisation des ?l?ments html
		F6.UI.activeBodyFullJS();
		F6.UI.mtelDestinataireTabsRemove();
		F6.UI.activeUniform();

		var actionSubmitHandler = function(form) {
			$('.btn-send input').attr('disabled', 'disabled');
			if (EBK.config.contextPath == ""){ // ($('#coordonneesParticulier').length > 0) {
                F6.AJAX.LRELAddPartExp(form);
			} else {
                F6.AJAX.LRELAddProExp(form);
			}

			$('.btn-send input').removeAttr('disabled');
		};

		if(EBK.config.contextPath == ""){// ($('#coordonneesParticulier').length > 0) {

			var particuliers_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
			// F6.UI.hideAndShowAddressPartAndProForm();
		}
        if(EBK.config.contextPath == "/professionnel"){ // ($('#coordonneesProfessionnel').length > 0) {
			var professionnel_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
		}
		$('.fancybox-container #popup .tabs-destin a').bind('click', {}, F6.UI.popinLinks);
	}

	F6.UI.executeVRELDestinatairePopinLink = function(fancybox) {
		// re-initalisation des ?l?ments html
		F6.UI.activeBodyFullJS();
		F6.UI.mtelDestinataireTabsRemove();
		F6.UI.activeUniform();
        F6.UI.initLELPopup();

		var actionSubmitHandler = function(form) {

			if ($('input[name=formProSelected]').val() == "true") {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.VRELAddProDES(form);
				$('.btn-send input').removeAttr('disabled');
			} else {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.VRELAddPartDES(form);
				$('.btn-send input').removeAttr('disabled');
			}

		};
		//if (EBK.config.contextPath == "") {
			var particuliers_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
			//F6.UI.activeSelectDestinataireForms();
			// F6.UI.hideAndShowAddressPartAndProForm();
		//}
		//if (EBK.config.contextPath == "/professionnel") {
			var professionnel_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
		//}

		  $("#ajouter-destinataire").submit(function( event ) {
			  var table = document.getElementsByName("contacts[]");
			  for(var i = 0; i < table.length; i++){
				  if(table[i].checked){
			  		F6.AJAX.VRELAddBookDES($("#ajouter-destinataire"));
			  		return false;
				  }
			  }
			  $("#addressBookErrorMessage").html("Veuillez s\351lectionner un contact.");
			  return false;
		  });

        $('.fancybox-container #popup .tabs-destin a').bind('click', {}, F6.UI.popinLinks);
	}

	F6.UI.VRELAddressUpdate = function(data) {
		var error = false;
		// Mascadia Control !!
		if (data.addressData != null
				&& data.addressData.mascadiaResponse != null
				&& (data.addressData.mascadiaResponse.ligne6Flag || data.addressData.mascadiaResponse.ligne4Flag)) {
			F6.UI.mascadiaError(data.addressData.mascadiaResponse, data.form);
			isMascadiaError = true;
			error = true;
		}

		if (error == false) {
			if (data != null && data.addressData != null
					&& data.addressData !== undefined && data.message == null) {
				window.location.href = "/vignette-recommandee-en-ligne/votre-envoi";
				$.fancybox.close();
			}

			if (data.error != null && data.error != undefined && data.error) {

				var errorLabel = '<label class="error">' + data.message
						+ '</label>';
				if (data.addressData != null && data.addressData.pro) {
					$('#error-coordonnees-pro').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-pro').show();
				} else {
					$('#error-coordonnees-part').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-part').show();
				}
				return;
			}
		}
	}

	F6.UI.LRELAddressUpdate = function(data) {
		var error = false;
		var prefixForm = ".expediteur ";
		// Mascadia Control !!
		if (data.addressData != null
				&& data.addressData.mascadiaResponse != null
				&& (data.addressData.mascadiaResponse.ligne6Flag || data.addressData.mascadiaResponse.ligne4Flag)) {
			F6.UI.mascadiaError(data.addressData.mascadiaResponse, data.form,
					prefixForm);
			isMascadiaError = true;
			error = true;
		}

		if (error == false) {
			if (data != null && data.addressData != null
					&& data.addressData !== undefined && data.message == null) {
				window.location.href = EBK.config.contextPath+"/lettre-recommandee-en-ligne/votre-recommande";
				$.fancybox.close();
			}

			if (data.error != null && data.error != undefined && data.error) {

				var errorLabel = '<label class="error">' + data.message
						+ '</label>';
				if (data.addressData != null && data.addressData.pro) {
					$('#error-coordonnees-pro').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-pro').show();
				} else {
					$('#error-coordonnees-part').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-part').show();
				}
				return;
			}
		}
	}

	/** **************************************************** */
	/** MTEL SUPPORT IMPRESSION ENVELOPPE */
	/** **************************************************** */

	/**
	 * F6.UI.executeMtelMailSupportSetup F6.UI.executeCounterIncremental
	 * F6.UI.executeMtelPopinLinks F6.UI.mtelDestinataireTabsRemove
	 * F6.UI.activeSelectDestinataireForms
	 * F6.VALIDATIONS.formAjouterDestinataire
	 * F6.UI.activeMtelFormAddressSelectList F6.UTILS.fillForm
	 * F6.UI.mtelEnveloppeReceiverList F6.AJAX.EnveloppeSelectorAjax
	 * F6.UI.mtelEnveloppeReceiver F6.AJAX.insertReceiverToBookList
	 * F6.UI.mtelSupportImpressionEnveloppeAjoutDestinataireCallback
	 * F6.AJAX.mtelPopinDestinataireUpdate
	 * F6.VALIDATIONS.formCoordonneesDestinataireParticulier
	 * F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel
	 *
	 * F6.UI.EnveloppeSelectorData
	 */

	F6.UI.executeMtelMailSupportSetup = function() {

		// OBJECTS
		// gestionnaire de quantite de timbres
		var counterTimbre = new F6.UI.executeCounterIncremental(
				{
					element : '.counter',
					initial_value : 1,
					max_value : 120,
					content_link_dec : '-',
					content_link_inc : '+',
					input_position : 'center',
					tt_inc : Globalize.localize("Augmente le nombre de timbres (XX actuellement)", "fr_FR"),
					tt_dec : Globalize.localize("Diminue le nombre de timbres (XX actuellement)", "fr_FR"),
					link_classes : 'aebk counter-modifier'
				});

		// gestion de l'adresse exp?diteur
		var expediteur = new F6.UI.mtelEnveloppeReceiverList(
				{
					render_template : '_scripts/templates/mtelEnveloppeExpediteurList.tmpl',
					render_element : '#expediteur-address',
					render_callback : 'F6.UI.mtelCallbackAfterRenderReceiversTable()'
				});
		// gestionnaire de la liste des destinataires
		//
		var destinataires = new F6.UI.mtelEnveloppeReceiverList(
				{
					render_template : '_scripts/templates/mtelEnveloppeDestinatairesList.tmpl',
					render_element : '#mtelTableDestinataire',
					render_callback : 'F6.UI.mtelCallbackAfterRenderReceiversTable()'
				});

		// TRIGGERS sur les boutons de quantit? de timbres
		// Recalcule le prix par une requete AJAX
		counterTimbre.btn_increment.bind('click', function() {
			if (parseInt($('.value-recever').text()) <= parseInt($('#nombreTimbre').val())) {
				F6.AJAX.EnveloppeSelectorAjax();
			} else {
				$('#nombreTimbre').val(parseInt($('.value-recever').text()));
			}
		});
		counterTimbre.btn_decrement.bind('click', function() {
			if (parseInt($('.value-recever').text()) <= parseInt($('#nombreTimbre').val())) {
				F6.AJAX.EnveloppeSelectorAjax();
			} else {
				$('#nombreTimbre').val(parseInt($('.value-recever').text()));
			}
		});
		$('#nombreTimbre').bind( 'change', function(event) {
            if (parseInt($('.value-recever').text()) <= parseInt($('#nombreTimbre').val())) {
                F6.AJAX.EnveloppeSelectorAjax();
            } else {
                $('#nombreTimbre').val(parseInt($('.value-recever').text()));
            }
        });
		// lancement de la fancybox pour ajouter des destinataires
		$('#destinataires-step1').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### S');
                $('.fancybox-slide').unbind('mousewheel.fb');
                $(".fancybox-container .blockPopin form label:first").focus();
                F6.UI.executeMtelPopinLinks($.fancybox, destinataires);
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()
            }
        });

		// lancement de la fancybox pour l'adresse exp
		$('#votre-adresse').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### T');
                $('.fancybox-slide').unbind('mousewheel.fb');
                $(".fancybox-container .blockPopin form label:first").focus();

                F6.UI.executeMtelPopinLinks($.fancybox, expediteur);
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()

            }
        });
	};

	// Gestion des TABS de la popin pour choisir les destinaires
	F6.UI.executeMtelPopinLinks = function(fancybox, destinataires) {

		// re-initalisation des ?l?ments html
		F6.UI.activeBodyFullJS();
		F6.UI.mtelDestinataireTabsRemove();
		F6.UI.activeUniform();

		// ?v?nement apr?s vaidation du formulaire pour l'onglet "Saissez
		// l'adresse du destinataire"
		var actionSubmitHandler = function(form) {
			destinataires.addReceiver(form); // ajoute un destinataire
			destinataires.renderReceiverTable(); // recalcule la table des
			// destinataires
			fancybox.close();
		};

		if ($('#coordonneesParticulier').length > 0) {
			var particuliers_form = F6.VALIDATIONS
					.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
			F6.UI.hideAndShowAddressPartAndProForm();
		}
		if ($('#coordonneesProfessionnel').length > 0) {
			var professionnel_form = F6.VALIDATIONS
					.formCoordonneesDestinataireProfessionnel();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
		}

		if ($('#formAddressSelectList').length > 0) {
			var receiver_list = '';

			$.ajax({
						url : '_ajax/mtelPopinDestinataireBook.ajax.php', // server
						// script to
						// process
						// data
						type : 'POST',
						success : function(e, m) {
							var datas = e;
							var jqxhr = $
									.get(
											'_scripts/templates/mtelEnveloppeDestinataireBookList.tmpl',
											function(template) {
												sortie = _.template(template,
														datas);
												el_parent = $(
														'#formAddressSelectList')
														.parent();
												$('#formAddressSelectList')
														.remove();
												$(el_parent).append(sortie);
												F6.UI
														.activeMtelFormAddressSelectList();
												book_list = F6.VALIDATIONS
														.formAjouterDestinataire();

												book_list.settings.submitHandler = function(
														form) {
													destinataires
															.addReceiverlist(form);
													fancybox.close();
												};
											})
									.error(
											function(e, m) {
												alert("Erreur de lecture du fichier de template : MTEL");
											})

						},
						error : function(e, m) {
							F6.log(e);
							F6.log(m)
						},
						// Options to tell JQuery not to process data or worry
						// about
						// content-type
						cache : false,
						contentType : false,
						processData : false
					});

		}

		if ($('#formAddressFiles').length) {
			var name = '';
			var size = 0;
			var type = '';
			var file = '';

			$('#formAddressFiles form')
					.submit(
							function() {
								var formData = $(this).serialize();
								uplo = $('#formAddressFiles form input[type="file"]')

								$('.upload-progressbar-wrap')
										.fadeIn(
												200,
												function() {
													$
															.ajax({
																url : '_ajax/upload.ajax.php', // server
																// script
																// to
																// process data
																type : 'POST',
																xhr : function() { // custom
																	// xhr
																	myXhr = $.ajaxSettings
																			.xhr();
																	if (myXhr.upload) { // check
																		// if
																		// upload
																		// property
																		// exists
																		myXhr.upload
																				.addEventListener(
																						'progress',
																						F6.UI.progressHandlingFunction,
																						false); // for
																		// handling
																		// the
																		// progress
																		// of
																		// the
																		// upload
																	}
																	return myXhr;
																},
																// Ajax events
																// beforeSend:
																// beforeSendHandler,
																success : function(
																		datas,
																		m) {
																	$(
																			'.upload-progressbar-wrap')
																			.fadeOut();
																	var jqxhr = $
																			.get(
																					'_scripts/templates/mtelEnveloppeDestinataireBookList.tmpl',
																					function(
																							template) {
																						sortie = _
																								.template(
																										template,
																										datas);
																						el_parent = $(
																								'#formAddressFiles')
																								.parent();
																						$(
																								el_parent)
																								.append(
																										sortie);
																						$(
																								'#formAddressFiles')
																								.remove();
																						F6.UI
																								.activeMtelFormAddressSelectList();
																						book_list = F6.VALIDATIONS
																								.formAjouterDestinataire();
																						book_list.settings.submitHandler = function(
																								form) {
																							destinataires
																									.addReceiverlist(form);
																							fancybox
																									.close();
																						};
																					})
																			.error(
																					function(
																							e,
																							m) {
																						alert("Erreur de lecture du fichier de template : MTEL");
																					})
																},
																error : function(
																		e, m) {
																	F6.log(e);
																	F6.log(m)
																},
																// Form data
																data : file,
																// Options to
																// tell JQuery
																// not to
																// process data
																// or worry
																// about
																// content-type
																cache : false,
																contentType : false,
																processData : false
															});
												});

								return false;
							});
		}

		$('.fancybox-container #popup .tabs-destin a').bind('click', {
			fancybox : fancybox,
			destinataires : destinataires
		}, F6.UI.mtelPopinLinks);
		$('#popup .tabs-destin a:eq(0)').focus();
		$('#popup .btn-footer input[type="submit"]').bind(
				'keypress.tabulation', function(e) {
					if (e.keyCode == 9 && !e.shiftKey) {
						return false;
					}
				});
	};

	F6.UI.mtelCallbackAfterRenderReceiversTable = function() {
		F6.AJAX.EnveloppeSelectorAjax();
	};

	// fonction recursive pour le trigger sur les tabd en haut des popin
	F6.UI.mtelPopinLinks = function(e) {
		F6.stop(e);
		var fny = e.data.fancybox;
		var dest = e.data.destinataires;
		fny({
			href : $(this).attr('href'),
			'onComplete' : function() {
				F6.UI.executeMtelPopinLinks(fny, dest);
			}
		});
	};

	F6.UI.mtelPopinDestinataireBookAfterLoad = function(datas) {
		var jqxhr = $.get(
				'_scripts/templates/mtelEnveloppeDestinataireBookList.tmpl',
				function(template) {
					sortie = _.template(template, datas);
					el_parent = $('#formAddressSelectList').parent();
					$('#formAddressSelectList').remove();
					$(el_parent).append(sortie);
					F6.UI.activeMtelFormAddressSelectList();
					return $('#formAddressSelectList').html();
				}).error(function(e, m) {
			alert("Erreur de lecture du fichier de template : MTEL");
		})
	};

	// Modifi le comportement de puces de s?lection par lettre
	F6.UI.activeMtelFormAddressSelectList = function() {
		$('#formAddressSelectList .adress-index li a').unbind('click');
		if ($('#formAddressSelectList .adress-index li a').length) {
			var carnet_element = $('#formAddressSelectList .adresses');
			var posY_book = carnet_element.offset().top;
			$('#formAddressSelectList .adress-index li a').bind(
					'click',
					function() {

						link_to = $(this).attr('href');

						if (typeof ($(link_to)) != 'undefined') {
							posY_of_book = $(link_to).offset().top;
							scroll_poxY = carnet_element.scrollTop();
							posY = posY_of_book + scroll_poxY - posY_book - 5;

							$('#formAddressSelectList .adresses li.selected')
									.removeClass('selected');
							$(this).parent('li').addClass('selected');

							carnet_element.scrollTop(posY);
						}
						return false;
					})
		}
	};

	F6.UI.activeSelectDestinataireForms = function() {
		$(".destinataire-btn-select .form-radio-simulation").unbind('click');
		$(".destinataire-btn-select .form-radio-simulation").bind('click', function() {
			$(".destinataire-btn-select .form-radio-simulation").removeClass('selected');
			if (!$($(this).attr('href')).is(":visible")) {
				$('#formAddressSingleProfessionnel').toggle();
				$('#formAddressSingleParticulier').toggle();
				F6.UI.activeSelectDestinataireButtons();
			}

			$('#error-coordonnees').html('');
			$(this).addClass('selected');
			return false;
		});
	};

    // Toggle pro/part forms buttons
    F6.UI.activeSelectDestinataireButtons = function() {
            $('#partFormButtons').toggle();
            $('#proFormButtons').toggle();
            return false;
    };

	// znouaoui : Callback Call Ajax Enveloppe
	F6.UI.EnveloppeSelectorData = function(datas) {
		var total_ht = datas.total_ht;
		var total_tva = datas.total_tva;
		var total = datas.total;
		var max_receivers = datas.max_receivers;
		var elibible_receivers_count = datas.eligibleReceivers_count;
		var all_receivers_count = datas.receiver_count;

		if (all_receivers_count == elibible_receivers_count) {
			// remove msg for not elibible receivers
			$('#eligibiliteBoxInfo').empty();
		}
		// Nombre de timbre ne peut pas etre inferieur du nombre de
		// destinataires
		if (parseInt($('#nombreTimbre').val()) < elibible_receivers_count) {
			$('#nombreTimbre').val(parseInt(elibible_receivers_count));
		}

		if (all_receivers_count > 0) {
			$('#lelTableDestinataire').show();
		} else {
			$('#lelTableDestinataire').hide();
		}

		if (all_receivers_count === 0) {
			all_receivers_count = "0";
			if ($('#lelTableDestinataire').length > 0) {
				$('.action-delete-all', '#lelTableDestinataire').fadeOut(
						function() {
							$(this).remove();
						});
				$('ul.pagination', '#lelTableDestinataire').fadeOut(function() {
					$(this).remove();
				});
			}
		} else {
			$('#manage-recipients-link').show();
			$('.specimen-dest-number').html(all_receivers_count);
			$('#attribute-quantity span').text(elibible_receivers_count+' timbre(s)');
			$('.test-ajout-dest1').hide();
			$('.test-ajout-dest2').show();
		}
		if (elibible_receivers_count == 0 || elibible_receivers_count == 1) {
			$('.destinataire-string.value-string').text("destinataire");
		} else {
			$('.destinataire-string.value-string').text("destinataires");
		}

		$('.recever-result .value-recever').text(elibible_receivers_count);
		$('.noDestinatairesInfo .addressesCount')
				.text(all_receivers_count);
		$('.noDestinatairesInfo .count-contact').text(all_receivers_count);
		$('.footer-destinataires .infoContacts strong').text(
				max_receivers - elibible_receivers_count);
		$(
				'.destinataires-resume-block .optionsResume .value-integer, .user-count .value-integer, .recever-result .value-integer')
				.text(all_receivers_count);

		var formattedTotal = total + ' <abbr title="euros">€</abbr>';
		var formattedTotalHT = F6.UTILS.changeToCurrency(total_ht);
		var formattedTotaTVA = F6.UTILS.changeToCurrency(total_tva);

		$('.destinataireResults .price-result .value-integer').html(
				formattedTotal)
		$('.totalHT .value').html(formattedTotalHT);
		$('.totalTVA .value').html(formattedTotaTVA);
		$('.total .value').html(formattedTotal);
		$('.optionsResume .value').html(formattedTotal);

		$('.value-total').html(formattedTotal);

		F6.UI
				.destinatairesCRUD(max_receivers - elibible_receivers_count,
						false);

		if ($.uniform.update) {
			$.uniform.update();
		}
	}

	F6.UI.progressHandlingFunction = function(e) {
		if (e.lengthComputable) {
			var pourcentage = Math.round(e.loaded / e.total * 100, 2);
			$('.pbProgress').css('width', pourcentage + '%');
			$('.pbText').text(pourcentage + '%')
			$('progress').attr({
				value : e.loaded,
				max : e.total
			});
		}
	};

	F6.UI.mtelDestinataireTabsRemove = function() {
		$('#removeTabsWithJS').remove();
		if ($('.tabsDestins li:eq(0) a').length) {
			$('.tabsDestins li:eq(0) a').html(Globalize.localize("Saissez l'adresse <br>du destinataire", "fr_FR"))
		} else {
			$('.tabsDestins li:eq(0)').html(
					'<span class="hidden">'
							+ Globalize.localize("rubrique sélectionnée", "fr_FR")
							+ '</span> '
							+ Globalize.localize("Saissez l'adresse <br>du destinataire", "fr_FR"))
		}
	};

	/** ******************************************************* */
	/** GESTION DES ENVELOPPES * */
	/** ******************************************************* */
	/**
	 * Objet enveloppe, CRUD des contacts / destinataires Ecris le tableau HTML
	 * des destinataires
	 *
	 */
	F6.UI.mtelEnveloppeReceiverList = Class({
		constructor : function(options) {
			this.list = new Array();
			this.max_contact = 100;
			this.is_authenticated = true;
			this.render_template = options.render_template;
			this.render_element = options.render_element;
			this.render_callback = options.render_callback;
		},
		addReceiver : function(form) {
			if (!this.isFull()) {
				this.list.push(new F6.UI.mtelEnveloppeReceiver($(form)
						.serialize()));
			}
		},
		addReceiverlist : function(input) {
			var temp_receiver_list = [];
			var temp_form = '';
			var dest = this;
			$(':checked', input).each(function() {
				el_parent = $(this).parent();
				temp_form = document.createElement('form');
				$(':hidden', el_parent).each(function() {
					input_name = $(this).attr('name');
					input_name_new = input_name.replace(/\[[0-3]+\]/gi, '')
					$(this).attr('name', input_name_new);
					$(temp_form).append(this);
				});
				dest.addReceiver(temp_form);
			});
			this.renderReceiverTable();
		},
		deleteReveiver : function(input) {
			delete (this.list[input]);
			tmp = new Array();
			for (idx in this.list) {
				if (this.list[idx] !== 'undefined') {
					tmp.push(this.list[parseInt(idx)]);
				}
			}
			this.list = tmp;
			this.renderReceiverTable();
		},
		deleteAllReveiver : function(input) {
			this.list = new Array();
			this.renderReceiverTable();
		},
		addReveiverToBook : function(input) {
			idx = parseInt(input);
			tmp = this.getReceiverAt(idx);
			tmp.setIssave(true);
			this.list[idx] = tmp;
		},
		updateReceiver : function(index, input) {
			this.list[index] = new F6.UI.mtelEnveloppeReceiver($(input)
					.serialize());
			this.renderReceiverTable();
		},
		getReceiverQuantity : function() {
			return this.list.length;
		},
		isFull : function() {
			if (this.getReceiverQuantity() < this.max_contact)
				return false;
			else
				return true;
		},
		getReceiverAt : function(input) {
			return this.list[parseInt(input)];
		},
		getReceiverFormAt : function(input) {
			receiver = this.getReceiverAt(input);
			datas = receiver.exportForm();
			return datas;
		},
		getReceiverRestQuantity : function() {
			return this.max_contact - this.getReceiverQuantity();
		},
		renderReceiverTable : function() {
			var datas = {
				'quantity' : this.getReceiverQuantity(),
				'invert_quantity' : this.getReceiverRestQuantity(),
				'destinataires' : this.list,
				'form_name' : 'destinataires',
				'is_user_authenticated' : this.is_authenticated
			};
			$('.recever-result .value-recever')
					.text(this.getReceiverQuantity());
			var dest = this;
			var render_element = this.render_element;
			var render_callback = this.render_callback;
			var jqxhr = $.get(
							this.render_template,
							function(template) {
								sortie = _.template(template, datas);

								$(render_element).html(sortie);

								// TRIGGERS DES BOUTONS UPDATE / DELETE / ADD TO
								// BOOK
								el_delete_item = $('.action-delete-item');
								if (el_delete_item.length > 0) {
									el_delete_item.unbind('click');
									el_delete_item
											.bind(
													'click',
													function(e) {
														F6.stop(e);
														var el_trigger = this;
														var id = F6.UTILS
																.findMyIdNumber($(this));
														var element = $('#item_'
																+ id);
														var txt = '<div class="typo-din title3">Confirmation</div>'
																+ Globalize
																		.localize(
																				"Etes-vous certain de vouloir supprimer ce destinataire ?",
																				"fr_FR")
																+ ' <input type="hidden" id="itemId" name="itemId" value="'
																+ id + '" />';
														$
																.prompt(
																		txt,
																		{
																			buttons : {
																				Supprimer : true,
																				Annuler : false
																			},
																			callback : function(
																					e,
																					v,
																					m,
																					f) {
																				if (v) {
																					$(
																							element)
																							.hide(
																									'slow',
																									function() {
																										$(
																												this)
																												.remove();
																										dest
																												.deleteReveiver(f.itemId);
																										// partie
																										// lel
																										// 3&4
																										if ($('#LelStep4Recap, #LelStep3Recap').length === 0) {
																											F6.AJAX
																													.EnveloppeSelectorAjax();
																										}
																										if ($('#mtelTableDestinataire').length > 0) {
																											if ($('#mtelTableDestinataire table tbody tr dd').length > 0) {
																												F6.VALIDATIONS
																														.highlightError('mtelTableDestinataire');
																											} else {
																												F6.VALIDATIONS
																														.highlightError('destinataires-step1');
																											}
																										}
																									});
																				} else {
																					$(
																							el_trigger)
																							.focus();
																					$(
																							'#successBoxTop')
																							.find(
																									'a')
																							.focus();
																				}
																			}
																		});
													});
								}

								el_delete_all = $('.action-delete-all');
								if (el_delete_all.length > 0) {
									el_delete_all.unbind('click');
									el_delete_all
											.bind(
													'click',
													function(e) {
														F6.stop(e);
														var el_trigger = this;
														var txt = '<div class="typo-din title3">Confirmation</div>'
																+ Globalize
																		.localize(
																				"Etes-vous certain de vouloir supprimer tous les destinataires ?",
																				"fr_FR")
																+ ' <input type="hidden" id="itemId" name="itemId" value="all" />';
														$
																.prompt(
																		txt,
																		{
																			buttons : {
																				Supprimer : true,
																				Annuler : false
																			},
																			callback : function(
																					e,
																					v,
																					m,
																					f) {
																				if (v) {
																					var table = $('#lelTableDestinataire').find("tr[id*=item_]");
																					if ($('ul.pagination','#lelTableDestinataire').is(':visible')) {
																						$('ul.pagination').hide();
																					}
																					el_delete_all.hide();
																					$.each(table, function(a, b) {
																										var id_del = table .attr('id');
																										$(this).fadeOut('slow').remove();
																									});
																					if ($('#LelStep3Recap').length > 0) {
																						F6.VALIDATIONS.highlightError('LelStep3Recap');
																						F6.AJAX.LelSummaryBasketAjax('LelStep3Recap');
																					} else if ($('#LelStep4Recap').length > 0) {
																						F6.VALIDATIONS.highlightError('LelStep4Recap');
																						F6.AJAX.LelSummaryBasketAjax('LelStep4Recap');
																					}

																					if ($('#mtelTableDestinataire').length > 0) {
																						if ($('#mtelTableDestinataire table tbody tr dd').length > 0) {
																							F6.VALIDATIONS.highlightError('mtelTableDestinataire');
																						} else {
																							document.location.href = '#destinataires-step1';
																							$('a#destinataires-step1').focus();
																						}
																					}
																					dest.deleteAllReveiver();
																				} else {
																					$(el_trigger).focus();
																					$('#successBoxTop').find('a').focus();
																				}
																			}
																		});
													});
								}

								el_insert_item = $('.action-insert-item');
								if (el_insert_item.length > 0) {
									el_insert_item.unbind('click');
									el_insert_item
											.bind(
													'click',
													function(e) {
														F6.stop(e);
														var el_trigger = this;
														var id = F6.UTILS
																.findMyIdNumber($(this));
														var element = $('#item_'
																+ id);
														var txt = '<div class="typo-din title3">Confirmation</div>'
																+ Globalize
																		.localize(
																				"Etes-vous certain de vouloir ajouter ce destinataire à votre carnet d'adresse ?",
																				"fr_FR")
																+ ' <input type="hidden" id="itemId" name="itemId" value="'
																+ id + '" />';
														$
																.prompt(
																		txt,
																		{
																			buttons : {
																				Confirmer : true,
																				Annuler : false
																			},
																			callback : function(
																					e,
																					v,
																					m,
																					f) {
																				if (v) {
																					$(
																							'.action-insert-item',
																							element)
																							.parent()
																							.html(
																									'<img src="images/icons/ico_check_gray.gif" alt="Contact déjà ajouté" />');
																					dest
																							.addReveiverToBook(f.itemId);
																					// Ajouter
																					// traitement
																					// AJAX
																					// pour
																					// inscription
																					// en
																					// base
																					receiver = dest
																							.getReceiverAt(f.itemId);
																					F6.AJAX
																							.insertReceiverToBookList(receiver
																									.exportForm());

																				} else {
																					$(
																							el_trigger)
																							.focus();
																					$(
																							'#successBoxTop')
																							.find(
																									'a')
																							.focus();
																				}
																			}
																		});
													});
								}

								el_update_item = $('.action-update-item');
								if (el_update_item.length) {
									el_update_item.unbind('click');
									el_update_item.bind('click', function(e) {
													    F6.stop(e);
														var id = F6.UTILS.findMyIdNumber($(this));
														var element = $('#item_' + id);
														var form_validation = '';
														receiver = dest.getReceiverAt(id);
														var href_fancybox = F6.AJAX.mtelPopinDestinataireUpdate(receiver.type);

													    $.fancybox.open({
                                                            src  : URLS.updatePath( href_fancybox ),
                                                            type : 'ajax',
                                                            afterShow : function(instance, current) { console.log('### U');
                                                                var update_form = false;
                                                                var name_form = '';
                                                                if ($('#coordonneesParticulier').length) {
                                                                    update_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
                                                                    name_form = 'coordonneesParticulier';
                                                                } else {
                                                                    update_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
                                                                    name_form = 'coordonneesProfessionnel';
                                                                }
                                                                if (update_form) {
                                                                    update_form.settings.submitHandler = function(form) {
                                                                        dest.updateReceiver(id, form);
                                                                        $.fancybox.close();
                                                                    };
                                                                }
                                                                // rempli le formulaire
                                                                F6.UTILS.fillForm(
                                                                    name_form, // id du formulaire
                                                                    _.first(dest.getReceiverFormAt(id)), // les donn?es
                                                                    Globalize.localize("Modifier", "fr_FR"),
                                                                    Globalize.localize("Modifier cette adresse personnelle", "fr_FR")
                                                                );

                                                                // init du HTML
                                                                F6.UI.activeUniform();
                                                                $('#fancybox-frame').attr('title', Globalize.localize("Ajouter des destinataires", "fr_FR"));
                                                                $('#fancybox-frame').attr('tabindex', '0');
                                                                $('#fancybox-frame').focus();
                                                            },
                                                            opts : {
                                                                touch: false,
                                                                momentum: false,
                                                                smallBtn: false,
                                                                clickOutside: false,
                                                                baseTpl : Popup.template()

                                                            }
                                                        });
													});
								}

								// ajout pour LEL step 3 & 4
								$('.tableDestinataire .addContact').fancybox({
                                    src  : URLS.updatePath( $(this).attr('href') ),
                                    type : 'ajax',
                                    afterShow : function(instance) { console.log('### V');
                                    	console.log('TEST2');
                                        $('.fancybox-slide').unbind('mousewheel.fb');
                                        $(".fancybox-container .blockPopin form label:first").focus();
                                        F6.UI.executeMtelPopinLinks($.fancybox, dest);
                                    },
                                    opts : {
                                        touch: false,
                                        momentum: false,
                                        smallBtn: false,
                                        clickOutside: false,
                                        baseTpl : Popup.template()

                                    }
                                });

								if (render_callback.length) {
									eval(render_callback);
								}

							})
					.error(
							function(e, m) {
								alert("Erreur de lecture du fichier de template : MTEL");
							})
		}
	});

	/**
	 * Definit un destinataire : pro ou part quelque soit le form tous les
	 * champs sont stock? param : form_element $(form).serialize()
	 *
	 */
	F6.UI.mtelEnveloppeReceiver = Class({
		constructor : function(form_element) {
			this.prefix = 'coordonnees';
			this.type = '';
			this.is_saved = false;
			this.name_fields = new Array();
			this.raw_fields = new Array();
			this.raw_form = new Array();
			this.raw_data = new Array();
			this.name = '';
			this.address = '';

			this.is_saved_label = 'is_saved';
			this.type_label = 'type';
			this.last_name_label = 'lastName';
			this.first_name_label = 'firstName';
			this.name_label = 'raisonSociale';
			this.numLibelle = 'numLibelle';
			this.codePostal = 'codePostal';
			this.localite = 'localite';

			// formater les donn?es
			this.init(form_element);
		},

		init : function(input) {
			temp = input.split('&');
			for (index in temp) {
				raw_field = temp[index];

				submited = raw_field.split('=');
				field_full_name = submited[0];
				field_value = submited[1];
				field_name = field_full_name;
				field_format = field_full_name;

				this.raw_fields.push(decodeURIComponent(field_format));
				this.raw_data.push(decodeURIComponent(field_value.replace(
						/\+/gi, ' ')));
				this.name_fields.push(decodeURIComponent(field_name));
			}
			this.setType();
			this.initIsSaved();
			this.setName();
			this.setAddress();
		},
		setType : function() {
			if (this.raw_data[2] === '') {
				this.type = 'particulier';
			}
		},
		initIsSaved : function() {
			this.is_saved = this.getValueFromField(this.is_saved_label) == '1' ? true
					: false;
		},
		setIssave : function(input) {
			this.is_saved = input;
			idx = this.getIndexFromField(this.is_saved_label);
			this.raw_data[parseInt(idx)] = input;
		},
		getIsSaved : function() {
			return this.is_saved;
		},
		getFieldsCount : function() {
			return this.name_fields.length;
		},
		getFields : function() {
			return this.name_fields;
		},
		getFieldAt : function(input) {
			return this.name_fields[parseInt(input)];
		},
		getIndexFromField : function(input) {
			return idx = _.indexOf(this.name_fields, input);
		},
		getValueFromField : function(input) {
			idx_field = this.getIndexFromField(input);
			return this.getValueAt(parseInt(idx_field));
		},
		getValueAt : function(input) {
			return this.raw_data[parseInt(input)];
		},
		// A ajuster en fonction du modele propos? par les d?veloppeurs BO
		// chercher soit dans raw_fields soit dans field_name
		setName : function() {
			idx = null;
			if (this.type === 'particulier') {
				this.name = this.getValueFromField(this.last_name_label) + ', '
						+ this.getValueFromField(this.first_name_label);
			} else {
				this.name = this.getValueFromField(this.name_label);
			}
		},
		getName : function() {
			return this.name;
		},
		setAddress : function() {
			this.address = this.getValueFromField(this.numLibelle) + ' '
					+ this.getValueFromField(this.codePostal) + ' '
					+ this.getValueFromField(this.localite);
			// this.getValueFromField(this.address_label);
		},
		getAddress : function() {
			return this.address;
		},
		exportForm : function() {
			export_string = '[{';
			num = 0;
			for (idx in this.raw_fields) {
				if (num > 0) {
					export_string += ','
				}
				export_string += '"' + this.raw_fields[parseInt(idx)] + '"'
						+ ': ' + '"' + this.raw_data[parseInt(idx)] + '"';
				num++;
			}
			export_string += '}]';
			return eval(export_string);
		},
		trace_log : function() {
			F6.log('raw_fields');
			F6.log(typeof this.raw_fields);
			F6.log(this.raw_fields);
			F6.log('raw_data');
			F6.log(typeof this.raw_data);
			F6.log(this.raw_data);
			F6.log('raw_form');
			F6.log(typeof this.raw_form);
			F6.log(this.raw_form);
			F6.log('name_fields');
			F6.log(typeof this.name_fields);
			F6.log(this.name_fields);
		}
	});

	F6.UI.mtelSupportImpressionEnveloppeAjoutDestinataireCallback = function() {
		F6.UI
				.displaySuccessMessage(
						Globalize
								.localize(
										"Ce destinataire a été ajouté à votre carnet d'adresse avec succés",
										"fr_FR"), 'mtelDestinatairesAjout',
						Globalize.localize(
								"Continuer à gérer les destinataires", "fr_FR"));
	}

	/** END GESTION DE MTEL SUPPORT IMPRESSION ENVELOPPES * */
	/** **************************************************** */

	/*
	 * F6.UI.mtelSupportImpressionEnveloppeDestinataireCallback =
	 * function(datas){ var template = 'none'; var destinataires_list =
	 * JSON.stringify(datas); $('#mtelTableDestinataire').html('');
	 * destinataires_list = destinataires_list.replace(':{', ':[');
	 * destinataires_list = destinataires_list.replace('},', '],');
	 * if(destinataires_list.length > 0) { var view = { destinataires:
	 * destinataires_list, quantity: destinataires_list.length };
	 *
	 * var jqxhr =
	 * $.get('_scripts/templates/mtelEnveloppeDestinatairesList.tmpl',
	 * function(template){
	 * $('#mtelTableDestinataire').html(Mustache.render(template, view)); })
	 * .error(function() { alert("Erreur de lecture du fichier de template :
	 * MTEL");}) } };
	 */

	F6.UI.activePropositionAdresses = function() {

		$("#certain-adresse").addClass('selected');
		$(".prop-adresse input").click(function() {
			$(".prop-adresse").removeClass('selected');
			$(this).parent(".prop-adresse").addClass('selected');
		});
	};

	F6.UI.champsPersonneDelete = function() {
		$(".add_person .block-name").find(".delete").click(function() {
			$(this).parent(".block-name").hide();
			return false
		});
	};

	/** END GESTION DE LA PLANCHE * */

	/** END MON TIMBRE EN LIGNE * */

	/** BEGIN USER ACCOUNT * */

	F6.UI.activeScrollPaneContactBook = function() {
		var carnet_element = $('.repertoire');

		cssObj = {
			height : '506px',
			overflow : 'auto',
			position : 'relative'
		}
		carnet_element.css(cssObj)
		var posY_book = carnet_element.offset().top;

		$('.liens-repertoire a')
				.each(
						function(index) {
							$(this)
									.bind(
											'click',
											function(event) {
												event.preventDefault();
												link_to = $(this).attr('href');

												if (typeof ($(link_to)) == 'undefined')
													return false;

												posY_of_book = $(link_to)
														.offset().top;
												scroll_poxY = carnet_element
														.scrollTop();
												posY = posY_of_book
														+ scroll_poxY
														- posY_book - 5;

												$(
														'.liens-repertoire li.selected')
														.removeClass('selected');
												$(this).parent().parent('li')
														.addClass('selected')

												carnet_element.scrollTop(posY);
												var index = $('.repertoire h4')
														.index($(link_to));
												$(
														'.repertoire ul:eq('
																+ index
																+ ') input[type=checkbox]:first')
														.focus();

											})
						})
	};

	F6.UI.activeContactDeleting = function() {
		F6.UI.activeContactDeletingChecking();
		$('.repertoire input').bind('change',
				F6.UI.activeContactDeletingChecking);
	};

	F6.UI.activeContactDeletingChecking = function() {
		var num_checked = 0;
		$('.repertoire input').each(function() {
			// if ($(this).attr('checked'))
			if ($(this)[0].checked )
				num_checked++;
		});
		if (num_checked) {
           $('.cl-footer .btn-send-minor').removeClass('light');
			$('.cl-footer .btn-send-minor input').removeAttr('disabled');
			$('.cl-footer .btn-send-minor input')
					.attr(
							'title',
							Globalize
									.localize(
											"Supprimer les contacts sélectionnés (actuelement ",
											"fr_FR")
									+ num_checked
									+ Globalize.localize(")", "fr_FR"));
		} else {
			$('.cl-footer .btn-send-minor').addClass('light');
			$('.cl-footer .btn-send-minor input').attr('disabled', 'disabled');
			$('.cl-footer .btn-send-minor input')
					.attr(
							'title',
							Globalize
									.localize(
											"Supprimer les contacts sélectionnés (actuelement aucun)",
											"fr_FR"));
		}
	}

	/** END USER ACCOUNT * */

	/** INIT LEL * */

	F6.UI.switchModelesLettre = function() {

		if ($("#lettre-part").hasClass('selected')) {
			$('#lettre-particulier').show();
			$("#lettre-part").addClass('selected');

			$('#lettre-professionnel').hide();
			$('#lettre-association').hide();
		} else if ($("#lettre-pro").hasClass('selected')) {
			$('#lettre-professionnel').show();
			$("#lettre-pro").addClass('selected');

			$('#lettre-association').hide();
			$('#lettre-particulier').hide();
		} else if ($("#lettre-asso").hasClass('selected')) {
			$('#lettre-association').show();
			$("#lettre-asso").addClass('selected');

			$('#lettre-professionnel').hide();
			$('#lettre-particulier').hide();
		} else {
			$('#lettre-particulier').show();
			$("#lettre-part").addClass('selected');

			$('#lettre-professionnel').hide();
			$('#lettre-association').hide();
		}

		$("#lettre-part").click(function() {

			$('#lettre-professionnel').hide();
			$('#lettre-particulier').show();
			$('#lettre-association').hide();
			$(this).addClass('selected');

			$('#lettre-pro').removeClass('selected');
			$('#lettre-asso').removeClass('selected');
			return false
		});
		$("#lettre-pro").click(function() {

			$('#lettre-professionnel').show();
			$('#lettre-particulier').hide();
			$('#lettre-association').hide();
			$(this).addClass('selected');

			$('#lettre-part').removeClass('selected');
			$('#lettre-asso').removeClass('selected');
			return false
		});
		$("#lettre-asso").click(function() {

			$('#lettre-professionnel').hide();
			$('#lettre-particulier').hide();
			$('#lettre-association').show();
			$(this).addClass('selected');

			$('#lettre-part').removeClass('selected');
			$('#lettre-pro').removeClass('selected');
			return false

		});

		return false

	};

	// ADD-REMOVE CLASS IN LEL - STEP2
	F6.UI.activeRadioBlock = function() {
		$('.block-radio input').click(function() {
			$(this).closest('ul').find('.block-radio').removeClass('selected');
			$(this).closest('.block-radio').addClass('selected');
		});

	};

	F6.UI.manageResumeLelEtape2Data = function(datas) {
		if (datas.price == "Forfait") {
			$('.optionsResume dd.value').text(datas.price);
			$('.price-result span.value').text(datas.price);
		} else {
			$('.optionsResume dd.value').text(datas.price).append(' &euro;');
			$('.price-result span.value').text(datas.price).append(' &euro;');
		}
	}

	F6.UI.manageResumeLrelEtape2Data = function(datas) {
		if (datas.forcerPPA) {
			$('#place_poste').attr('disabled', 'disabled');
			$('#place_vierge').attr('checked', 'checked');
			$('.block-radio-adress').removeClass('selected');
			$('#place_vierge').parent().addClass('selected');
		} else {
			$('#place_poste').removeAttr('disabled');
		}
		$('.optionsResume dd.value').text(datas.price).append(' &euro;');
		$('.price-result span.value').text(datas.price).append(' &euro;');
		// set avis de reception's value
		$('#price-option-suivi').text(datas.avisReception).append(' &euro;');
	}

	// MNA Choose duration du service de reexpedition
	F6.UI.changePack = function() {
		$('.pack-chooser li').first('li').addClass('selected');
		$('.pack-chooser li').click(function() {
			$(this).parent().find('li').removeClass('selected');
			$(this).addClass('selected');
		});

	};

	F6.UI.maxlength_textarea = function(id, crid, max) {
		var txtarea = document.getElementById(id);
		document.getElementById(crid).innerHTML = '(' + txtarea.value.length
				+ '/' + max + ')';
		txtarea.onkeypress = function() {
			eval('F6.UI.v_maxlength("' + id + '","' + crid + '",' + max + ');')
		};
		txtarea.onblur = function() {
			eval('F6.UI.v_maxlength("' + id + '","' + crid + '",' + max + ');')
		};
		txtarea.onkeyup = function() {
			eval('F6.UI.v_maxlength("' + id + '","' + crid + '",' + max + ');')
		};
		txtarea.onkeydown = function() {
			eval('F6.UI.v_maxlength("' + id + '","' + crid + '",' + max + ');')
		};
		txtarea.onpaste = function() {
			eval('F6.UI.v_maxlength("' + id + '","' + crid + '",' + max + ');')
		};
	};

	F6.UI.v_maxlength = function(id, crid, max) {
		var txtarea = document.getElementById(id);
		var crreste = document.getElementById(crid);
		var len = txtarea.value.length;
		if (len > max) {
			txtarea.value = txtarea.value.substr(0, max);
		}
		len = txtarea.value.length;
		crreste.innerHTML = '(' + len + '/' + max + ')';
	};

	F6.UI.mnaEnvoiSMS = function() {
		$('input[type="text"]')
				.keydown(
						function(e) {
							code = e.keyCode;
							if ((((code >= 96 && code <= 105) || (code >= 48 && code <= 57)) && $(
									this).val().length <= 10)
									|| (code == 9 || code == 8 || code == 36
											|| code == 37 || code == 38
											|| code == 39 || code == 46))
								return true;
							else
								return false;
						});

		$('.add-numtel .block-name').hide();
		$('.js-active .add-numtel').css('display', 'block');

		var idx_form = 0;
		var max_champ = $('.add-numtel .block-name').length;
		var txt_title = Globalize
				.localize(
						"ajouter un formulaire pour un autre numéro (actuellement XX affiché",
						"fr_FR");
		var num = 0;

		$('.add-numtel .block-name').each(function() {
			$(this).attr('id', 'block-' + num);
			num++;
		});

		$('.send-smscard .btn-ajouter')
				.bind(
						'click',
						function(event) {
							event.preventDefault();
							title_temp = txt_title.replace('XX', idx_form + 2)
							if (idx_form > 0) {
								title_temp += Globalize.localize("s)", "fr_FR")
							} else {
								title_temp += ')'
							}
							$('.send-smscard .btn-ajouter a').attr('title',
									title_temp);

							if (idx_form < max_champ) {
								$(
										'.add-numtel .block-name:eq('
												+ idx_form + ')').show();
								id_add = $(
										'.add-numtel .block-name:eq('
												+ idx_form + ')').find('input')
										.attr('id');
								$('#' + id_add).focus()

								idx_form++;
							}
							return false;
						});

		$(".add-numtel .block-name").find(".delete").click(
				function(event) {
					event.preventDefault();
					id_delete = $(this).parent(".block-name").attr('id');
					idx_delete = id_delete.replace('block-', '') * 1;
					var tab_values = new Array();

					$('.add-numtel .block-name input').each(function() {
						tab_values.push($(this).val());
					});

					for (i = idx_delete; i < tab_values.length - 1; i++) {
						tab_values[i] = tab_values[i + 1];
					}
					tab_values[tab_values.length - 1] = '';

					idx_form--;
					$('.add-numtel .block-name').hide();
					$('.add-numtel .block-name input').val('');
					$.each(tab_values, function(index, value) {
						if (index == idx_form) {
							return false
						}
						$('.add-numtel .block-name:eq(' + index + ')').find(
								'input').val(value);
						$('.add-numtel .block-name:eq(' + index + ')').show();
					});

					return false
				});
	};

	F6.UI.mnaCalculVolumeResetForm = function() {
		$('.btn-reset input').bind('mouseup', function() {

			tab_input = $('#mna_calcul_volume_demenager input');
			$(tab_input[0]).focus();
			// position_form = $("#mna_calcul_volume_demenager").offset().top;
			// //znouaoui -> Watch out IE bug with console.log(position_form);
			// var documentBody = (($.browser.chrome)||($.browser.safari)) ?
			// document.body : document.documentElement;
			// $('body').animate({top: position_form} , 500);
		})
	};

	F6.UI.tableCommandStampsCollapse = function() {
		$('.user-account .stamps-online .blockPack').each(
				function() {
					if ($(this).find('tbody tr').length > 1) {
						$(this).find('.lineBD').addClass('filledlineBD')
								.removeClass('lineBD');
						$(this).find('.lineBG').addClass('filledlineBG')
								.removeClass('lineBG');
						$(this).find('tbody tr').each(function() {
							$(this).hide()
						});
						$(this).find('tbody tr:first-child').show();
						// $(this)
						// .find('.block-border-corner')
						// .append(
						// '<div class="packActions"><a href="#" title="'
						// + Globalize
						// .localize(
						// "Afficher la totalité des lignes du tableau",
						// "fr_FR")
						// + '" class="expand">'
						// + Globalize
						// .localize(
						// "Voir toute la commande en détail",
						// "fr_FR")
						// + '</a></div>');
					}
				});
		$('.user-account .stamps-online .blockPack .packActions a.expand')
				.bind('click', F6.UI.tableCommandStampsCollapseActionExpand);
	};

	F6.UI.tableCommandStampsCollapseActionExpand = function() {
		$('.user-account .stamps-online .blockPack .packActions a').unbind(
				'click');
		$(this).parent().parent().find('tbody tr').each(function() {
			$(this).show()
		});
		var orderNum = $(this).attr('id');
		if (orderNum != null) {
			$(this).parent().html(
					'<a href="#" id="'
							+ orderNum
							+ '" title="'
							+ Globalize.localize(
									"Afficher la première ligne du tableau",
									"fr_FR") + '" class="collapse">'
							+ Globalize.localize("Fermer", "fr_FR") + '</a>');
			$('.user-account .stamps-online .blockPack .packActions a.collapse')
					.bind('click',
							F6.UI.tableCommandStampsCollapseActionCollapse());

			    F6.AJAX.getLsStatutFromCsuivi(orderNum);

			$('a.expand').bind('click',
					F6.UI.tableCommandStampsCollapseActionExpand);
			$("#" + orderNum + " tbody").html("");
			$('#' + orderNum + '.detailsLS').removeClass(
					"noneDisplayToutDeatil");
			$('#' + orderNum + '.detailsLS').addClass("displayToutDeatil");
			var titleId = "" + orderNum + "Title";
			$('#' + titleId).removeClass("noneDisplayToutDeatil");
			$('#' + titleId).addClass("displayToutDeatil");
			$('#' + orderNum + 'ProgressBar').removeClass(
					"noneDisplayToutDeatil");
			$('#' + orderNum + 'ProgressBar').addClass("displayToutDeatil");
		} else {
			$(this).parent().html(
					'<a href="#" title="'
							+ Globalize.localize(
									"Afficher la première ligne du tableau",
									"fr_FR") + '" class="collapse">'
							+ Globalize.localize("Fermer", "fr_FR") + '</a>');
			$('.user-account .stamps-online .blockPack .packActions a.collapse')
					.bind('click',
							F6.UI.tableCommandStampsCollapseActionCollapse());
			$('a.expand').bind('click',
					F6.UI.tableCommandStampsCollapseActionExpand);
		}
		return false;
	};

	F6.UI.tableCommandStampsCollapseActionCollapse = function() {
		$('.user-account .stamps-online .blockPack .packActions a').unbind(
				'click');
		$(this).parent().parent().find('tbody tr').each(function() {
			$(this).hide();
		});
		$(this).parent().parent().find('tbody tr:first-child').show();
		var orderNum = $(this).attr('id');
		if (orderNum != null) {
			$(this)
					.parent()
					.html(
							'<a href="#" id="'
									+ orderNum
									+ '" title="'
									+ Globalize
											.localize(
													"Afficher la totalité des lignes du tableau",
													"fr_FR")
									+ '" class="expand">'
									+ Globalize.localize(
											"Voir toute la commande en détail",
											"fr_FR") + '</a>');
			$('.user-account .stamps-online .blockPack .packActions a.expand')
					.bind('click', F6.UI.tableCommandStampsCollapseActionExpand);

			$('#' + orderNum + '.detailsLS').removeClass("displayToutDeatil");
			$('#' + orderNum + '.detailsLS').addClass("noneDisplayToutDeatil ");
			$('#' + orderNum + 'cSuiviServerError').removeClass(
					"displayToutDeatil");
			$('#' + orderNum + 'cSuiviServerError').addClass(
					"noneDisplayToutDeatil");
			var titleId = "" + orderNum + "Title";
			$('#' + titleId).removeClass("displayToutDeatil");
			$('#' + titleId).addClass("noneDisplayToutDeatil ");
			$('#' + orderNum + 'ProgressBar').removeClass("displayToutDeatil");
			$('#' + orderNum + 'ProgressBar').addClass("noneDisplayToutDeatil");
		} else {
			$(this)
					.parent()
					.html(
							'<a href="#" title="'
									+ Globalize
											.localize(
													"Afficher la totalité des lignes du tableau",
													"fr_FR")
									+ '" class="expand">'
									+ Globalize.localize(
											"Voir toute la commande en détail",
											"fr_FR") + '</a>');
			$('.user-account .stamps-online .blockPack .packActions a.expand')
					.bind('click', F6.UI.tableCommandStampsCollapseActionExpand);
		}
		$('a.collapse').bind('click',
				F6.UI.tableCommandStampsCollapseActionCollapse);
		return false;
	};

	F6.UI.timerForDatepickerPosition = function() {
		setTimeout("F6.UI.timer()", 100);
	};

	F6.UI.timer = function() {

		if ($('.user-account .content.user-commands.send-postcard .ui-popup').length) {
			$('.user-account .content.user-commands.send-postcard .ui-popup')
					.css('left', '332px');
		}
		setTimeout("F6.UI.timer()", 100);

	};

	F6.UI.activeAjoutPersonneContrat = function() {
		$('.add_person .block-name').hide();

		$('.js-active .add_person').css('display', 'block')
		var idx_form = 0;
		var max_champ = $('.add_person .block-name').length;
		var txt_title = Globalize
				.localize(
						"ajouter un formulaire pour une autre personne concernée par le contrat (actuellement XX affiché",
						"fr_FR");
		$('.perscontrat .btn-ajouter').click(
				function(event) {
					event.preventDefault();

					title_temp = txt_title.replace('XX', idx_form + 1);

					// if(idx_form > 0) {title_temp += Globalize.localize("s)",
					// "fr_FR")}
					// else {title_temp += ')'}

					$('.perscontrat .btn-ajouter a').attr('title', title_temp);

					if (idx_form < max_champ) {
						$('.add_person .block-name:eq(' + idx_form + ')')
								.show();
						$('.add_person .block-name:eq(' + idx_form + ')').find(
								'select').focus();
						idx_form++;
					}
					return false;
				});
	};

	F6.UI.activeZIndex = function() {
		// bulles d'aide
		/*var zIndexNumber = 0;
		if ($('.htmltooltip_aide').length) {
			zIndexNumber = 10300;
			$('.htmltooltip_aide').each(function() {
				$(this).css('zIndex', zIndexNumber);
				zIndexNumber -= 10;
			});
		}
		if ($('.htmltooltip_aide_envoisuivi').length) {
			zIndexNumber = 10300;
			$('.htmltooltip_aide_envoisuivi').each(function() {
				$(this).css('zIndex', zIndexNumber);
				zIndexNumber -= 10;
			});
		}
		// DatePicker sur Page Compte_Prepaye_Historiqu
		// #datepicker #datepickerdebut #datepickerfin
		if ($('#datepicker').length || $('#datepickerdebut').length
				|| $('#datepickerfin').length) {
			zIndexNumber = 10000;
			$('.ui-popup').each(function() {
				$(this).closest('fieldset').css('zIndex', zIndexNumber);
				zIndexNumber -= 10;
			});

			$('.bg-datepicker div').each(function() {
				$(this).css('zIndex', zIndexNumber);
				zIndexNumber -= 10;
			});
			$('.ui-popup .block-bg-corner').each(function() {
				$(this).css('zIndex', zIndexNumber);
				zIndexNumber -= 10;
			});
		}

		zIndexNumber = 1000;

		if ($('#datepicker').length || $('#datepickerdebut').length
				|| $('#datepickerfin').length) {
			$('.datepicker-block-bg.block-bg-corner .block-corner').each(
					function() {
						$(this).css('zIndex', zIndexNumber);
						zIndexNumber -= 10;
					});
			$('.datepicker-block-bg.block-bg-corner').each(function() {
				$(this).css('zIndex', zIndexNumber);
				zIndexNumber -= 10;
			});
		}*/

	};

	F6.UI.activeDatepickerForm = function() {
		Globalize.culture('fr');
		$("#datepicker").datepicker();
		$('.datepicker-close-contener a.ui-datepicker-close').bind('click',
				function() {
					$("#datepicker").datepicker('close');
					$("#formReexStep1").blur();
					$("#formReexStep1").focus();
					return false;
				});
	};

	F6.UI.activeDatepickerDebut = function() {
		Globalize.culture('fr');
		$("#datepickerdebut").datepicker();
		if ($('.user-account .content.user-commands.send-postcard').length) {
			F6.UI.timerForDatepickerPosition();
		}

		$('.datepicker-close-contener a.ui-datepicker-close').bind('click',
				function() {
					$("#datepickerdebut").datepicker('close');
					var zIndexNumber = 1000;
					$('.bg-datepicker div').each(function() {
						$(this).css('zIndex', zIndexNumber);
						zIndexNumber -= 10;
					});
					$('.block-bg-corner').each(function() {
						$(this).css('zIndex', zIndexNumber);
						zIndexNumber -= 10;
					});
					return false;
				})
	};

	F6.UI.activeDatepickerFin = function() {
		Globalize.culture('fr');
		$("#datepickerfin").datepicker();
		$('.datepicker-close-contener a.ui-datepicker-close').bind('click',
				function() {
					$("#datepickerfin").datepicker('close');
					return false;
				})
	};

	F6.UI.activeSelectSimulation = function() {
		var zIndexNumber = 1000;
		$('.btn-select-simulation div').each(function() {
			$(this).css('zIndex', zIndexNumber);
			zIndexNumber -= 10;
		});

		$('.stamp-user-options div, .stamp-user-options label').each(
				function() {
					$(this).css('zIndex', zIndexNumber);
					zIndexNumber -= 10;
				});

		$('.btn-select-simulation .major-list').superfish({
			autoArrows : false,
			delay : 0,
			speed : 0
		});
		$('.btn-select-library a.btn-select').bind('click', function() {
			return false
		});
		cssObj = {
			'display' : 'block!important',
			'visibility' : 'visible !important'
		};
	};

	F6.UI.activeStampThumbs = function() {
		$('.stamp-thumbs').removeClass('scrollpane');
		$('.stamp-thumbs > ul').addClass('scrollpane');
		if (!F6.UTILS.isImageActivate()) {
			$('.stamp-thumbs .scrollpane li').css({
				'float' : 'none',
				'width' : 'auto',
				'height' : 'auto'
			});
			$('.stamp-thumbs label').css({
				'position' : 'relative',
				'border' : '0'
			});
			$('.stamp-thumbs li img').css('position', 'relative');
		}
		;
	};

	F6.UI.csuiviCheckboxList = function() {
		$('.track-order .select-etat .type-link')
				.append(
						'<a href="#" class="selectionner-les-etats form-radio-simulation selected" title="'
								+ Globalize
										.localize(
												"Sélectionne toutes les cases à cocher identifiant les états",
												"fr_FR")
								+ '">'
								+ Globalize.localize("tous les états", "fr_FR")
								+ '<span class="icon"></span></a> <a href="#" class="deselectionner-les-etats form-radio-simulation" title="'
								+ Globalize
										.localize(
												"Désélectionne les cases à cocher identifiant les états",
												"fr_FR")
								+ '">'
								+ Globalize.localize("Sélectionner les états",
										"fr_FR")
								+ '<span class="icon"></span></a>');

		select_element = $('.track-order .type-link a.selectionner-les-etats');
		unselect_element = $('.track-order .type-link a.deselectionner-les-etats');
		var checkbox_group = $('.track-order .select-etat input');
		var select_link = $('.track-order .type-link a');
		$('.track-order .select-etat .type-link').append(
				'<span class="hidden text-select-checkbox-descriptif">'
						+ Globalize.localize(
								"Aucune case à cocher est sélectionnée",
								"fr_FR") + '</span>')
		unselect_element.bind('click', function() {
			checkbox_group.removeAttr('checked');
			select_link.removeClass('selected');
			$(this).addClass('selected');
			$('.text-select-checkbox-descriptif').text(
					Globalize.localize("Aucune case à cocher est sélectionnée",
							"fr_FR"))
			return false;
		});

		select_element.bind('click', function() {
			checkbox_group.attr('checked', 'checked');
			select_link.removeClass('selected');
			$(this).addClass('selected');
			$('.text-select-checkbox-descriptif').text(
					Globalize.localize(
							"Toutes les cases à cocher sont sélectionnées",
							"fr_FR")
							+ ' (' + checkbox_group.length + ')')
			return false;
		});

	};

	F6.UI.searchSuiviByFile = function() {

		$("#search_suivi_by_file_fichier").change(function() {
			if ($("#search_suivi_by_file_fichier:checked").length) {
				$(".affichage-options").show();
			}

		}).change();
		$("#search_suivi_by_file_resultats").change(function() {
			if ($("#search_suivi_by_file_resultats:checked").length) {
				$(".affichage-options").hide();
			}

		}).change();
	};

	F6.UI.activeSuiviSubscription = function() {
		$('#suivi-subscription-btn').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### W');
                $.fancybox.resize();
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()

            }
        });
	};

	F6.UI.activeImpromptuDeleteItem = function() {
		if ($('.action-delete-item').length) {
			$('.action-delete-item').each(function() {
						uid = $(this).parent().parent().attr('id').replace('userid', '');
						$(this).bind('click', {uid : uid}, F6.UI.removeUser)
					});
		}
	};

	F6.UI.activeMtelImpromptuDeleteItem = function() {
		F6.UI.activeImpromptuDeleteItem();
	};

	/** **************************************** */
	/** GENERAL METHOD FOR AJAX AND PROMPT * */
	/** **************************************** */

	F6.UI.formatCurrency = function(value) {
		var temp = '';
		if (typeof (value) === 'string') {
			temp = value;
		} else {
			if (typeof (value) === 'number') {
				temp = String(value);
			}
		}
		if (temp != '') {
			temp = temp.replace('.', ',');
		}
		return temp;
	};

	F6.UI.removeItemSelectedAfterPrompt = function(datas, form_id) { // affichage
		// des messages de succes (successBoxTop)

		var message = datas.success_message;
		var emptied = false;
		if (datas.delete_fallback == 1) {
			// Update poidsTotal
			$('.poidsTotal').text(datas.poidsTotal);

			$('.removeAfterSuccesPromptAndAjax')
					.hide(
							'slow',
							function() {
								$(this).remove();
								var continueLink;
								if ($('#LelStep3Recap').length > 0
										|| $('#LelStep4Recap').length > 0) {
									// F6.VALIDATIONS.highlightError('lelTableDestinataire');
									continueLink = Globalize
											.localize(
													"Continuer à gérer les destinataires",
													"fr_FR");

								} else if (isMonComptePage){
								    continueLink = Globalize
                                            .localize(
                                                    "Retour vers la page profil",
                                                    "fr_FR");
								} else {
									continueLink = Globalize
											.localize(
													"Continuer la consultation des documents téléchargés",
													"fr_FR");
								}

								// Disgusting, isn't it ? Just don't get me
								// started.
								if ($('.tableBasketOverview').size() > 0) {
									continueLink = Globalize
											.localize(
													"Continuer la consultation de votre commande",
													"fr_FR");
									var count = $(
											'.tableBasketOverview tbody tr')
											.size()
									if (count <= 0) {
										// Si lien vers étape 1 présent sur la page, alors redirection auto vers cette page
										var redirection = $('.stepper-item-link');
										if (redirection.length > 0) {
											if (redirection[0].click) {
												redirection[0].click();
											}
										}

										if ($('.remote-recap-item-result')) {
											$('.remote-recap-item-result').html('0');
										}

										if ($('.remote-recap-item-price')) {
											$('.remote-recap-item-price').html('0 €');
										}

										if ($('#mtel-sheetpicker-iconDl')) {
											$('#mtel-sheetpicker-iconDl').hide();
										}

										if ($('.mtel-sheetpicker-note')) {
											$('.mtel-sheetpicker-note').hide();
										}

										if ($('#MTELRecapAjoutPanier')) {
											$('#MTELRecapAjoutPanier').attr('disabled', 'disabled');
											$('#MTELRecapAjoutPanier').addClass('mtel-btn-disabled');
										}

										if ($('#LOGORecapAjoutPanier')) {
											$('#LOGORecapAjoutPanier').attr('disabled', 'disabled');
											$('#LOGORecapAjoutPanier').addClass('mtel-btn-disabled');
										}

										message = Globalize
												.localize(
														"Tous vos articles ont bien été supprimés",
														"fr_FR");
										continueLink = Globalize.localize(
												"Retour.page.accueil", "fr_FR");
										$('#successBoxTop a').attr('href', "/");
										$(
												'.tableBasketOverview , .importantMessage, .importantMessageRecap, .printMessage, .total-ht, .total-tva, .numberTimbre, .recever-result, .price-result, .price-vat, .blockButtons, .aide_form')
												.remove();
										// $('.mtel-sheetpicker-note,
										// .mtel-sheetpicker-iconDl,
										// .mtel-sheetpicker-dlExample')
										// .remove();
										emptied = true;
									} else {
										var sum_tot_ttc = 0;
										var sum_nb_timbres = 0;
										var sum_nb_sticker = 0;
										$('[data-totalttc]')
												.each(
														function() {
															var temp = $(this)
																	.attr(
																			'data-totalttc');
															temp = temp
																	.replace(
																			'€',
																			'')
																	.replace(
																			',',
																			'.');
															sum_tot_ttc += Number(temp);
														});
										$('[data-nbitems]').each(
												function() {
													sum_nb_timbres += Number($(
															this).attr(
															'data-nbitems'));
												});
										$('[data-nbitems-sticker]').each(
												function() {
													sum_nb_sticker += Number($(
															this).attr(
															'data-nbitems-sticker'));
												});

										if ($('.remote-recap-item-result')) {
											$('.remote-recap-item-result').html(sum_nb_timbres);
										}
										if ($('.remote-recap-item-result-sticker')) {
											$('.remote-recap-item-result-sticker').html(sum_nb_sticker);
										}

										if ($('.remote-recap-item-price')) {
											$('.remote-recap-item-price').html(F6.UI.formatCurrency(sum_tot_ttc.toFixed(2)) + ' €');
											$('.remote-recap-item-price').attr( "content", F6.UI.formatCurrency(sum_tot_ttc.toFixed(2)) + ' €' );
										}

										form_id = $(
												'.tableBasketOverview tbody tr:first')
												.attr('id');
									}
								} else if ($('.myaddress', '#content').length > 0) {
									continueLink = Globalize.localize(
											"Continuer à gérer les adresses",
											"fr_FR");
									if (!$('.list-address li:eq(0)').find(
											'a:first-child').attr('id'))
										$('.list-address li:eq(0)').find(
												'a:first-child').attr('id',
												'linkto');
									form_id = 'linkto';
								} else if ($('#myBrouillon').length > 0) {
									continueLink = Globalize
											.localize(
													"Continuer la gestion de mes brouillons",
													"fr_FR");
									var count = $('#myBrouillon .tableMyCommands tr[id*="produit_item_"]').length;
									$('.numberBrouillon').text(
											'(' + count + ')');
									if (count <= 0) {
										message = Globalize
												.localize(
														"Tous vos brouillons ont bien été supprimés",
														"fr_FR");
										continueLink = Globalize
												.localize(
														"Retour vers la page d'accueil du compte",
														"fr_FR");
										$('#successBoxTop a').attr('href',
												'Compte_home.php');
										$(
												'#myBrouillon, .tableMyCommands, .blockFilter, .pagination')
												.remove();
										emptied = true;
									} else
										form_id = $(
												'.tableMyCommands tbody tr:first')
												.attr('id');
								} else if ($('#lel-tabs-1').length > 0) {
									// change the state of the page
									if (!$('.tabs-courrier li').first()
											.hasClass("notSaved")) {
										$('.tabs-courrier li').first()
												.removeClass("saved")
										$('.tabs-courrier li').first()
												.addClass("notSaved")
									}
									// Disabel upload buttons
									if (datas.nombreOfFichierUploader >= 10) {
										$('#file').attr("disabled", "disabled");
										$('#submitUploadFile').attr("disabled",
												"disabled");
									} else {
										$('#file').removeAttr("disabled");
										$('#submitUploadFile').removeAttr(
												"disabled");
										$('.btn-send-minor').removeClass(
												"light");

									}
									$('.error').innerHTML = ' ';
									$('.error').hide();
									message = "Document supprimé avec succès";

									// znouaoui BTKBACKLOG-1483 hide bloc remove
									// all items if no items found
									if (!$('.action-delete-item').length) {
										$('#uploadTableFooterId1').show();
										$('#uploadTableFooterId2').hide();
									}
								}


								// Ajout message complémentaire pour suppression paniers
								//message += '. Avez-vous regardé toute notre sélection de timbres ?';


								F6.UI.displaySuccessMessage(message, form_id,
										continueLink);
								if (emptied) {
									$('#successBoxTop a').attr('href',
											F6.UTILS.getMtelLink()
									/*
									 * retour à l'accueil du Mtel
									 */
									);
									$('.error').text('');
								}
								// remove option csuivi notification
								var containsSuiviProduct = false;
								$('.block-bg-corner tbody').find('.envoy')
										.each(function() {
											var product = $(this).html();
											if (product.contains('Suivi')) {
												containsSuiviProduct = true;
											}
										});
								/*if (containsSuiviProduct == false) {
									$('.trackLSMessage').css('display', 'none');
								}*/
							});
		} else {
			$.prompt('<div class="typo-din title3">Erreur</div>'
					+ Globalize.localize("Problème lors de la suppression",
							"fr_FR"));
		}
	}

	F6.UI.displaySuccessMessage = function(m, form_id, link_message) {

		message_lien = link_message !== undefined ? link_message : 'Poursuivre';
		// if(typeof form_id !== 'undefined')
		$('#successBoxTop').html(
				'' + m + '<p><a href="#' + form_id + '"> ' + message_lien
						+ ' </a></p>');
        if (isMonComptePage) {
            $('#successBoxTop a').attr('href', "/compte/profil?ref=adresses");
        }
		$('#successBoxTop').fadeIn(
				200,
				function(e) {
					$('#tableProduitItems td.exergue-color span').removeClass(
							'product-price-value');
					$('#tableServiceItems .infoService div').css('font-weight',
							'400');
					window.setTimeout(function() {
						document.location.href = "#successBoxTop";
						$('#successBoxTop').find('a').focus();
						$('#tableProduitItems td.exergue-color span').addClass(
								'product-price-value');
						$('#tableServiceItems .infoService div').css(
								'font-weight', 'normal');
					}, 200);

					/* add for /adresses-personnelles/#linto (rga) */
					$('#successBoxTop').find('a').bind('click', function() {
						$('#successBoxTop').empty();
						$('#successBoxTop').removeAttr('style');
					});

					/* rga : affichage des bordures et padding */
					$('ul.list-address > li').each(function(index) {
						$(this).removeClass('first');
						$(this).removeClass('last');
						if (index % 3 == 0) {
							$(this).addClass('first');
						} else if (index % 3 == 2) {
							$(this).addClass('last');
						}
					});

					return false;
				});
	};

	// znouaoui JIRA 1321
	F6.UI.fadeSuccessMessage = function() {
		$('.successDisplay.jsOFF').find('a').focus();
		$('.successDisplay.jsOFF').fadeIn(200, function(e) {
			$('.successDisplay.jsOFF').find('a').bind('click', function() {
				$('.successDisplay.jsOFF').empty();
				$('.successDisplay.jsOFF').removeAttr('style');
			});

			return true;
		});
	};

	/** ************************************** */
	/** MTEL CRUD * */
	/** ************************************** */
	F6.UI.executeMTELRecapStep = function() {

		$('.mtel-recap-icon-delete2').bind('click', F6.UI.promptMtelRecapStep);

	};

	F6.UI.promptMtelRecapStep = function(e) {
		// e.data pour recuperer des variables
		e.preventDefault();
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this));
		var element = $('.item_' + id);
		var isLogo = false;
		if ($('#mtelLogo').length > 0) {
			isLogo = true;
		}
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize.localize(
						"Etes-vous certain de vouloir supprimer ce produit ?",
						"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$.prompt(txt, {
			buttons : {
				Supprimer : true,
				Annuler : false
			},
			callback : function(e, v, m, f) {
				if (v) {
					$(element).addClass('removeAfterSuccesPromptAndAjax');
					F6.AJAX.mtelDeleteItem(e, {
						id : f.itemId,
						success_message : Globalize.localize(
								"Ligne de commande supprimée avec succés",
								"fr_FR"),
						isProLogo : isLogo
					});
				} else {
					// $(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			}
		});
	};

	F6.UI.mtelDeleteItemAfterPrompt = function(datas) {
		F6.UI.removeItemSelectedAfterPrompt(datas, null);
		var isLogo = false;
		if ($('#mtelLogo').length > 0)
			isLogo = true;
		F6.AJAX.mtelCalculateItemPrice(isLogo)

		// F6.AJAX.tunnelAchatPanierAdjutPrice($('#courrierData').serialize());

	}

	F6.UI.popMariannezoom = function() {
		$('#popup-marianne').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### X');
                $('<a class="btn-cancel btn-placement" href="#" onClick="parent.jQuery.fancybox.close(); "><span>Fermer</span></a>').appendTo('.fancybox-container');
                $('#fancybox-frame').attr('tabindex', '0');
                $('#fancybox-frame').focus();
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()

            }
        });
	};
	F6.UI.sendAlerteFicheProduit = function(data) {
		if (data.success) {
			$('#successMessage').css({
				'color' : 'rgb(101,92,83)'
			});
			$('#fieldNom').find("span").removeClass("error-contener");
			$('#messageErreurNom').html("");
			$('#fieldPrenom').find("span").removeClass("error-contener");
			$('#messageErreurPrenom').html("");
			$('#fieldMail').find("span").removeClass("error-contener")
			$('#messageErreurMail').html("");
			$('#successMessage').html(data.message);
			$('#envoyerFormPopin').prop('disabled', true);
			$('#formPopinFicheProduit .btn-effect').css({
				'visibility' : 'hidden'
			});
			$(".formContent, .descriptionPopin, .label-name, .label-firstname, .label-email").css({
				'visibility' : 'hidden'
			});

			$('.linkbacktoproduct').css({
				'visibility' : 'visible'
			});
			$('.popinAlerte').addClass('success');
		} else {
			$('#envoyerFormPopin').prop('disabled', false);
			$('#formPopinFicheProduit .btn-effect').css({
				'visibility' : 'visible'
			});
			$(".formContent, .descriptionPopin").css({
				'visibility' : 'visible'
			});

			$(".label-name, .label-firstname, .label-email").css({
				'visibility' : 'visible'
			});
			 $(".label-name, .label-firstname, .label-email").addClass('error-label');

			$('.linkbacktoproduct').css({
				'visibility' : 'hidden'
			});
			$('.popinAlerte').removeClass('success');
			if (data.erreurNom != null) {
				$('#fieldNom').find("span").addClass("error-contener")
				$('#messageErreurNom').html(data.erreurNom);
			} else {
				$('#fieldNom').find("span").removeClass("error-contener")
				$('#messageErreurNom').html("");
			}
			if (data.erreurPrenom != null) {
				$('#fieldPrenom').find("span").addClass("error-contener")
				$('#messageErreurPrenom').html(data.erreurPrenom);
			} else {
				$('#fieldPrenom').find("span").removeClass("error-contener")
				$('#messageErreurPrenom').html("");
			}
			if (data.erreurMail != null) {
				$('#fieldMail').find("span").addClass("error-contener")
				$('#messageErreurMail').html(data.erreurMail);

			} else {
				$('#fieldMail').find("span").removeClass("error-contener")
				$('#messageErreurMail').html("");
			}
			if (data.message != null) {
				$('#successMessage').css({
					'color' : 'rgb(153,7,5)'
				});
				$('#successMessage').html(data.message);
			} else {
				$('#successMessage').css({
					'color' : 'green'
				});
				$('#successMessage').html("");
			}
		}
	}

	F6.UI.mtelCalculateItemPrice = function(datas) {
		// dans certains cas (notamment dans le cas de redirection), l'objet datas peut être à null
		// ce qui plante le JS (le patch ci-dessous a pour but d'empêcher ce plantage)
		if (datas != null) {
			$('.price-result .value-total').html(datas.total_ttc + ' <abbr title="euros">€</abbr>');
			$('.recever-result .value-recever').html(datas.stamp_count);
			$('.numberTimbre .value-recever').html(datas.stamp_count);
			$('.total-ht .value').html(datas.total_ht + ' <abbr title="euros">€</abbr>');
			$('.total-tva .value').html(datas.total_tva + ' <abbr title="euros">€</abbr>');

            var nb_divStickersSuivi = $('.item-mtel-suivi-recap').length -1;
            /** ECOMHT-175 **/
            if (nb_divStickersSuivi == 0) {
                $('.js-stickers_suivi').hide();
            }
		}

	}

	/** **************************************** */
	/** LEL * */
	/** ************************************** */

	F6.UI.executeLelCourrierDownloadList = function() {
		if ($('.action-delete-item').length) {
			$('.action-delete-item').unbind('click');
			$('.action-delete-item').bind('click',
					F6.UI.promptLelRemoveDownloadMail);
		}
		// znouaoui BTKBACKLOG-1483
		if ($('.action-delete-allitems').length) {
			$('.action-delete-allitems').unbind('click');
			$('.action-delete-allitems').bind('click',
					F6.UI.promptLelRemoveAllDownloadedDoc);
		}
	};

	F6.UI.promptLelRemoveDownloadMail = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this));
		var element = $('#item_' + id);
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize.localize(
						"Etes-vous certain de vouloir supprimer ce document ?",
						"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$.prompt(txt, {
			buttons : {
				Supprimer : true,
				Annuler : false
			},
			callback : function(e, v, m, f) {
				if (v) {
					$(element).addClass('removeAfterSuccesPromptAndAjax')
					F6.AJAX.LelRemoveDownloadMail(e, {
						id : f.itemId,
						success_message : Globalize.localize(
								"Courrier supprimée avec succés", "fr_FR")
					});
				} else {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			}
		});

		$('.jqibuttons .btn-dir-cancel button')
				.attr(
						'title',
						Globalize
								.localize(
										'Annuler la suppression du document et revenir à la gestion de vos documents',
										'fr_FR'));
		$('.jqibuttons .confirm-choice button').attr(
				'title',
				Globalize.localize('Confirmer la suppression du document',
						'fr_FR'));
	};

	// znouaoui BTKBACKLOG-1483
	F6.UI.promptLelRemoveAllDownloadedDoc = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize
						.localize(
								"Etes-vous certain de vouloir supprimer tous les documents ?",
								"fr_FR") + '';
		$
				.prompt(
						txt,
						{
							buttons : {
								Supprimer : true,
								Annuler : false
							},
							callback : function(e, v, m, f) {
								if (v) {
									F6.UI
											.redirect(EBK.config.contextPath+'/lettre-en-ligne/supprimer-tous-document#successBoxTop');
								} else {
									$(el_trigger).focus();
									$('#successBoxTop').find('a').focus();
								}
							}
						});
		$('.jqibuttons .btn-dir-cancel button')
				.attr(
						'title',
						Globalize
								.localize(
										'Annuler la suppression du document et revenir à la gestion de vos documents',
										'fr_FR'));
		$('.jqibuttons .confirm-choice button').attr(
				'title',
				Globalize.localize('Confirmer la suppression du document',
						'fr_FR'));

	};

	F6.UI.promptLrelRemoveAllDownloadedDoc = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize
						.localize(
								"Etes-vous certain de vouloir supprimer tous les documents ?",
								"fr_FR") + '';
		$.prompt(txt,{
							buttons : {
								Supprimer : true,
								Annuler : false
							},
							callback : function(e, v, m, f) {
								if (v) {
									F6.UI
											.redirect(EBK.config.contextPath+'/lettre-recommandee-en-ligne/supprimer-tous-document#successBoxTop');
								} else {
									$(el_trigger).focus();
									$('#successBoxTop').find('a').focus();
								}
							}
						});
		$('.jqibuttons .btn-dir-cancel button')
				.attr(
						'title',
						Globalize
								.localize(
										'Annuler la suppression du document et revenir à la gestion de vos documents',
										'fr_FR'));
		$('.jqibuttons .confirm-choice button').attr(
				'title',
				Globalize.localize('Confirmer la suppression du document',
						'fr_FR'));

	};
	F6.UI.LelRemoveDownloadMailAfterPrompt = function(datas) {
	};

	F6.UI.executeLelCRUD = function() {

		if ($('.action-delete-item').length > 0) {
			$('.action-delete-item').unbind('click');
			$('.action-delete-item').bind('click',
					F6.UI.promptLelRemoveReceiverAddress);
		}
		if ($('.action-insert-item').length > 0) {
			$('.action-insert-item').unbind('click');
			$('.action-insert-item').bind('click',
					F6.UI.promptLelAddReceiverToAddressBook);
		}
		var el_delete_all = $('.action-delete-all');
		if (el_delete_all.length > 0) {
			el_delete_all.unbind('click');
			el_delete_all
					.bind(
							'click',
							function(e) {
								F6.stop(e);
								var el_trigger = this;
								var txt = '<div class="typo-din title3">Confirmation</div>'
										+ Globalize
												.localize(
														"Etes-vous certain de vouloir supprimer tous les destinataires ?",
														"fr_FR")
										+ ' <input type="hidden" id="itemId" name="itemId" value="all" />';
								$
										.prompt(
												txt,
												{
													buttons : {
														Supprimer : true,
														Annuler : false
													},
													callback : function(e, v,
															m, f) {
														if (v) {
															var table = $(
																	'#lelTableDestinataire')
																	.find(
																			"tr[id*=item_]");
															$
																	.each(
																			table,
																			function(
																					a,
																					b) {
																				var id_del = table
																						.attr('id');
																				$(
																						this)
																						.fadeOut(
																								'slow')
																						.remove();
																				F6.AJAX
																						.lelDeleteReceiverAddresses(
																								e,
																								{
																									id : id_del
																								},
																								"");
																			});
															if ($(
																	'ul.pagination')
																	.is(
																			':visible'))
																$(
																		'ul.pagination')
																		.fadeOut(
																				'slow');
															$(
																	'.action-delete-all')
																	.fadeOut(
																			'slow');
															if ($('#LelStep3Recap').length > 0) {
																F6.VALIDATIONS
																		.highlightError('LelStep3Recap');
																F6.AJAX
																		.LelSummaryBasketAjax('LelStep3Recap');
															} else if ($('#LelStep4Recap').length > 0) {
																F6.VALIDATIONS
																		.highlightError('LelStep4Recap');
																F6.AJAX
																		.LelSummaryBasketAjax('LelStep4Recap');
															}
														} else {
															$(el_trigger)
																	.focus();
															$('#successBoxTop')
																	.find('a')
																	.focus();
														}
														$.fancybox.close();
													}
												});
							});
		}
		var el_update_item = $('.action-update-item');
		if (el_update_item.length > 0) {
			el_update_item.unbind('click');
			el_update_item
					.bind(
							'click',
							function(e) {
								F6.stop(e);
								var id = F6.UTILS.findMyIdNumber($(this));
								var element = $('#item_' + id);
								var form_validation = '';
								var receiver = destinataires.getReceiverAt(id);
								var typ = element.find('td:first-child input[type="hidden"]:first-child').val();
								var href_fancybox = F6.AJAX.mtelPopinDestinataireUpdate(typ);
								F6.UI.activeBodyFullJS();
                                $.fancybox.open({
                                    src  : URLS.updatePath( href_fancybox ),
                                    type : 'ajax',
                                    afterShow : function(instance, current) { console.log('### Y');
                                        var update_form = false;
                                        var name_form = '';
                                        if ($('#coordonneesParticulier').length) {
                                            update_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
                                            name_form = 'coordonneesParticulier';
                                        } else {
                                            update_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
                                            name_form = 'coordonneesProfessionnel';
                                        }
                                        if (update_form) {
                                            update_form.settings.submitHandler = function(form) {
                                                destinataires.updateReceiver(typ, form);
                                                $.fancybox.close();
                                            };
                                        }

                                        // init du HTML
                                        F6.UI.activeUniform();
                                        $('#fancybox-frame').attr('title', Globalize.localize("Ajouter des destinataires", "fr_FR"));
                                        $('#fancybox-frame').attr('tabindex', '0');
                                        $('#fancybox-frame').focus();
                                    },
                                    opts : {
                                        touch: false,
                                        momentum: false,
                                        smallBtn: false,
                                        clickOutside: false,
                                        baseTpl : Popup.template()

                                    }
                                });
							});
		}
		var destinataires = new F6.UI.mtelEnveloppeReceiverList(
				{
					render_template : ($('#LelStep4Recap').length > 0) ? '_scripts/templates/lelRecap.tmpl'
							: '_scripts/templates/lelDestinataires.tmpl',
					render_element : '#lelTableDestinataire',
					render_callback : 'F6.UI.executeAfterRenderReceiverTable(dest)'
				});

		$('.destinatairesAdd .btn-action-minor').fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### Z');
                F6.UI.executeMtelPopinLinks(instance, destinataires);
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                trapFocus: false,
                trapFocus: false,
                clickOutside: false,
                baseTpl : Popup.template()

            }
        });
	};

	F6.UI.promptLelRemoveReceiverAddress = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this));
		var element = $('#item_' + id);
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize.localize("Etes-vous certain de vouloir supprimer cette adresse ?", "fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$.prompt(txt,
				{
					buttons : {
						Supprimer : true,
						Annuler : false
					},
					callback : function(e, v, m, f) {
						if (v) {
							$(element).addClass(
									'removeAfterSuccesPromptAndAjax')
							$('input[name="receiver_count"]')
									.val(
											$('input[name="receiver_count"]')
													.val() - 1);
							F6.AJAX.lelDeleteReceiverAddresses(e, {
								id : f.itemId,
								success_message : Globalize.localize(
										"Adresse supprimée avec succès",
										"fr_FR")
							});
							if ($('#lelTableDestinataire')
									.find("tr[id*=item_]").length === 0) {
								$('ul.pagination').fadeOut('slow');
								$('#lelTableDestinataire').find(
										".actions.delete").fadeOut('slow');
							}
						} else {
							$(el_trigger).focus();
							$('#successBoxTop').find('a').focus();
						}
					}
				});
		return false;
	}

	F6.UI.removeLelItemSelectedAfterPrompt = function(datas) {
		datas.success_message = 'Destinataire supprimé';
		F6.UI.removeItemSelectedAfterPrompt(datas, 'lelTableDestinataire');
		if ($('.content.step4').length > 0) {
			// pour l'etape 4
			F6.VALIDATIONS.highlightError('LelStep4Recap');
			F6.AJAX.LelSummaryBasketAjax('LelStep4Recap');
		} else {
			F6.VALIDATIONS.highlightError('LelStep3Recap');
			F6.AJAX.LelSummaryBasketAjax('LelStep3Recap'); // pour l'?tape 3

		}

	}

	F6.UI.executeLelOptionItem = function() {
		if ($('.action-option-item').length) {
			$('.action-option-item input').bind(
					'change',
					function() {
						if ($(this).attr('checked') == 'checked') {
							option_price = $(this).val();
						} else {
							option_price = 0;
						}
						$(this).parent().find('.value').html(
								F6.UTILS.changeToCurrency(option_price));
						F6.AJAX.LelSummaryBasketAjax();
					});
		}
	};

	// recalcule le panier
	F6.UI.LelSummaryBasket = function(datas) {

		unit_price = datas.price;
		total_ht = datas.total_ht;
		total_tva = datas.total_tva;
		total = datas.total;
		max_receivers = datas.max_receivers;
		receiver_count = datas.receiver_count;
		receiver_inluded_withdrawal = datas.receiver_inluded_withdrawal;

		if (receiver_count === 0) {
			receiver_count = "0";
			if ($('#lelTableDestinataire').length > 0) {
				$('.action-delete-all', '#lelTableDestinataire').fadeOut(
						function() {
							$(this).remove();
						});
				$('ul.pagination', '#lelTableDestinataire').fadeOut(function() {
					$(this).remove();
				});
			}
		}
		if (receiver_count == 0 || receiver_count == 1) {
			$('.destinataire-string.value-string').text("destinataire");
		} else {
			$('.destinataire-string.value-string').text("destinataires");
		}

		$('.noDestinatairesInfo .addressesCount').text(receiver_count);
		$('.footer-destinataires .infoContacts strong').text(
				max_receivers - receiver_count);
		$(
				'.destinataires-resume-block .optionsResume .value-integer, .user-count .value-integer, .recever-result .value-integer')
				.text(receiver_count);

		var formattedTotal = F6.UTILS.changeToCurrency(total);
		var formattedTotalHT = F6.UTILS.changeToCurrency(total_ht);
		var formattedTotaTVA = F6.UTILS.changeToCurrency(total_tva);

		if (datas.total == "Forfait") {
			formattedTotal = "Forfait";
			formattedTotalHT = "";
			formattedTotaTVA = "";

			if ($('.pmcConfirmEnvoi').length > 0) {
				$('.pmcConfirmEnvoi').name = "checkout";
				$('.pmcConfirmEnvoi').value = "Confirmer l'envoi";
			}
		}

		$('.destinataireResults .price-result .value-integer').html(
				formattedTotal)
		$('.totalHT .value').html(formattedTotalHT);
		$('.totalTVA .value').html(formattedTotaTVA);
		$('.total .value').html(formattedTotal);
		$('.optionsResume .value').html(formattedTotal);
		$('.receiver_inluded_withdrawal .value-integer').html(
				receiver_inluded_withdrawal);
		$('dd.receiver_inluded_withdrawal').text(receiver_inluded_withdrawal);

		F6.UI.destinatairesCRUD(max_receivers - receiver_count, false);
	};

	F6.UI.promptLelAddReceiverToAddressBook = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this));
		var element = $(this).parent();
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize
						.localize(
								"Etes-vous certain de vouloir ajouter cette adresse à votre carnet ?",
								"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$.prompt(txt, {
			buttons : {
				Ajouter : true,
				Annuler : false
			},
			callback : function(e, v, m, f) {
				if (v) {
					$(element).addClass('removeAfterSuccesPromptAndAjax')
					F6.AJAX.LelAddReceiverToAddressBook(e, {
						id : f.itemId,
						success_message : Globalize.localize(
								"Adresse ajoutée avec succés", "fr_FR")
					});
				} else {
					$(el_trigger).focus()
					$('#successBoxTop').find('a').focus();
				}
			}
		});
	};

	F6.UI.LelAddReceiverToAddressBookAfterPrompt = function(datas) {
		var message = datas.success_message;
		if (datas.update_fallback == 1) {
			$('.removeAfterSuccesPromptAndAjax')
					.html(
							'<img src="images/icons/ico_check_gray.gif" alt="Contact déjà ajouté" />');
			$('.removeAfterSuccesPromptAndAjax').removeClass(
					'removeAfterSuccesPromptAndAjax');
			if ($('#LelStep3Recap').length > 0
					|| $('#LelStep4Recap').length > 0) {
				F6.VALIDATIONS.highlightError('lelTableDestinataire');
				return false;
			}
			F6.UI.displaySuccessMessage(message, '', Globalize.localize(
					"Continuer à gérer les destinataires", "fr_FR"));
		} else {
			$.prompt('<div class="typo-din title3">Erreur</div>'
					+ Globalize.localize("Problème lors de la mise à jour",
							"fr_FR"));
		}
	}

	F6.UI.executeAfterRenderReceiverTable = function(destinataires) {
		$('.destinataires-wrap li').show();
		$('.destinataireResults .value-integer').text(
				destinataires.getReceiverQuantity());
		$('.destinataires-resume-block .user-count .value-integer').text(
				destinataires.getReceiverQuantity());
		$(
				"#LelStep3Recap_receiver_count, #LelStep4Recap input[name='receiver_count']")
				.val(destinataires.getReceiverQuantity());
		// action pour LEL step 3&4
		// F6.UI.displaySuccessMessage(Globalize.localize( "Adresse ajout?e avec
		// succ?s", "fr_FR" ), 'lelTableDestinataire');
		if ($('#LelStep3Recap').length > 0) {
			F6.VALIDATIONS.highlightError('LelStep3Recap');
			F6.AJAX.LelSummaryBasketAjax('LelStep3Recap');
		} else if ($('#LelStep4Recap').length > 0) {
			F6.VALIDATIONS.highlightError('LelStep4Recap');
			F6.AJAX.LelSummaryBasketAjax('LelStep4Recap');
		}
	}

	/** ****************************************************** */
	/** USER ACCOUNT CRUD * */
	/** ****************************************************** */

	F6.UI.executeUserAddressCRUD = function() {
		$('.action-update-item').bind('click', function(e) {
			F6.stop(e);
			idx = F6.UTILS.findMyIdNumber($(this));
			F6.AJAX.userLoadAddresses(e, {
				id : idx
			});
			$('#errorBoxTop > ul > li > label').attr("style", "display:none");
			$('.error-contener').removeClass('error-contener');
			$('#successBoxTop').removeAttr('style');
		});
		$('.action-delete-item').bind('click', F6.UI.promptRemoveUserAddress);
		$('.action-default-item').bind('click', F6.UI.promptDefaultUserAddress);
		$('.action-add-item')
				.bind(
						'click',
						function(e) {
							F6.stop(e);
							F6.UTILS
									.clearForm(
											'editAddress',
											Globalize.localize("Ajouter",
													"fr_FR"),
											Globalize
													.localize(
															"Ajouter cette nouvelle adresse à mes adresses personnelles",
															"fr_FR"));
							$('#errorBoxTop > ul > li > label').attr("style",
									"display:none");
							$('.error-contener').removeClass('error-contener');
							$('div#uniform-countryCode > span:first').empty();
							$('select#countryCode > option:first').attr(
									'selected', 'selected');
							$('#successBoxTop').removeAttr('style');
						});
	};

	F6.UI.promptRemoveUserAddress = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this));
		var element = $(this).parent().parent().parent();
        var csrfNameElt = document.querySelector("meta[name='_csrf']");
        var token = csrfNameElt && csrfNameElt.getAttribute("content");

		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize
						.localize(
								"Etes-vous certain de vouloir supprimer cette adresse ?",
								"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$.prompt(txt, {
			buttons : {
				Supprimer : true,
				Annuler : false
			},
			callback : function(e, v, m, f) {
				if (v) {
					$(element).addClass('removeAfterSuccesPromptAndAjax')
					$("#block-address-form").hide();
					F6.AJAX.userDeleteAddresses(e, {
						id : f.itemId,
						'_csrf' : token,
						success_message : Globalize.localize(
								"Adresse supprimée avec succès", "fr_FR")
					});
				} else {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			}
		});
		return false;
	}

	F6.UI.promptDefaultUserAddress = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this));
		var element = $(this).parent();
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize
						.localize(
								"Etes-vous certain de vouloir définir cette adresse par défaut ?",
								"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$.prompt(txt, {
			buttons : {
				Oui : true,
				Non : false
			},
			callback : function(e, v, m, f) {
				if (v) {
					$(element).addClass('removeAfterSuccesPromptAndAjax')
					F6.AJAX.userDefaultAddresses(e, {
						id : f.itemId,
						success_message : Globalize.localize(
								"Adresse modifiée avec succés", "fr_FR")
					});
				} else {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			}
		});
		return false;
	}

	F6.UI.userDefaultAddressesAfterPrompt = function(datas) {
		var message = datas.success_message;
		if (datas.update_fallback == 1) {
			old_contener = $('.list-action .default');
			new_contener = $('.removeAfterSuccesPromptAndAjax');

			old_element = old_contener.html();
			new_element = new_contener.html();
			old_contener.html('').html(new_element);
			new_contener.html('').html(old_element);
			if (old_contener.parent().find('.action-delete-item').parent().length > 0)
				old_contener.parent().find('.action-delete-item').parent()
						.show();
			else {
				nContent = new_contener.parent().find('.action-delete-item')
						.parent().html();
				var nTag = $('<li>' + nContent + '</li>').insertAfter(
						old_contener.parent().children().eq(0));
				nTag.find('.action-delete-item').bind('click',
						F6.UI.promptRemoveUserAddress);
			}
			old_contener.parent().find('.action-default-item').bind('click',
					F6.UI.promptDefaultUserAddress).parent().show();
			new_contener.parent().find('.action-delete-item').parent().hide();
			new_contener.parent().find('.action-default-item').parent().hide();
			old_contener.removeClass('default');
			new_contener.removeClass('removeAfterSuccesPromptAndAjax')
					.addClass('default');
			new_contener.text("Adresse par défaut ");

			if (!$('.list-address li:eq(0)').find('a:first-child').attr('id'))
				$('.list-address li:eq(0)').find('a:first-child').attr('id',
						'linkto');
			form_id = 'linkto';

			F6.UI.displaySuccessMessage(message, 'linkto', Globalize.localize(
					"Continuer à gérer les adresses", "fr_FR"));

		} else {
			$.prompt('<div class="typo-din title3">Erreur</div>'
					+ Globalize.localize("Problème lors de la mise à jour",
							"fr_FR"));
		}
	}

	/** ****************************************************** */
	/** USER ACCOUNT ADDRESS BOOK CRUD * */
	/** ****************************************************** */

	F6.UI.userAddressBookCRUD = function() {
		$('#user_account_personal_address_book input[type="submit"]').bind(
				'click', F6.UI.promptUserDeleteAddressBook);
		$('#user_account_personal_address_book').bind('submit', function(e) {
			F6.stop(e);
			F6.AJAX.userDeleteAddressBook(this);
		});
		$('#user_account_personal_address_book .edit-part a').bind('click',
				F6.UI.getAddressBookEdit);

		F6.UI.userAddressBookUploadFile();
	};

	F6.UI.executeAddressBookEditForm = function(e) {
		F6.stop(e);
		var addressId = e.currentTarget.id;
		$('#user_id').val(addressId);
		var form_element = $('<form>');
		form_element.attr('id', 'address_book_edit_form');
		user_id_input = $('#user_id').clone();
		el_parent = $(this).parent().parent();
		input_contact = $('input', el_parent);
		destinataire_id_form = $('<input>');
		destinataire_id_form.attr('value', input_contact.val());
		destinataire_id_form.attr('name', 'destinataire_id');
		form_element.append(user_id_input);
		form_element.append(destinataire_id_form);
		form_element.submit(function(e) {
			e.preventDefault();
			F6.AJAX.getPersonalAddress(this);
		});
		form_element.trigger('submit');
	}

	F6.UI.AddressBookEditFormAfterAjax = function(datas) {
		var tempolate_url = '';
		if (datas.destinataire.type == 'particulier') {
			tempolate_url = '_scripts/templates/carnetAdresseParticulierForm.tmpl'
		}
		if (datas.destinataire.type == 'professionnel') {
			tempolate_url = '_scripts/templates/carnetAdresseProfessionnelForm.tmpl'
		}

		if (tempolate_url.length)
			$.get(tempolate_url, function(template) {
				$('.content.contact-book').addClass('edit-contact');
				$('.panel-display').html(_.template(template, datas));
				$('.panel-display form fieldset input:first').focus();
				F6.UI.activeUniform();
				if (datas.destinataire.type == 'particulier') {
					F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
				} else {
					F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
				}
			}).error(
					function(e, m) {
						alert("Erreur de lecture du fichier de template :\n"
								+ tempolate_url);
					});
		return false;
	}

	F6.UI.promptUserDeleteAddressBook = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var ids = '';
		$('#user_account_personal_address_book input:checked').each(function() {
			ids += '|' + $(this).val();
		});
		var count_selected = $(':checked',
				'#user_account_personal_address_book').length;
		var adjust = count_selected > 1 ? 'ces ' + count_selected + ' contacts'
				: 'ce contact';
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize.localize("Etes-vous certain de vouloir supprimer ",
						"fr_FR") + adjust + " ?"
				+ ' <input type="hidden" id="itemIds" name="itemIds" value="'
				+ ids + '" />';
		$.prompt(txt, {
			buttons : {
				Supprimer : true,
				Annuler : false
			},
			callback : function(e, v, m, f) {
				if (v) {
					$('#user_account_personal_address_book').trigger('submit');
				} else {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			}
		});
	}

	F6.UI.userDeleteAddressBookAfterPrompt = function(datas) {
		var isMonCompte = document.getElementsByClassName("moncompte-container")[0];
		if (datas.delete_fallback == true) {
			if (datas.count_contacts == 0) {
				if (isMonCompte) {
					F6.UI.redirect(EBK.config.contextPath+'/compte/profil?ref=adresses');
				}
				else{
				F6.UI.redirect(EBK.config.contextPath+'/mon-compte/carnet-adresses');
				}

			} else {
				var myArray = [];
				$.each(datas.contacts, function(key, val) {
					// Recuperation id de l'ul à supprimer
					var ulEle = $('input[value="' + val + '"]',
							'#user_account_personal_address_book').parent()
							.parent().parent().attr('id');

					myArray.push(ulEle);

					$('input[value="' + val + '"]',
							'#user_account_personal_address_book').parent()
							.parent().fadeOut(200, function() {
								$(this).remove()
							})
				});

				$.each(myArray, function(index, item) {
					setTimeout(
							function() {
								if ($('ul[id="' + myArray[index] + '"]')
										.children().length == 0) {
									$('[id="rep-' + myArray[index] + '"]')
											.remove();
									$(
											'[id="rep-' + myArray[index]
													+ myArray[index] + '"]')
											.remove();
									$('ul[id="' + myArray[index] + '"]')
											.remove();
								}
							}, 250);
				});

				if (datas.count_contacts > 1) {
					$('span.contact-count').text(
							datas.count_contacts + ' contacts')
				} else {
					$('span.contact-count').text(
							datas.count_contacts + ' contact')
				}

				if (datas.contacts.length > 1) {
					F6.UI.displaySuccessMessage(Globalize.localize(
							"Les contacts sélectionnés ont été supprimés",
							"fr_FR"), 'top-rep', Globalize.localize(
							"Continuer à gérer les contacts", "fr_FR"));
				} else {
					F6.UI.displaySuccessMessage(Globalize.localize(
							"Le contact sélectionné a été supprimé", "fr_FR"),
							'top-rep', Globalize.localize(
									"Continuer à gérer les contacts", "fr_FR"));
				}

				id_table = datas.contacts;
				for (idx in id_table) {
					id = id_table[idx];
					var li = $('span.delete-part input[value="' + id + '"]')
							.parent().parent();
					var ul = li.parent();
					li.remove();
					if (ul.find('li').length == 0) {
						var character = ul.prev().attr('id');
						ul.prev().remove();
						$('.liens-repertoire li a[href="#' + character + '"]')
								.parent().parent().remove();
					}
				}
				$('.liens-repertoire li a:first').focus();
				$('.liens-repertoire li a:first').parent().parent().addClass(
						'selected');
			}
			var template = "<div class='no-content-yet'> "
					+ "<p>Pour afficher les d&eacute;tails d'un contact,<br> "
					+ "veuillez cliquer dans la liste de gauche </p> "
					+ "</div>";
			$('.panel-display').html(template);
			$('.cl-footer .delete').addClass('light');
			$('.cl-footer .delete input').prop('disabled', true);
			tc_events_1(this, "CLICK",{'event': 'F', 'level2': '2', 'chapter1': 'Carnet_adresses', 'name':'Confirmation_suppression_contacts'});
		}

	}

	F6.UI.showUserAddress = function(datas) {
		var form = document.forms['editAddress'];
		F6.UTILS.fillForm('editAddress', datas, Globalize.localize("Modifier",
				"fr_FR"), Globalize.localize(
				"Modifier cette adresse personnelle", "fr_FR"))

        $(document).ready(function(){
            reInitCodePostalInput();
        });
	};

	/** ******************************** */
	/** MY BROUILLON * */

	F6.UI.executeMyBrouillon = function() {
		if ($('#myBrouillon #tableServiceItems a.action-delete-item').length > 0)
			$('#myBrouillon #tableServiceItems a.action-delete-item').bind(
					'click', {
						prefix_id : 'produit_item_'
					}, F6.UI.promptMyBrouillonDeleteItem);
		if ($('#myBrouillon .blockButtons a.btn-cancel').length > 0)
			$('#myBrouillon .blockButtons a.btn-cancel').bind('click', {
				prefix_id : 'produit_item_'
			}, F6.UI.promptMyBrouillonDeleteAll);
	};

	F6.UI.promptMyBrouillonDeleteAll = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this), e.data.prefix_id);
		var element = $('#myBrouillon .tableMyCommands tbody tr');
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize
						.localize(
								"Etes-vous certain de vouloir supprimer tous vos brouillons ?",
								"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$
				.prompt(
						txt,
						{
							buttons : {
								Oui : true,
								Non : false
							},
							callback : function(e, v, m, f) {
								if (v) {
									if ($(element).hasClass('multipleItems')) {
										var group_id = $(element).attr('id');
										$(element)
												.siblings()
												.each(
														function() {
															if ($(this)
																	.attr('id')
																	.match(
																			group_id)) {
																$(this)
																		.addClass(
																				'removeAfterSuccesPromptAndAjax')
															}
														});
									}

									$(element).removeClass().addClass(
											'removeAfterSuccesPromptAndAjax')
									F6.AJAX
											.myBrouillonDeleteItemAfterPrompt(
													e,
													{
														id : f.itemId,
														success_message : Globalize
																.localize(
																		"Brouillon supprimé avec succés",
																		"fr_FR")
													});
								} else {
									$(el_trigger).focus();
									$('#successBoxTop').find('a').focus();
								}
							}
						});
	};

	/** ******************************** */
	/** TUNNEL ACHAT * */

	F6.UI.actionAchatPanierProduit = function(event) {
		if (event.keyCode == 13 || event.keyCode == undefined) {
			event.preventDefault();
			var qty = F6.UTILS.findSpecialParent(this, 'input', 'name',
					'quantity', 3);
			var entryNumber = F6.UTILS.findSpecialParent(this, 'input', 'name',
					'entryNumber', 3);
			var mtam = F6.UTILS.findSpecialParent(this, 'input', 'name',
					'mtam', 3);
			if (mtam) {
				var param_quantity = $(qty).val();
				var param_entry_id = $(entryNumber).val();
				setTimeout(function() {
					if (param_quantity == $(qty).val()) {
						F6.AJAX.updateMtamCartEntryQuantity(param_entry_id,
								parseInt(param_quantity));
						var ancestor = F6.UTILS.findMyAncestor(this,
								'mtam_item_');
					}
				}, 500);

			} else if (qty && entryNumber) {
				var param_quantity = $(qty).val();
				var param_entry_id = $(entryNumber).val();
				setTimeout(function() {
					if (param_quantity == $(qty).val()) {
						F6.AJAX.updateCartEntryQuantity(param_entry_id,
								parseInt(param_quantity));
						var ancestor = F6.UTILS.findMyAncestor(this,
								'produit_item_');
					}
				}, 500);

			}
		}
	}

	F6.UI.tunnelAchatPanierCodePromo = function(datas) {
		messageError = "";
		if (datas) {
			messageError = datas.message;
		}
		$('#errorBoxTop').append(messageError).show();
		F6.VALIDATIONS.highlightError('errorBoxTop');

		if (datas && datas.voucherOk) {
			total_ht = datas.amountTotalHT;
			total_tva = datas.amountTVA;
			total = datas.amountTotalTTC;
			total_promo = datas.totalDiscount;

			promo_items = datas.code_promo;
			port_promo = datas.port_promo;

			$('.order_total .total-ht .value').html(
					F6.UTILS.changeToCurrency(total_ht));
			$('.order_total .total-tva .value').html(
					F6.UTILS.changeToCurrency(total_tva));
			$('.order_total .total-ttc .value').html(
					F6.UTILS.changeToCurrency(total));

			if (total_promo > 0) {
				$('.order_total .total-reduction .value').html(
						F6.UTILS.changeToCurrency(total_promo));
				$('.order_total .total-reduction').show();
			} else {
				$('.order_total .total-reduction').hide();
			}

			if ($('.info-produit-livraison .alert .exergue-color').length) {
				$('.info-produit-livraison .exergue-color').text(port_promo);
			} else {
				$('.info-produit-livraison').prepend(
						'<div class="alert"><span class="exergue-color">'
								+ port_promo + '</span></div>');
			}

			if ($('#myMixedBasket .alert .exergue-color').length > 0) {
				if (port_promo !== undefined && port_promo !== null)
					$('#myMixedBasket .alert .exergue-color').text(port_promo);
			} else {
				if (port_promo !== undefined && port_promo !== null)
					$('#myMixedBasket').find('.blockButtons').prepend(
							'<div class="alert alert-bottom"><span class="exergue-color">'
									+ port_promo + '</span></div>');
			}

			if (total_promo) {
				F6.UI.tunnelAchatPanierCodePromo(promo_items);
				$('#errorBoxTop').text('');
				$('#errorBoxTop').hide();
			} else {
				if (promo_items) {
					$('#errorBoxTop').text(promo_items).show();
					F6.VALIDATIONS.highlightError('errorBoxTop')
				}
			}
		}
	};

	F6.UI.promptTunnelAchatPanierDeleteItem = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this), e.data.prefix_id);
		var reg = new RegExp("_-_", "g");
		var typeService = id.split(reg);
		if (typeService[0] == "AELC") {
			var msgPopin = "Etes-vous certain de vouloir supprimer l'ensemble de vos colis ?";
		} else if (typeService[0] == "VREL") {
			var msgPopin = "Etes-vous certain de vouloir supprimer l’ensemble de vos vignettes recommandées ?";
		} else {
			var msgPopin = "Etes-vous certain de vouloir supprimer cet article ?";
		}
		var element = $('#' + e.data.prefix_id + id);
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize.localize(msgPopin, "fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$
				.prompt(
						txt,
						{
							buttons : {
								Oui : true,
								Non : false
							},
							callback : function(e, v, m, f) {
								if (v) {
									if ($(element).hasClass('multipleItems')) {
										var group_id = $(element).attr('id');
										$(element)
												.siblings()
												.each(
														function() {
															if ($(this)
																	.attr('id')
																	.match(
																			group_id)) {
																$(this)
																		.addClass(
																				'removeAfterSuccesPromptAndAjax');
															}
														});
									}

									$(element).addClass(
											'removeAfterSuccesPromptAndAjax');

									// delete without ajax for the page Tunnel
									// achat Step1

									F6.UI.redirect(EBK.config.contextPath+'/panier/supprimer?id='
											+ f.itemId);
									$('#successBoxTop').find('a').focus();

									// F6.AJAX.tunnelAchatPanierDeleteItem(e,
									// {id: f.itemId,
									// success_message: Globalize.localize(
									// "Article supprimé
									// avec succés", "fr_FR" )});
									// $('#successBoxTop').find('a').focus();

								} else {
									$(el_trigger).focus();
									$('#successBoxTop').find('a').focus();
								}
							}
						});
	};

	F6.UI.tunnelAchatPanierDeleteItemAfterPrompt = function(datas) {
		F6.UI.removeItemAchatPanierSelectedAfterPrompt(datas, 'myMixedBasket');
		F6.UI.tunnelAchatPanierAdjutPrice();
	};

	F6.UI.promptMyBrouillonDeleteItem = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this), e.data.prefix_id);
		var element = $('#' + e.data.prefix_id + id);
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize
						.localize(
								"Etes-vous certain de vouloir supprimer ce brouillon ?",
								"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$
				.prompt(
						txt,
						{
							buttons : {
								Oui : true,
								Non : false
							},
							callback : function(e, v, m, f) {
								if (v) {
									if ($(element).hasClass('multipleItems')) {
										var group_id = $(element).attr('id');
										$(element)
												.siblings()
												.each(
														function() {
															if ($(this)
																	.attr('id')
																	.match(
																			group_id)) {
																$(this)
																		.addClass(
																				'removeAfterSuccesPromptAndAjax');
															}
														});
									}

									$(element).removeClass().addClass(
											'removeAfterSuccesPromptAndAjax');
									F6.AJAX
											.myBrouillonDeleteItemAfterPrompt(
													e,
													{
														id : f.itemId,
														success_message : Globalize
																.localize(
																		"Brouillon supprimé avec succés",
																		"fr_FR")
													});
								} else {
									$(el_trigger).focus();
									$('#successBoxTop').find('a').focus();
								}
							}
						});
	};

	F6.UI.myBrouillonDeleteItemAfterPrompt = function(datas) {
		F6.UI.removeItemSelectedAfterPrompt(datas, 'myBrouillon');
	};

	/*
	 * F6.UI.removeItemAchatPanierSelectedAfterPrompt = function(datas,
	 * form_id){ var message = datas.success_message; if(datas.delete_fallback ==
	 * 1){ $('.removeAfterSuccesPromptAndAjax').fadeOut('slow', function(){
	 * $(this).remove(); if($('#tableProduitItems tbody tr').length == 0){
	 * $('#tableProduitItems').parent().parent().fadeOut('slow', function(){
	 * $(this).remove(); }); } if($('#tableServiceItems tbody tr').length == 0){
	 * $('#tableServiceItems').parent().parent().fadeOut('slow', function(){
	 * $(this).remove(); }); }
	 *
	 * F6.UI.displaySuccessMessage(message, form_id, Globalize.localize(
	 * "Continuer la gestionde mon panier", "fr_FR" )); }); } else { $.prompt('<div
	 * class="typo-din title3">Erreur</div>' + Globalize.localize( "Probl?me
	 * lors de la suppression", "fr_FR" )); } }
	 */

	/* Updated by Nouaoui Zakaria */
	F6.UI.removeItemAchatPanierSelectedAfterPrompt = function(datas, form_id) {
		var message = datas.success_message;
		var hasProducts = $('#tableProduitItems').size() > 0;
		var hasServices = $('#tableServiceItems').size() > 0;

		if (datas.delete_fallback == 1) {
			$('.removeAfterSuccesPromptAndAjax')
					.fadeOut(
							'slow',
							function() {
								$(this).remove();
								if ($('#tableProduitItems tbody tr').length == 0) {
									hasProducts = false;
									$('#tableProduitItems').parent().parent()
											.fadeOut('slow', function() {
												$(this).remove();
											});
								}
								if ($('#tableServiceItems tbody tr').length == 0) {
									hasServices = false;
									$('#tableServiceItems').parent().parent()
											.fadeOut('slow', function() {
												$(this).remove();
											});
								}

								if (!hasProducts && !hasServices) {
									$(
											'.blockButtons, .order_total, .block-command-wrap')
											.remove();
									F6.UI
											.displaySuccessMessage(
													Globalize
															.localize(
																	"Tous vos articles ont bien été supprimés",
																	"fr_FR"),
													form_id,
													Globalize
															.localize(
																	"Retour vers la page d'accueil du compte",
																	"fr_FR"));
									$('#successBoxTop a').attr('href',
											'Compte_home.php');
								} else if (hasServices) {
									if (message.length <= 0) {
										message = "Destinatiare(s) supprimé(s)."
									}
									F6.UI
											.displaySuccessMessage(
													message,
													form_id,
													Globalize
															.localize(
																	"Continuer la gestion de mon panier",
																	"fr_FR"));
								}
							});
		} else {
			$.prompt('<div class="typo-din title3">Erreur</div>'
					+ Globalize.localize("Problème lors de la suppression",
							"fr_FR"));
		}
	}

	F6.UI.tunnelAchatPanierAdjutPrice = function() {
		F6.AJAX.tunnelAchatPanierAdjutPrice($('#myMixedBasket').serialize());
	};

	F6.UI.tunnelAchatPanierAdjutPriceLineCallback = function(datas) {
		entyNumber = datas.entryNumber;
		sous_total_ht = datas.totalHt;
		sous_total_ttc = datas.totalTTC;
		msg_discount = datas.descriptionPromo;

		$('#basket_produit_' + entyNumber + '_quantity').val(datas.qtyDemanded);
		$('#produit_' + entyNumber + 'sous-total-ht').html(
				F6.UTILS.changeToCurrency(sous_total_ht));
		$('#produit_' + entyNumber + 'sous-total-ttc').html(
				F6.UTILS.changeToCurrency(sous_total_ttc));
		$('#produit_' + entyNumber + 'produit_reduction').html(msg_discount);
		$('#produit_' + entyNumber + '_prix_unitaire').html(datas.prixUnitaire);

	};

	F6.UI.tunnelAchatPanierAdjutMtamPriceLineCallback = function(datas) {
		entyNumber = datas.entryNumber;
		sous_total_ht = datas.totalHt;
		sous_total_ttc = datas.totalTTC;
		msg_discount = datas.descriptionPromo;

		// Prix unitaire
		$('#mtamProduct_' + entyNumber + 'produit_prix_unitaire').html(
				datas.prixUnitaire);

		// Affranchissement
		$('#mtamProduct_' + entyNumber + 'sous-total-ht').html(
				F6.UTILS.changeToCurrency(datas.totalHtAffranchissement));
		$('#mtamProduct_' + entyNumber + 'sous-total-ttc').html(
				F6.UTILS.changeToCurrency(datas.totalTTCAffranchissement));

		// Coût de personnalisation
		$('#mtamProduct_' + entyNumber + 'sous-total-ht-Perso').html(
				F6.UTILS.changeToCurrency(datas.totalHtCoutPersonnalisation));
		$('#mtamProduct_' + entyNumber + 'sous-total-ttc-Perso').html(
				F6.UTILS.changeToCurrency(datas.totalTTCCoutPersonnalisation));
		$('#mtamProduct_' + entyNumber + 'produit_reduction')
				.html(msg_discount);

	};

	F6.UI.tunnelAchatPanierAdjutGiftedPrices = function(datas) {

		for (var i = 0; i < datas.length; i++) {

			productCode = datas[i].productCode;
			reduc_quantity = datas[i].qtyDemanded;
			reduc_ss_total_ht = datas[i].totalHt;
			reduc_ss_total_ttc = datas[i].totalTTC;
			reduc_msg_discount = datas[i].descriptionPromo;
			unitPrice = datas[i].prixUnitaire;

			offertMsg = F6.UI.extractDiscountMsg(reduc_msg_discount);

			reduc_msg_discount = "-"
					+ F6.UTILS.changeToCurrency(reduc_ss_total_ttc) + " "
					+ offertMsg;

			$('#quantity-reduction_' + productCode).html(reduc_quantity);
			$('#msg-reduction_' + productCode).html(reduc_msg_discount);
			$('#sub-total-ht-reduction_' + productCode).html(
					F6.UTILS.changeToCurrency(reduc_ss_total_ht));
			$('#sub-total-ttc-reduction_' + productCode).html(
					F6.UTILS.changeToCurrency(reduc_ss_total_ttc));
			$('#unit-reduction_' + productCode).html(
					F6.UTILS.changeToCurrency(unitPrice));
		}
	};

	F6.UI.tunnelAchatPanierRefresh = function(datas) {
		if (datas != null && datas != "") {
			$("#tableProduitItems").html(datas);
			if (!$('#myMixedBasket').length)
				return false;
			F6.UI.executeAchatPanierMixte();
		}
	};
	/* Updated by Nouaoui Zakaria */
	F6.UI.tunnelAchatPanierAdjutPriceCallback = function(datas) {
		total_ht = datas.amountTotalHT;
		total_tva = datas.amountTVA;
		total = datas.amountTotalTTC;
		total_promo = datas.totalDiscount;
		total_port = datas.total_port;
		promo_items = datas.code_promo;
		port_promo = datas.port_promo;
		msg_delivery = datas.deliveryMsg;
		msg_plafond_cmd = datas.plafondCmdMsg;
		msg_livraisons = datas.amountDelivery;
		$('.order_total .total-ht .value').html(
				F6.UTILS.changeToCurrency(total_ht));
		$('.order_total .total-tva .value').html(
				F6.UTILS.changeToCurrency(total_tva));
		$('.order_total .total-ttc .value').html(
				F6.UTILS.changeToCurrency(total));
		if (total_promo > 0) {
			$('.order_total .total-reduction .value').html(
					F6.UTILS.changeToCurrency(total_promo));
			$('.order_total .total-reduction').show();
		} else {
			$('.order_total .total-reduction').hide();

		}
		$('.order_total .total-frais-port .value').html(
				F6.UTILS.changeToCurrency(total_port));
		$('.order_total .frais-livraison-estime .value').html(
				F6.UTILS.changeToCurrency(msg_livraisons));

		if (msg_delivery) {
			if ($('#myMixedBasket .shippingMsg2 #shippingMsgId').length) {
				$('#myMixedBasket .shippingMsg2 #shippingMsgId').text(
						msg_delivery);
			} else {
				$('#myMixedBasket .shippingMsg2').html(
						'<div class="alert alert-bottom"><em class="exergue-color" id="shippingMsgId">'
								+ msg_delivery + '</em></div></div>');
			}
		}

		if ($('#myMixedBasket .info-produit-livraison #plafond_Msg').length) {
			$('#myMixedBasket .info-produit-livraison #plafond_Msg').text(
					msg_plafond_cmd);
		} else {
			$('#myMixedBasket .info-produit-livraison').prepend(
					'<label class="exergue-color" id="plafond_Msg">'
							+ msg_plafond_cmd + '</label>');
		}

		if ($('.info-produit-livraison .alert .exergue-color').length) {
			$('.info-produit-livraison .exergue-color').text(port_promo);
		} else {
			$('.info-produit-livraison').prepend(
					'<div class="alert"><span class="exergue-color">'
							+ port_promo + '</span></div>');
		}

		if ($('#myMixedBasket .alert .exergue-color').length > 0) {
			if (port_promo !== undefined && port_promo !== null)
				$('#myMixedBasket .alert .exergue-color').text(port_promo);
		} else {
			if (port_promo !== undefined && port_promo !== null)
				$('#myMixedBasket').find('.blockButtons').prepend(
						'<div class="alert alert-bottom"><span class="exergue-color">'
								+ port_promo + '</span></div>');
		}

		if (total_promo) {
			F6.UI.tunnelAchatPanierCodePromo(promo_items);
			$('#errorBoxTop').text('');
			$('#errorBoxTop').hide();
		} else {
			if (promo_items) {
				$('#errorBoxTop').text(promo_items).show();
				F6.VALIDATIONS.highlightError('errorBoxTop')
			}
		}
	};

	/**
	 *
	 * ********************************************************************************
	 * ********************************* Version 2
	 * *********************************
	 * ********************************************************************************
	 */

	/** ADDRESS BOOK AND LEL ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Switch between forms on loading page (part and pro) * */
	F6.UI.hideAndShowAddressPartAndProForm = function() {
		if ($("#switchFormPart").hasClass('selected')) {
			$("#formAddressSingleProfessionnel").hide();
			$("#proFormButtons").hide();
			$("#formAddressSingleParticulier").show();
			$("#partFormButtons").show();
		} else {
			$("#formAddressSingleParticulier").hide();
			$("#partFormButtons").hide();
			$("#formAddressSingleProfessionnel").show();
			$("#proFormButtons").show();
		}
	};

	// BY NOUAOUI ZAKARIA
	// Desactive Multiple click
	F6.UI.desactiveMultipleClick = function() {
		$(".multipleClick").preventDoubleSubmission();
	};
	jQuery.fn.preventDoubleSubmission = function() {
		$(this).on('click', function(e) {
			var $form = $(this);
			// Raison du commentaire : valid() marche pas IE et Firefox
			// if($('form').valid() == true)
			// {
			if ($form.data('submitted') === true) {
				// Previously submitted - don't submit again
				e.preventDefault();
			} else {
				// Mark it so that the next submit can be ignored
				$form.data('submitted', true);
			}
			// }

		});

		// Keep chainability
		return this;
	};

	F6.UI.preventMultiClickOnAnchors = function() {
		$("a.preventMultiClick").on('click', function(e) {
			if ($(this).hasClass("clicked")) {
				e.preventDefault();
			} else {
				$(this).addClass("clicked");
			}
		});
	};

	// FOR LRTEL STEP3 PAGE
	F6.UI.hideInfoWhenJSDesactive = function() {
		$(".info-when-js-desactive").hide();
	};

	// Toggle pro/part forms
	F6.UI.activeSelectLrtelDestinataireForms = function() {
		$(".destinataire-btn-select .form-radio-simulation").click(
				function() {
					$(".destinataire-btn-select .form-radio-simulation")
							.removeClass('selected');

					$('#formAddressSingleParticulier').toggle();
					$('#formAddressSingleProfessionnel').toggle();
					$('#formMaillingAddressSingleParticulier').toggle();
					$('#formMaillingAddressSingleProfessionnel').toggle();

					// $('#error-coordonnees').html('');
					$(this).addClass('selected');
					return false
				});
	};
	// Init the right state for Lrtel page step3 (part/pro)
	F6.UI.hideAndShowTheRightDestinataire = function() {
		F6.UI.carnetAddressPopin();

		if ($("#switchDestinatiareLinkToPar").hasClass('selected')) {
			// alert('Particulier is activated');
			$("#formAddressSingleProfessionnel").hide();
			$("#formMaillingAddressSingleProfessionnel").hide();
			$("#formAddressSingleParticulier").show();
			$("#formMaillingAddressSingleParticulier").show;
		} else {
			// alert('Professionnel is activated');
			$("#formAddressSingleParticulier").hide();
			$("#formMaillingAddressSingleParticulier").hide();
			$("#formAddressSingleProfessionnel").show();
			$("#formMaillingAddressSingleProfessionnel").show();
		}

	};
	// Popin Carnet Adresse Step3 LRTEL
	F6.UI.carnetAddressPopin = function() {
		var carnetAddressPopin = $('.carnetAddressPopin');
		if (carnetAddressPopin.length > 0) {
			carnetAddressPopin.unbind('click');
			carnetAddressPopin.bind('click', function(e) {
                F6.stop(e);
                var href_fancybox = EBK.config.contextPath+'/lettre-recommandee-en-ligne/votre-recommande-tout-electronique/carnet-adresses';

                F6.UI.activeBodyFullJS();
                $.fancybox.open({
                    src  : URLS.updatePath( href_fancybox ),
                    type : 'ajax',
                    afterShow : function(instance, current) {
                    	console.log('### AA');
                        // Full the form with data
                        // init du HTML
                        F6.VALIDATIONS.addressBookFormOnly();
                        F6.UI.activeUniform();
                        $('#fancybox-frame').attr('title', 'Carnet d\'adresses');
                        $('#fancybox-frame').attr('tabindex', '0');
                        $('#fancybox-frame').focus();
                    },
                    opts : {
                        touch: false,
                        momentum: false,
                        smallBtn: false,
                        clickOutside: false,
                        baseTpl : Popup.template()

                    }
                });
            });
		}
	}

	// Toggle pro/part forms
	F6.UI.activeSelectLrtelDestinataireForms = function() {
		$(".destinataire-btn-select .form-radio-simulation")
				.click(
						function(event) {
							$(".destinataire-btn-select .form-radio-simulation")
									.removeClass('selected');
							if (event.target.id
									.indexOf("switchDestinatiareLinkToPar") >= 0) {
								$('#formAddressSingleParticulier').show();
								$('#formMaillingAddressSingleParticulier')
										.show();
								$('#formAddressSingleProfessionnel').hide();
								$('#formMaillingAddressSingleProfessionnel')
										.hide();
							} else {
								$('#formAddressSingleParticulier').hide();
								$('#formMaillingAddressSingleParticulier')
										.hide();
								$('#formAddressSingleProfessionnel').show();
								$('#formMaillingAddressSingleProfessionnel')
										.show();
							}
							// $('#error-coordonnees').html('');
							$(this).addClass('selected');
							return false
						});
	};

	// SWITCH TABS IN LREL -STEP 3
	F6.UI.switchLrelTabStep3 = function() {
		// init active Tab
		if ($("#switchToSearchEmail").hasClass('selected')) {
			// alert('recherche-email is activated');
			$('#recherche-email').show();
			$('#saise-email').hide();
			$("li.recherche-email-item").addClass('selected');
			$("li.saise-email-item").removeClass('selected');
		} else {
			// alert('saisi-email is activated ??');
			$('#recherche-email').hide();
			$('#saise-email').show();
			$("li.recherche-email-item").removeClass('selected');
			$("li.saise-email-item").addClass('selected');
		}

		$(".saise-email-item a").click(function() {
			$('#recherche-email').hide();
			$('#saise-email').show();
			if ($("#switchDestinatiareLinkToPar").hasClass('selected')) {
				$("#formAddressSingleParticulier").show();
				$("#formAddressSingleProfessionnel").hide();
			} else {
				$("#formAddressSingleParticulier").hide();
				$("#formAddressSingleProfessionnel").show();
			}
			$("li.recherche-email-item").removeClass('selected');
			$("li.saise-email-item").addClass('selected');
			return false
		});

		$(".recherche-email-item a").click(function() {

			$('#saise-email').hide();
			$('#recherche-email').show();
			if ($("#switchDestinatiareLinkToPar").hasClass('selected')) {
				$("#formMaillingAddressSingleProfessionnel").hide();
				$("#formMaillingAddressSingleParticulier").show();
			} else {
				$("#formMaillingAddressSingleProfessionnel").show();
				$("#formMaillingAddressSingleParticulier").hide();
			}
			$("li.saise-email-item").removeClass('selected');
			$("li.recherche-email-item").addClass('selected');
			return false

		});

		return false

	};

	// LEREL STEP 4 (Updated to manage authentificated users)
	F6.UI.activeLrelEtape4 = function() {
		// hide refresh Button
		$('.refreshBtn').hide();

		if (!$('.user-authentificated').length
				|| (($('.user-authentificated').length) && $("#addressFlag").value == "yes")) {
			$('#lrel_etape4_ajouter_adresse').show();
		} else {
			if ($('#lrel_etape4_ajouter_adresse').hasClass('activated')) {
				$('#lrel_etape4_ajouter_adresse').show();
			} else {
				$('#lrel_etape4_ajouter_adresse').hide();
			}
		}
		$('.addAddressLink a').bind('click', function() {
			$('#lrel_etape4_ajouter_adresse').show();
			$('#lrel_etape4_ajouter_adresse_civilite_mme').focus();
		});
	};

	// Manage resume form LREL ETAPE 2
	F6.UI.manageResumeLrelEtape2 = function() {
		var fields = [ 'optionFollow', 'impressionType', 'impressionFormat',
				'addressPlace', 'latterName'/* ,'dateenvoi' */];

		var updateResume = function(itemName, message) {
			// alert('dd'+itemName +' = '+message)
			$('dd' + itemName).text(message);
			$(itemName).show();
		};
		var higlightBlockRadio = {
			selection : function(el1, el2) {
				$(el1).closest('.block-radio').addClass('selected');
				$(el2).closest('.block-radio').removeClass('selected');
			}
		};

		// 0 == optionFollow
		$('[name=' + fields[0] + ']').change(function(e) {
			if ($(e.currentTarget).is(':checked'))
				updateResume('.opt1', Globalize.localize("Oui", "fr_FR"));
			else
				updateResume('.opt1', Globalize.localize("Non", "fr_FR"));

			return true;
		}).trigger('change');
		// Ajax Call
		$('[name=' + fields[0] + ']').click(function() {

			F6.AJAX.manageResumeLrelEtape2Ajax();
		});
		// $('[name='+fields[6]+']').keydown(function(e){e.preventDefault();return
		// false;}).blur(function() {
		// updateResume('.opt2', $(this).val());
		//
		// F6.AJAX.manageResumeLrelEtape2Ajax();
		//
		// return true;
		// }).trigger('change');

		// 1 : impressionType
		$('[name=' + fields[1] + ']').change(
				function() {
					if ($('#n_b').is(':checked')) {
						updateResume('.opt3', Globalize.localize(
								"Noir & Blanc", "fr_FR"));
						higlightBlockRadio.selection($('#n_b'), $('#color'));
					} else {
						updateResume('.opt3', Globalize.localize("Couleur",
								"fr_FR"));
						higlightBlockRadio.selection($('#color'), $('#n_b'));
					}

				}).trigger('change');

		// Ajax Call
		$('[name=' + fields[1] + ']').click(function() {

			F6.AJAX.manageResumeLrelEtape2Ajax();
		});

		// 2 : impressionFormat
		$('[name=' + fields[2] + ']').change(
				function() {
					if ($('#recto_verso').is(':checked')) {
						updateResume('.opt4', Globalize.localize(
								"Recto / Verso", "fr_FR"));
						higlightBlockRadio.selection($('#recto_verso'),
								$('#recto'));
					} else {
						updateResume('.opt4', Globalize.localize("Recto",
								"fr_FR"));
						higlightBlockRadio.selection($('#recto'),
								$('#recto_verso'));
					}

				}).trigger('change');

		// Ajax Call
		$('[name=' + fields[2] + ']').click(function() {

			F6.AJAX.manageResumeLrelEtape2Ajax();
		});

		// 3 : addressPlace
		$('[name=' + fields[3] + ']').change(
				function() {
					if ($('#place_poste').is(':checked')) {
						updateResume('.opt5', Globalize.localize(
								"Sur courrier", "fr_FR"));
						higlightBlockRadio.selection($('#place_poste'),
								$('#place_vierge'));
					} else {
						updateResume('.opt5', Globalize.localize(
								"Sur page blanche", "fr_FR"));
						higlightBlockRadio.selection($('#place_vierge'),
								$('#place_poste'));
					}

				}).trigger('change');

		// Ajax Call
		$('[name=' + fields[3] + ']').click(function() {

			F6.AJAX.manageResumeLrelEtape2Ajax();
		});

		// 4 : latterName
		$('[name=' + fields[4] + ']').change(function() {
			if ($(this).val().length) {
				updateResume('.opt6', $('#name_doc').val());
			}
		}).trigger('change');

		$('[name=' + fields[4] + ']').keyup(function() {
			if ($('#name_doc').val().length <= 38) {
				updateResume('.opt6', $('#name_doc').val());
			}
		});

		// 5 : Nombre de page
		$('.opt7').show();

		// On click functions
		$('.options-shipping label', '#impression-options-lrel').on('click',
						function(e)
						// $(/*'.options-shipping
						// label'*/'#label-choice-numeric',
						// '#impression-options-lrel').on('click', function(e)
						{
							e.preventDefault();

							// 1 : switch blocs

							var label = $(this);
							var classe = label.attr('class');
							// 1 : Changer qu'au clic droit

							if (label.attr('id') == "label-choice-factor") {

								// update the resume values
								updateResume('.opt0', Globalize.localize(
										"Distribuée par le facteur", "fr_FR"));

								$("#label-choice-factor")
										.attr('class',
												'btn-action-minor add numeric-bloc-activated');
								$("#label-choice-numeric").attr('class', '');

								$('li.step3 a')
										.attr('href',
												EBK.config.contextPath+'/lettre-recommandee-en-ligne/votre-recommande');
								$('li.step3 span').text('Votre recommandé');

								// Go to Factor
								$(this)
										.attr('class',
												'btn-action-minor add factor-bloc-activated');

								// 1 : checked it
								$('#action-choice-factor').attr('checked',
										'checked');

								// test ( changer qu'au clic droit
								//
								// var labelNumeric =
								// $('#label-choice-numeric').html();
								// $('#label-choice-numeric').html($('#label-choice-factor').html());
								// $('#label-choice-factor').html(labelNumeric);

								// end test

								// 1 : show print options
								$('dt.opt3').show();
								$('dd.opt3').show();
								$('dt.opt4').show();
								$('dd.opt4').show();
								$('dt.opt5').show();
								$('dd.opt5').show();
								$('dt.opt7').show();
								$('dd.opt7').show();

								// remettre le css original
								$('#letter-name-block').css('border-top',
										'1px solid #DEDEDE');
								$('#letter-name-block').css('padding-top',
										'22px');

								$('.visualizeDocBlock').show();
								$('#impressionOptionsId').show();
								$('#option3-impression-title').show();
								$('#option3-letter-title').hide();
								$('#option3-required-fields').show();
							} else if (label.attr('id') == "label-choice-numeric") {
								$("#label-choice-numeric")
										.attr('class',
												'btn-action-minor add factor-bloc-activated');
								$("#label-choice-factor").attr('class', '');
								tc_events_1(this, "CLICK",{'event': 'F', 'level2': '5', 'chapter1': 'LRE_Process_Achat', 'name':'Options_LRTE'});

								updateResume('.opt0', Globalize.localize(
										"Par voie numérique", "fr_FR"));

								$('li.step3 a')
										.attr(
												'href',
												EBK.config.contextPath+'/lettre-recommandee-en-ligne/votre-recommande-tout-electronique');
								$('li.step3 span').text('Votre recommandé');

								// Go to Numeric
								// $(this).attr('class','btn-action-minor add
								// numeric-bloc-activated');

								// Check the numeric button
								$('#action-choice-numeric').attr('checked',
										'checked');
								// test
								// //test ( changer qu'au clic droit
								// var labelFactor =
								// $('#label-choice-factor').html();
								// $('#label-choice-factor').html($('#label-choice-numeric').html());
								// $('#label-choice-numeric').html(labelFactor);

								// end test

								// 1 : hide print options
								$('dt.opt3').hide();
								$('dd.opt3').hide();
								$('dt.opt4').hide();
								$('dd.opt4').hide();
								$('dt.opt5').hide();
								$('dd.opt5').hide();
								$('dt.opt7').hide();
								$('dd.opt7').hide();

								// 2 : hide bloc
								// css = change Letter Name Bloc
								$('#letter-name-block').css('border', '0px');
								$('#letter-name-block').css('padding-top',
										'3px');

								$('.visualizeDocBlock').hide();
								$('#impressionOptionsId').hide();
								$('#option3-impression-title').hide();
								$('#option3-letter-title').show();
								$('#option3-required-fields').hide();
							}

							// if(classe === undefined || classe === '')// when
							// click on
							// button not selected
							// {
							// var oLabel =
							// label.parent().siblings('li').find('label');
							//
							// label.addClass(oLabel.attr('class'));
							// oLabel.removeClass();
							// }
							// update
							// updateResume('.opt0',
							// Globalize.localize(label.find('span').text(),
							// "fr_FR" ));
							// Update the Price when change (numeric/factor)
							F6.AJAX.manageResumeLrelEtape2Ajax();
						});
	};

	// Init the right state for Lrel page step2 (numeric/facteur)
	F6.UI.initStateStep2 = function() {
		$('.button-choice').show();
		$('.link-choice').hide();
		flag = 1;
		var updateResume = function(itemName, message) {
			// alert('dd'+itemName +' = '+message)
			$('dd' + itemName).text(message);
			$(itemName).show();
		};

		if ($("#label-choice-factor").hasClass('factor-bloc-activated'))// .hasClass('btn-action-minor
		// add'))
		{
			// 1 : show print options
			$('dt.opt3').show();
			$('dd.opt3').show();
			$('dt.opt4').show();
			$('dd.opt5').show();
			$('dt.opt5').show();
			$('dd.opt5').show();

			$("#label-choice-factor").attr('class',
					'btn-action-minor add factor-bloc-activated');
			$("#label-choice-numeric").attr('class', '');

			if (flag != 1) {
				flag++;
			}

			updateResume('.opt0', Globalize.localize(
					"Distribuée par le facteur", "fr_FR"));

			$('li.step3 a')
					.attr('href',
							EBK.config.contextPath+'/lettre-recommandee-en-ligne/votre-recommande');
			$('li.step3 span').text('Votre recommandé');

			// remettre le css original
			$('#letter-name-block').css('border-top', '1px solid #DEDEDE');
			$('#letter-name-block').css('padding-top', '22px');

			$('#impressionOptionsId').show();
			$('#option3-impression-title').show();
			$('#option3-letter-title').hide();
			$('#option3-required-fields').show();
		} else if ($("#label-choice-numeric")
				.hasClass('numeric-bloc-activated')) {
			// Go to Numeric
			$("#label-choice-numeric").attr('class',
					'btn-action-minor add numeric-bloc-activated');
			$("#label-choice-factor").attr('class', '');

			// Check the numeric button
			$('#action-choice-numeric').attr('checked', 'checked');
			// test
			// test ( changer qu'au clic droit
			// var labelFactor = $('#label-choice-factor').html();
			// $('#label-choice-factor').html($('#label-choice-numeric').html());
			// $('#label-choice-numeric').html(labelFactor);

			// 1 : show print options
			$('dt.opt3').hide();
			$('dd.opt3').hide();
			$('dt.opt4').hide();
			$('dd.opt4').hide();
			$('dt.opt5').hide();
			$('dd.opt5').hide();
			$('dt.opt7').hide();
			$('dd.opt7').hide();

			tc_events_1(this, "CLICK",{'event': 'F', 'level2': '5', 'chapter1': 'LRE_Process_Achat', 'name':'Options_LRTE'});

			updateResume('.opt0', Globalize.localize("Par voie numérique",
					"fr_FR"));
			$('li.step3 a')
					.attr(
							'href',
							EBK.config.contextPath+'/lettre-recommandee-en-ligne/votre-recommande-tout-electronique');
			$('li.step3 span').text('Votre recommandé');

			// css = change Letter Name Bloc
			$('#letter-name-block').css('border', '0px');
			$('#letter-name-block').css('padding-top', '3px');

			$('#impressionOptionsId').hide();
			$('#option3-letter-title').show();
			$('#option3-impression-title').hide();
			$('#option3-required-fields').hide();
		}
	};

	// Manage resume form LEL,PMC,PAF etape 2

	F6.UI.manageResumeStep2LEL = function(ajaxMethod) {
		var fields = [ 'impressionType', 'impressionFormat', 'addressPlace',
				'latterName', 'envoiSuivi' ]
		var updateResume = function(itemName, message) {
			$('dd' + itemName).text(message);
			$(itemName).show();
		}
		var higlightBlockRadio = {
			selection : function(el1, el2) {
				$(el1).closest('.block-radio').addClass('selected');
				$(el2).closest('.block-radio').removeClass('selected');
			}
		};

		// 1 : impressionType
		$('[name=' + fields[0] + ']').change(
				function() {
					if ($('#n_b').is(':checked')) {
						updateResume('.opt2', Globalize.localize(
								"Noir & Blanc", "fr_FR"));
						higlightBlockRadio.selection($('#n_b'), $('#color'));
					} else {
						updateResume('.opt2', Globalize.localize("Couleur",
								"fr_FR"));
						higlightBlockRadio.selection($('#color'), $('#n_b'));
					}

				}).trigger('change');

		// Ajax Call
		$('[name=' + fields[0] + ']').click(function() {

			ajaxMethod();
		});

		// 2 : impressionFormat
		$('[name=' + fields[1] + ']').change(
				function() {
					if ($('#recto_verso').is(':checked')) {
						updateResume('.opt3', Globalize.localize(
								"Recto / Verso", "fr_FR"));
						higlightBlockRadio.selection($('#recto_verso'),
								$('#recto'));
					} else {
						updateResume('.opt3', Globalize.localize("Recto",
								"fr_FR"));
						higlightBlockRadio.selection($('#recto'),
								$('#recto_verso'));
					}

				}).trigger('change');

		// Ajax Call
		$('[name=' + fields[1] + ']').click(function() {

			ajaxMethod();
		});

		// 3 : addressPlace
		$('[name=' + fields[2] + ']').change(
				function() {
					if ($('#place_poste').is(':checked')) {
						updateResume('.opt4', Globalize.localize(
								"Sur courrier", "fr_FR"));
						higlightBlockRadio.selection($('#place_poste'),
								$('#place_vierge'));
					} else {
						updateResume('.opt4', Globalize.localize(
								"Sur page blanche", "fr_FR"));
						higlightBlockRadio.selection($('#place_vierge'),
								$('#place_poste'));
					}

				}).trigger('change');

		// Ajax Call
		$('[name=' + fields[2] + ']').click(function() {

			ajaxMethod();
		});

		$('[name=' + fields[3] + ']').keyup(function() {

			if ($('#name_doc').val().length <= 38) {
				updateResume('.opt5', $('#name_doc').val());
			}
		});

		// envoiSuivi option
		$('.opt8').show();
		$('[name=' + fields[4] + ']').change(
				function(e) {
					if ($('#envoi_suivi').is(':checked')) {
						updateResume('.opt8', Globalize
								.localize("Oui", "fr_FR"));
						higlightBlockRadio.selection($('#envoi_suivi'),
								$('#envoi_simple'));
					} else {
						updateResume('.opt8', Globalize
								.localize("Non", "fr_FR"));
						higlightBlockRadio.selection($('#envoi_simple'),
								$('#envoi_suivi'));
					}

					return true;
				}).trigger('change');

		$('[name=' + fields[4] + ']').click(function() {

			ajaxMethod();
		});

		// 5 : Nombre de page
		$('.opt6').show();

	};// end

	// step5 LREL
	F6.UI.waitPdfGenerationStep5 = function() {
		// 1 : hide the bloc of Visualization
		// $('#step5PdfVisualisation').hide();
		if ($('.pdfVisualisation').length) {
			$('.pdfVisualisation').hide();
		}
		// 2 : show the bloc of Generation
		// $('#step5PdfGeneration').show();
		$('.pdfGeneration').show();
		// 3 : call Ajax
		if ($('#step4Lel').length) {
			// setInterval('F6.AJAX.isPdfGeneratedLelEtape4Ajax()', 3000);
			F6.AJAX.isPdfGeneratedLelEtape4Ajax();
		}
		if ($('#step4Pmc').length) {
			// setInterval('F6.AJAX.isPdfGeneratedLelEtape4Ajax()', 3000);
			F6.AJAX.isPdfGeneratedPMCEtape4Ajax();
		}
		if ($('#step4Paf').length) {
			// setInterval('F6.AJAX.isPdfGeneratedLelEtape4Ajax()', 3000);
			F6.AJAX.isPdfGeneratedPAFEtape4Ajax();
		}
		if ($('#step5Lrel').length) {
			// setInterval('F6.AJAX.isPdfGeneratedLrelEtape5Ajax()', 3000);
			F6.AJAX.isPdfGeneratedLrelEtape5Ajax();
		}
		// 3 : call Ajax LEL Step2
		if ($('#step1UploadLel').length) {
			F6.AJAX.isPdfGeneratedLelEtape2Ajax();
		}
		// 3 : call Ajax LEL TextEditor Step2
		if ($('#step1EditeLel').length) {
			F6.AJAX.sendAjaxLink(
                EBK.config.contextPath + "/lettre-en-ligne/editer-document/calculer-nombre-page",
                'F6.UI.callBackWaitPdfGenerationStep2LELTextEdit');
		}
		// 3 : call Ajax LEL TextEditor Step2 PMC
		if ($('#step1EditePMC').length) {
			F6.AJAX.sendAjaxLink(
                EBK.config.contextPath + "/prevenir-mes-contacts/editer-document/calculer-nombre-page",
							'F6.UI.callBackWaitPdfGenerationStep2PMCTextEdit');
		}
		if ($('#step1EditePAF').length) {
			F6.AJAX.sendAjaxLink(
                EBK.config.contextPath + "/prevenir-mes-administrations-fournisseurs/editer-document/calculer-nombre-page",
							'F6.UI.callBackWaitPdfGenerationStep2PAFTextEdit');
		}
		// 3 : call Ajax LEL TextEditor Step2
		if ($('#step1EditeLrel').length) {
			F6.AJAX.isPdfGeneratedTextEditorLrelEtape2Ajax();
		}
		// 3 : call Ajax LEL Step2
		if ($('#step1UploadLrel').length) {
			F6.AJAX.isPdfGeneratedLrelEtape2Ajax();
		}

		// 5: call ajax lrel step 5
		if ($('#step5bLrel').length) {
			F6.AJAX.addToCartLrelEtape5Ajax();
		}
		if (!$('#step5bLrel').length) {
			$(".lrelConfirmationCart").show();
			$('#step5bLrel').hide();
		}

		// 4: call ajax lel step 4
		if ($('#step4bLel').length) {
			F6.AJAX.addToCartLelEtape4Ajax();
		}

		if (!$('#step4bLel').length) {
			$(".lelConfirmationCart").show();
			$('#step4bLel').hide();
		}

		// 1 : Popin When validation
		if ($('#validez-courrier').length > 0) {
			$('.btn-send.validation').unbind('click');
			$('.btn-send.validation').bind('click', F6.UI.validationVotreCourrierPopin);
		}
		// affichage du sablier pour l'étape postPayment avec lettre suivie avec
		// appel au ws csuivi de notification
		if ($('#postPaymentProgressBar').length) {
			$('#postPaymentProgressBar').removeClass("noneDisplayToutDeatil");
			var commandNumber = $('#commandNumber').html();
			F6.AJAX.getPostPaymentPageAjax(commandNumber, 0);
		}
	};
	F6.UI.callBackWaitPdfGenerationStep5 = function(data) {
		if (data.docLink == "500") {
			// 1 : show the bloc of Visualization
			$('.pdfVisualisation').hide();
			// 2 : hide the bloc of Generation
			$('.pdfGeneration').hide();

			$('#textErrorPlace').text("Une erreur s'est produite. Nous vous invitons à réessayer");
			$('.genPDF_error_block').show();
		} else if (data.docLink == "408") {
			// 1 : show the bloc of Visualization
			$('.pdfVisualisation').hide();
			// 2 : hide the bloc of Generation
			$('.pdfGeneration').hide();

			$('#textErrorPlace').text("Le service est momentanément indisponible. Nous vous invitons à réessayer dans quelques minutes");
			$('.genPDF_error_block').show();
		} else {
			// 1 : show the bloc of Visualization
			$('.pdfVisualisation').show();
			// 2 : hide the bloc of Generation
			$('.pdfGeneration').hide();
			// 3 : insert link + size
			// $('#docLinkId').attr('href',data.docLink);
			$('#docSizeId').text(data.size);
		}

	};

	// WAIT FOR ADD TO CART LREL
	F6.UI.callBackWaitForAddToCart = function(data) {
		// $(".lrelConfirmationCart").show();
		// $('#step5bLrel').hide();
		window.location = EBK.config.contextPath + "/panier";
	}

	// WAIT FOR ADD TO CART LEL
	F6.UI.callBackWaitForLelAddToCart = function(data) {
		window.location = EBK.config.contextPath + "/panier";
		// $(".lelConfirmationCart").show();
		// $('#step4bLel').hide();
	}

	F6.UI.callBackWaitPdfGenerationStep2LEL = function(data) {
		window.location =EBK.config.contextPath + "/lettre-en-ligne/telecharger-document/calculer-nombre-page-fini?errorCode="
				+ data;
	};
	F6.UI.callBackWaitPdfGenerationStep2LELTextEdit = function(data) {
		window.location =EBK.config.contextPath + "/lettre-en-ligne/editer-document/calculer-nombre-page-fini?errorCode="
				+ data;
	};
	F6.UI.callBackWaitPdfGenerationStep2PMCTextEdit = function(data) {
		window.location =EBK.config.contextPath + "/prevenir-mes-contacts/editer-document/calculer-nombre-page-fini?errorCode="
				+ data;
	};
	F6.UI.callBackWaitPdfGenerationStep2PAFTextEdit = function(data) {
		window.location =EBK.config.contextPath + "/prevenir-mes-administrations-fournisseurs/editer-document/calculer-nombre-page-fini?errorCode="
				+ data;
	};
	// callback step1 LREL genPDF of textEditor
	F6.UI.callBackWaitPdfGenerationStep2LRELTextEdit = function(data) {
		window.location = EBK.config.contextPath  + "/lettre-recommandee-en-ligne/editer-document/calculer-nombre-page-fini?errorCode="
				+ data;
	};

	F6.UI.callBackWaitPdfGenerationStep2LREL = function(data) {
		window.location = EBK.config.contextPath + "/lettre-recommandee-en-ligne/telecharger-document/calculer-nombre-page-fini?errorCode="
				+ data;
	};
	// Step 5 LRTEL Recap Ajax Call
	F6.UI.recapLRTELStep5 = function() {
		$('[name=optionFollow]').click(function() {
			F6.AJAX.manageResumeLrtelEtape5Ajax();
			// update : optionFollow
			if ($('#option-suivi').is(':checked'))
				$('dd.opt1').html(Globalize.localize("Oui", "fr_FR"));
			else
				$('dd.opt1').html(Globalize.localize("Non", "fr_FR"));

		});
	};
	// Step5 LRTEL Call back
	F6.UI.manageResumeLreEtape5Data = function(data) {
		total_ht = data.amountTotalHT;
		total_tva = data.amountTVA;
		total = data.amountTotalTTC;
		receiver_count = data.nombreDestinataires;

		$('.totalHT .value').html(total_ht + ' <abbr title="euros">€</abbr>');
		$('.totalTVA .value').html(total_tva + ' <abbr title="euros">€</abbr>');
		$('.total .value').html(total + ' <abbr title="euros">€</abbr>');
		$('.optionsResume .value')
				.html(total + ' <abbr title="euros">€</abbr>');
		// $('dd.opt1').html(Globalize.localize("Oui", "fr_FR" ));
	};

	F6.UI.recapLRELStep5 = function() {
		// 1 : Upload Popin When validation
		if ($('.popinCoutRecupOption').length > 0) {
			$('.popinCoutRecupOption').unbind('click');
			$('.popinCoutRecupOption').bind('click',
					F6.UI.infoOptionStep5LRELPopin);
		}

		$('.recuperationEnvoiBlock .refreshBtn').hide();

		$('[name=optionRecuperation]').click(function() {
			// //update : optionFollow
			if ($('[name=optionFollow]').is(':checked')) {
				$('[name=avisReception]').val('true');
			} else {
				$('[name=avisReception]').val('false');
			}

			// recalculate Ajax
			F6.AJAX.manageResumeLrelEnvoiRecapEtape5Ajax();
			// submit form
			// $('#envoiRecuperationIdForm').submit();

		});
		// 2 :
		$('[name=optionFollow]').click(function() {
			F6.AJAX.manageResumeLrelEtape5Ajax();
			// update : optionFollow
			if ($('#option-suivi').is(':checked'))
				$('dd.opt1').html(Globalize.localize("Oui", "fr_FR"));
			else
				$('dd.opt1').html(Globalize.localize("Non", "fr_FR"));

		});
	};

	// NOUAOUI ZAKARIA
	F6.UI.initStep1 = function() {
		// 1 : Upload Popin When validation
		if ($('#lel-tabs-1').length > 0) {
			$('.btn-send.validation').unbind('click');
			$('.btn-send.validation').bind('click',
					F6.UI.validationUploadStep1Popin);
			$('.changeCurrentPageLink').unbind('click');
			$('.changeCurrentPageLink').bind('click',
					F6.UI.confirmChangeCurrentPageStep1Popin);
		}

		if ($('#lel-tabs-2-modele').length > 0) {
			$('.btn-send.validation').unbind('click');
			$('.btn-send.validation').bind('click',
					F6.UI.validationEditeStep1Popin);

			$('.changeCurrentPageLink').unbind('click');
			$('.changeCurrentPageLink').bind('click',
					F6.UI.confirmChangeCurrentPageStep1Popin);

			$(document).ready(function() {
				CKEDITOR.on('instanceReady', ready);
			});

			function ready() {
				CKEDITOR.instances.editor1
						.on(setInterval(output, 2000), output);
			}

			function output(evt) {
				var editor_data = CKEDITOR.instances.editor1.getData();
				var div = document.createElement("div");
				div.innerHTML = editor_data;

				var text = div.textContent || div.innerText || "";
				var nbrpage = Math.ceil(text.length
						/ nombreDeCaracteresDansUnePageA4);

				var nbrSplit = editor_data.split('\n').length;
				var nbrpageLigne = 0;
				if (nbrSplit > 1) {
					nbrpageLigne = Math.ceil(nbrSplit
							/ nombreDeLignesDansUnePageA4);
				}

				if (nbrpageLigne > nbrpage) {
					nbrpage = nbrpageLigne;
				}

				$('#nbrpage').html(nbrpage);

				// change state of the page
				if (editor_data.length > 0) {
					if (!$('.tabs-courrier li').first().hasClass("notSaved")) {
						$('.tabs-courrier li').first().addClass("notSaved");
						$('.tabs-courrier li').first().removeClass("saved");
					}
				}
			}
		}

	};

	// Popin Info option Recuperation de l'envoi Step 3 LRE
	F6.UI.infoOptionStep5LRELPopin = function(e) {
		var el_trigger = this;

		F6.stop(e);
		prompt = true;
		var prix = '17,94 &euro;';
		if ($('.RecupEnvoiHT').length > 0) {
			prix = '15,00 &euro; HT';
		}

		var txt = '<div class="typo-din title3">Récupération de l’envoi</div>'
				+ 'Cette option vous sera facturée pour chaque lettre du montant de la prestation totale réduit '
				+ 'du montant de l’affranchissement plus un montant correspondant à la prestation de ré-acheminement à l’expéditeur.<br/><br/>'
				+ 'Le montant forfaitaire de ré-acheminement est facturé '
				+ prix + ' par envoi.';

		if (prompt) {
			$.prompt(txt, {
				buttons : {
					Fermer : true
				},
				callback : function(e, v, m, f) {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			});
		} else {
			// begin QC 1434 : the click must work for left area of the button
			mouseX = e.pageX;
			inputX = $(e.currentTarget).children('input[type="submit"]')
					.offset().left;
			spanX = $(e.currentTarget).offset().left;
			if (mouseX >= spanX && mouseX < inputX) {
				$(e.currentTarget).children('input[type="submit"]').get(0)
						.click();
			}
			// end QC 1434 : the click must work for left area of the button
		}
	};

	// znouaoui : Confirmation du changement de la page Popin Step1

	F6.UI.confirmChangeCurrentPageStep1Popin = function(e) {
		var txt = '';
		// Set that page step1 can manage js
		if ($('.tabs-courrier li').first().hasClass("notSaved")) {
			F6.stop(e);
			var prompt = true;
			var el_trigger = this;

			txt = '<div class="typo-din title3">Confirmation</div> Attention, vous n’avez pas validé la préparation de votre courrier.'
					+ ' Pour préparer votre courrier vous avez le choix entre 3 options : le téléchargement de fichiers,'
					+ ' l’utilisation d’un modèle de lettre ou la rédaction de contenu dans l’éditeur de texte. '
					+ 'Que souhaitez-vous faire ?';

			if (prompt) {
				$.prompt(txt, {
					buttons : {
						Annuler : false,
						Poursuivre : true
					},
					callback : function(e, v, m, f) {
						if (v) {
							$(el_trigger).focus();
							$('#successBoxTop').find('a').focus();
							document.location = $(el_trigger).attr('href')
									+ "?action=initStep1";
						}
					}
				});
				$('#jqi').css('line-height', '1.5em');
			} else {
				// begin QC 1434 : the click must work for left area of the
				// button
				mouseX = e.pageX;
				inputX = $(e.currentTarget).children('input[type="submit"]')
						.offset().left;
				spanX = $(e.currentTarget).offset().left;
				if (mouseX >= spanX && mouseX < inputX) {
					$(e.currentTarget).children('input[type="submit"]').get(0)
							.click();
				}
				// end QC 1434 : the click must work for left area of the button
			}

		}
	};

	// Validation Step1 upload Popin
	F6.UI.validationUploadStep1Popin = function(e) {
		$('[name=jsActivated]').val('true');

		var el_trigger = this;
		var prompt = false;
		var filesCountStep1 = $('#table1').find("tr[id]").length;
		var txt = '';
		if (filesCountStep1 == 0) {
			F6.stop(e);
			prompt = true;
			txt = "<p>Attention, votre courrier est vide. "
					+ "Pour préparer votre courrier vous avez le choix entre 3 options : le téléchargement de fichiers, "
					+ "l’utilisation d’un modèle de lettre ou la rédaction de contenu dans l’éditeur de texte</p>";
		}

		if (prompt) {
			$.prompt(txt, {
				buttons : {
					Poursuivre : true
				},
				callback : function(e, v, m, f) {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			});
			$('#jqi').css('line-height', '1.5em');
		} else {
			// begin QC 1434 : the click must work for left area of the button
			mouseX = e.pageX;
			inputX = $(e.currentTarget).children('input[type="submit"]')
					.offset().left;
			spanX = $(e.currentTarget).offset().left;
			if (mouseX >= spanX && mouseX < inputX) {
				$(e.currentTarget).children('input[type="submit"]').get(0)
						.click();
			}
			// end QC 1434 : the click must work for left area of the button
		}
	};
	// Validation Step1 Edite Text Popin
	F6.UI.validationEditeStep1Popin = function(e) {
		// Set that page step1 can manage js
		$('[name=jsActivated]').val('true');

		var el_trigger = this;
		var prompt = false;
		var editor_data = CKEDITOR.instances.editor1.getData();
		var txt = '';
		if (editor_data.length <= 0) {
			F6.stop(e);
			prompt = true;
			txt = "Attention, votre courrier est vide. "
					+ "Pour préparer votre courrier vous avez le choix entre 3 options : le téléchargement de fichiers, "
					+ "l’utilisation d’un modèle de lettre ou la rédaction de contenu dans l’éditeur de texte";
		}

		if (prompt) {
			$.prompt(txt, {
				buttons : {
					Poursuivre : true
				},
				callback : function(e, v, m, f) {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			});
		} else {
			// begin QC 1434 : the click must work for left area of the button
			mouseX = e.pageX;
			inputX = $(e.currentTarget).children('input[type="submit"]')
					.offset().left;
			spanX = $(e.currentTarget).offset().left;
			if (mouseX >= spanX && mouseX < inputX) {
				$(e.currentTarget).children('input[type="submit"]').get(0)
						.click();
			}
			// end QC 1434 : the click must work for left area of the button
		}
	};
	// Validation Step 4 LEL/ Step5 LRE
	F6.UI.validationVotreCourrierPopin = function(e) {
		var el_trigger = this;
		var prompt = false;
		var isConfirmated = $('#confirme').is(':checked');
		var txt = '';
		if (isConfirmated == 0) {
			F6.stop(e);
			prompt = true;
			txt = "Veuillez valider votre courrier pour passer à l’étape suivante";
		}

		if (prompt) {
			$.prompt(txt, {
				buttons : {
					Valider : true
				},
				callback : function(e, v, m, f) {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			});
		} else {
			// begin QC 1434 : the click must work for left area of the button
			mouseX = e.pageX;
			inputX = $(e.currentTarget).children('input[type="submit"]')
					.offset().left;
			spanX = $(e.currentTarget).offset().left;
			if (mouseX >= spanX && mouseX < inputX) {
				$(e.currentTarget).children('input[type="submit"]').get(0)
						.click();
			}
			// end QC 1434 : the click must work for left area of the button
		}
	};
	// BY NOUAOUI ZAKARIA
	/* Address book Get form for update address */
	F6.UI.getAddressBookEdit = function(e) {

        var isMonCompte = document.getElementsByClassName("moncompte-container")[0];
        var tempolate_url = "";
        if (isMonCompte) {
            var tempolate_url = EBK.config.contextPath+'/compte/carnet-adresses?isAjax=true&addressId='
            				+ addressId;
        } else {
            var tempolate_url = EBK.config.contextPath+'/mon-compte/carnet-adresses?isAjax=true&addressId='
                    				+ addressId;
        }

		var addressId = e.currentTarget.id;

		if (isMonCompte) {
		    var tempolate_url = EBK.config.contextPath+'/compte/carnet-adresses?isAjax=true&addressId='
            				+ addressId;
		} else {
		var tempolate_url = EBK.config.contextPath+'/mon-compte/carnet-adresses?isAjax=true&addressId='
				+ addressId;
		}

		$('.for-scrollpane  ul  li.selected').removeClass('selected');
		$(this).parent('span').parent('li').addClass('selected');

		$.get(tempolate_url, function(template) {
			$('.content.contact-book').addClass('edit-contact');
			try {
				$('.panel-display').html(template);
			} catch (err) {
			}

			$('#lastName').focus();
			if ($('input[id=servicePro]').length) {
				F6.VALIDATIONS.formBookCoordonneesDestinataireProfessionnel();
			} else {
				F6.VALIDATIONS.formBookCoordonneesDestinataireParticulier();
			}
			F6.UI.activeUniform();
		}).error(
				function(e, m) {
					alert("Erreur de lecture du fichier de template :\n"
							+ tempolate_url);
				});
		return false;
	}

	/** Add parameter to all url containing 'sendJsActive' attribute */
	F6.UI.sendJsActive = function() {
		var _href = $(".sendJsActive").attr("href");
		if (_href != null && _href.indexOf('jsActive') < 0) {
			var jsActive_href = "?jsActive=true"
			if (_href.indexOf('recap') >= 0) {
				var jsActive_href = "&jsActive=true"
			}
			$('.sendJsActive').attr("href", _href + jsActive_href);
		}
	};

	/** LEL - STEP 3 : Setting all operation on page */
	F6.UI.destinatairesCRUD = function(remainingCount, onLoad) {
		F6.UI.sendJsActive();

		var typeParcoursVal = "LEL";

		if ($('.recommande').length > 0) {
			typeParcoursVal = "LREL";
		} else if ($('.pmc').length > 0) {
			typeParcoursVal = "PMC";
		} else if ($('.paf').length > 0) {
			typeParcoursVal = "PAF";
		} else if ($('.mtel').length > 0) {
			typeParcoursVal = "MTEL";
		}

		var href = $(".sendJsActive").attr("href");

		var infoContact = $('.footer-destinataires .infoContacts strong');
		var infoContactsText = 'Vous pouvez encore ajouter <strong></strong> contacts';
		var emptyContactsText = 'Vous ne pouvez plus ajouter de destinataires';

		if ((emptyContactsText.indexOf(infoContact.text()) >= 0 || infoContact.text() == '0') && remainingCount <= 0) {

			$('.destinatairesAdd .btn-action-minor, .tableDestinataire .addContact').unbind('click');
			$('.destinatairesAdd .btn-action-minor, .tableDestinataire .addContact').click(function() { return false; });
			$('.destinatairesAdd .btn-action-minor').addClass('light');
			$('.footer-destinataires .infoContacts').html(emptyContactsText);
		} else {
			if (!onLoad) {
				$('.footer-destinataires .infoContacts').html(infoContactsText);
				$('.footer-destinataires .infoContacts strong').text(remainingCount);
			}
			$('.destinatairesAdd .btn-action-minor, .tableDestinataire .addContact').unbind('click');
			$('.destinatairesAdd .btn-action-minor').removeClass('light');

			// LREL | LEL : Etape 3 > Ajouter un destinataire
            $('.destinatairesAdd .btn-action-minor, .tableDestinataire .addContact').click(function(e){
                e.preventDefault();
                $.fancybox.open({
                    src  : URLS.updatePath( href + '&x=' + new Date().getMilliseconds() ),
                    type : 'ajax',
                    opts : {
                        touch: false,
                        momentum: false,
                        smallBtn: false,
                        trapFocus: false,
                        clickOutside: false,
                        baseTpl : Popup.template(),
                        afterShow : function(instance, current) {
                            console.log('### AB!! :: LEL > 3 > Ajouter des destinataires ');
                            F6.MAIN.initInputFileBox();
                            F6.UI.executePopinLinks(instance);
                            F6.UI.addessBookSelectList();
                        },
                    }
                });
            });
		}

		if ($('.action-delete-item').length > 0) {
			$('.action-delete-item').unbind('click');
			$('.action-delete-item').bind('click', {
				typeParcours : typeParcoursVal
			}, F6.UI.promptRemoveDestinataire);
		}
		if ($('.action-insert-item').length > 0) {
			$('.action-insert-item').unbind('click');
			$('.action-insert-item').bind('click', {
				typeParcours : typeParcoursVal
			}, F6.UI.promptAddDestinataireToAddressBook);
		}

		//this code is proper to MTEL > lettre > list of destinataires
		if ($('.mtel-popup-btn-close').length > 0) {
			$('.mtel-popup-btn-close').unbind('click');
			$('.mtel-popup-btn-close').bind('click', {
				typeParcours : typeParcoursVal
			}, F6.UI.closeStepPopin );  // Note : suppression de validationStepPopin
		}

		if ($('.btn-send.validation').length > 0) {
			$('.btn-send.validation').unbind('click');
			$('.btn-send.validation').bind('click', {
				typeParcours : typeParcoursVal
			}, F6.UI.validationStepPopin );
		}

		var el_delete_all = $('.action-delete-all');
		if (el_delete_all.length > 0) {
			el_delete_all.unbind('click');
			el_delete_all
					.bind(
							'click',
							function(e) {
								var zindex = $('.mtel-popup-bg').css('z-index');
								var background = $('.mtel-popup-bg').css(
										'background');
								$('.mtel-popup-bg').css('z-index', 9999);
								$('.mtel-popup-bg').css('background',
										'transparent !important');

								//
								F6.stop(e);
								var el_trigger = this;
								var txt = '<div class="typo-din title3">Confirmation</div>'
										+ Globalize
												.localize(
														"Etes-vous certain de vouloir supprimer tous les destinataires ?",
														"fr_FR")
										+ ' <input type="hidden" id="itemId" name="itemId" value="all" />';
								$.prompt(
                                    txt,
                                    {
                                        buttons : {
                                            Confirmer : true,
                                            Annuler : false
                                        },
                                        callback : function(e, v, m, f) {
                                            if (v) {
                                                F6.AJAX.LELDeleteAllDestinataire(e, {typeParcours : typeParcoursVal}, "");
                                                $('.mtel-popup-bg').css('z-index', zindex);
                                                $('.mtel-manage-recipients-modal').hide();
                                            } else {
                                                $(el_trigger).focus();
                                                $('#successBoxTop a').focus();
                                            }
                                        }
                                    });
							});
		}
		var el_update_item = $('.action-update-item');
		if (el_update_item.length > 0) {
			el_update_item.unbind('click');
			el_update_item.bind('click', function(e) {
                F6.stop(e);
                $('.mtel-manage-recipients-modal').hide();

                var id = $(this).parent('td').parent('tr').attr('id');
                var href_fancybox = EBK.config.contextPath+'/lettre-en-ligne/modifier-destinataires' + '?isAjax=true&addressToUpdate=' + id; // F6.AJAX.mtelPopinDestinataireUpdate(typ);

                if (typeParcoursVal == "LREL") {
                    href_fancybox = EBK.config.contextPath+'/lettre-recommandee-en-ligne/modifier-destinataires'
                            + '?isAjax=true&addressToUpdate='
                            + id;
                } else if (typeParcoursVal == "PMC") {
                    href_fancybox = EBK.config.contextPath+'/prevenir-mes-contacts/modifier-destinataires'
                            + '?isAjax=true&addressToUpdate='
                            + id;
                } else if (typeParcoursVal == "PAF") {
                    href_fancybox = EBK.config.contextPath+'/prevenir-mes-administrations-fournisseurs/modifier-destinataires'
                            + '?isAjax=true&addressToUpdate='
                            + id;
                } else if (typeParcoursVal == "MTEL") {
                    href_fancybox = F6.UTILS.getMtelLink()
                            +'/support-impression/enveloppes/destinataires/modifier-destinataires'
                            + '?isAjax=true&addressToUpdate='
                            + id;
                }

                F6.UI.activeBodyFullJS();
                $.fancybox.open({
                	src  : URLS.updatePath( href_fancybox ),
                	type : 'ajax',
                    afterShow : function(instance, current) {console.log('### A');
                        var update_form = false;
                        if ($('#coordonneesParticulier').length) {
                            update_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
                        } else {
                            update_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
                        }
                        if (update_form) {
                            update_form.settings.submitHandler = function(form) {
                                if ($("#coordonneesProfessionnel").attr('action')) {
                                    F6.AJAX.LELAddProDestinataire(form,{typeParcours : typeParcoursVal});
                                } else {
                                    F6.AJAX.LELAddPartDestinataire(form,{typeParcours : typeParcoursVal});
                                }
                                globalFancybox = instance;
                            };
                        }
                        // init du HTML
                        F6.UI.activeUniform();
                        $('.fancybox-container input:eq(0)');
                    },
                	opts : {
                		touch: false,
                		momentum: false,
                		smallBtn: false,
                		clickOutside: false,
                		baseTpl : Popup.template(),
                		afterShow : function(instance, current) {console.log('### A BIS');
                            var update_form = false;
                            if ($('#coordonneesParticulier').length) {
                                update_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
                            } else {
                                update_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
                            }
                            if (update_form) {
                                update_form.settings.submitHandler = function(form) {
                                    if ($("#coordonneesProfessionnel").attr('action')) {
                                        F6.AJAX.LELAddProDestinataire(form,{typeParcours : typeParcoursVal});
                                    } else {
                                        F6.AJAX.LELAddPartDestinataire(form,{typeParcours : typeParcoursVal});
                                    }
                                    globalFancybox = instance;
                                };
                            }
                            // init du HTML
                            //F6.UI.activeUniform();
                            $('.fancybox-container input:eq(0)');
                        }

                	}
                });
            });
		}
	};

	F6.UI.executeInformationDepot = function() {
		if ($('.lrelinfodepot').length > 0) {
			$('.lrelinfodepot').bind('click', F6.UI.informatonDepotPopin);
		}
	};

	F6.UI.executeInformationAR = function() {
		if ($('.lrelinfoAR').length > 0) {
			$('.lrelinfoAR').bind('click', F6.UI.informatonAR);
		}
	};

	/** Popin operation LEL - STEP 3 : Manage tabs within fancy box */
	F6.UI.executePopinLinks = function(fancybox) {
		var typeParcoursVal = "LEL";

		if ($('.recommande').length > 0) {
			typeParcoursVal = "LREL";
		} else if ($('.pmc').length > 0) {
			typeParcoursVal = "PMC";
		} else if ($('.paf').length > 0) {
			typeParcoursVal = "PAF";
		} else if ($('.mtel').length > 0) {
			typeParcoursVal = "MTEL";
		}

		globalFancybox = fancybox;
		F6.UI.activeBodyFullJS();
		F6.UI.mtelDestinataireTabsRemove();
		F6.UI.activeUniform();
		F6.UI.initLELPopup();

		var actionSubmitHandler = function(form) {

			if (EBK.config.contextPath == ""){ // ($('input[name=lastName]').val()) {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.LELAddPartDestinataire(form, {
					typeParcours : typeParcoursVal
				});
				$('.btn-send input').removeAttr('disabled');
			} else {
				$('.btn-send input').attr('disabled', 'disabled');
				F6.AJAX.LELAddProDestinataire(form, {
					typeParcours : typeParcoursVal
				});
				$('.btn-send input').removeAttr('disabled');
			}

		};

		//if ($('#coordonneesParticulier:visible').length > 0) {
			var particuliers_form = F6.VALIDATIONS.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
			//F6.UI.activeSelectDestinataireForms();
			F6.UI.hideAndShowAddressPartAndProForm();
            F6.MAIN.initSelectBoxParent();
		//}
		//if ($('#coordonneesProfessionnel:visible').length > 0) {
			var professionnel_form = F6.VALIDATIONS.formCoordonneesDestinataireProfessionnel();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
			F6.UI.activeSelectDestinataireForms();
		//}

		if ($('#formAddressSelectList').length > 0) {
			destinataires_list = F6.VALIDATIONS.formAddDestinataireFromList();
			destinataires_list.settings.submitHandler = function(form) {
				if ($('#ajouter-destinataire input:checked').length > 0) {
					$('.btn-send input').attr('disabled', 'disabled');
					F6.AJAX.LELAddDestinataireFromAddressBook(form, {
						typeParcours : typeParcoursVal
					});
					$('.btn-send input').removeAttr('disabled');
				} else {
					$('#error-destinataires .error').html('Veuillez sélectionner au moins un contact');
					$('.adresses input:eq(0)').focus();
				}
			};
		}

		if ($('#importDestinataires').length > 0) {
			F6.VALIDATIONS.formImport();

			btn = $('#import');
			urlAction = $('#import').attr("data-url");
			rdm1 = Math.random();
			rdm2 = Math.random();
			realFilename = '';
			var uploader = new ss.SimpleUpload(
					{
						responseType : "text/html",
						multipart : true,
						button : btn,
						data : {
							isAjax : true,
							random1 : rdm1,
							random2 : rdm2,
                            '_csrf' : token
						},
						method : "POST",
						url : urlAction,

						accept : '*/*',
						name : "file",

						autoSubmit : false,
						onComplete : function(filename, response) {
							jsonResponse = $.parseJSON(response);
							$('.btn-send input').removeAttr('disabled');
							// failed
							if (!jsonResponse.success) {
								$('.btn-action').unbind('click');
								$('#error-import .error').html(
										'<ul><li>' + jsonResponse.data[0].message + '</li></ul>');
								$('#import').focus();
								$('.importTab .progressBar').hide();
								$('.importTab .firstForm').show();
								return false;
							}
							// succeed
							$('.importTab .firstForm').hide();
							$('.importTab .progressBar').hide();
							$('.importTab .secondForm').show();
							$('.secondForm .successAddressCount').text(jsonResponse.information.successAddressCount);
							$('.secondForm .addressesCount').text(jsonResponse.information.addressCount);

							var notValidateAddress = '';
							$.each(jsonResponse.information.notValidateAddress,function(i, line) {
                                if (i != 0) {
                                    notValidateAddress = notValidateAddress + ', ';
                                }
                                notValidateAddress = notValidateAddress + line;
                            });
							$('.secondForm .noValidateAddress').text(notValidateAddress);
							if (jsonResponse.information.lrelNoneEligibleContactError && jsonResponse.information.errorMessage == null) {
								$('#lrelNoneEligibleContactError').text('Votre liste contient au moins une adresse de destinataire à l\'étranger (hors France et DOM-TOM). Or, la Lettre Recommandée en ligne n\'accepte que les adresses de destinataires en France. Veuillez retirer les adresses à l\'étranger de votre liste');
							}
							if (jsonResponse.information.errorMessage != null) {
								$('.secondForm #lastAddress p').text('Le nombre limite de contacts importés a été atteint avant la fin du fichier. Le dernier contact importé correspond à la ligne ' + jsonResponse.information.errorMessage);
							}
							$('#popup').find('a:first').focus();
							$('#popup').find('#focus').focus();
						},
						onChange : function(filename, extension) {
							$("#importDestinataires .filename").html(filename);
							realFilename = filename;
						}
					});

			$("#importBtn").click(function(e) {

				if (realFilename != '') {
					e.preventDefault();
					$('.btn-send input').attr('disabled', 'disabled');
					$('.importTab .progressBar').show();
					$('.importTab .firstForm').hide();
					uploader.submit();
				}

			});

		}

		$(".importTab .secondForm .validation a").click(function(e) {
            e.preventDefault();
            if (typeParcoursVal == "MTEL") {
                F6.AJAX.UpdateSessionListeDestinataire();
            } else {
                F6.UI.LELUpdateDestinataireTable(jsonResponse.data,
                        null, true);
            }
        });

		$('.fancybox-container #popup .tabs-destin a').bind('click', {},F6.UI.popinLinks);

		$('#popup .tabs-destin a:eq(0)').focus();
		$('#popup .btn-footer input[type="submit"]').bind('keypress.tabulation', function(e) {
            if (e.keyCode == 9 && !e.shiftKey) {
                return false;
            }
        });
	};
	F6.UI.popinLinks = function(e) {
		F6.stop(e);
		var isRecommandee = $('.recommande').length > 0 ? true : false;
		var isExpediteur = $('.expediteur').length > 0 ? true : false;
		// LREL Pro
		if (!isExpediteur) {
			F6.UI.LELSwitchTab($(this), isRecommandee);
		}
	};

	F6.UI.mascadiaError = function(mascadiaResponse, form, prefix) {
		var codeErrLocalite = 24;

		if (mascadiaResponse.codeErrCommune.indexOf(codeErrLocalite) >= 0) {
			// mtaieb: message d'erreur suite au retour mascadia
			// F6.UI.displayErrorFormMessage('#error-coordonnees-part','erooooor');
			var htmlErr = '<ul style="display:block"><li style="display:block"> <label class="error" >'
					+ Globalize.localize("Localité est incorrecte", "fr_FR")
					+ '</label> </li></ul>';
			if (form == "Part") {
				$('#error-coordonnees-part').html(htmlErr);
				$('#error-coordonnees-part').show();
			} else {
				$('#error-coordonnees-pro').html(htmlErr);
				$('#error-coordonnees-pro').show();
			}
			$('#localite').parent().parent().addClass('error-contener');
			$('.type-select').hide();
		} else {

			$('.mascadiaProposition.' + form).html("");
			F6.UI.enableInputs(form);
			var htmlCode = '<div class="type-select">'
					+ '<label class="" for="register-composedAddress"> Liste des adresses proposées  <span class="skip"></span></label>'
					+ '<select id="register-composedAddress" name="composedAddress" class="use-uniform" style="opacity: 0;">';

			if ($('.mtel').length > 0) {
				htmlCode = '<div class="row spBottom-small">'
						+ '<label class="mtel-popin-label" for="register-composedAddress propart-mtelE2-txt41"> <label>Liste des adresses proposées <span class="skip"></span></label> '
						+ '<div class="square-select-custom mtel-popin-select">'
						+ '<select id="register-composedAddress" name="composedAddress" class="square-select no-radius">'
						+ '</div></label>';

			}

			// znouaoui : refacto : build mascadia proposition
			// znouaoui : TODO build address from server side using @See
			// SercadiaUtils.buildMascadiaProposition
			$.each(mascadiaResponse.addressSelections, function(i, propostion) {
				htmlCode = htmlCode + '<option value="' + propostion.code
						+ '">' + propostion.libelle + '</option>';

				if ("-1" != propostion.code) {
					window["address" + propostion.code] = {
						titleCode : mascadiaResponse.ligne1.civilite,
						lastName : mascadiaResponse.ligne1.nom,
						firstName : mascadiaResponse.ligne1.prenom,
						appartement : mascadiaResponse.ligne2.libelle,
						batiment : mascadiaResponse.ligne3.libelle,
						libelle : propostion.libelleComplet,
						localite : propostion.libelleAcheminement,
						codePostal : propostion.codePostal,
						countryCode : mascadiaResponse.countryCode,
						lieuDit : mascadiaResponse.ligne5.libelle
					};
				}
			});

			htmlCode = htmlCode + '</select>' + '</div>';

			window["countryCode"] = mascadiaResponse.countryCode;

			$('.mascadiaProposition.' + form).html(htmlCode);
			F6.UI.activeUniform();
			F6.UI.initializeUpdateMascadia(prefix, form);
		}

        F6.MAIN.initSelectBoxParent();
	}

	/** LEL Switch Tab */
	F6.UI.LELSwitchTab = function(aTag, isRecommandee) {
		var destinatairesLink = '#';
		var step2WithLink = '<a href="' + destinatairesLink + '">'
				+ 'Recherchez dans votre<br>carnet d\'adresses La Poste </a>';
		var step2WithoutLink = 'Recherchez dans votre<br>carnet d\'adresses La Poste';
		var step3WithLink = '<a href="' + destinatairesLink
				+ '">Téléchargez votre <br>fichier d\'adresses </a>';
		var step3WithoutLink = 'Téléchargez votre <br>fichier d\'adresses';

		var step1WithLink = '<a href="' + destinatairesLink + '">'
				+ 'Saisissez l\'adresse <br>du destinataire '
				+ '<span class="hidden-active-script">particulier</span></a>';
		var step1WithoutLink = 'Saisissez l\'adresse <br>du destinataire '
				+ '<span class="hidden-active-script">particulier</span>';

		if (aTag.parent().hasClass('step1')) {
			$('.destinataireTab').show();
			$('.tabs-destin .step1').addClass('active');
			$('.tabs-destin .step1').html(step1WithoutLink);

			$('.addressBookTab').hide();
			$('.tabs-destin .step2').removeClass('active');
			$('.tabs-destin .step2').html(step2WithLink);

			$('.importTab').hide();
			$('.tabs-destin .step3').removeClass('active');
			$('.tabs-destin .step3').html(step3WithLink);

			$('#switchFormPart').focus()
		} else if (aTag.parent().hasClass('step2')) {
			$('.addressBookTab').show();
			$('.tabs-destin .step2').addClass('active');
			$('.tabs-destin .step2').html(step2WithoutLink);
			$('.destinataireTab').hide();

			$('.tabs-destin .step1').removeClass('active');
			$('.tabs-destin .step1').html(step1WithLink);

			$('.importTab').hide();
			$('.tabs-destin .step3').removeClass('active');
			$('.tabs-destin .step3').html(step3WithLink);

			$(".adress-index > li > a:first").focus();

		} else if (aTag.parent().hasClass('step3')) {
			$('.importTab').show();
			$('.tabs-destin .step3').addClass('active');
			$('.tabs-destin .step3').html(step3WithoutLink);

			$('.addressBookTab').hide();
			$('.tabs-destin .step1').removeClass('active');
			$('.tabs-destin .step1').html(step1WithLink);

			$('.destinataireTab').hide();
			$('.tabs-destin .step2').removeClass('active');
			$('.tabs-destin .step2').html(step2WithLink);

			$('input[name=file]').focus();
		} else {
			$('.importTab').show();
			$('.tabs-destin .step3').addClass('active');
			$('.tabs-destin .step3').html(step3WithoutLink);

			$('.addressBookTab').hide();
			$('.tabs-destin .step1').removeClass('active');
			$('.tabs-destin .step1').html(step1WithLink);

			$('.destinataireTab').hide();
			$('.tabs-destin .step2').removeClass('active');
			$('.tabs-destin .step2').html(step2WithLink);

			$('input[name=file]').focus();

		}
		var remainingNumber = $('.footer-destinataires .infoContacts strong')
				.text();
		if (remainingNumber == '0') {
			$('.btn-send input').attr('disabled', 'disabled');
		}

		$('.fancybox-container #popup .tabs-destin a').bind('click', {}, F6.UI.popinLinks);
		$('#popup .tabs-destin a:eq(0)').focus();

		$('#popup .btn-footer input[type="submit"]').bind('keypress.tabulation', function(e) {
            if (e.keyCode == 9 && !e.shiftKey) {
                return false;
            }
        });
	};

	/** LEL Init tabs and buttons */
	F6.UI.initLELPopup = function() {
		var remainingNumber = $('.footer-destinataires .infoContacts strong').text();
		$('.addressBookTab').hide();
		$('.importTab').hide();
		$('.importTab .secondForm').hide();
		$('.importTab .progressBar').hide();
		$('.tabs-destin .step1').addClass('active');
		$('.tabs-destin .step2').removeClass('active');
		$('.tabs-destin .step3').removeClass('active');

		if (remainingNumber == '0') {
			$('.btn-send input').attr('disabled', 'disabled');
		}
	};

	/** LEL Change highlight and position of addresses for addressBook */
	F6.UI.addessBookSelectList = function() {
		$('#formAddressSelectList .adress-index li a').unbind('click');
		if ($('#formAddressSelectList .adress-index li a').length) {
			var carnet_element = $('#formAddressSelectList .adresses');
			var posY_book = carnet_element.offset().top;
			$('#formAddressSelectList .adress-index li a').bind('click', function() {
                link_to = $(this).attr('href');

                if (typeof ($(link_to)) != 'undefined') {
                    posY_of_book = $(link_to).offset().top;
                    scroll_poxY = carnet_element.scrollTop();
                    posY = posY_of_book + scroll_poxY - posY_book - 220;

                    $('#formAddressSelectList .adress-index li a.selected').removeClass('selected');
                    $(this).addClass('selected');

                    carnet_element.scrollTop(posY);
                    var index = $('.adresses dt').index($(link_to));
                    $('.adresses d:eq(' + index + ') input[type=checkbox]:first').focus();
                }
                return false;
            })
		}
	};

    F6.UI.addressBookSelectListVrel = function() {
        $('#formAddressSelectList .adress-index li a').unbind('click');
        if ($('#formAddressSelectList .adress-index li a').length) {
            $('#formAddressSelectList .adress-index li a').bind('click', function() {
                link_to = $(this).attr('href');

                if (typeof ($(link_to)) != 'undefined') {

                    $('#formAddressSelectList .adress-index li a.selected').removeClass('selected');
                    $(this).addClass('selected');

                    var index = $('.adresses dt').index($(link_to));
                    $('.adresses d:eq(' + index + ') input[type=checkbox]:first').focus();
                }

            })
        }
    };


    /**
	 * Update destinataire table LEL - STEP 3 : Update table of Destinataire
	 * after all CRUD operation
	 */
	F6.UI.LELUpdateDestinataireTable = function(datas, opts, isImport, error_messages) {

		var pageLink = EBK.config.contextPath+'/lettre-en-ligne/destinataires';
		var typeParcours = "LEL";
		var iconFermer = "/_ui/eboutique/images/icons/ico_fermer_orange.gif";
		var iconModifier = "/_ui/eboutique/images/icons/ico_label.gif";
		var iconCarnetAdresse = "/_ui/eboutique/images/icons/ico_address_orange.gif";
		$(".mascadiaDownError").each(function() {
			$(this).text("");
		});
		// nhentati: effacer le msginfo du block expediteur
		$("#blockExpediteurMsg").empty();
		if (datas.error != null && datas.error != undefined && datas.error) {
			var errorLabel = '<label class="error">' + datas.message
					+ '</label>';
			if (datas.pro) {
				$('#error-coordonnees-pro').html(
						'<ul style="display:block"><li style="display:block">'
								+ errorLabel + '</li><ul>');
				$('#error-coordonnees-pro').show();
			} else {
				$('#error-coordonnees-part').html(
						'<ul style="display:block"><li style="display:block">'
								+ errorLabel + '</li><ul>');
				$('#error-coordonnees-part').show();
			}
			return;
		}

		if ($('.recommande').length > 0) {
			pageLink = EBK.config.contextPath+'/lettre-recommandee-en-ligne/votre-recommande';
			typeParcours = "LREL";
		} else if ($('.pmc').length > 0) {
			pageLink = EBK.config.contextPath+'/prevenir-mes-contacts/destinataires';
			typeParcours = "PMC";
		} else if ($('.paf').length > 0) {
			typeParcours = "PAF";
			pageLink = EBK.config.contextPath+'/prevenir-mes-administrations-fournisseurs/destinataires';
		} else if ($('.mtel').length > 0) {
			typeParcours = "MTEL";
			pageLink = F6.UTILS.getMtelLink()
					+ EBK.config.contextPath+'/support-impression/enveloppes/destinataires';
			iconFermer = "/_ui/eboutique/images/mtel-part-addressbook-delete.png";
			iconModifier = "/_ui/eboutique/images/mtel-part-addressbook-edit.png";
			iconCarnetAdresse = '/_ui/eboutique/images/mtel-part-addressbook-add.png';
		}

		$('.destinataires-wrap li').show();
		var msg = '';
		var msgInfoMtel = '';
		var isMascadiaError = false;
		var prefixForm = ".destinataires ";
		var operatingImgExistOn = '<img src="/_ui/eboutique/images/icons/ico_check_gray.gif" alt="Contact déjà&nbsp; ajouté">';
		var mascadiaErrorMessage = '<br> <span class="error"> (Adresse non validée) </span>';
		var lselAdresseNonELigibleMessage = '<br> <span class="error"> (Adresse non éligible) </span>';
		var operatingImgDoNotExist = '<img src="' + iconCarnetAdresse
				+ '" alt="Ajouter au carnet d\'adresse">';
		var rowId;
		var operation;
		var error = false;
		var ligibiliteStyle = '';
		var nbAddressIligible = 0;
		var allowedCountriesLSELMsg = '';
		$.each(datas, function(i, data) {
            var msg = '';

            if (!data.notValidAdresse) {
                $('#lselErrorMesgTop').css('display', 'none');
            }

            if (data.addressData != null
                    && data.addressData.mascadiaResponse != null
                    && (data.addressData.mascadiaResponse.ligne6Flag || data.addressData.mascadiaResponse.ligne4Flag)) {
                F6.UI.mascadiaError(
                        data.addressData.mascadiaResponse,
                        data.form, prefixForm);
                isMascadiaError = true;
                error = true;
            }
            // Si le service mascadia est indisponile on affiche
            // un message d'erreur comme quoi mascadia est
            // indisponible
            else if (data.addressData != null
                    && data.addressData.mascadiaServerError == true) {
                if (data.message.length > 0) {
                    $(".mascadiaDownError").each(function() {
                        $(this).text(data.message);
                    });
                }

            } else {
                if (globalFancybox != null && !data.error
                        && !isImport) {
                    globalFancybox.close();
                }

                if (data.addressData != undefined
                        && data.addressData.mtelAddressEligibilite != undefined
                        && data.addressData.mtelAddressEligibilite == 'ADDRESS_NOT_ELIGIBLE') {
                    ligibiliteStyle = '; color:rgb(153,7,5);';
                    msgInfoMtel = 'Certaines adresses ne sont pas compatibles avec le produit et/ou le poids que vous avez choisi.'
                        +'Vous pouvez modifier ou supprimer ces adresses';
                    nbAddressIligible = nbAddressIligible + 1;
                } else {
                    ligibiliteStyle = '';
                }

                operation = data.operation;
                if (operation == null)
                    operation = '';

                var dest = '';
                if (data.addressData.companyName){
                    dest = data.addressData.companyName;
                }
                else{
                    dest = data.addressData.lastName + ", " + data.addressData.firstName;
                }

                if (operation.toLowerCase().indexOf('new') >= 0) {
                    rowId = data.addressData.rowId;
                    var addressName = data.addressData.lastName + ', '+ data.addressData.firstName;
                    if( (data.addressData.lastName == null || data.addressData.lastName == 'undefined')
                            && (data.addressData.firstName == null || data.addressData.firstName == 'undefined' ) )
                        addressName = data.addressData.companyName;
                    var destinataireLine = '<tr class="receiver" id="'
                            + rowId
                            + '">'
                            + '<td headers="contactNom" class="name" style="'
                            + ligibiliteStyle
                            + '">'
                            + addressName
                            + '</td>'
                            + '<td headers="contactAdresse" class="address" style="'
                            + ligibiliteStyle
                            + '"  title="'
                            + data.addressData.shortAddress
                            + '">'
                            + data.addressData.longAddress;

                    if (data.addressData.notAllowedCountryForLSEL) {
                        destinataireLine = destinataireLine
                                + lselAdresseNonELigibleMessage;
                    } else if (data.addressData.mascadiaError
                            || data.addressData.civilityMandatoryPro
                            || data.addressData.notAllowedCountryForLREL) {
                        destinataireLine = destinataireLine
                                + mascadiaErrorMessage;
                    }

                    destinataireLine = destinataireLine
                            + '</td>';

                    if (!$('.lelStep4RecapClass').length) {
                        if (data.addressData.savedOnAddressBook) {
                            destinataireLine = destinataireLine
                                    + '<td headers="contactAjouter" class="actions addAdress"> '
                                    + operatingImgExistOn
                                    + '</td>';
                        } else {
                            destinataireLine = destinataireLine
                                    + '<td headers="contactAjouter" class="actions addAdress"> '
                                    + '<a class="action-insert-item" href="'
                                    + pageLink
                                    + '?addressToSave='
                                    + rowId
                                    + '" title="Ajouter au carnet d\'adresse le destinataire '
                                    + data.addressData.owner
                                    + '">'
                                    + operatingImgDoNotExist
                                    + '</a>' + '</td>';
                        }

                        destinataireLine = destinataireLine
                                + '<td headers="contactModifier" class="actions edit">'
                                + '<a class="action-update-item" href="'
                                + pageLink
                                + '?addressToUpdate='
                                + rowId
                                + '" title="Modifier le destinataire '
                                + data.addressData.owner + '">'
                                + '<img src="' + iconModifier
                                + '" alt="Modifier">' + '</a>'
                                + '</td>';
                    }

                    destinataireLine = destinataireLine
                            + '<td headers="contactSupprimer" class="actions delete">'
                            + '<a class="action-delete-item" href="'
                            + pageLink
                            + '?addressToRemove='
                            + rowId
                            + '" title="Supprimer le destinataire '
                            + data.addressData.owner + '">'
                            + '<img src="' + iconFermer
                            + '" alt="Supprimer">' + '</a>'
                            + '</td>';
                    var deleteAllButtom = '<a class="action-delete-all" href="'
                            + pageLink
                            + '?removeAll=true"'
                            + 'title="tout supprimer : Supprimer tous les destinataires sélectionnés">Tout supprimer'
                            + '</a>';

                    if ($('#lelTableDestinataire').find(
                            'tr[id^="Item_Error_"]:last').length > 0
                            && !data.addressData.mascadiaError) {
                        $('#lelTableDestinataire').find(
                                'tr[id^="Item_Error_"]:last')
                                .after(destinataireLine);
                    } else {
                        $('#lelTableDestinataire').find(
                                'tr#header').after(
                                destinataireLine);
                    }

                    $('tfoot .actions.delete',
                            '#lelTableDestinataire').html(
                            deleteAllButtom);
                    msg = data.addressData.owner
                            + ' a été ajouté';

                }// end if (new line)

                if (operation.toLowerCase().indexOf('error') >= 0) {
                    rowId = data.addressData.rowId;
                    var element = $('tr#' + opts.rowId);
                    $('.name', element).text(
                        dest);
                    $('.name', element).attr('style',
                            ligibiliteStyle);
                    $('.address', element).text(
                            data.addressData.longAddress);
                    $('.address', element).attr('style',
                            ligibiliteStyle);
                    $('.address', element).attr('title',
                            data.addressData.shortAddress);

                    element.attr("id", rowId);
                    if ($('#lelTableDestinataire').find(
                            'tr[id^="Item_Error_"]:last').length > 0)
                        $('#lelTableDestinataire').find(
                                'tr[id^="Item_Error_"]:last')
                                .after(element);
                    else
                        $('#lelTableDestinataire').find(
                                'tr#header').after(element);
                    msg = data.addressData.owner
                            + ' a été modifié';
                }

                if (operation.toLowerCase().indexOf('valide') >= 0) {
                    rowId = data.addressData.rowId;
                    var element = $('tr#' + rowId);

                    $('.name', element).text(
                        dest);
                    $('.name', element).attr('style',
                            ligibiliteStyle);
                    $('.address', element).text(
                            data.addressData.longAddress);
                    $('.address', element).attr('title',
                            data.addressData.shortAddress);
                    $('.address', element).attr('style',
                            ligibiliteStyle);

                    msg = data.addressData.owner
                            + ' a été modifié';
                }

                if (operation.toLowerCase().indexOf('addaddressbook') >= 0) {
                    rowId = data.addressData.rowId;
                    var element = $('tr#' + rowId);
                    $('.action-insert-item', element).parent().html(operatingImgExistOn);
                    msg = data.addressData.owner + ' a été ajouté au carnet d\'adresses';
                }

                if (operation.toLowerCase().indexOf('delete') >= 0) {
                    rowId = data.addressData.rowId;
                    $('#lelTableDestinataire').find('tr#' + rowId).fadeOut('slow').remove();
                    msg = data.addressData.owner + ' a été supprimé';
                }

                if (operation.toLowerCase().indexOf('all') >= 0) {
                    var table = $('#lelTableDestinataire').find("tr[id*=Item_]");
                    if ($('ul.pagination', '#lelTableDestinataire').is(':visible'))
                        $('ul.pagination').hide();

                    $.each(table, function(a, b) {
                        var id_del = table.attr('id');
                        $(this).fadeOut('slow').remove();
                    });
                    msg = 'Tous les destinataires ont été supprimés';
                }

                if (data.error == true) {
                    error = true;
                    $('#error-destinataires .error').html(data.message);
                    $('.adresses input:eq(0)').focus();
                }
                if (msgInfoMtel.length > 0) {
                    $('#eligibiliteBoxInfo').text(msgInfoMtel);
                }
            }
        });
		if (error == false) {
			if ($('#LelStep3Recap').length > 0) {
				if (typeParcours == "LEL") {
					F6.AJAX.LelSummaryBasketAjax('LelStep3Recap');

				} else if (typeParcours == "LREL") {
					F6.AJAX.LelSummaryBasketAjax('LrelStep3Recap');
				} else if (typeParcours == "PMC") {
					F6.AJAX.LelSummaryBasketAjax('PmcStep3Recap');
				} else if (typeParcours == "PAF") {
					F6.AJAX.LelSummaryBasketAjax('PafStep3Recap');
				} else if (typeParcours == "MTEL") {
					// commented by znouaoui -> faut pas diminuer le nombre de
					// timbre en supprimant un destinataire
					// receiver_count = datas.length - nbAddressIligible;
					// if (receiver_count > 0) {
					// if (operation.toLowerCase().indexOf('new') >= 0) {
					// if (parseInt($('#nombreTimbre').val()) == 1 ) {
					// $('#nombreTimbre').val(parseInt(receiver_count));
					// } else {
					// $('#nombreTimbre').val(parseInt($('#nombreTimbre').val())
					// +
					// parseInt(receiver_count));
					// }
					// } else if (operation.toLowerCase().indexOf('delete') >=
					// 0) {
					//
					//
					// if (parseInt($('#nombreTimbre').val()) > receiver_count )
					// {
					// $('#nombreTimbre').val(parseInt(parseInt($('#nombreTimbre').val())
					// -
					// parseInt(receiver_count)));
					// } else if (parseInt($('#nombreTimbre').val()) ==
					// receiver_count ) {
					// $('#nombreTimbre').val(1);
					// }
					// } else if (operation.toLowerCase().indexOf('all') >= 0) {
					// $('#nombreTimbre').val(1);
					// }
					// }
					F6.AJAX.EnveloppeSelectorAjax();
				}
			}
			if (typeParcours == "MTEL") {
				// commented by znouaoui -> faut pas diminuer le nombre de
				// timbre en
				// supprimant un destinataire
				// receiver_count = datas.length - nbAddressIligible;
				// if (receiver_count > 0) {
				// if (operation.toLowerCase().indexOf('new') >= 0) {
				// if (parseInt($('#nombreTimbre').val()) == 1 ) {
				// $('#nombreTimbre').val(parseInt(receiver_count));
				// } else {
				// $('#nombreTimbre').val(parseInt($('#nombreTimbre').val()) +
				// parseInt(receiver_count));
				// }
				// } else if (operation.toLowerCase().indexOf('delete') >= 0) {
				// if (parseInt($('#nombreTimbre').val()) > receiver_count ) {
				// $('#nombreTimbre').val(parseInt(parseInt($('#nombreTimbre').val())
				// -
				// parseInt(receiver_count)));
				// } else if (parseInt($('#nombreTimbre').val()) ==
				// receiver_count ) {
				// $('#nombreTimbre').val(1);
				// }
				// } else if (operation.toLowerCase().indexOf('all') >= 0) {
				// $('#nombreTimbre').val(1);
				// }
				// }
				F6.AJAX.EnveloppeSelectorAjax();
			}

			if (datas.length > 1) {
				F6.UI.displaySuccessMessage(
						'Les destinataires ont été ajoutés', '', Globalize
								.localize(
										"Continuer à gérer les destinataires",
										"fr_FR"));
			} else {
				var addressTmp = datas[0].addressData;
				var type_crud = datas[0].operation=='new'?'INSERT':'UPDATE';
				var addressName = '' ;
                if (addressTmp.line1 != null && addressTmp.line1 != '' ) {
                    addressName = addressTmp.line1;
                } else if(addressTmp.addressName != null && addressTmp.addressName != '' && addressTmp.addressName != 'undefined') {
                    addressName = addressTmp.addressName;
                }else if(addressTmp.companyName != null && addressTmp.companyName != '' && addressTmp.companyName != 'undefined'){
                    addressName = addressTmp.companyName;
                }
                 else{
                    addressName = addressTmp.firstName +' '+addressTmp.lastName;
                }
				if (type_crud == 'INSERT') {
					addressName += ' a été ajouté(e)<br>';
				} else {
					addressName += ' a été modifié(e)<br>';
				}
				if (msg != '') {
					msg = addressName + msg;
				} else {
					msg = addressName;
				}
				F6.UI.displaySuccessMessage(msg, '', Globalize.localize(
						"Continuer à gérer les destinataires", "fr_FR"));
			}

			var itemsPerPage = 10;
			if (typeParcours == "MTEL") {
				itemsPerPage = 7;
			}
			var numPage = Math.ceil($('tbody  tr[id^="Item_"]').length
					/ itemsPerPage);
			var currentPage = $('.clickable.selected').children().attr('class');
			if (rowId != null && operation.toLowerCase().indexOf('delete') < 0)
				currentPage = Math
						.ceil($('tr#' + rowId).index() / itemsPerPage);

			if (currentPage == null || currentPage > numPage) {
				currentPage = 1;
			}
			$('.pagination.destinataires').remove();

			F6.UI.destinatairesPagination(currentPage - 1, currentPage + 1,
					currentPage - 1, itemsPerPage, true);
		}

	};

	/** LEL Pagination */
	F6.UI.destinatairesPagination = function(currentPage, nextPage,
			previousPage, numberPerPage, generateButtom) {
		$('table.paginated')
				.each(
						function() {
							var $table = $(this);
							$table.bind('repaginate', function() {
								$table.find('tbody  tr[id^="Item_"]').hide()
										.slice(currentPage * numberPerPage,
												++currentPage * numberPerPage)
										.show();
							});

							$table.trigger('repaginate');
							var numRows = $table.find('tbody  tr[id^="Item_"]').length;
							var numPages = Math.ceil(numRows / numberPerPage);
							if (generateButtom) {
								var $pagination = $('<ul  class="pagination  destinataires"></ul>');

								$('<li  class="previousPage">  </li>')
										.html('<a  href="#"  title="Aller  à   la  page  précédente"><img  src="/_ui/eboutique/images/icons/ico_table_arrow_left.png"  alt="page  précédente"></a>')
										.bind('click',
												function(event) {
													currentPage = $('.clickable.selected').children().attr('class');
													if (currentPage > 1) {
														$('#page-number'+ currentPage--).removeClass('selected');
														currentPage--;
														$table.trigger('repaginate');
														currentPage++;
														$('#page-number' + --currentPage).addClass('selected');
													}
													$(".block-bg-corner.destinatairesAdd .btn-action-minor.add").focus();
													$('html, body').animate({scrollTop : $("#lelTableDestinataire").offset().top}, 500);
												}).appendTo($pagination).addClass('clickable');

								for (var page = 0; page < numPages; page++) {
									$('<li  id="page-number' + (page + 1) + '">  </li>')
											.html('<a  href="#"  class="'
															+ (page + 1)
															+ '"  title="page  '
															+ (page + 1) + '">'
															+ (page + 1)
															+ '</a>')
											.bind('click',{
														newPage : page
													},
													function(event) {
														currentPage = event.data['newPage'];
														$table.trigger('repaginate');
														$(this).addClass('selected')
																.siblings()
																.removeClass('selected');
														$(".block-bg-corner.destinatairesAdd .btn-action-minor.add").focus();
														$('html, body').animate({scrollTop : $("#lelTableDestinataire").offset().top}, 500);
													}).appendTo($pagination).addClass('clickable');
								}
								$pagination.insertAfter('.block-pagination  .hidden');
								$('#page-number' + (--currentPage + 1)).addClass('selected');

								$('<li  class="nextPage">  </li>')
										.html('<a  href="#"  title="Aller  à   la  page  suivante"><img  src="/_ui/eboutique/images/icons/ico_table_arrow_right.png"  alt="page  suivante"></a>')
										.bind('click',
												function(event) {
													currentPage = $(
															'.clickable.selected')
															.children().attr(
																	'class');
													if (currentPage < numPages) {
														$(
																'#page-number'
																		+ currentPage)
																.removeClass(
																		'selected');
														$table
																.trigger('repaginate');
														$(
																'#page-number'
																		+ currentPage)
																.addClass(
																		'selected');
													}
													$(".block-bg-corner.destinatairesAdd .btn-action-minor.add").focus();
													$('html, body').animate({
																		scrollTop : $("#lelTableDestinataire").offset().top
																	}, 500);
												}).appendTo($pagination).addClass('clickable');

								if ($('.clickable').length > 1) {
									$('<li>  </li>')
											.html(
													'<a  href="#">Afficher  tout</a>  </li>')
											.bind(
													'click',
													{
														numberPerPage : (400)
													},
													function(event) {
														numberPerPage = event.data['numberPerPage'];
														currentPage = 0;
														$table
																.trigger('repaginate');
														$('.clickable').remove();
														$(".block-bg-corner.destinatairesAdd .btn-action-minor.add").focus();
														$('html, body').animate({scrollTop : $("#lelTableDestinataire").offset().top
																		}, 500);
													}).appendTo($pagination).addClass('clickable');
								}
							}
							if (numRows <= numberPerPage) {
								$('.clickable').remove();
							}
							// $('.clickable.selected').unbind('click');
							// $('.clickable.selected').click(function(e) {
							// e.preventDefault();
							// });
							// $('.clickable.selected').html($('.clickable.selected
							// a').text());
							// $(".block-bg-corner.destinatairesAdd
							// .btn-action-minor.add").focus();
						});
		if ($.uniform.update != undefined) {
			$.uniform.update();
		}
	};

	/** LEL & LREL ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Remove destinataire from table *********************************** */
	F6.UI.promptRemoveDestinataire = function(e) {
		F6.stop(e);
		var typeParcoursVal = e.data.typeParcours;

		var id = $(this).parent('td').parent('tr').attr('id');
		var el_trigger = this;
		var element = $('#' + id);
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize
						.localize(
								"Etes-vous certain de vouloir supprimer cette adresse ?",
								"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		var zindex = $('.mtel-popup-bg').css('z-index');
		var background = $('.mtel-popup-bg').css('background');
		$('.mtel-popup-bg').css('z-index', 9999);
		$('.mtel-popup-bg').css('background', 'transparent !important');

		$.prompt(txt, {
			buttons : {
				Supprimer : true,
				Annuler : false
			},
			callback : function(e, v, m, f) {
				if (v) {
					$(element).addClass('removeAfterSuccesPromptAndAjax');
					$('input[name="receiver_count"]').val(
							$('input[name="receiver_count"]').val() - 1);
					F6.AJAX.LELDeleteDestinataire(e, {
						typeParcours : typeParcoursVal,
						id : id,
						success_message : Globalize.localize(
								"Adresse supprimée avec succès", "fr_FR")
					});
					// if ($('#lelTableDestinataire').find("tr[id*=]").length <=
					// 1) { // check 1 pour exclure 1ère ligne tableau
					$('.mtel-popup-bg').css('z-index', zindex);
					$('.mtel-manage-recipients-modal').hide();
					// }
				} else {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			}
		});
		return false;
	}

	/** LEL & LREL ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Add destinataire to addressBook *********************************** */
	F6.UI.promptAddDestinataireToAddressBook = function(e) {
		F6.stop(e);
		var txt = '';
		var typeParcoursVal = e.data.typeParcours;

		var el_trigger = this;
		var id = $(this).parent('td').parent('tr').attr('id');
		var element = $(this).parent();
		var authenticated = true;

		var element = $('#' + id);
		var isMascadiaError = element.find('.error').length;
		// .user-action a[href*="/deconnexionPopin"]
		if ($('#isUserConnected').text() == "true") {
			if (isMascadiaError == 0) {
				txt = '<div class="typo-din title3">Confirmation</div>'
						+ Globalize
								.localize(
										"Etes-vous certain de vouloir ajouter cette adresse à votre carnet ?",
										"fr_FR")
						+ ' <input type="hidden" id="itemId" name="itemId" value="'
						+ id + '" />';
			} else {
				txt = "Seuls les contacts dont l'adresse est validée peuvent être ajoutés au Carnet d'Adresse La Poste. Veuillez d'abord valider l'adresse de ce contact";
				isMascadiaError = true;
			}

		} else {
			txt = 'Pour ajouter un contact à votre carnet d\'adresses La Poste, veuillez vous identifier';
			authenticated = false;
		}
		if (authenticated) {
			if (isMascadiaError) {
				$.prompt(txt, {
					buttons : {
						Poursuivre : true
					},
					callback : function(e, v, m, f) {
						if (v) {
							$(el_trigger).focus();
							$('#successBoxTop').find('a').focus();
						}
					}
				});
			} else {
				$.prompt(txt, {
					buttons : {
						Ajouter : true,
						Annuler : false
					},
					callback : function(e, v, m, f) {
						if (v) {
							$(element).addClass(
									'removeAfterSuccesPromptAndAjax')
							F6.AJAX.LELAddDestinataireToAddressBook(e, {
								typeParcours : typeParcoursVal,
								id : id,
								success_message : Globalize.localize(
										"Adresse supprimée avec succès",
										"fr_FR")
							});
						} else {
							$(el_trigger).focus();
							$('#successBoxTop').find('a').focus();
						}
					}
				});
			}
		} else {
			$.prompt(txt,{
						buttons : {
							"Connexion" : true,
							Annuler : false
						},
						callback : function(e, v, m, f) {
							if (v) {
								var url = EBK.config.contextPath+'/lettre-en-ligne/destinataires';
								if (typeParcoursVal == "LREL") {
									url = EBK.config.contextPath+'/lettre-recommandee-en-ligne/votre-recommande';
								} else if (typeParcoursVal == "PMC") {
									url = EBK.config.contextPath+'/prevenir-mes-contacts/destinataires';
								} else if (typeParcoursVal == "PAF") {
									url = EBK.config.contextPath+'/prevenir-mes-administrations-fournisseurs/destinataires';
								} else if (typeParcoursVal == "MTEL") {
									url = EBK.config.contextPath+'' ; //  F6.UTILS.getMtelLink() ;  //  + '/support-impression/enveloppes';
								}

								if (typeParcoursVal == "MTEL") {
									F6.UI.redirect(url + '/authentification ');
								} else {
									F6.UI.redirect(url + '/authentication');
								}
							} else {
								$(el_trigger).focus();
								$('#successBoxTop').find('a').focus();
							}
						}
			});
		}

	};

	/** Address Book ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Upload file *********************************** */
	F6.UI.userAddressBookUploadFile = function() {
		var isMonCompte = document.getElementsByClassName("moncompte-container")[0];
		if ($('#importDestinataires').length > 0) {
			F6.VALIDATIONS.formImport();

			btn = $('#import');
			urlAction = $('#import').attr("data-url");
			rdm1 = Math.random();
			rdm2 = Math.random();
			real = '';
			var uploader = new ss.SimpleUpload(
					{
						responseType : "text/html",
						multipart : true,
						button : btn,
						data : {
							isAjax : true,
							random1 : rdm1,
							random2 : rdm2,
                            '_csrf' : token
						},
						method : "POST",
						url : urlAction,
						accept : '*/*',
						name : "file",
						autoSubmit : false,
						onComplete : function(filename, response) {
							jsonResponse = $.parseJSON(response);
							if (!response) {
								$('.btn-action').unbind('click');
								$('#error-import .error').html(
										'<ul><li>' + jsonResponse.information
												+ '</ul></li>');
								$('.block-content.import').show();
								$('#import').focus();
								return false;
							}

							jsonResponseStr = F6.UI.stringify(jsonResponse.information);

							jsonResponseObj = JSON.parse(jsonResponseStr);

							console.log(jsonResponseObj, jsonResponseObj["success.import.message1"] );

							if(jsonResponseObj["success.import.message1"])
								jsonResponseStr = jsonResponseObj["success.import.message1"];

							if (isMonCompte) {
								F6.UI.redirect(encodeURI(EBK.config.contextPath+'/compte/profil?ref=adresses&message=' + jsonResponseStr));
							} else {
							F6.UI.redirect(encodeURI(EBK.config.contextPath+'/mon-compte/carnet-adresses?message=' + jsonResponseStr));
							}
							var xmlhttp = new XMLHttpRequest();

							$('.progressBar').hide();
						},
						onChange : function(filename, extension) {
							real = $("#importDestinataires .filename").html(filename);

						}
					});

			$("#importBtn").click(function(e) {
				if (real != '') {
					e.preventDefault();
					$('.btn-action').click(function(e) {
						e.preventDefault();
					});
					$('.block-content.import').hide();
					$('.progressBar').show();
					uploader.submit();
				} else {
					e.preventDefault();
				}

			});
		}
	}

	/** GENERIC ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Add progression Bar *********************************** */
	F6.UI.insertProgressBar = function(title) {
		var progressDiv = '	<div id="${pageId}" class="upload-progressbar-wrap pdfGeneration">'
				+ '<div class="upload-progressbar">'
				+ '<div class="info-progressbar">'
				+ '<span class="pbText exergue-color">'
				+ title
				+ '</span>'
				+ '</div>'
				+ '<div class="show-progressbar">'
				+ '<img src="/_ui/eboutique/images/loader.gif" alt="'
				+ title
				+ '">'
				+ '</div>'
				+ '</div>'
				+ '<div class="upload-progressbar-wrap-top"> </div>'
				+ '<div class="upload-progressbar-wrap-bottom"> </div>'
				+ '<span class="cornerHG"></span>'
				+ '<span class="cornerHD"></span>'
				+ '<span class="cornerBG"></span>'
				+ '<span class="cornerBD"></span>'
				+ '</div>'
				+ '<span class="block-corner lineBD"></span>'
				+ '<span class="block-corner lineBG"></span>';
		$('#progressBar').html(progressDiv);
	}

	/** GENERIC ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Remove progression Bar *********************************** */
	F6.UI.removeProgressBar = function() {
		$('#progressBar').html('');
	}

	/** GENERIC ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/**
	 * Remove all bloc/div with id 'hideBloc'
	 * ***********************************
	 */
	F6.UI.hide = function() {
		$('#hideBloc').hide();
	}

	validateFormStep3LREL = function() {

		var msg = "Vous devez renseigner une adresse expéditeur.";
		var msg2 = "Vous devez renseigner une adresse destinataire.";
		var popin = true;
		var destinataireCount = $('#lelTableDestinataire').find("tr[id*=Item_]").length;
		var expediteurExist = $(".myaddress").length > 0;

		if (!expediteurExist) {
			$(".exp").addClass("error actived");
			$(".exp.error.actived").html(msg);
		}

		if (!destinataireCount) {
			$(".dest").addClass("error actived");
			$(".dest.error.actived").html(msg2);
		}

		if (!expediteurExist || !destinataireCount) {
			$(".infoGlobal").addClass("error errorGlobale actived");
			$(".error.errorGlobale.actived")
					.html(
							"Les informations que vous avez fournies ne vous permettent pas d'accéder à l'étape suivante. Merci de modifier votre saisie à partir des indications de couleur rouge, positionnées près des erreurs correspondantes.")
			popin = false;
		}
		if (!popin) {
			$(".btn-action-minor").focus();
			return false;
		}
		return true;
	}

	/** LEL & LREL ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Validation Step3 & Step1 *********************************** */
	F6.UI.closeStepPopin = function(e) {
		$('.mtel-manage-recipients-modal').hide();
	};

	F6.UI.validationStepPopin = function(e) {
		var el_trigger = this;
		var txt = '';
		var prompt = false;
		var destinataireCount = $('#lelTableDestinataire')
				.find("tr[id*=Item_]").length;
		var expediteurExist = $(".myaddress").length > 0;
		var validationLRELstep3 = $(".validationLRELstep3").length > 0;

		var mascadiaErrorCount = $('#lelTableDestinataire').find(
				"tr[id*=Item_]").find(".error").length;

		if (mascadiaErrorCount > 0) {
			F6.stop(e);
			prompt = true;
			txt = "Vous avez "
					+ mascadiaErrorCount
					+ " adresse(s) non validée(s). Merci de bien vouloir la(les) modifier en cliquant sur l’icône Modifier";
		}

		if (validationLRELstep3) {
			if (!validateFormStep3LREL()) {
				return false;
			}
		}

		if (destinataireCount == 0) {
            F6.stop(e);

            Popup.info({
               message: "Vous n'avez aucun destinataire pour votre envoi. Veuillez ajouter au moins 1 destinataire pour passer à l'étape suivante",
               okButton: "OK"
            });
		}

		if (prompt) {
			$.prompt(txt, {
				buttons : {
					Retour : true
				},
				callback : function(e, v, m, f) {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			});

			// Mantis 231: LEL/LRE: Renommer le bouton "Retour" en "Ok" dans
			// popin destinataire vide
			if (destinataireCount == 0) {
				$("button#jqi_state0_buttonRetour").text("Ok");
			}
			// console.log($.prompt);
			// console.log($.prompt.defaults);
			// console.log($.prompt.defaults.buttons);
			$('#jqi').css('line-height', '1.5em');
		} else {
			// begin QC 1434 : the click must work for left area of the button
			mouseX = e.pageX;
			inputX = $(e.currentTarget).children('input[type="submit"]')
					.offset().left;
			spanX = $(e.currentTarget).offset().left;
			if (mouseX >= spanX && mouseX < inputX) {
				$(e.currentTarget).children('input[type="submit"]').get(0)
						.click();
			}
			// end QC 1434 : the click must work for left area of the button
		}
	}

	F6.UI.informatonDepotPopin = function(e) {
		var el_trigger = this;
		var prompt = true;
		var txt = "<span style=\"font-size: 13px;\">La Poste conserve pendant 1 an l'archive complète de votre lettre recommandée électronique, pendant 3 ans la preuve électronique de dépôt.</span><br><br>"
				+ "Cette archive contient les documents suivants:<br><br>"
				+ "<ul>"
				+ "<li style=\"font-size: 13px; margin-left: 30px; list-style-type:disc; \">la lettre recommandée (ou fichier d'édition) (1 an).</li>"
				+ "<li style=\"font-size: 13px;margin-left : 30px;  list-style-type:disc;\">la preuve éléctronique de dépôt (3 ans).</li>"
				+ "<li style=\"font-size: 13px;margin-left : 30px;  list-style-type:disc;\">la représentation graphique de la preuve (3 ans).</li>"
				+ "</ul>"
				+ "<br><br>"
				+ "<span style=\"font-size: 13px;font-weight:bold; \">Cette archive au format zip doit être téléchargée et conservée sur votre ordinateur.</span>";
		if (prompt) {
			$.prompt(txt, {
				buttons : {
					Retour : true
				},
				callback : function(e, v, m, f) {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			});
			$("button#jqi_state0_buttonRetour").text("Ok");
		} else {
			// begin QC 1434 : the click must work for left area of the button
			mouseX = e.pageX;
			inputX = $(e.currentTarget).children('input[type="submit"]')
					.offset().left;
			spanX = $(e.currentTarget).offset().left;
			if (mouseX >= spanX && mouseX < inputX) {
				$(e.currentTarget).children('input[type="submit"]').get(0)
						.click();
			}
			// end QC 1434 : the click must work for left area of the button
		}

	}

	F6.UI.informatonAR = function(e) {
		var el_trigger = this;
		var prompt = true;
		var txt = "<span style=\"font-size: 13px;\">La Poste conserve pendant 1 an l'archive complète de votre lettre recommandée électronique, pendant 3 ans la preuve électronique d'accusé de réception.</span><br><br>"
				+ "Cette archive contient les documents suivants:<br><br>"
				+ "<ul>"
				+ "<li style=\" font-size: 13px;margin-left: 30px; list-style-type:disc; \">la lettre recommandée (ou fichier d'édition) (1 an).</li>"
				+ "<li style=\" font-size: 13px;margin-left: 30px; list-style-type:disc; \">la preuve éléctronique d'accusé de réception (3 ans).</li>"
				+ "<li style=\" font-size: 13px;margin-left: 30px; list-style-type:disc; \">la représentation graphique de la preuve (3 ans).</li>"
				+ "</ul>"
				+ "<br><br>"
				+ "<span style=\"font-size: 13px;font-weight:bold; \">Cette archive au format zip doit être téléchargée et conservée sur votre ordinateur.</span>";
		if (prompt) {
			$.prompt(txt, {
				buttons : {
					Retour : true
				},
				callback : function(e, v, m, f) {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			});
			$("button#jqi_state0_buttonRetour").text("Ok");
		} else {
			// begin QC 1434 : the click must work for left area of the button
			mouseX = e.pageX;
			inputX = $(e.currentTarget).children('input[type="submit"]')
					.offset().left;
			spanX = $(e.currentTarget).offset().left;
			if (mouseX >= spanX && mouseX < inputX) {
				$(e.currentTarget).children('input[type="submit"]').get(0)
						.click();
			}
			// end QC 1434 : the click must work for left area of the button
		}

	};

	// implement JSON.stringify serialization
	// JIRA : 1360, F6.UI.stringify = JSON.stringify || function(obj) {
	F6.UI.stringify = function(obj) {
		var t = typeof (obj);
		if (t != "object" || obj === null) {
			// simple data type
			if (t == "string")
				obj = '"' + obj + '"';
			return String(obj);
		} else {
			// recurse array or object
			var n, v, json = [], arr = (obj && obj.constructor == Array);
			for (n in obj) {
				v = obj[n];
				t = typeof (v);
				if (t == "string")
					v = '"' + v + '"';
				else if (t == "object" && v !== null)
					v = JSON.stringify(v);
				json.push((arr ? "" : '"' + n + '":') + String(v));
			}
			return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
		}
	};

	/** REDIRECTION ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Redirect to the specified link *********************************** */
	F6.UI.redirect = function(link) {
		$(location).attr('href', link);
	}

	/** MASCADIA ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Ajax Operation *********************************** */

	F6.UI.initializeUpdateMascadia = function(prefix, suffix) {
        F6.MAIN.initSelectBoxParent();
		if (prefix == undefined) {
			prefix = '';
		}
		if (suffix == 'Part') {
			suffix = '';
		}
		var myInputs = {
			titleCode : '',
			lastName : '',
			firstName : '',
			libelle : '',
			localite : '',
			codePostal : '',
			appartement : '',
			batiment : '',
			lieuDit : ''
		};
		var mascadiaInputs = {
			titleCode : '',
			lastName : '',
			firstName : '',
			appartement : '',
			batiment : '',
			lieuDit : ''
		};
		mascadiaInputs.titleCode = $(prefix + '#titleCode' + suffix).val();
		mascadiaInputs.lastName = $(prefix + '#lastName' + suffix).val();
		mascadiaInputs.firstName = $(prefix + '#firstName' + suffix).val();
		mascadiaInputs.appartement = $(prefix + '#appartement' + suffix).val();
		mascadiaInputs.batiment = $(prefix + '#batiment' + suffix).val();
		mascadiaInputs.lieuDit = $(prefix + '#lieuDit' + suffix).val();

		myInputs.titleCode = $(prefix + '#titleCode' + suffix).val();
		myInputs.lastName = $(prefix + '#lastName' + suffix).val();
		myInputs.firstName = $(prefix + '#firstName' + suffix).val();
		myInputs.libelle = $(prefix + '#numLibelle' + suffix).val();
		myInputs.localite = $(prefix + '#localite' + suffix).val();
		myInputs.codePostal = $(prefix + '#codePostal' + suffix).val();
		myInputs.appartement = $(prefix + '#appartement' + suffix).val();
		myInputs.batiment = $(prefix + '#batiment' + suffix).val();
		myInputs.lieuDit = $(prefix + '#lieuDit' + suffix).val();
		var selectedValue = $(prefix + "select[id$=composedAddress]").val();
		// TODO : remove "-2" test but should inject address json
		if (selectedValue != "-1") {
			$(prefix + '#country' + suffix + ' option:selected').removeAttr("selected");
			$(prefix + '#country' + suffix).val(countryCode);
			if ($('.mtel').length <= 0 && $.uniform.update) {
				$.uniform.update(prefix + '#country' + suffix);
			}

			F6.UI.disableInputs(suffix);
			$(prefix + '#titleCode' + suffix).val(					eval('address' + selectedValue).titleCode);
			$(prefix + '#lastName' + suffix).val(					eval('address' + selectedValue).lastName);
			$(prefix + '#firstName' + suffix).val(					eval('address' + selectedValue).firstName);
			$(prefix + '#numLibelle' + suffix).val(					eval('address' + selectedValue).libelle);
			$(prefix + '#localite' + suffix).val(					eval('address' + selectedValue).localite);
			$(prefix + '#codePostal' + suffix).val(					eval('address' + selectedValue).codePostal);
		}

        $("select[id$=composedAddress]")
            .change(
                function() {
                    if ($(this).find(':selected').attr('value') != "-1") {
                        if ($(this).find(':selected').attr('oldValue') == "-1") {
                            myInputs.titleCode = $(prefix + '#titleCode' + suffix).val();
                            myInputs.lastName = $(prefix + '#lastName' + suffix).val();
                            myInputs.firstName = $(prefix + '#firstName' + suffix).val();
                            myInputs.libelle = $(prefix + '#numLibelle' + suffix).val();
                            myInputs.localite = $(prefix + '#localite' + suffix).val();
                            myInputs.codePostal = $(prefix + '#codePostal' + suffix).val();
                            myInputs.appartement = $(prefix + '#appartement' + suffix).val();
                            myInputs.batiment = $(prefix + '#batiment' + suffix).val();
                            myInputs.lieuDit = $(prefix + '#lieuDit' + suffix).val();
                        }
                        $(prefix + '#titleCode' + suffix).val(eval('address' + $(this).find(':selected').attr('value')).titleCode);
                        $(prefix + '#lastName' + suffix).val(eval('address' + $(this).find(':selected').attr('value')).lastName);
                        $(prefix + '#firstName' + suffix).val(eval('address'+ $(this).find(':selected').attr('value')).firstName);
                        $(prefix + '#numLibelle' + suffix).val(eval('address' + $(this).find(':selected').attr('value')).libelle);
                        $(prefix + '#localite' + suffix).val(eval('address' + $(this).find(':selected').attr('value')).localite);
                        $(prefix + '#codePostal' + suffix).val(eval('address' + $(this).find(':selected').attr('value')).codePostal);
                        $(prefix + '#appartement' + suffix).val(
                            mascadiaInputs.appartement);
                        $(prefix + '#batiment' + suffix).val(
                            mascadiaInputs.batiment);
                        $(prefix + '#lieuDit' + suffix).val(
                            mascadiaInputs.lieuDit);
                        F6.UI.disableInputs(suffix);
                    } else {
                        if ($(this).find(':selected').attr('value') == "-1") {
                            F6.UI.enableInputs(suffix);
                        } else {
                            F6.UI.disableInputs(suffix);
                        }

                        $(prefix + '#titleCode' + suffix).val(
                            myInputs.titleCode);
                        $(prefix + '#lastName' + suffix).val(
                            myInputs.lastName);
                        $(prefix + '#firstName' + suffix).val(
                            myInputs.firstName);
                        $(prefix + '#numLibelle' + suffix).val(
                            myInputs.libelle);
                        $(prefix + '#localite' + suffix).val(
                            myInputs.localite);
                        $(prefix + '#codePostal' + suffix).val(
                            myInputs.codePostal);
                        $(prefix + '#appartement' + suffix).val(
                            myInputs.appartement);
                        $(prefix + '#batiment' + suffix).val(
                            myInputs.batiment);
                        $(prefix + '#lieuDit' + suffix).val(
                            myInputs.lieuDit);
                    }
                });
    };


    F6.UI.enableInputs = function(suffix) {
		$('#titleCode' + suffix).attr("readonly", false);
		$('#lastName' + suffix).attr("readonly", false);
		$('#firstName' + suffix).attr("readonly", false);
		$('#numLibelle' + suffix).attr("readonly", false);
		$('#localite' + suffix).attr("readonly", false);
		$('#codePostal' + suffix).attr("readonly", false);
		$('#appartement' + suffix).attr("readonly", false);
		$('#batiment' + suffix).attr("readonly", false);
		$('#lieuDit' + suffix).attr("readonly", false);
		$('#country' + suffix).removeAttr("disabled");
	};

	F6.UI.disableInputs = function(suffix) {
		$('#titleCode' + suffix).attr("readonly", true);
		$('#lastName' + suffix).attr("readonly", true);
		$('#firstName' + suffix).attr("readonly", true);
		$('#numLibelle' + suffix).attr("readonly", true);
		$('#localite' + suffix).attr("readonly", true);
		$('#codePostal' + suffix).attr("readonly", true);
		$('#appartement' + suffix).attr("readonly", true);
		$('#batiment' + suffix).attr("readonly", true);
		$('#lieuDit' + suffix).attr("readonly", true);
		$('#country' + suffix).attr("disabled", "disabled");
	};

	F6.UI.executeLrelCourrierDownloadList = function() {
		if ($('.action-delete-item').length) {
			$('.action-delete-item').unbind('click');
			$('.action-delete-item').bind('click',
					F6.UI.promptLrelRemoveDownloadMail);
		}

		// znouaoui BTKBACKLOG-1483
		if ($('.action-delete-allitems').length) {
			$('.action-delete-allitems').unbind('click');
			$('.action-delete-allitems').bind('click',
					F6.UI.promptLrelRemoveAllDownloadedDoc);
		}
	};

	F6.UI.updatePrice = function(price) {
		$('#priceValue').text(price);
	}

	F6.UI.promptLrelRemoveDownloadMail = function(e) {
		F6.stop(e);
		var el_trigger = this;
		var id = F6.UTILS.findMyIdNumber($(this));
		var element = $('#item_' + id);
		var txt = '<div class="typo-din title3">Confirmation</div>'
				+ Globalize.localize(
						"Etes-vous certain de vouloir supprimer ce document ?",
						"fr_FR")
				+ ' <input type="hidden" id="itemId" name="itemId" value="'
				+ id + '" />';
		$.prompt(txt, {
			buttons : {
				Supprimer : true,
				Annuler : false
			},
			callback : function(e, v, m, f) {
				if (v) {
					$(element).addClass('removeAfterSuccesPromptAndAjax')
					F6.AJAX.LrelRemoveDownloadMail(e, {
						id : f.itemId,
						success_message : Globalize.localize(
								"Courrier supprimÃ©e avec succÃ©s", "fr_FR")
					});
				} else {
					$(el_trigger).focus();
					$('#successBoxTop').find('a').focus();
				}
			}
		});

		$('.jqibuttons .btn-dir-cancel button')
				.attr(
						'title',
						Globalize
								.localize(
										'Annuler la suppression du document et revenir Ã  la gestion de vos documents',
										'fr_FR'));
		$('.jqibuttons .confirm-choice button').attr(
				'title',
				Globalize.localize('Confirmer la suppression du document',
						'fr_FR'));
	};

	/** REEX Step1 ******************************** */
	/** Mhammed ORCH : morch * */
	/** Add person form ***************** */
	F6.UI.addPersonToContract = function() {
		var personForm = '<fieldset  id="Persons"  class="personsForm  block-name  %INDEX%">'
				+ '<legend  class="hidden">Formulaire  pour  définir  la  %INDEX%  personne  concernée  par  le  contrat</legend>'
				+ '<hr  style="margin:  0  131px  10px;  text-align:  center;  border-color:  #CCC;  border-style:  solid  none  none;  border-width:  1px  0  0;">'
				+ '<div  class="type-select">'
				+ '<label  class="civ"  for="civility%INDEX%"  aria-required="true">Civilité*</label>'
				+ '<div class="selector" id="uniform-civility%INDEX%"><span></span>'
				+ '<select  id="civility%INDEX%"  name="persons[%INDEX%].titleCode"  class="required">'
				+ '<option value=""></option>'
				+ '<option  value="mr">M.</option>'
				+ '<option  value="mrs">Mme</option>'
				+ '</select>'
				+ '</div>'
				+ '</div>'
				+

				'<div  class="type-text">'
				+ '<label  class=""  for="lastName">  Nom *</label>  '
				+ '<span  class="wrapInput  ">  <span onFocus = "this.blur();">'
				+ '<input  id="lastName"  name="persons[%INDEX%].lastName"  onkeydown="if(this.readOnly  &amp;&amp;  event.keyCode==8)  return  false;"  class="required"  type="text"  value=""  maxlength="38"  autocomplete="true">  '
				+ '</span>  </span>'
				+ '</div>'
				+

				'<div  class="type-text">'
				+ '<label  class=""  for="firstName">  Prénom  *  </label>  '
				+ '<span  class="wrapInput  ">  <span onFocus = "this.blur();">'
				+ '<input  id="firstName"  name="persons[%INDEX%].firstName"  onkeydown="if(this.readOnly  &amp;&amp;  event.keyCode==8)  return  false;"  class="required"  type="text"  value=""  maxlength="38"  autocomplete="true">  '
				+ '</span>  </span>'
				+ '</div>'
				+

				'<div  class="type-text">'
				+ '<label  class=""  for="maidenName">  Nom de naissance </label>  '
				+ '<span  class="wrapInput  ">  <span onFocus = "this.blur();">'
				+ '<input  id="maidenName"  name="persons[%INDEX%].maidenName"  onkeydown="if(this.readOnly  &amp;&amp;  event.keyCode==8)  return  false;"  type="text"  value=""  maxlength="38"  autocomplete="true">  '
				+ '</span>  </span>'
				+ '</div>'
				+

				'<a  id="removePerson"  class="delete"  href="#">supprimer</a>'
				+ '<div  class="clear"></div>' + '</fieldset>';

		$('.perscontrat .btn-ajouter a, .perscontratsouscription .btn-action-minor a').click(
				function(event) {
					event.preventDefault();
					personsCount = $('.personsForm').length;
					if (personsCount == 1
							&& ($('input[id=contractType]').val() == 'AM')) {
						personToAdd = personForm;
						while (personToAdd.indexOf('%INDEX%') >= 0) {
							personToAdd = personToAdd.replace('%INDEX%', 0);
						}
						$("#selectCountPersons").after(personToAdd);
						F6.VALIDATIONS.reexStep1();
						F6.UI.removePersonToContract();
						$('#civility0').uniform();
						$('#civility0').focus();
						$('#civility0').change(function(){
                            $(this).prev().text($(this).find('option:selected').text());
                        });
					} else {
						if ($('input[id=contractType]').val() == 'AM') {
							personsCount = personsCount - 1;
						}
						if (personsCount < 30) {
							personToAdd = personForm;
							while (personToAdd.indexOf('%INDEX%') >= 0) {
								personToAdd = personToAdd.replace('%INDEX%',
										personsCount);
							}
							$('.personsForm:last').after(personToAdd);
							F6.VALIDATIONS.reexStep1();
							F6.UI.removePersonToContract();
							$('#civility' + personsCount).uniform();
							$('#civility' + personsCount).focus();
							$('#civility' + personsCount).change(function(){
                                $(this).prev().text($(this).find('option:selected').text());
                            });
						}
					}

					return false;
				});
	};

	F6.UI.addPersonFromAMDetail = function() {
		var personForm = '<fieldset  id="Persons"  class="personsForm  block-name  %INDEX%" style="padding-left: 1px;">'
				+ '<legend  class="hidden">Formulaire  pour  définir  la  %INDEX%  personne  concernée  par  le  contrat</legend>'
				+ '<hr  style="margin: 0 78px 10px 102px;  text-align:  center;  border-color:  #CCC;  border-style:  solid  none  none;  border-width:  1px  0  0;">'
				+ '<div  class="type-select" style="margin-left: -38px;">'
				+ '<label  class="civ"  for="civility%INDEX%"  aria-required="true">Civilité*</label>'
				+ '<div class="selector" id="uniform-civility%INDEX%"><span></span>'
				+ '<select  id="civility%INDEX%"  name="persons[%INDEX%].titleCode"  class="required">'
				+ '<option value=""></option>'
				+ '<option  value="mr">M.</option>'
				+ '<option  value="mrs">Mme</option>'
				+ '</select>'
				+ '</div>'
				+ '</div>'
				+

				'<div  class="type-text">'
				+ '<label  class=""  for="lastName">  Nom  d\'usage  *</label>  '
				+ '<span  class="wrapInput  ">  <span onFocus = "this.blur();">'
				+ '<input  id="lastName"  name="persons[%INDEX%].lastName"  onkeydown="if(this.readOnly  &amp;&amp;  event.keyCode==8)  return  false;"  class="required"  type="text"  value=""  maxlength="38"  autocomplete="true">  '
				+ '</span>  </span>'
				+ '</div>'
				+

				'<div  class="type-text" style="margin-left: -38px;">'
				+ '<label  class=""  for="firstName">  Prénom  *  </label>  '
				+ '<span  class="wrapInput  ">  <span onFocus = "this.blur();">'
				+ '<input  id="firstName"  name="persons[%INDEX%].firstName"  onkeydown="if(this.readOnly  &amp;&amp;  event.keyCode==8)  return  false;"  class="required"  type="text"  value=""  maxlength="38"  autocomplete="true">  '
				+ '</span>  </span>'
				+ '</div>'
				+

				'<div  class="type-text">'
				+ '<label  class=""  for="maidenName">  Nom de jeune fille  </label>  '
				+ '<span  class="wrapInput  ">  <span onFocus = "this.blur();">'
				+ '<input  id="maidenName"  name="persons[%INDEX%].maidenName"  onkeydown="if(this.readOnly  &amp;&amp;  event.keyCode==8)  return  false;"  type="text"  value=""  maxlength="38"  autocomplete="true">  '
				+ '</span>  </span>'
				+ '</div>'
				+

				'<a  id="removePerson"  class="delete"  href="#">supprimer</a>'
				+ '<div  class="clear"></div>' + '</fieldset>';

		$('.perscontrat .btn-ajouter a, .perscontratsouscription .btn-action-minor a').click(
				function(event) {
					event.preventDefault();
					personsCount = $('.personsForm').length + 1;
					if (personsCount == 1) {
						personToAdd = personForm;
						while (personToAdd.indexOf('%INDEX%') >= 0) {
							personToAdd = personToAdd.replace('%INDEX%', 0);
						}
						$("#selectCountPersons").after(personToAdd);
						F6.VALIDATIONS.reexStep1();
						F6.UI.removePersonToContract();
						$('#civility0').uniform();
						$('#civility0').focus();
                        $('#civility0').change(function(){
                            $(this).prev().text($(this).find('option:selected').text());
                        });
                    } else {

						personsCount = personsCount - 1;

						if (personsCount < 30) {
							personToAdd = personForm;
							while (personToAdd.indexOf('%INDEX%') >= 0) {
								personToAdd = personToAdd.replace('%INDEX%', personsCount);
							}
							$('.personsForm:last').after(personToAdd);
							F6.VALIDATIONS.reexStep1();
							F6.UI.removePersonToContract();
							$('#civility' + personsCount).uniform();
							$('#civility' + personsCount).focus();
                            $('#civility' + personsCount).change(function(){
                                $(this).prev().text($(this).find('option:selected').text());
                            });
                        }
					}

					return false;
				});
	};

	/** REEX PD Step1 ******************************** */
	/**
	 * Mhammed ORCH : morch *
	 */
	/** Choose duration du service de reexpedition ***************** */
	// MNA Choose duration du service de reexpedition
	F6.UI.changeDuration = function() {
		if ($('.pack-chooser li:eq(0) input:radio').is(':checked'))
			$('.pack-chooser li').first('li').addClass('selected');
		else
			$('.pack-chooser li:eq(2)').addClass('selected');

		$('.pack-chooser li').click(function() {
			$(this).parent().find('li').removeClass('selected');
			$(this).addClass('selected');
		});

	};
	/** REEX Step1 ******************************** */
	/** Mhammed ORCH : morch * */
	/** Remove person form ***************** */
	F6.UI.removePersonToContract = function() {
		$('.delete')
				.click(
						function(event) {
							event.preventDefault();
							$(this).parent().remove();
							personsCount = $('.personsForm').length;
							var i = 0;
							if ($('input[id=contractType]').val() == 'AM') {
								$('.block-name')
										.each(
												function() {
													$(this)
															.removeClass()
															.addClass(
																	'personsForm block-name '
																			+ i);
													$(this)
															.find('legend')
															.text(
																	'Formulaire  pour  définir  la '
																			+ i
																			+ '  personne  concernée  par  le  contrat');
													/* Civility */
													$(this).find('.civ').attr(
															'for',
															'civility' + i);
													$(this)
															.find('.selector')
															.attr(
																	'id',
																	'uniform-civility'
																			+ i);
													$(this)
															.find('select')
															.attr(
																	'id',
																	'civility'
																			+ i);
													$(this)
															.find('select')
															.attr(
																	'name',
																	'persons['
																			+ i
																			+ '].titleCode');
													/* LastName */
													$(this)
															.find('#lastName')
															.attr(
																	'name',
																	'persons['
																			+ i
																			+ '].lastName');
													/* FirstName */
													$(this)
															.find('#firstName')
															.attr(
																	'name',
																	'persons['
																			+ i
																			+ '].firstName');
													/* MaidenName */
													$(this)
															.find('#maidenName')
															.attr(
																	'name',
																	'persons['
																			+ i
																			+ '].maidenName');

													i++;
												});
							} else {
								$('.personsForm')
										.each(
												function() {
													if (i > 0) {
														$(this)
																.removeClass()
																.addClass(
																		'personsForm block-name '
																				+ i);
														$(this)
																.find('legend')
																.text(
																		'Formulaire  pour  définir  la '
																				+ i
																				+ '  personne  concernée  par  le  contrat');
														/* Civility */
														$(this)
																.find('.civ')
																.attr(
																		'for',
																		'civility'
																				+ i);
														$(this)
																.find(
																		'.selector')
																.attr(
																		'id',
																		'uniform-civility'
																				+ i);
														$(this)
																.find('select')
																.attr(
																		'id',
																		'civility'
																				+ i);
														$(this)
																.find('select')
																.attr(
																		'name',
																		'persons['
																				+ i
																				+ '].titleCode');
														/* LastName */
														$(this)
																.find(
																		'#lastName')
																.attr(
																		'name',
																		'persons['
																				+ i
																				+ '].lastName');
														/* FirstName */
														$(this)
																.find(
																		'#firstName')
																.attr(
																		'name',
																		'persons['
																				+ i
																				+ '].firstName');
														/* MaidenName */
														$(this)
																.find(
																		'#maidenName')
																.attr(
																		'name',
																		'persons['
																				+ i
																				+ '].maidenName');
													}

													i++;
												});
							}
							return false;
						});
	};
	/** REEX Step1 ******************************** */
	/** Mhammed ORCH : morch * */
	/** Remove person form ***************** */
	F6.UI.changeStateOfOnePerson = function() {
		$('input[name=onePerson]')
				.change(
						function() {
							if ($('input[name=onePerson]:checked').val() == 'true') {
								$('#element-entitledPerson').html('');
								$('input[name=agreement]')
										.prop('checked', true);
								$('input[name=agreement]').attr('disabled',
										'disabled');
								$("label[for='entitledPersonLastName']")
										.html(
												$(
														"label[for='entitledPersonLastName']")
														.text()
														+ '<div style="display:inline;">*</div>');
								$("label[for='entitledPersonFirstName']")
										.html(
												$(
														"label[for='entitledPersonFirstName']")
														.text()
														+ '<div  style="display:inline;">*</div>');
								$("#deceasedPersonInformations").show();
							} else {
								$('input[name=agreement]').prop('checked',
										false);
								$('input[name=agreement]').removeAttr(
										'disabled');
								$("label[for='entitledPersonLastName'] div")
										.html('');
								$("label[for='entitledPersonFirstName'] div")
										.html('');
								$("#deceasedPersonInformations").hide();
							}

						});
	};
	/** REEX Step0******************************** */
	/** Mhammed ORCH : morch * */
	/** Init page ***************** */
	F6.UI.initReexStep0 = function() {
		F6.UI.hide();
		F6.VALIDATIONS.reexStep0();

	};
	/** REEX Step1 ******************************** */
	/** Mhammed ORCH : morch * */
	/** Init page ***************** */
	F6.UI.initReexStep1 = function() {
		F6.UI.hide();
		F6.VALIDATIONS.reexStep1();
		F6.UI.addPersonToContract();
		F6.UI.removePersonToContract();
		F6.UI.changeStateOfOnePerson();
		$('#addPersons').show();
		$('#selectCountPersons').hide();
		$("#deceasedPersonInformations").hide();
	};

	/***************************************************************************
	 * MTEL STEP 1, NOUAOUI ZAKARIA
	 */

	// MTEL STEP1 Pro, update carecteristique
	F6.UI.initMTELStep1Pro = function() {
		previousProduct = $('[name=productType]').val();
		// id form : formStampStep1
		var recommandeMtel = $('[name=recommandeMtel]').val();
		$('#pliMTELPro').empty();
		F6.UI.changeR1R2R3();
		if (recommandeMtel == undefined)
			recommandeMtel = null;
		F6.AJAX.getR1R2R3(recommandeMtel,false);
		// 1 : On change From place
		$('[name=weight]')
				.change(
						function() {
							var recommandeMtel = $(
									'[name=recommandeMtel]:checked').val();
							var avisDeReception = $('#avisDeReception').is(":checked");
							$('#pliMTELPro').empty();
							F6.UI.initPrices();
							if ($('#pliMTELPro').length > 0) {
								if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE"
										|| $('[name=productType]').val() == "PPIR"
										|| $('[name=productType]').val() == "LETTRE_RECOMMANDEE_INTERNATIONALE") {
									if (recommandeMtel == undefined)
										recommandeMtel = null;
									if (avisDeReception == undefined)
										avisDeReception = false;
									F6.AJAX.getR1R2R3(recommandeMtel,avisDeReception);
								}
							}

						});
		// 2 : On change Destination
		$('[name=fromPlace]').change(function() {
			$('#pliMTELPro').empty();
			$('#productListId').html("");
			$('#weightListId').html("");
			F6.AJAX.getProducts();
		});
		// 2 : On change Destination
		$('[name=destination]').change(function() {
			F6.AJAX.getProducts();
		});

		// 3 : On change Produit, get weights
		$('[name=productType]')
				.change(
						function() {
							F6.UI.enableCaracteristiques();
							$('#pliMTELPro').empty();
							$('#weightListId').html("");

							if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE"
									|| previousProduct == "LETTRE_RECOMMANDEE"
									|| $('[name=productType]').val() == "LETTRE_SUIVIE"
									|| previousProduct == "LETTRE_SUIVIE")
								F6.AJAX.getDestinations();
							previousProduct = this.value;
							F6.AJAX.getWeights();
							F6.UI.changeR1R2R3();
							F6.UI.putMiniMaxText();
							if ($('[name=productType]').val() == "LETTRE_SUIVIE"
									|| $('[name=productType]').val() == "LETTRE_SUIVIE_INTERNATIONALE"
									|| $('[name=productType]').val() == 'LPIAS'
									|| $('[name=productType]').val() == 'PPIAS')
								F6.AJAX.disabledLettreSuivie();
						});
		// 4 : On change Type d'envoi
		$('[name=sendType]').change(function() {
			F6.UI.enableCaracteristiques();
			if ($('#sendTypeIntr').is(":checked")) {
				$('#pliMTELPart').empty();
				// Ajax Call
				$('#productListId').html("");
				$('#weightListId').html("");
				// EBOUTIQUE-1564 : MTEL PRO intl > supprimer phrase liée au
				// continuum
				$('#petitsObjetsEtDocumentID').hide();
                $('#hausseTarifaireMsg').show();
				F6.AJAX.getCaracteristiqueForIntr();
			} else {
				$('#pliMTELPart').empty();
				// Ajax Call
				$('#productListId').html("");
				$('#weightListId').html("");
				$('#petitsObjetsEtDocumentID').show();
                $('#hausseTarifaireMsg').hide();
				F6.AJAX.getCaracteristiqueForFrOM();
			}
		});
	};// end initMtelstep1

	// MTEL STEP1 Part, update carecteristique
	F6.UI.initMTELStep1Part = function() {
		previousProduct = $('[name=productType]').val();
		// id form : formStampStep1
		$('#pliMTELPart').empty();
		F6.UI.changeR1();
		F6.AJAX.getR1();

		// 1 : On change From place
		$('[name=weight]').change(function() {
			$('#pliMTELPart').empty();
			F6.UI.initPricesPart();
			if ($('#pliMTELPart').length > 0) {
				if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE") {
					F6.AJAX.getR1();
				}
			}

		});
		// 2 : On change Destination
		$('[name=destination]').change(function() {
			F6.UI.initPricesPart();
			if ($('#pliMTELPart').length > 0) {
				if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE") {
					F6.AJAX.getWeights();
					F6.AJAX.getR1();
				} else { // refresh product list and weight after destination
					// change (other case then LETTRE_RECOMMANDEE)
					if ($('[name=sendType]').val() == "FranceOutreMer")
						F6.AJAX.getProducts();
					if ($('[name=sendType]').val() == "international")
						F6.AJAX.getProductsForInternatioanl()
				}
			}

		});

		// 2 : On change Destination
		$('[name=fromPlace]').change(function() {
			if($('#formStampStep1').hasClass('mtel_part_form')) {
		      lastMtel = $('#productListId').find('input:checked').val();
		    } else {
			  lastMtel = $('#productListId').find('option:selected').val();
		    }
			$('#pliMTELPart').empty();
			$('#productListId').html("");
			$('#weightListId').html("");

			if ($('[name=sendType]').val() == "FranceOutreMer")
				F6.AJAX.getProducts();
			if ($('[name=sendType]').val() == "international")
				F6.AJAX.getProductsForInternatioanl()
		});

		// 3 : On change Produit, get weights
		F6.UI.bindProductTypePartAction();

		// 4 : On change Type d'envoi
		$('[name=sendType]').change(function() {
			F6.UI.enableCaracteristiques();
			if ($('#sendTypeIntr').is(":checked")) {
				$('#pliMTELPart').empty();
				// Ajax Call
				$('#weightListId').html("");
				$('#productListId').html("");
				F6.AJAX.getCaracteristiqueForIntr();
                $('#hausseTarifaireMsg').show();
			} else {
				$('#pliMTELPart').empty();
				// Ajax Call
				$('#weightListId').html("");
				$('#productListId').html("");
				F6.AJAX.getCaracteristiqueForFrOM();
                $('#hausseTarifaireMsg').hide();
			}

		});
	};
	F6.UI.bindProductTypePartAction = function() {

		// On change Produit, get weights
		$('[name=productType]')
				.change(
						function() {
							F6.UI.enableCaracteristiques();
							$('#pliMTELPart').empty();
							$('#weightListId').html("");

							if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE"
									|| previousProduct == "LETTRE_RECOMMANDEE"
									|| $('[name=productType]').val() == "LETTRE_SUIVIE"
									|| previousProduct == "LETTRE_SUIVIE")
								F6.AJAX.getDestinations();
							F6.AJAX.getWeights();
							F6.UI.changeR1();
							F6.UI.putMiniMaxText();
							previousProduct = this.value;
							if ($('[name=productType]').val() == "LETTRE_SUIVIE"
									|| $('[name=productType]').val() == 'LETTRE_SUIVIE_INTERNATIONALE')
								F6.AJAX.disabledLettreSuivie();
						});
	}
	// 3 : injection pli (R1)

	F6.UI.changeR1 = function() {
		if ($('#pliMTELPart').length > 0) {
			var tarifR1 = "---";
			var R1 = '<p> '
					+ '<input id="idMtelR1" name="recommandeMtel" type="radio" value="R1" checked="checked"/> '
					+ '<label for="idMtelR1" > R1- <span id="idR1Label">'
					+ tarifR1 + ' €</span></label>' + '</p>';

			var prixAvisReception = '1.05';

			/*
			 * LETTRE_RECOMMANDEE == lre national
			 */
			var pli = "";
			if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE") {
				// inject pli
				pli = '<div class="left">'
						+ '<div style="margin-left:110px;"> '
						+ R1
						+ '<p>'
						+ '<input id="avisDeReception" name="avisDeReception" type="checkbox" />'
						+ '<span for="avisDeReception" style="font-size : 1.5em;color:#565a5c;">'
						+ ' Avis de réception <span id="idAvisLabel">'
						+ prixAvisReception + ' €</span></span>' + '</p>' +

						'</div>' + '</div>' + '<div class="left">'
						+ '<div class="formRow">'
						+ '<span style="font-size : 1.2em;">'
						+ $('[name=RDVFacteurStep1MtelMsg1]').val()
				if ($('[name=isExperimentationRDVFacteur]').val() == "true") {
					pli += $('[name=RDVFacteurStep1MtelMsg2]').val()
				}
				pli += '</span>' + '</div>' + '</div>';

				$('#pliMTELPart').html(pli);

			} else {
				$('#pliMTELPart').empty();

			}
		}// end if
	};

    F6.UI.showhide = function ()
    {
        var div = document.getElementById("enlireplus");
        if (div.style.display !== "none") {
            div.style.display = "none";
            $('a#enlirepluslink').text('> En lire plus');
        }
        else {
            div.style.display = "block";
            $('a#enlirepluslink').text('v En lire plus');
        }
    }

	F6.UI.changeR1R2R3 = function() {
		var avisReception= $("#pliMTELPro").attr("data-recept");
		$('#sendTypeFrOM').click(function(e){
			var avisReception= $("#pliMTELPro").attr("data-recept","false");
		});
		$('#sendTypeIntr').click(function(e){
			var avisReception= $("#pliMTELPro").attr("data-recept","false");
		});

		if ($('#pliMTELPro').length > 0) {
			var tarifR1 = "---";
			var tarifR2 = "---";
			var tarifR3 = "---";
			var levelRecommand =$("#pliMTELPro").attr("data-recommande");

			var checked ;

			 if(levelRecommand !=undefined &&levelRecommand =="R1"){
			 var checkedForR1="checked" ;
			 }
			 if( levelRecommand !=undefined && levelRecommand =="R2"){
			var	checkedForR2 ="checked" ;
			 }
			 if(levelRecommand !=undefined && levelRecommand =="R3"){
			 var checkedForR3=	"checked";
			 }
			 if (avisReception!=undefined && avisReception=="true"){
				 	checked= "checked";
			 }
			var R1 = '<label for="idR1" class="control control--radio"> R1 (<span id="idR1Label">'
					+ tarifR1
					+ '€</span>)'
					+ '<input id="idR1" name="recommandeMtel" type="radio" value="R1" checked='+checkedForR1+'/> '
					+ '<div class="control__indicator"></div>' + '</label>';
			var R2 = '<label for="idR2" class="control control--radio"> R2 (<span id="idR2Label">'
					+ tarifR2
					+ '€</span>)'
					+ '<input id="idR2" name="recommandeMtel" type="radio" value="R2" '+checkedForR2+'/> '
					+ '<div class="control__indicator"></div>' + '</label>';

			var R3 = '<label for="idR3" class="control control--radio"> R3 (<span id="idR3Label">'
					+ tarifR3
					+ '€</span>)'
					+ '<input id="idR3" name="recommandeMtel" type="radio" value="R3" '+checkedForR3+'/> '
					+ '<div class="control__indicator"></div>' + '</label>';

			var prixAvisReception = '1.00';

			/*
			 * LETTRE_RECOMMANDEE == lre national
			 * LETTRE_RECOMMANDEE_INTERNATIONALE == lreInternationale PPIR ==
			 * paquet Recommande International
			 */
			var pli = "";
            var lirePlus = '<br/>Le suivi jusqu’à la distribution est disponible vers les destinations suivantes : <br/>Albanie,'
                +' Allemagne, Arménie, Autriche, Belgique, Chypre, Danemark, États-Unis, Finlande, Gibraltar, Grande-Bretagne,'
                +' Iles Caïman, Indonésie, Irlande, Islande, Italie, Japon, Jordanie, Liban, Lituanie, Luxembourg, Malte,'
                +' Nouvelle-Zélande, Pays-Bas, Russie, Suède, Suisse, Slovénie, Thaïlande, Vanuatu (liste non exhaustive '
                +' susceptible de varier au cours de l’année).'
                + '<br/>&nbsp;<br/>'
                + 'Pour tout envoi vers une autre destination, le suivi s’effectue jusqu’à la frontière française.'


			if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE") {

				prixAvisReception='1.15';
				// inject pli
				pli = '<div class="row">'
						+ '<div class="col-sm-10 col-md-offset-1 offset-1-mod col-xs-12">'
						+ R1
						+ R2
						+ R3
						+ '<label  for="avisDeReception" class="control control--checkbox">'
						+ ' Avis de réception (+ '
						+ prixAvisReception
						+ '€)'
						+ '<input id="avisDeReception" name="avisDeReception" type="checkbox" '+checked +'/>'
						+ '<div class="control__indicator"></div>'
						+ '</div>'
						+ '</div>'
						+ '<div class="row">'
						+ '<div class="col-sm-11 col-sm-offset-1 col-xs-12">'
						+ '<div class="general-userTips bg-information">'
						+ '<p class="general-userTips-text">'
						+ 'La lettre recommandée doit être <span class="bold">déposée en bureau de Poste,</span><br>'
						+ 'le support de recommandation préalablement apposé sur le pli.'
						+ '<br/>'
						+ '<br/>'
						+ 'L\'indemnisation forfaitaire en cas de perte ou d\'avarie est déterminée par le niveau de recommandation : <br/>Niveau R1 : 16 € <br/>Niveau R2 : 153 € <br/>Niveau R3 : 458 €'
						+ '</p>' + '</div>' + '</div>' + '</div>';

				$('#pliMTELPro').html(pli);

			} else if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE_INTERNATIONALE") {

				prixAvisReception='1.30';
				// inject pli
				pli = '<div class="row">'
						+ '<div class="col-sm-10 col-md-offset-1 offset-1-mod col-xs-12"> '
							+ R1
							+ R2
							+ '<label for="avisDeReception" class="control control--checkbox">'
							+ ' Avis de réception (+<span id="idAvisLabel">'
							+ prixAvisReception
							+ '€</span>)'
							+ '<input id="avisDeReception" name="avisDeReception" type="checkbox" '+checked +'/>'
							+ '<div class="control__indicator"></div>'
							+ '</label>'
						+ '</div>'
					+ '</div>'
					+ '<div class="row">'
						+ '<div class="col-sm-11 col-sm-offset-1 col-xs-12">'
							+ '<div class="general-userTips bg-information">'
								+ '<p class="general-userTips-text">'
								+ 'La lettre recommandée doit être <span class="bold">déposée en bureau de Poste,</span><br>'
								+ 'le support de recommandation préalablement apposé sur le pli.'
								+ '<br/>'
								+ '<br/>'
								+ 'L\'indemnisation forfaitaire en cas de perte ou d\'avarie est déterminée par le niveau de recommandation : <br/>Niveau R1 : 45 € <br/>Niveau R2 : 150 €'
								+ '</p>'
                   				+ '<br/><br/>'
								+ '<p class="general-userTips-text" style=" margin-left: 10px; ">'
								+ '<b><a  id="enlirepluslink" href="" onclick="F6.UI.showhide();return false;">> En lire plus</a></b>'
                    			+ '<br/>'
								+ '<span id="enlireplus" style="display: none;">'+lirePlus +'</span>'
								+ '</p>'
							+ '</div>'
						+ '</div>'
					+ '</div>';






				$('#pliMTELPro').html(pli);

			}

			else if ($('[name=productType]').val() == "PPIR") {

                var lirePlusPRI = lirePlus
                    + '<br/>&nbsp;<br/>'
                    + 'Information Brexit : pour tout envoi de marchandise vers le Royaume-Uni, vous'
                    + 'pourriez être tenus, selon la date et les modalités de sortie du Royaume-Uni de'
                    + 'l’UE, d’effectuer des formalités douanières';

            	prixAvisReception='1.30';
            	// inject pli
            	pli = '<div class="row">'
            			+ '<div class="col-sm-10 col-md-offset-1 offset-1-mod col-xs-12"> '
            			    + R1
            			    + R2
            			    + '<label for="avisDeReception" class="control control--checkbox">'
            			    + ' Avis de réception (+<span id="idAvisLabel">'
            			    + prixAvisReception
            			    + '€</span>)'
            			    + '<input id="avisDeReception" name="avisDeReception" type="checkbox" '+checked +'/>'
            			    + '<div class="control__indicator"></div>'
            			    + '</label>'
            			+ '</div>'
            		+ '</div>'
            		+ '<div class="row">'
            			+ '<div class="col-sm-11 col-sm-offset-1 col-xs-12">'
            				+ '<div class="general-userTips bg-information">'
            					+ '<p class="general-userTips-text">'
            					+ 'Le paquet recommandé doit être <span class="bold">déposé en bureau de Poste,</span><br>'
            					+ 'le support de recommandation préalablement apposé sur le pli.'
            					+ '<br/>'
            					+ '<br/>'
            					+ 'L\'indemnisation forfaitaire en cas de perte ou d\'avarie est déterminée par le niveau de recommandation : <br/>Niveau R1 : 45 € <br/>Niveau R2 : 150 €'
            					+ '</p>'
                               	+ '<br/><br/>'
            					+ '<p class="general-userTips-text" style=" margin-left: 10px; ">'
            					+ '<b><a  id="enlirepluslink" href="" onclick="F6.UI.showhide();return false;">> En lire plus</a></b>'
                                + '<br/>'
            					+ '<span id="enlireplus" style="display: none;">'+ lirePlusPRI +'</span>'
            					+ '</p>'
            				+ '</div>'
           				+ '</div>'
        			+ '</div>';

                $('#pliMTELPro').html(pli);

            }

			else {

				$('#pliMTELPro').empty();

			}
		}// end if
	};



	// Step 1 MTEL : call back get weights
	F6.UI.callbackStep1MTELR1R2R3Data = function(data) {
		F6.UI.changeR1R2R3();
		// console.log('appel de F6.UI.callbackStep1MTELR1R2R3Data');
		if (data && data.proProducts) {
			if (data.proProducts.formattedPriceR1
					&& data.proProducts.formattedPriceR1 != null) {
				$('#idR1Label').text(data.proProducts.formattedPriceR1 + " €");
			}
			if (data.proProducts.formattedPriceR2
					&& data.proProducts.formattedPriceR2 != null) {
				$('#idR2Label').text(data.proProducts.formattedPriceR2 + " €");
			}
			if (data.proProducts.formattedPriceR3
					&& data.proProducts.formattedPriceR3 != null) {
				$('#idR3Label').text(data.proProducts.formattedPriceR3 + " €");
			}
			if (data.proProducts.formattedPriceAvisDeReciption
					&& data.proProducts.formattedPriceAvisDeReciption != null) {
				$('#idAvisLabel').text(
						data.proProducts.formattedPriceAvisDeReciption + " €");
			}
		} else {
			console
					.warn('Donnée "data.proProducts" non disponible dans ce contexte d\'utilisation');

		}
		if (data.selectedR1R2R3 != undefined) {
			$('#id' + data.selectedR1R2R3).attr('checked', 'checked');
		}

  		if (data.avisDeReception != undefined) {
			if (data.avisDeReception) {
				$('#avisDeReception').attr('checked', 'checked');
			}
		}

		// $('#idR1').val(data.proProducts.priceR1);
		// $('#idR2').val(data.proProducts.priceR2);
		// $('#idR3').val(data.proProducts.priceR3);
		// $('#avisDeReception').val(data.proProducts.priceAvisDeReciption);

	}

	// Step 1 MTEL : call back get weights
	F6.UI.callbackStep1MTELR1Data = function(data) {
		selectedDest = $('[name=destination]').val();
		$('#destinationId').empty();
		if (data.listDestinataires != undefined) {
			for (i = 0; i < data.listDestinataires.length; i++) {
				if (data.listDestinataires[i].isocode == selectedDest) {
					$('#destinationId').append(
							'<option value="'
									+ data.listDestinataires[i].isocode
									+ '" selected="selected">'
									+ data.listDestinataires[i].name
									+ '</option>');
				} else {
					$('#destinationId').append(
							'<option value="'
									+ data.listDestinataires[i].isocode + '">'
									+ data.listDestinataires[i].name
									+ '</option>');
				}
			}

		}
		F6.UI.changeR1();
		// Patch ajouté par GJ le 8/03/2017 : TODO => analyser ultérieurement pourquoi ce cas de figure se produit
		if (data && data.partProducts) {
			if (data.partProducts.formattedPriceR1 != undefined) {
				$('#idR1Label').text(data.partProducts.formattedPriceR1 + " €");
			}
			$('#idAvisLabel').text(
					data.partProducts.formattedPriceAvisDeReciption + " €");
		}

	}

	// Step 1 MTEL : call back for check if a lettre Suivie enable
	F6.UI.callbackStep1MTELDisableLSData = function(data) {
		if (data.disableLettreSuivie != undefined) {
			if (data.disableLettreSuivie) {
				$('[name=destination]').prop('disabled', true);
				$('[name=fromPlace]').prop('disabled', true);
				$('[name=weight]').prop('disabled', true);
				$("#MTELStep1ValiderSpan").removeClass('btn-send');
				$("#MTELStep1ValiderSpan").addClass('btn-send-disabled');
				$("#MTELStep1Valider").prop('disabled', true);
				$("#disabledLSId").addClass('displayDisabledLSMsg');
			}
		}
	}
	F6.UI.enableCaracteristiques = function() {
		$('[name=destination]').prop('disabled', false);
		$('[name=fromPlace]').prop('disabled', false);
		$('[name=weight]').prop('disabled', false);
		$("#MTELStep1ValiderSpan").removeClass('btn-send-disabled');
		$("#MTELStep1ValiderSpan").addClass('btn-send');
		$("#MTELStep1Valider").prop('disabled', false);
		$("#disabledLSId").removeClass('displayDisabledLSMsg');
	}
	// Step 1 MTEL : initPrices
	F6.UI.initPrices = function() {
		// FormattedPriceR1

		$('#idR1Label').text("---");
		$('#idR2Label').text("---");
		$('#idR3Label').text("---");
		$('#idAvisLabel').text("---");

		// $('#idR1').val(data.priceR1);
		// $('#idR2').val(data.priceR2);
		// $('#idR3').val(data.priceR3);
		// $('#avisDeReception').val(data.priceAvisDeReciption);

	}

	// Step 1 MTEL Part : initPrices
	F6.UI.initPricesPart = function() {
		// FormattedPriceR1

		$('#idR1Label').text("---");
		$('#idAvisLabel').text("---");

	}

	// Step 1 MTEL : call back get products
	F6.UI.callbackStep1MTELProductsAndDestinationData = function(data) {
		if (data.listOfProduct != undefined) {
			if ($('#formStampStep1').hasClass('mtel_part_form')) {
				$('.mtel-tooltip').hide();
				for (i = 0; i < data.listOfProduct.length; i++) {
					if(data.listOfProduct[i].code == 'LETTRE_SUIVIE' || data.listOfProduct[i].code == 'LETTRE_SUIVIE_INTERNATIONALE'){
						$('.mtel-tooltip').show();
					}
					isLSuivieDisabled = document.getElementById("disableLettreSuivie");
					if (data.listOfProduct[i].code == data.selectedProductCode && !((isLSuivieDisabled.value === "true") && (data.listOfProduct[i].code === "LETTRE_SUIVIE" || data.listOfProduct[i].code === "LETTRE_SUIVIE_INTERNATIONALE"))) {
					    $('#productListId')
								.append(
										'<label for="'
												+ data.listOfProduct[i].code
												+ '" class="control control--radio control-select">'
												+ data.listOfProduct[i].name
												+ '&nbsp;<input id="'
												+ data.listOfProduct[i].code
												+ '" name="productType" type="radio" value="'
												+ data.listOfProduct[i].code
												+ '" checked="checked" title="'
												+ data.listOfProduct[i].name
												+ '"> <div class="control__indicator"></div></label>');
					} else if (data.listOfProduct[i].code != data.selectedProductCode && !((isLSuivieDisabled.value === "true") && (data.listOfProduct[i].code === "LETTRE_SUIVIE" || data.listOfProduct[i].code === "LETTRE_SUIVIE_INTERNATIONALE"))) {
						$('#productListId')
								.append(
										'<label for="'
												+ data.listOfProduct[i].code
												+ '" class="control control--radio control-select">'
												+ data.listOfProduct[i].name
												+ '&nbsp;<input id="'
												+ data.listOfProduct[i].code
												+ '" name="productType" type="radio" value="'
												+ data.listOfProduct[i].code
												+ '" title="'
												+ data.listOfProduct[i].name
												+ '"> <div class="control__indicator"></div></label>');
					}else{
                        						$('#productListId')
                        								.append(
                        										'<label for="'
                        												+ data.listOfProduct[i].code
                        												+ '" class="control control--radio control-select impDisabledLabel">'
                        												+ data.listOfProduct[i].name
                        												+ '&nbsp;<input id="'
                        												+ data.listOfProduct[i].code
                        												+ '" name="productType" type="radio" value="'
                        												+ data.listOfProduct[i].code
                        												+ '" title="'
                        												+ data.listOfProduct[i].name
                        												+ '" disabled> <div class="control__indicator"></div></label>');
					}
				}
			} else {
				$('#toolTipFr').hide();
				$('#toolTipIntr').hide();
				isLSuivieDisabled = document.getElementById("disableLettreSuivie");
				for (i = 0; i < data.listOfProduct.length; i++) {

					if (data.listOfProduct[i].code == data.selectedProductCode && !((isLSuivieDisabled.value === "true") && (data.listOfProduct[i].code == "LETTRE_SUIVIE" || data.listOfProduct[i].code == "PPIAS" || data.listOfProduct[i].code == "LPIAS"))) {
						if(data.listOfProduct[i].code == 'LETTRE_SUIVIE'){
							$('#toolTipFr').show();
						}
						if(data.listOfProduct[i].code == 'LPIAS'||data.listOfProduct[i].code == 'PPIAS'){
							$('#toolTipIntr').show();
						}
						$('#productListId').append(
								'<option value="' + data.listOfProduct[i].code
										+ '" selected="selected">'
										+ data.listOfProduct[i].name
										+ '</option>');
					} else if (data.listOfProduct[i].code != data.selectedProductCode && !((isLSuivieDisabled.value === "true") && (data.listOfProduct[i].code == "LETTRE_SUIVIE" || data.listOfProduct[i].code == "PPIAS" || data.listOfProduct[i].code == "LPIAS"))) {
						$('#productListId').append(
								'<option value="' + data.listOfProduct[i].code
										+ '">' + data.listOfProduct[i].name
										+ '</option>');
					}else {
					    $('#productListId').append(
                            '<option value="' + data.listOfProduct[i].code
                            + '" disabled>' + data.listOfProduct[i].name
                            + '</option>');
					}
				}
			}

		}
		F6.UI.bindProductTypePartAction();
		$('#destinationId').empty();

		if (data.listDestinataires != undefined) {
			for (i = 0; i < data.listDestinataires.length; i++) {
				if (i == 0) {
					$('#destinationId').append(
							'<option value="'
									+ data.listDestinataires[i].isocode
									+ '" selected="selected">'
									+ data.listDestinataires[i].name
									+ '</option>');
				} else {
					$('#destinationId').append(
							'<option value="'
									+ data.listDestinataires[i].isocode + '">'
									+ data.listDestinataires[i].name
									+ '</option>');
				}
			}

		}

		if (data.listOfWeight != undefined) {
			for (i = 0; i < data.listOfWeight.length; i++) {
				if (data.listOfWeight[i].code == data.selectedWeightCode) {
					$('#weightListId').append(
							'<option modulo=' + data.listOfWeight[i].modulo
									+ ' value="' + data.listOfWeight[i].code
									+ '" selected="selected">'
									+ data.listOfWeight[i].label + '</option>');
				} else {
					$('#weightListId').append(
							'<option modulo=' + data.listOfWeight[i].modulo
									+ ' value="' + data.listOfWeight[i].code
									+ '">' + data.listOfWeight[i].label
									+ '</option>');
				}
			}
			displayKnowMoreLink();

		}
		F6.UI.changeR1R2R3();
		if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE"
				|| $('[name=productType]').val() == "PPIR"
				|| $('[name=productType]').val() == "LETTRE_RECOMMANDEE_INTERNATIONALE") {
			var recommandeMtel = $('[name=recommandeMtel]').val();
			F6.UI.initPrices();
			if (recommandeMtel == undefined)
				recommandeMtel = null;
			F6.AJAX.getR1R2R3(recommandeMtel,false);
		}

		// add links and text
		F6.UI.putMiniMaxText();

	}

	// Step 1 MTEL : call back get products For Petit Objet
	F6.UI.callbackStep1MTELProductsData = function(data) {
		$('#pliMTELPart').empty();
		$('#pliMTELPart').empty();
		$('#productListId').html("");
		$('#weightListId').html("");
		if (data.listOfProduct != undefined) {
			if ($('#formStampStep1').hasClass('mtel_part_form')) {
				$('.mtel-tooltip').hide();
				for (i = 0; i < data.listOfProduct.length; i++) {
					if(data.listOfProduct[i].code == 'LETTRE_SUIVIE' || data.listOfProduct[i].code == 'LETTRE_SUIVIE_INTERNATIONALE'){
						$('.mtel-tooltip').show();
					}
					if (data.listOfProduct[i].code == data.selectedProductCode) {
						$('#productListId')
								.append(
										'<label for="'
												+ data.listOfProduct[i].code
												+ '" class="control control--radio control-select">'
												+ data.listOfProduct[i].name
												+ '&nbsp;<input id="'
												+ data.listOfProduct[i].code
												+ '" name="productType" type="radio" value="'
												+ data.listOfProduct[i].code
												+ '" checked="checked" title="'
												+ data.listOfProduct[i].name
												+ '"> <div class="control__indicator"></div></label>');
					} else {
						$('#productListId')
								.append(
										'<label for="'
												+ data.listOfProduct[i].code
												+ '" class="control control--radio control-select">'
												+ data.listOfProduct[i].name
												+ '&nbsp;<input id="'
												+ data.listOfProduct[i].code
												+ '" name="productType" type="radio" value="'
												+ data.listOfProduct[i].code
												+ '" title="'
												+ data.listOfProduct[i].name
												+ '"> <div class="control__indicator"></div></label>');
					}
				}
			} else {
				$('#toolTipFr').hide();
				$('#toolTipIntr').hide();
				for (i = 0; i < data.listOfProduct.length; i++) {
					if (data.listOfProduct[i].code == data.selectedProductCode) {
						if(data.listOfProduct[i].code == 'LETTRE_SUIVIE'){
							$('#toolTipFr').show();
						}
						if(data.listOfProduct[i].code == 'LPIAS'||data.listOfProduct[i].code == 'PPIAS'){
							$('#toolTipIntr').show();
						}
						$('#productListId').append(
								'<option value="' + data.listOfProduct[i].code
										+ '" selected="selected">'
										+ data.listOfProduct[i].name
										+ '</option>');
					} else {
						$('#productListId').append(
								'<option value="' + data.listOfProduct[i].code
										+ '">' + data.listOfProduct[i].name
										+ '</option>');
					}
				}
			}
			F6.UI.bindProductTypePartAction();
		}
		if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE"
				|| previousProduct == "LETTRE_RECOMMANDEE"
				|| $('[name=productType]').val() == "LETTRE_SUIVIE"
				|| previousProduct == "LETTRE_SUIVIE") {
			F6.AJAX.getDestinations();
		}
		if (data.listOfWeight != undefined) {
			for (i = 0; i < data.listOfWeight.length; i++) {
				if (data.listOfWeight[i].code == data.selectedWeightCode) {
					$('#weightListId').append(
							'<option modulo=' + data.listOfWeight[i].modulo
									+ ' value="' + data.listOfWeight[i].code
									+ '" selected="selected">'
									+ data.listOfWeight[i].label + '</option>');
				} else {
					$('#weightListId').append(
							'<option modulo=' + data.listOfWeight[i].modulo
									+ ' value="' + data.listOfWeight[i].code
									+ '">' + data.listOfWeight[i].label
									+ '</option>');
				}
			}
			displayKnowMoreLink();

		}
		F6.UI.changeR1R2R3();
		if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE"
				|| $('[name=productType]').val() == "PPIR"
				|| $('[name=productType]').val() == "LETTRE_RECOMMANDEE_INTERNATIONALE") {
			F6.UI.initPrices();
			var recommandeMtel = $('[name=recommandeMtel]').val();
			F6.AJAX.getR1R2R3(recommandeMtel,false);
		}

		// add links and text
		F6.UI.putMiniMaxText();

	}

	F6.UI.putMiniMaxText = function() {
		if ($('[name=productType]').val() == "MINI_MAX") {

			// inject part pli
			pliPart = '<div class="textleft">'
					+ '<div class="formRow">'
					+ '<span>'
					+ '* Pour les envois nationaux avec la Mini Max, les plis ne doivent pas dépasser 1 Kg et 2 cm d’épaisseur.'
					+ '<br/>'
					+ '* Pour les envois à destination des DOM, les plis doivent être accompagnés d’un formulaire de douane '
					+ '<a href="//aide.boutique.laposte.fr/?q=formalit%C3%A9+douani%C3%A8res">CN22/CN23'
					+ '</a>' + '</span>' + '</div>' + '</div>';

			// inject pro pli
			pliPro = '<div class="textleft">'
					+ '<div class="formRow">'
					+ '<span>'
					+ '* Pour les envois nationaux avec la Mini Max, les plis ne doivent pas dépasser 1 Kg et 2 cm d’épaisseur.'
					+ '<br/>'
					+ '* Pour les envois à destination des DOM, les plis doivent être accompagnés d’un formulaire de douane '
					+ '<a href="//aide.boutique.laposte.fr/?q=formalit%C3%A9s+douani%C3%A8res">CN22/CN23'
					+ '</a>' + '</span>' + '</div>' + '</div>';

			$('#miniMaxTextId').empty();
			$('#miniMaxTextIdPart').html(pliPart);
			$('#miniMaxTextIdPro').html(pliPro);

			$('#miniMaxTextId').empty();
			$('#miniMaxTextIdPart').html(pliPart);
			$('#miniMaxTextIdPro').html(pliPro);

			// Découvrez la mini-max
			$('#pop-lettre-verte').text("Découvrez la mini-max");
			if ($('#pliMTELPro').length > 0) {
				$('#pop-lettre-verte')
						.attr(
								'href',
								"//aide.boutique.laposte.fr/professionnel/contenu/qu-est-ce-que-le-service-d-affranchissement-mini-max");
			} else {
				$('#pop-lettre-verte').attr('href',
						"//aide.boutique.laposte.fr/?q=mini+max");
			}
			$('#pop-lettre-verte').show();

		} else {
			// mettre ajour poids + product list
			if ($('[name=productType]').val().includes("LETTRE_VERTE")) {
				// Découvrez la lettre verte
				$('#pop-lettre-verte').text("Découvrez la lettre verte");
				if ($('#pliMTELPro').length > 0) {
					$('#pop-lettre-verte')
							.attr(
									'href',
									"//aide.boutique.laposte.fr/professionnel/contenu/qu-est-ce-que-la-lettre-verte");
				} else {
					$('#pop-lettre-verte').attr('href',
							"//aide.boutique.laposte.fr/?q=lettre+verte");
				}
				$('#pop-lettre-verte').show();
			} else {
				// Vider Block
				$('#pop-lettre-verte').hide();
			}
			// Vider Block
			$('#miniMaxTextId').empty();
			$('#miniMaxTextIdPart').empty();
			$('#miniMaxTextIdPro').empty();
		}
	}

	// Step 1 MTEL : call back get weights
	F6.UI.callbackStep1MTELWeightsData = function(data) {
		$('#weightListId').empty();

		if (data.listOfWeight != undefined) {
			for (i = 0; i < data.listOfWeight.length; i++) {
				if (i == 0) {
					$('#weightListId').append(
							'<option modulo=' + data.listOfWeight[i].modulo
									+ ' value="' + data.listOfWeight[i].code
									+ '" selected="selected">'
									+ data.listOfWeight[i].label + '</option>');
				} else {
					$('#weightListId').append(
							'<option modulo=' + data.listOfWeight[i].modulo
									+ ' value="' + data.listOfWeight[i].code
									+ '">' + data.listOfWeight[i].label
									+ '</option>');
				}
			}
			displayKnowMoreLink();

		}

		//
		if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE"
				|| $('[name=productType]').val() == "PPIR"
				|| $('[name=productType]').val() == "LETTRE_RECOMMANDEE_INTERNATIONALE") {
			if ($('#pliMTELPro').length) {
				F6.UI.initPrices();
				var recommandeMtel = $('[name=recommandeMtel]').val();
				F6.AJAX.getR1R2R3(recommandeMtel,false);
			} else {
				F6.UI.initPricesPart();
				F6.AJAX.getR1();
			}

		}
	}

	// Step 1 MTEL : call back get weights
	F6.UI.callbackStep1MTELDestinationsData = function(data) {
		selectedDest = $('[name=destination]').val();
		$('#destinationId').empty();
		if (data.listDestinataires != undefined) {
			for (i = 0; i < data.listDestinataires.length; i++) {
				if (data.listDestinataires[i].isocode == selectedDest) {
					$('#destinationId').append(
							'<option value="'
									+ data.listDestinataires[i].isocode
									+ '" selected="selected">'
									+ data.listDestinataires[i].name
									+ '</option>');
				} else {
					$('#destinationId').append(
							'<option value="'
									+ data.listDestinataires[i].isocode + '">'
									+ data.listDestinataires[i].name
									+ '</option>');
				}
			}

		}

		//
		if ($('[name=productType]').val() == "LETTRE_RECOMMANDEE"
				|| $('[name=productType]').val() == "PPIR"
				|| $('[name=productType]').val() == "LETTRE_RECOMMANDEE_INTERNATIONALE") {
			if ($('#pliMTELPro').length) {
				F6.UI.initPrices();
				var recommandeMtel = $('[name=recommandeMtel]').val();
				F6.AJAX.getR1R2R3(recommandeMtel,false);
			} else {
				F6.UI.initPricesPart();
				F6.AJAX.getR1();
			}

		}
	}

	// MTEL Change Position Impression MTEL

	/** START GESTION DE LA PLANCHE | fichier : MTEL_popinModifierPosDepart * */

	F6.UI.SheetstampPickerChangePos = Class({

		constructor : function() {
			this.global_sheet = $('#sheetpicker-planche .sheetstamp-body');
			this.select_element = $('#dimensionPlanche');
			this.grid_element = $('#sheet-stamp-list-mini');
			this.ref_stamp_cell = $('#sheet-stamp-list-mini li:eq(0)');
			this.slots_per_page = 0;
			this.rows = 0;
			this.cols = 0;
			this.selected_option = null;
			this.caption = '';
			this.captionurl = '';
			this.defineSelectedOption();
			this.current_page = 1;
			this.max_page = 1;
			this.stamps = 1;
			// this.displayGrid();
			this.position = 1;
			this.label_num_slots = Globalize.localize(
					"Planche de XX étiquettes", "fr_FR");
			this.pagination = false;
			this.array_slots = new Array();
			this.defineArraySlot();

			this.defineTextSheetNumber();
			// $('.complement a.code-planche').attr('href',
			// this.captionurl).text(this.caption);
		},
		defineSelectedOption : function() {
			selObj = $('#dimensionPlanche');
			selIndex = 0;
			this.selected_option = this.select_element.find('option:eq('
					+ selIndex + ')');
			this.setRows(this.selected_option.attr('data-rows'));
			this.setCols(this.selected_option.attr('data-cols'));
			this.caption = this.selected_option.attr('data-caption');
			this.captionurl = this.selected_option.attr('data-captionurl');
			this.slots_per_page = this.getRows() * this.getCols();
			this.slots_stamp = this.stamps + this.position - 1;

		},
		defineArraySlot : function() {

			this.array_slots = new Array();

			for (n = 0; n < (this.slots_per_page * this.max_page); n++) {
				if (n >= this.position - 1
						&& n < this.stamps + this.position - 1) {
					this.array_slots.push('stamp')
				} else {
					this.array_slots.push('empty');
				}
			}

		},
		setRows : function(input) {
			tmp = Math.round(input * 1);
			if (tmp == 8 || tmp == 6 || tmp == 7)
				this.rows = tmp;
		},
		getRows : function() {
			return this.rows;
		},
		setCols : function(input) {
			tmp = Math.round(input * 1);
			if (tmp == 3 || tmp == 2)
				this.cols = tmp;
		},
		getCols : function() {
			return this.cols;
		},
		setAjaxUrl : function(input) {
			this.ajax_url = input;
		},
		getAjaxUrl : function() {
			return this.ajax_url;
		},
		setAjaxFormId : function(input) {
			this.form_id = input;
		},
		getAjaxFormId : function() {
			return this.form_id;
		},
		setAjaxCallback : function(input) {
			this.callback = input;
		},
		getAjaxCallback : function() {
			return this.callback;
		},
		debug : function() {
			// znouaoui -> Watch out IE bug with console.log(this.getRows() + '
			// ' +
			// this.getCols() )
		},
		displayGrid : function() {
			this.grid_element.find('li').remove();
			this.grid_element.removeClass('cols-num-3');
			this.grid_element.removeClass('cols-num-2');
			$('.specimen').removeClass('cols-num-3');
			$('.specimen').removeClass('cols-num-2');

			this.grid_element.addClass('cols-num-' + this.getCols());

			$('.specimen').addClass('cols-num-' + this.getCols());

			for (n = ((this.current_page - 1) * this.slots_per_page); n < ((this.current_page - 1) * this.slots_per_page)
					+ this.slots_per_page; n++) {
				if (this.array_slots[n] == 'stamp') {
					this.grid_element.append(this.ref_stamp_cell.clone());
				} else {
					this.grid_element.append($('<li></li>').attr('data-index',
							n).text(n + 1));
				}
			}
		},
		updatePriceByAjax : function() {
			if (this.getAjaxCallback() && this.getAjaxUrl()
					&& this.getAjaxFormId()) {
				F6.UTILS.sendAjaxForm(this.getAjaxFormId(), {
					url : this.getAjaxUrl()
				}, '', this.getAjaxCallback(), '');
			}
		},
		displayPagination : function() {
			var barrePagination = $('.sheetstamps-pagination');
			barrePagination.html('');

			if (this.pagination) {
				barrePagination
						.append('<ol class="horinaja_pagination"></ol></div>');
				var horinajaPagination = $('.horinaja_pagination');
				for (var i = 1; i <= this.max_page; i++) {
					if (i == this.current_page) {
						horinajaPagination.append('<li><span>' + i
								+ '</span></li>')
					} else {
						horinajaPagination.append('<li><a href="#" title="'
								+ Globalize
										.localize("aller à la page", "fr_FR")
								+ '">' + i + '</a></li>')
					}
				}
				$('.horinaja_pagination a').click({
					that : this
				}, function(event) {
					event.preventDefault();
					event.data.that.changePagination($(this).text());
					return false;
				});

			}
		},
		defineTextSheetNumber : function() {
			txt_planche = this.max_page == 1 ? this.max_page + ' '
					+ Globalize.localize("planche", "fr_FR") : this.max_page
					+ ' ' + Globalize.localize("planches", "fr_FR");
			$('.sheetstamp-description').text(
					this.label_num_slots.replace('XX', this.slots_per_page)
							.replace(Globalize.localize("Planche", "fr_FR"),
									txt_planche));
		},
		commitChanges : function() {
			this.defineSelectedOption();
			this.calculePager();
			this.displayGrid();
			this.mouseHoverGrid();
			this.defineTextSheetNumber();
			// $('.complement a.code-planche').attr('href',
			// this.captionurl).text(this.caption);

		},
		setStamps : function(input) {
			this.stamps = input;
			this.calculePager();
		},
		getStamps : function() {
			return this.stamps;
		},
		setPosition : function(input) {
			this.position = input;
			this.calculePager();
		},
		calculePager : function() {
			this.slots_stamp = this.stamps + this.position - 1;
			this.max_page = Math.ceil(this.slots_stamp / this.slots_per_page)
			if (this.max_page > 1) {
				this.pagination = true
			} else {
				this.pagination = false
			}
			this.defineTextSheetNumber();
			this.defineArraySlot();
			this.displayPagination();
		},
		getPosition : function() {
			return this.position;
		},
		getSlots : function() {
			return this.slots_per_page;
		},
		getCurrentPage : function() {
			return this.current_page;
		},
		setCurrentPage : function() {
			return this.current_page;
		},
		setPage : function(input) {
			this.current_page = input
		},
		changePagination : function(input) {
			this.setPage(input);
			this.displayGrid();
			this.mouseHoverGrid();
			this.displayPagination();
		}
	});

	// Change Pos page imprission
	// znouaoui
	F6.UI.executeSheetstampPickerChangePos = function() {

		var Sheetstamp = new F6.UI.SheetstampPickerChangePos();// element,
		// initial_value,
		// max_value,
		// tt_inc,
		// tt_dec

		// Sheetstamp = F6.AJAX.executeSheetstampPickerChangePos(Sheetstamp);

		var counterPosition = new F6.UI.executeCounterIncremental({
			element : '.counter-position',
			initial_value : 1,
			max_value : 24,
			tt_inc : Globalize.localize(
					"Avance le point de départ (XX sur YY actuellement)",
					"fr_FR"),
			tt_dec : Globalize.localize(
					"Recule le point de départ (XX sur YY actuellement)",
					"fr_FR"),
			link_classes : '',
			content_link_dec : '',
			content_link_inc : '',
			input_position : 'center'
		});

		counterPosition.setMaxValue(Sheetstamp.getSlots());
		Sheetstamp.setStamps(1);
		Sheetstamp.setPosition(counterPosition.getValue());

		Sheetstamp.displayGrid();
		Sheetstamp.mouseHoverGrid();
		// Sheetstamp.updatePriceByAjax();

		Sheetstamp.select_element.bind('change', function(event) {
			event.preventDefault();
			Sheetstamp.commitChanges();
			counterPosition.setMaxValue(Sheetstamp.getSlots());
		});

		counterPosition.btn_increment.bind('click', function(event) {
			Sheetstamp.setPosition(counterPosition.getValue());
			Sheetstamp.displayGrid();
			Sheetstamp.mouseHoverGrid();
		});

		counterPosition.btn_decrement.bind('click', function(event) {
			Sheetstamp.setPosition(counterPosition.getValue());
			Sheetstamp.displayGrid();
			Sheetstamp.mouseHoverGrid();
		});

		counterPosition.input_counter.bind('change', function(event) {
			Sheetstamp.setPosition(counterPosition.getValue());
			Sheetstamp.displayGrid();
			Sheetstamp.mouseHoverGrid();
		});

	}// end znouaoui : change Pos

	// znouaoui MTEL : POPIN Probleme impression
	F6.UI.popinProblemImpression = function() {
		var href = $("#pop-probleme-impression").attr('href');
		href = href + "?isAjax=true";
		$("#pop-probleme-impression").attr('href', href);

        $("#pop-probleme-impression").fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) {console.log('### B');
                $('#popup h2').attr('tabindex', '0');
                $('#popup h2').focus();
                $('#popup .btn-cancel').click(function() {
                    $.fancybox.close();
                    $("#pop-probleme-impression").focus();
                    return false;
                });
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()

            }
        });
		text = $("#pop-probleme-impression").text();
		$("#pop-probleme-impression").attr('title',	$.trim($("#pop-probleme-impression").text()));

	};
	// znouaoui MTEL : POPIN Changer position depart
	F6.UI.popinChangerPositionDepart = function() {
		var href = $("#pop-changer-position-depart").attr('href');
		href = href + "&&isAjax=true";
		$("#pop-changer-position-depart").attr('href', href);

		$("#pop-changer-position-depart").fancybox({
             src  : URLS.updatePath( $(this).attr('href') ),
             type : 'ajax',
			 afterShow : function(instance) {console.log('### C');
                if (!$('#errorMode').length > 0) {
                    F6.UI.executeSheetstampPickerChangePos();
                }
                $('#popup h2').attr('tabindex', '0');
                $('#popup h2').focus();
                $('#popup .btn-cancel').click(function() {
                    $.fancybox.close();
                    $("#pop-changer-position-depart").focus();
                    return false;
                });
                $('#popup .btn-ok').click(function() {
                    $.fancybox.close();
                    $("#pop-changer-position-depart").focus();
                    return false;
                });
            },
             opts : {
                 touch: false,
                 momentum: false,
                 smallBtn: false,
                 clickOutside: false,
                 baseTpl : Popup.template()

             }
        });
		$("#pop-changer-position-depart").attr('title', $.trim($("#pop-changer-position-depart").text()));
	};

	// --------------------------------------------------------------------
	// ------------------------ V3 ----------------------------------------
	// --------------------------------------------------------------------
	F6.UI.adjustPageNumberOptions = function() {
		var num_page = 30;
		$('#formNosTarifsContent select').change(
				function(e) {
					if ($(e.currentTarget).attr('id') == 'formFormat') {
						var original = $('#formNombres').val();
						if ($(this).find('option:selected').val() == 1) {
							num_page = 30;
						} else {
							num_page = 60;
						}
						$('#formNombres').html('');
						for (i = 1; i <= num_page; i++) {
							page_label = i > 1 ? 'pages' : 'page';
							$('#formNombres').append(
									'<option value="' + i + '" '
											+ (i == original ? 'selected' : '')
											+ '>' + i + ' ' + page_label
											+ '</option>')
						}
						$('#formNombres').change();
					} else
						$('.blockPrice .btn-action-minor input').trigger('click');
				});
		$('#formFormat').trigger('change');
	};

	F6.UI.formNosTarifsContentData = function(datas) {
		$('.priceValue').text(datas.price)
	};

	F6.UI.executeTCatalogueCarrousel = function() {
		// Change HTML si JS + CSS
		/*
		 * $('#carrousel .back-menu').each(function(){ $(this).remove(); });
		 */
		var ref_width = $('#carrousel .slide').eq(0).width();
		var dimensions = $('#carrousel .slide').length * ref_width;
		var idx_active = $('#carrousel .slide').eq(0).attr('id')

		// TRIGGERS
		$('#carrousel .slide .inner a').bind('focusin', function() {

			var ancestor = F6.UTILS.findMyAncestorbyClass(this, 'slide');
			if (idx_active !== $(ancestor).attr('id')) {
				$(ancestor).hide();
				// $('#carrousel .slide').hide();
				$('#' + idx_active).show();
				$(ancestor).css('z-index', 5).fadeIn(450, function() {
					$(this).css('z-index', 4)
					$('#' + idx_active).css('z-index', 1);
					idx_active = $(ancestor).attr('id');
				});

			}

		});

		$('#carrousel .menu a').bind('click', function(e) {
			F6.stop(e);

			var id = $(this).attr('href');
			var idx = parseInt(id);

			$('#carrousel .content ' + id + ' .inner a').focus();

		});
	}

	/** ****************** PUSH PRODUIT */
	F6.UI.executeProductPush = function() {
		var dimension = 0;
		var nb_push = 0;
		var content_link_dec = '<img src="/_ui/eboutique/images/btn/btn_main_pdt_fiche_dec.png" width="20" height="19" alt="Diminuer la quantité">';
		var content_link_inc = '<img src="/_ui/eboutique/images/btn/btn_main_pdt_fiche_inc.png" width="20" height="19" alt="Augmenter la quantité">';

		if ($('.collector-section').length) {
			content_link_dec = '<img src="/_ui/eboutique/images/btn/btn_main_pdt_fiche_dec.png" width="20" height="19" alt="Diminuer la quantité">';
			content_link_inc = '<img src="/_ui/eboutique/images/btn/btn_main_pdt_fiche_inc.png" width="20" height="19" alt="Augmenter la quantité">';
		}

		var max_value = 9999;
		if ($('.maxQtyProduct') != null && $('.maxQtyProduct').get(0) != null
				&& $('.maxQtyProduct').get(0).value != null) {
			max_value = $('.maxQtyProduct').get(0).value;
		}

		$('.btn-basket').on(
				'click',
				function(e) {
					e.preventDefault();
					F6.AJAX.addToCart($(e.currentTarget).parent().find(
							'input[type=hidden]:eq(0)').val(), parseInt($(
							e.currentTarget).parent().find('.digits').val()));
				});

		// Pour chaque push on défini les paramètres et les triggers
		$('.product-group')
				.each(
						function() {
							dimension = 0;
							nb_push = $('.product-slot', this).length;
							// Calcul de la taille pour le scroller
							$('.product-slot', this)
									.each(
											function() {
												dimension += $(this).width() + 1;

												unit_price = $('.unit-price',
														this).text();

												new F6.UI.executeCounterIncremental(
														{
															element : $(
																	'.counter',
																	this),
															initial_value : 1,
															max_value : max_value,
															tt_inc : Globalize
																	.localize(
																			"Augmente le nombre d'article (XX actuellement)",
																			"fr_FR"),
															tt_dec : Globalize
																	.localize(
																			"Diminue le nombre d'article (XX actuellement)",
																			"fr_FR"),
															link_classes : 'aebk counter-modifier',
															content_link_dec : content_link_dec,
															content_link_inc : content_link_inc,
															input_position : 'center'
														});

												/*
												 * $(this).bind('focusin',
												 * function(){
												 * if(!$('.product-buy',
												 * this).hasClass('active')){
												 * $('.product-slot
												 * .active').removeClass('active'); }
												 * });
												 *
												 * $('.product-buy',
												 * this).bind('focusin',
												 * function(){
												 * if(!$(this).hasClass('active')) {
												 * $('.product-slot
												 * .active').removeClass('active');
												 * $(this).addClass('active');
												 * $('.decrement',
												 * this).focus(); } });
												 */

												/*
												 * $('.product-buy',
												 * this).hover(function(){
												 * $(this).addClass('active') },
												 * function(){
												 * $(this).removeClass('active')
												 * });
												 */
											});

							dimension = Math.round(dimension);
							nb_page = Math.round(dimension / $(this).width());
							nb_item_by_page = Math.round(nb_push / nb_page);

							// $('ul', this).css('width', dimension + 'px');

							el_bottom = $(this).siblings(
									'.product-push-bottom-wrap').find(
									'.product-push-bottom');
							if (el_bottom.length) {
								pager_content = $('<div>');
								for (i = 0; i < nb_page; i++) {
									btn_slot = $('<a>');
									btn_slot.attr('href', '#');
									btn_slot
											.attr(
													'title',
													'Afficher la page numéro '
															+ Math.abs(i + 1)
															+ ' de cette collection de produits');
									btn_slot.addClass('action-move-slot slot_'
											+ i);
									img_pager = new Image();
									img_pager.width = 15;
									img_pager.height = 16;
									img_pager.alt = 'page ' + Math.abs(i + 1);
									if (i == 0) {
										btn_slot.addClass('selected');
										img_pager.src = "/_ui/eboutique/images/btn/push_pdt_page_active.png";
									} else {
										img_pager.src = "/_ui/eboutique/images/btn/push_pdt_page.png";
									}
									btn_slot.append(img_pager);
									btn_slot.bind('click',
											F6.UI.activeBtnProductpushSlot);

									pager_content.append(btn_slot);
									if (!F6.UTILS.isImageActivate()) {
										pager_content.append(' ');
									}
								}

								page_num = 0;

								if (nb_page > 1) {
									$('.product-slot', this).hide();
									for (n = 0; n < nb_item_by_page; n++) {
										element_idx = (page_num * nb_item_by_page)
												+ n;
										$('.product-slot', this)
												.eq(element_idx).show();
									}
								}
								el_bottom.prepend(pager_content);
							}

						});

		// titles pour les boutons
		$('.product-slot')
				.each(
						function() {
							var $link = $(this).find('.product-description a');
							var $input = $(this).find('.btn-basket input');
							var $price = $(this).find('.unit-price');
							var spanIndex = $link.find('span').size();
							var titlestring = $link
									.find(
											'span:eq('
													+ (spanIndex == 2 ? 1 : 0)
													+ ')').text();
							var text = "";

							if($price.length > 0){
							    text = $price[0].textContent || $price[0].innerText; // innerText
							}
							text = $price[0].innerText.replace(/\r?\n/g, " "); // innerText
							// for
							// IE7/IE8*

							if (text !== "") {
								text = $.trim(text); // trim avec jquery
								$link.attr('title', titlestring
										+ ' - '
										+ text.replace(/\r?\n/g, "").replace(
												/\t/g, ""));
							}

							$input.attr('title', 'Ajouter l\'article '
									+ titlestring + ' à votre panier');
						});

	};

	F6.UI.showHidePushItems = function(element, page) {

	}

	F6.UI.activeBtnProductpushSlot = function(e) {
		F6.stop(e)

		if ($(this).hasClass('selected'))
			return false;

		var el_bind = this;
		var nb_push = 0;
		var dimension = 0;
		var nb_page = 0;
		var nb_item_by_page = 0;
		var speed = 600;
		var el_parent = '';
		reg = new RegExp(/slot_([0-9]+)/);

		selected_page = $(this).parent().find('.selected');

		slot_tag = $(this).attr('class').match(reg);
		page_num = slot_tag[1];
		el_parent = $(this).parent();
		// recupération de l'element ancetre
		while (!$(el_parent).prev().hasClass('product-group'))
			el_parent = el_parent.parent();
		product_group = $(el_parent).prev();
		item_size = $('.product-slot', product_group).eq(0).width();
		nb_push = $('.product-slot', product_group).length;
		// dimension = Math.round($(product_group).width());
		dimension = (product_group.children('#prdListId')).width();
		nb_page = Math.round(dimension / product_group.width());
		nb_item_by_page = Math.round(nb_push / nb_page);
		// calcul de la marge pour la page en cours
		slot_tag = $($(selected_page).attr('class').match(reg)).get(0);
		selected_page_num = slot_tag.replace('slot_', '') * 1;
		actual_marge = selected_page_num * nb_item_by_page * item_size;

		// calcul de la parge à atteindre
		margin_value = Math.round(nb_item_by_page * item_size * page_num * -1);

		// calcul de la vitesse de deplacement pour quelle soit toujours
		// équivalente
		speed = Math.abs(selected_page_num - page_num) * speed;

		// ul de la liste
		var product_group_list = product_group.children();

		// rendre visible tous les produits
		$('.product-slot', product_group).show();

		// repositionne la liste car les slots sont de nouveau visibles
		product_group_list.css('margin-left', '-' + actual_marge + 'px');

		// effet de déplacement des produits
		product_group_list.animate({
			'margin-left' : margin_value + 'px'
		}, speed,
				function() {
					$('.product-slot', product_group).hide();
					$('.item-visible', product_group).removeClass(
							'item-visible');

					// calcul des éléments qui doivent rester visible
					for (n = 0; n < nb_item_by_page; n++) {
						element_idx = (page_num * nb_item_by_page) + n;
						$('.product-slot', product_group).eq(element_idx)
								.show();
						$('.product-slot', product_group).eq(element_idx)
								.addClass('item-visible');
					}
					// recalage de dernière seconde pour ne ma afficher la
					// border et être raccord avec la css
					$(this).css('margin-left', '-1px');

					// Focus sur le lien du premier produit nouvellement
					// afficher
					focus_item = $('.product-slot:eq('
							+ parseInt(page_num * nb_item_by_page) + ')',
							product_group);
					focus_div = $('.product-description', focus_item);
					focus_link = $('a', focus_div).focus();
				});
		$(this).parent().find('.selected').removeClass('selected');
		$(this).addClass('selected');
		$(this)
				.parent()
				.find('a')
				.each(
						function() {
							img_pager = new Image();
							img_pager.width = 15;
							img_pager.height = 16;
							img_pager.alt = 'page ' + Math.abs(i + 1);
							if ($(this).hasClass('selected')) {
								img_pager.src = "/_ui/eboutique/images/btn/push_pdt_page_active.png";
							} else {
								img_pager.src = "/_ui/eboutique/images/btn/push_pdt_page.png";
							}
							$(this).html('');
							$(this).append(img_pager);
						});
	};

	F6.UI.executeMainProductBuy = function() {
		var content_link_dec = '<img src="/_ui/eboutique/images/btn/btn_main_pdt_fiche_dec.png" width="20" height="19" alt="Diminuer la quantité">';
		var content_link_inc = '<img src="/_ui/eboutique/images/btn/btn_main_pdt_fiche_inc.png" width="20" height="19" alt="Augmenter la quantité">';
		var max_value = 999999999;
		if ($('.maxQtyProduct') != null && $('.maxQtyProduct').get(0) != null
				&& $('.maxQtyProduct').get(0).value != null) {
			max_value = $('.maxQtyProduct').get(0).value;
		}
		new F6.UI.executeCounterIncremental({
			element : $('.main-product-buy .counter'),
			initial_value : 1,
			max_value : max_value,
			tt_inc : Globalize.localize(
					"Augmente le nombre d'article (XX actuellement)", "fr_FR"),
			tt_dec : Globalize.localize(
					"Diminue le nombre d'article (XX actuellement)", "fr_FR"),
			link_classes : 'aebk counter-modifier',
			content_link_dec : content_link_dec,
			content_link_inc : content_link_inc,
			input_position : 'center'
		});
	}

	// Version V2; a supprimer,
	/*
	 * F6.UI.executeAchatPanierMixte = function() { $('#myMixedBasket
	 * button.check_code_submit').bind('click',function(e) {
	 *
	 * submitted = $('#voucherCode').attr('submitted');
	 * $('#voucherErrorBoxTop').empty(); F6.stop(e); if ($('#myMixedBasket
	 * input[name="voucherCode"]').val() && (submitted == undefined || submitted ==
	 * "false")) { $('#errorBoxTop').text(''); $('#errorBoxTop').hide();
	 * $('#voucherCode').attr('submitted', true); $('#myMixedBasket').submit(); //
	 * F6.UI.tunnelAchatPanierAdjutPrice(); } else {
	 * $('#errorBoxTop').text(Globalize.localize("Votre code promo est
	 * obligatoire","fr_FR")).show();
	 * F6.VALIDATIONS.highlightError('errorBoxTop');
	 * $('#voucherCode').attr('submitted', false); } });
	 *
	 * if ($('#myMixedBasket #tableProduitItems a.action-delete-item').length)
	 * $('#myMixedBasket #tableProduitItems a.action-delete-item').bind(
	 * 'click', { prefix_id : 'produit_item_' },
	 * F6.UI.promptTunnelAchatPanierDeleteItem); if ($('#tableServiceItems
	 * a.action-delete-item').length) { $('#tableServiceItems
	 * a.action-delete-item') .bind('click', { prefix_id : 'service_item_' },
	 * F6.UI.promptTunnelAchatPanierDeleteItem); } };
	 */
	/*
	 * -------------------------------------------------------------------
	 * RECAPITULATIF DE LA COMMANDE - PANIER MIXTE GESTION DU CODE PROMO GESTION
	 * PROMO SUR LE TOTAL
	 * -------------------------------------------------------------------
	 */

	F6.UI.executeAchatPanierMixte = function() {
		$('#myMixedBasket button.check_code_submit')
				.bind(
						'click',
						function(e) {
							submitted = $('#voucherCode').attr('submitted');
							$('#voucherErrorBoxTop').empty();
							F6.stop(e);
							if ($('#myMixedBasket input[name="voucherCode"]')
									.val()
									&& (submitted == undefined || submitted == "false")) {
								$('#errorBoxTop').text('');
								$('#errorBoxTop').hide();
								$('#voucherCode').attr('submitted', true);
								$('#myMixedBasket').submit();
								// F6.UI.tunnelAchatPanierAdjutPrice();
							} else {
								$('#errorBoxTop')
										.text(
												Globalize
														.localize(
																"Votre code promo est obligatoire",
																"fr_FR"))
										.show();
								F6.VALIDATIONS.highlightError('errorBoxTop');
								$('#voucherCode').attr('submitted', false);
							}
						});

		if ($('#myMixedBasket #tableProduitItems a.action-delete-item').length)
			$('#myMixedBasket #tableProduitItems a.action-delete-item').bind(
					'click', {
						prefix_id : 'produit_item_'
					}, F6.UI.promptTunnelAchatPanierDeleteItem);

		if ($('#myMixedBasket #tableServiceItems a.action-delete-item').length)
			$('#myMixedBasket #tableServiceItems a.action-delete-item').bind(
					'click', {
						prefix_id : 'service_item_'
					}, F6.UI.promptTunnelAchatPanierDeleteItem);

		if ($('#myBrouillon #tableServiceItems a.action-delete-item').length > 0)
			$('#myBrouillon #tableServiceItems a.action-delete-item').bind(
					'click', {
						prefix_id : 'service_item_'
					}, F6.UI.promptTunnelAchatPanierDeleteItem);

		if ($('#myMixedBasket #tableMtamItems a.action-delete-item').length)
			$('#myMixedBasket #tableMtamItems a.action-delete-item').bind(
					'click', {
						prefix_id : 'service_'
					}, F6.UI.promptTunnelAchatPanierDeleteItem);

		$('.save-cart a').bind(
				'click',
				{
					success_message : Globalize.localize(
							"Votre panier a été sauvegardé", "fr_FR")
				}, F6.AJAX.tunnelAchatPanierSave);

		$('.empty-cart').bind(
				'click',
				{
					success_message : Globalize.localize(
							"Votre panier a été supprimé", "fr_FR")
				}, F6.UI.tunnelAchatPanierEmptyBeforePrompt);

		$('.infoService')
				.each(
						function() {
							var bouton = new F6.UI.executeCounterIncremental(
									{
										element : $('.quantity', this),
										initial_value : 1,
										max_value : 9999,
										tt_inc : Globalize
												.localize(
														"Augmente le nombre d'article (XX actuellement)",
														"fr_FR"),
										tt_dec : Globalize
												.localize(
														"Diminue le nombre d'article (XX actuellement)",
														"fr_FR"),
										link_classes : 'btn',
										content_link_dec : '<img src="/_ui/eboutique/images/bg/bg_transverse-circle-dec.png" width="19" height="19" alt="Diminuer la quantité">',
										content_link_inc : '<img src="/_ui/eboutique/images/bg/bg_transverse-circle-inc.png" width="19" height="19" alt="Augmenter la quantité">',
										input_position : 'center'
									});

							bouton.btn_increment.bind('click', {
								trigger : bouton
							}, F6.UI.actionAchatPanierProduit);
							bouton.btn_decrement.bind('click', {
								trigger : bouton
							}, F6.UI.actionAchatPanierProduit);
							bouton.input_counter.bind('change', {
								trigger : bouton
							}, F6.UI.actionAchatPanierProduit);
							bouton.input_counter.keyup({
								trigger : bouton
							}, F6.UI.actionAchatPanierProduit);
						});

	};

	F6.UI.tunnelAchatPanierEmptyBeforePrompt = function(event) {
		event.preventDefault();
		var txt = Globalize.localize(
				"Etes-vous certain de vouloir supprimer votre panier", "fr_FR");
		$
				.prompt(
						txt,
						{
							buttons : {
								Supprimer : true,
								Annuler : false
							},
							callback : function(e, v, m, f) {
								$(
										"#jqibox .confirm-choice button, #jqibox .btn-dir-cancel button")
										.attr('title', '');
								if (v) {
									// en l'absence de service global,
									// j'utilise la suppression item par
									// item sur les deux tableaux
									if ($('#tableProduitItems').find(
											'tr[id*="produit_item_"]').length > 0) {
										var produits = $('#tableProduitItems')
												.find('tr[id*="produit_item_"]');
										$
												.each(
														produits,
														function(a, b) {
															if ($(this)
																	.hasClass(
																			'multipleItems')) {
																var group_id = $(
																		this)
																		.attr(
																				'id');
																$(this)
																		.siblings()
																		.each(
																				function() {
																					if ($(
																							this)
																							.attr(
																									'id')
																							.match(
																									group_id)) {
																						$(
																								this)
																								.addClass(
																										'removeAfterSuccesPromptAndAjax')
																					}
																				});
															}

															$(this)
																	.addClass(
																			'removeAfterSuccesPromptAndAjax')
															F6.AJAX
																	.tunnelAchatPanierDeleteItem(
																			e,
																			{
																				id : $(
																						this)
																						.attr(
																								'id'),
																				success_message : ''
																			});
														});
									}
									if ($('#tableServiceItems').find(
											'tr[id*="service_item_"]').length > 0) {
										var services = $('#tableServiceItems')
												.find('tr[id*="service_item_"]');
										$
												.each(
														services,
														function(c, d) {
															if ($(this)
																	.hasClass(
																			'multipleItems')) {
																var group_id = $(
																		this)
																		.attr(
																				'id');
																$(this)
																		.siblings()
																		.each(
																				function() {
																					if ($(
																							this)
																							.attr(
																									'id')
																							.match(
																									group_id)) {
																						$(
																								this)
																								.addClass(
																										'removeAfterSuccesPromptAndAjax')
																					}
																				});
															}

															$(this)
																	.addClass(
																			'removeAfterSuccesPromptAndAjax')
															F6.AJAX
																	.tunnelAchatPanierDeleteItem(
																			e,
																			{
																				id : $(
																						this)
																						.attr(
																								'id'),
																				success_message : ''
																			});
														});
									}

								} else
									$('.empty-cart input').focus();
							}
						});
		$("#jqibox .confirm-choice button").attr(
				'title',
				Globalize.localize("Confirmer la suppression du panier",
						"fr_FR"));
		$("#jqibox .btn-dir-cancel button")
				.attr(
						'title',
						Globalize
								.localize(
										"Annuler la suppression du panier et revenir au panier",
										"fr_FR"));
	};

	F6.UI.updateMiniCart = function(data, error) {
		if (error != null) {
			// In the case of error, data is the code of the product
			$("[id^=error_]").text('');
			$('#error_' + data).text(error);
			return false;
		}
		var tabPrice = String(data.totalPrice).split('.');
		var out = '';
		for (var i = 0; i < data.content.length; i++) {
			out += '<li>';
			out += '<span class="visual"><img src="' + data.content[i].imageUrl
					+ '" alt="' + data.content[i].imageAltText;
			if (data.content[i].physicalProduct) {
				out += '"/></span>';
			} else {
				out += '" width="55" height="36"/></span>';
			}
			out += '<span class="price">' + data.content[i].basePriceValue
					+ '</span>';
			out += '<span class="type">' + data.content[i].productName
					+ '</span>';
			out += '<span>Timbre | Quantité : ' + data.content[i].quantity
					+ '</span>';
			out += '</li>';
		}
		$('.cart_nb_products').text(data.nbProducts);
		$('.tooltip-bottom .euros').html(tabPrice[0]);
		$('.tooltip-bottom .centimes').html("," + tabPrice[1] + "&euro;");
		$('.tooltip-content .type-services').html(out);
		$('.basketBtn').attr('href', EBK.config.contextPath+'/panier');
		$('.basketBtn').attr('title',
				'Visualiser votre panier (' + data.nbProducts + ' articles)');
		$('.htmltooltip_header').attr('style',
				'top:2.7em; visibility: visible;');
	};

	/**
	 * Refresh mini cart orders count and show errors and info into the
	 * pushProduct (ex home-Page)
	 */
	F6.UI.addToCartCallback = function(data, error) {

		// if max qte is exceed
		if (data.exceed == true) {
			$('#maxOrderQtMssg_' + data.productCode).text(data.message);
			$('#maxOrderQtMssg_' + data.productCode).show();

			// BTKBACKLOG-5175
			$('.farandole-product .product-textcontainer').css("height",
					"228px");

			return false;

		}  else if (data.exceed === false && error) {
			$('#error_' + data.productCode).text(data.message).show();
			return false;
		}
		else {
			$('#maxOrderQtMssg_' + data.productCode).hide();
		}

		// if action is from product panel
		if (error != null) {
			// if (data != null && data.quantity == 0 && (error.contains("/p/")
			// || error.contains("/commande-detail/"))){
			if (data != null
					&& data.quantity == 0
					&& (error.indexOf("/p/") >= 0 || error
							.indexOf("/commande-detail/") >= 0)) {
				F6.UI.redirect(error);
				return false;
			}
		}

		$("[id^=error_]").text('');
		if (data.quantity != null) {
			$('#produit_' + data.productCode + '_quantity').val(data.quantity);
		}

		if (error != null) {
			$('#error_' + data.productCode).text(error);
			return false;
		}
		// data is the number of diffrents orders into the cart
		if (data.quantity != null) {
			$('.cart_nb_products').text(data.quantity > 99 ? "+99" : data.quantity );
		}
		// affichage popin ajout panier
		$.get(EBK.config.contextPath+"/ajaxAjoutPanierPopin", {
			"productCodePost" : data.productCode,
			"qty" : data.message,
			"orderCode" : data.orderCode,
			"entryId" : data.entryId,
			"entryNumber" : data.entryNumber

		}, function(popupHtml) {

			$("#panierPopin").html("");
			$("#panierPopin").html(popupHtml);
			ajoutPanierPopin();
			$('#produit_' + data.productCode + '_quantity').val(1);
			// Farandole : Metre la quantite a un > apres achat
			$('#produit_' + data.productCode + ' [name=qty]').val(1);
			return false;
		});

		return false;
	}

	// Mkaabi Recommand All Button Callback
	F6.UI.recommandAllCallback = function(data, error) {

		if (error != null) {
			if (data != null && data.recommandableProducts == "[]") {
				F6.UI.redirect(error);
				return false;
			}

		}
		// update the cart icon
		$("[id^=error_]").text('');
		if (error != null) {
			$('#error_recommanderTout').text(error);
			return false;
		}
		$('.cart_nb_products').text("1");
		// affichage popin ajout panier
		$.get("/recommandAnOrder", {
			"orderCode" : data.orderCode,
			"recommandableProducts" : data.recommandableProducts
		}, function(popupHtml) {
			$("#panierPopin").html("");
			$("#panierPopin").html(popupHtml);
			ajoutPanierPopin();
			return false;
		});
	}

	/**
	 * Refresh mini cart orders count and show errors and info into the
	 * pushProduct (ex home-Page)
	 */
	F6.UI.addAllFavorisToCartCallback = function(data, error) {

		// data is the number of diffrents orders into the cart
		if (data.quantity != null) {
			$('.cart_nb_products').text(data.quantity);
		}

		if (data.listProduitsReptureStock.length > 2) {
			$.get("/mesproduitsfavoris/ajaxBuyAllPopUp", {
				"listProduitsReptureStock" : data.listProduitsReptureStock,
				"isProductsInCart" : data.isProductsInCart
			}, function(popupHtml) {
				$("#productFavorisPopPart").html("");
				$("#productFavorisPopPart").html(popupHtml);
				F6.UI.centerFavorisAjaxPopup();
			});
			$(window).resize(function() {
				if ($("#productFavorisPopPart").css('display') != 'none') {
					F6.UI.centerFavorisAjaxPopup();
				}
			});
		} else {
			F6.UI.redirect(EBK.config.contextPath+'/panier');
		}
	}

	F6.UI.addToFavorisCallback = function(data, error) {
		if (data == "/authentification" || data == "/professionnel/authentification") {
			F6.UI.redirect(data);
		} else {
			if (data == "false") {
				$.get(EBK.config.contextPath+"/mesproduitsfavoris/ajaxAddToFavorisPopup", function(
						popupHtml) {
						$.fancybox.open({
						    src : popupHtml,
						    type : 'html',
						    opts: {
                                touch: false,
                                momentum: false,
                                smallBtn: false,
                                clickOutside: false,
                                baseTpl : Popup.template()
                            }
						})
				});
			} else {
				$.get(EBK.config.contextPath+"/mesproduitsfavoris/ajaxProductAddedPopup", function(
						popupHtml) {

						$.fancybox.open({
                            src : popupHtml,
                            type : 'html',
                            opts: {
                                touch: false,
                                momentum: false,
                                smallBtn: false,
                                clickOutside: false,
                                baseTpl : Popup.template()
                            }
                        })
				});
			}

			$(window).resize(function() {
				if ($("#productFavorisPopPart").css('display') != 'none') {
					F6.UI.centerFavorisAjaxPopup();
				}
			});
		}

	}

	// centering popup
	F6.UI.centerFavorisAjaxPopup = function() {
		if ($("#productFavorisPopPart").html() != "") {
			// request data for centering
			var windowWidth = document.documentElement.clientWidth;
			var windowHeight = document.documentElement.clientHeight;
			if (window.innerHeight > 0) {
				var windowHeight = window.innerHeight;
			}
			var popupHeight = $("#productFavorisPopPart").height();
			var popupWidth = $("#productFavorisPopPart").width();
			// centering
			$("#productFavorisPopPart").css({
				"top" : windowHeight / 2 - popupHeight / 2,
				"left" : windowWidth / 2 - popupWidth / 2,
				"opacity" : 1,
				"z-index" : 9999
			});
			// only need force for IE6

			$("#backgroundPopPart").css({
				"height" : windowHeight,
				"opacity" : 0.8,
				"z-index" : 5555
			});
			$("#productFavorisPopPart").fadeIn('fast');
			$("#backgroundPopPart").fadeIn('fast');
			$('#productFavorisPopPart').attr("tabindex", -1).focus();
		}
	}

	F6.UI.centerRecomAjaxPopup = function() {
		if ($("#panierRecomPopin").html() != "") {
			// request data for centering
			var windowWidth = document.documentElement.clientWidth;
			var windowHeight = document.documentElement.clientHeight;
			if (window.innerHeight > 0) {
				var windowHeight = window.innerHeight;
			}
			var popupHeight = $("#panierRecomPopin").height();
			var popupWidth = $("#panierRecomPopin").width();
			// centering
			$("#panierRecomPopin").css({
				"top" : windowHeight / 2 - popupHeight / 2,
				"left" : windowWidth / 2 - popupWidth / 2,
				"opacity" : 1,
				"z-index" : 9999
			});
			// only need force for IE6

			$("#backgroundPanierRecomPopin").css({
				"height" : windowHeight,
				"opacity" : 0.8,
				"z-index" : 5555
			});
			$("#panierRecomPopin").fadeIn('fast');
			$("#backgroundPanierRecomPopin").fadeIn('fast');
			$('#panierRecomPopin').attr("tabindex", -1).focus();
		}
	}
	/** Refresh mini cart orders count and show errors into the cart detail page */
	F6.UI.updateCartEntryQuantityCallback = function(data, error) {
		$("[id^=error_]").text('');
		if (error != null) {
			$('#error_' + data.priceLigne.entryNumber).text(error);
			if (!data.successUpdateQty) {
				$(
						'#basket_produit_' + data.priceLigne.entryNumber
								+ '_quantity').val(data.priceLigne.qtyDemanded);
				return false;
			}
		}
		if (data.infoMsg != null) {
			// $.prompt(data.infoMsg, {
			// buttons : {
			// OK : true
			// },
			// callback : function(e, v, m, f) {
			// // if (v) {
			// //
			// // $(el_trigger).focus();
			// // $('#successBoxTop').find('a').focus();
			// // }
			// }
			// });
		}
		var isFromCart = $("#isFromCart").val();
		if (isFromCart == null || isFromCart == "" || isFromCart == 'false') {
			F6.UI.tunnelAchatPanierRefresh(data.content);
		}
		F6.UI.tunnelAchatPanierAdjutPriceLineCallback(data.priceLigne);
		F6.UI.tunnelAchatPanierAdjutPriceCallback(data.price);
		F6.UI.tunnelAchatPanierAdjutGiftedPrices(data.giftedPrices);
		$('#shippingMsgId').text(data.deliveryMsg);
		$('.cart_nb_products').text(data.nbItems);
		/**Option Suivi Afficher un popup de suggestion sur le panier - MDHM**/
		var conditioningData = data.conditioningData ;
		if(conditioningData != null && (conditioningData.productQuantity12 != null || conditioningData.productQuantity100 !=null))
		{
			$.ajax({
			    headers: {
			        'Accept': 'application/json',
			        'Content-Type': 'application/json'
			    },
			    type: 'POST',
			    url: EBK.config.contextPath + '/panier/conditionnement-panier',
			    data: JSON.stringify(conditioningData),
			    success : function(data) {
					Popup.popinHTML(data);
				}

			});
		}
	};




	/** Refresh mini cart orders count and show errors into the cart detail page */
	F6.UI.updateMtamCartEntryQuantityCallback = function(data, error) {
		$("[id^=error_]").text('');
		if (error != null) {
			$("#ifErrorMtam").html(error);
			if (!data.successUpdateQty) {
				$(
						'#basket_mtamProduct_' + data.priceLigne.entryNumber
								+ '_quantity').val(data.priceLigne.qtyDemanded);
				return false;
			}
		}
		if (data.infoMsg != null) {
			// $.prompt(data.infoMsg, {
			// buttons : {
			// OK : true
			// },
			// callback : function(e, v, m, f) {
			// // if (v) {
			// //
			// // $(el_trigger).focus();
			// // $('#successBoxTop').find('a').focus();
			// // }
			// }
			// });
		}
		$("#ifErrorMtam").html("");
		if (data.sizeMaxforMtamEntries != "") {
			var chaine = data.sizeMaxforMtamEntries;
			var reg = new RegExp("[ *;]+", "g");
			var tableau = chaine.split(reg);
			var result = 0;
			for (var i = 0; i < tableau.length; i += 2) {
				result = tableau[i + 1]
						- $('#basket_mtamProduct_' + tableau[i] + '_quantity')
								.val();
				if (result < 0) {
					$("#ifErrorMtam").html(data.errorSizeMaxforMtamEntries);
				}
			}
		}

		if (data.indexOfIdtPrestigeWithinCart != "") {
			var chaine = data.indexOfIdtPrestigeWithinCart;
			var reg = new RegExp("[ *;]+", "g");
			var tableau = chaine.split(reg);
			var result = 0;
			for (var i = 0; i < tableau.length; i += 2) {
				result = $('#basket_mtamProduct_' + tableau[i] + '_quantity')
						.val();
				if (result < 10) {
					$("#ifErrorMtam").html(data.errorSizeMinforIdtPrestige);
				}
			}

		}
		var isFromCart = $("#isFromCart").val();
		if (isFromCart == null || isFromCart == "" || isFromCart == 'false') {
			F6.UI.tunnelAchatPanierRefresh(data.content);
		}
		F6.UI.tunnelAchatPanierAdjutMtamPriceLineCallback(data.priceLigne);
		F6.UI.tunnelAchatPanierAdjutPriceCallback(data.price);
		$('#shippingMsgId').text(data.deliveryMsg);
		$('.cart_nb_products').text(data.nbItems);
	};

	/** ******************************** */
	/** MY BROUILLON * */

	F6.UI.executeMyBrouillon = function() {
		if ($('#myBrouillon #tableServiceItems a.action-delete-item').length)
			$('#myBrouillon #tableServiceItems a.action-delete-item').bind(
					'click', {
						prefix_id : 'brouillon_item_'
					}, F6.UI.promptMyBrouillonDeleteItem);
		if ($('#myBrouillon .blockButtons btn-cancel').length)
			$('#myBrouillon .blockButtons span.btn-cancel').bind('click', {
				prefix_id : 'brouillon_item_'
			}, F6.UI.promptMyBrouillonDeleteAll);
	};

	F6.UI.tunnelAchatPanierDeleteItemAfterPrompt = function(datas) {
		F6.UI.removeItemAchatPanierSelectedAfterPrompt(datas, 'myMixedBasket');
		F6.UI.tunnelAchatPanierAdjutPrice();
	};

	F6.UI.tunnelAchatPanierAdjutPrice = function() {
		F6.AJAX.tunnelAchatPanierAdjutPrice($('#myMixedBasket').serialize());
		/* F6.AJAX.tunnelAchatPanierAdjutPrice($('#courrierData').serialize()); */
	};

	F6.UI.executeTunnelAchatCoordonnees = function() {
		$('#tunnel_achat_coordonnees select')
				.bind(
						'change',
						function(e) {
							// znouaoui : if delivery addess has changed, relaod
							// the page
							// TODO :
							var selectedDeliveryAddressId = $(
									"#tunnel_achat_coordonnees_select_delivry_address")
									.val();
							var selectedBillingAddressId = $(
									"#tunnel_achat_coordonnees_select_billing_address")
									.val();
							// document.location.href =
							// '/coordonnees_livraison?selectedBillingAddressId='+selectedBillingAddressId+'&selectedDeliveryAddressId='+selectedDeliveryAddressId;
							// iomari test cas MTEL LEL (seule l'adresse de
							// facturation qui est renseignée)
							if (selectedDeliveryAddressId == null
									&& selectedBillingAddressId != null) {
								F6.AJAX
										.tunnelAchatPanierFacturation(selectedBillingAddressId);
							} else {
								// znouaoui : desactivate ajax's call
								// F6.stop(e);
                                // BTKTMA-920 : S'il s'agit du mode colissimo et que celui-ci n'est pas sélectionné au moment du changement d'adresse,
                                //              on le coche par défaut de façon à envoyer le mode de livraison qui est obligatoire.
                                if($('#ulModeShipping').size() == 1 && $('#tunnel_achat_coordonnees')[0][4].defaultValue === 'so-colissimo-gross'){
                                    $('#tunnel_achat_coordonnees')[0][4].checked = true;
                                }
								F6.AJAX
										.tunnelAchatPanierCoordonnees($('#tunnel_achat_coordonnees'));
							}

						});

		$('#addshippingaddress,#addbillingaddress').click(function(e) {
			e.preventDefault();
			var trigger = e.currentTarget;
			vHref = trigger.href;
			if ($('#templatePart').length > 0) {
				vHref = vHref + "?isAjax=true&particulier=";
			} else if ($('#templatePro').length > 0) {
				vHref = vHref + "?isAjax=true&professionnel=";
			}

			$.fancybox.open({
                src  : URLS.updatePath( vHref ),
                type : 'ajax',
                opts: {
                    touch: false,
                    momentum: false,
                    smallBtn: false,
                    clickOutside: false,
                    baseTpl : Popup.template(),
                    afterShow: function(instance){ console.log('### D!! :: panier > AJOUTER CETTE ADRESSE');
                        F6.MAIN.initSelectBoxParent();
                        F6.UI.executeCoordonneesPopin(instance, trigger);

                        $('#AnnulerAdressePart').on('click.fancyboxPart', function() {
                            $.fancybox.close(true);
                        });
                    }
                }
            });
		});
	};

	// znouaoui
	F6.UI.executeCoordonneesPopin = function(fancybox, trigger) {

		F6.UI.activeBodyFullJS();
		F6.UI.activeUniform();

		var actionSubmitHandler = function(form) {
			isPro = EBK.config.contextPath == "/professionnel" ? true : false;
			F6.AJAX.formLivraisonFacturation(form, trigger, isPro);
		};

		if ($('#coordonneesParticulier').length > 0) {

			var particuliers_form = F6.VALIDATIONS
					.formCoordonneesDestinataireParticulier();
			particuliers_form.settings.submitHandler = actionSubmitHandler;
		} else if ($('#coordonneesProfessionnelPerso').length > 0) {
			var professionnel_form = F6.VALIDATIONS
					.formCoordonneesDestinataireProfessionnelPerso();
			professionnel_form.settings.submitHandler = actionSubmitHandler;
		}

	};
	// znouaoui
	F6.UI.formLivraisonFacturationCallback = function(data, trigger) {
		var error = false;
		// Mascadia Control !!
		if (data.addressData != null
				&& data.addressData.mascadiaResponse != null
				&& (data.addressData.mascadiaResponse.ligne6Flag || data.addressData.mascadiaResponse.ligne4Flag)) {
			F6.UI.mascadiaError(data.addressData.mascadiaResponse, data.form);
			isMascadiaError = true;
			error = true;
		}

		if (error == false) {
			if (data != null && data.addressData != null
					&& data.addressData !== undefined) {
				var delivery_element = $('.deliveryAddress .detailsAddress');
				var billing_element = $('.billingAddress .detailsAddress');
				if (!data.pro) {
					$('#personalAddressSaved').show();
				}
				if (data.addressData.shippingAddress) {
					F6.UI.displayAddress(delivery_element, data.addressData);
				} else if (data.addressData.billingAddress) {
					F6.UI.displayAddress(billing_element, data.addressData);
				}
			}

			if (data.error != null && data.error != undefined && data.error) {
				var errorLabel = '<label class="error">' + data.message
						+ '</label>';
				if (data.pro) {
					$('#error-coordonnees-pro').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-pro').show();
				} else {
					$('#error-coordonnees-part').html(
							'<ul style="display:block"><li style="display:block">'
									+ errorLabel + '</li><ul>');
					$('#error-coordonnees-part').show();
				}
			}

			// F6.UI.activeUniform();
			$.fancybox.close();
			// F6.UI.activeUniform();
			var selector = 'tunnel_achat_coordonnees_select_delivry_address';
			if ($(trigger).attr('id') == 'addbillingaddress') {
				selector = 'tunnel_achat_coordonnees_select_billing_address';
			}
			var $select = $('#' + selector);
			$select.find('option').removeAttr('selected');
			$select.append('<option selected="selected" value="'
					+ data.addressData.id + '">' + data.addressData.addressName
					+ '</option>');
            if ($.uniform.update) {
               $.uniform.update("#" + selector);
            }
			// Iomari remplacement du $select.change() par la redirection vers
			// coordonnees_ livraison
			var savedAddressNotification = "";
			if (!data.pro) {
				isSavedAddressFromBilInv = "?isSavedAddressFromBilInv=true";
			}
			F6.UI.redirect(EBK.config.contextPath+'/coordonnees_livraison' + isSavedAddressFromBilInv);
		}

		// F6.UI.activeUniform();
	};

	// znouaoui
	F6.UI.displayAddress = function(element, address) {

		var selector = 'tunnel_achat_coordonnees_select_delivry_address';
		if (address.billingAddress)
			selector = 'tunnel_achat_coordonnees_select_billing_address';

		var $select = $('#' + selector);
		$select.find('option').removeAttr('selected');
		$select.find('option[value="' + address.id + '"]').remove();
		$select.append('<option selected="selected" value="' + address.id
				+ '">' + address.addressName + '</option>');
		if ($.uniform.update) {
           $.uniform.update("#" + selector);
        }

		// iomari BTKBACKLOG-1955: Ajout du raison sociale
		// 0 Company Name : • {CompangyName}
		$('.display-address-companyName', element).empty();
		if (address.companyName != null) {
			$('.display-address-companyName', element)
					.text(address.companyName);
		}

		// 1 Livraison : • {Civilite} {Prenom} {Nom}
		$('.display-address-name', element).empty();
		if (address.firstName != null && address.lastName != null) {
			$('.display-address-name', element).text(
					address.title + ' ' + address.firstName + ' '
							+ address.lastName);
		}

		// 2 Livraison : • {Appartement_Etage}
		$('.display-address-appartement', element).empty();
		$('.display-address-appartement', element).text(address.appartment);

		// 3 Livraison : • {Batiment_Immeuble}
		$('.display-address-bulding', element).empty();
		$('.display-address-bulding', element).text(address.building);

		// 4 Livraison : • {No_Libelle_voie}
		$('.display-address', element).empty();
		$('.display-address', element).text(address.streetNumber);

		// 5 Livraison : • {Lieu-dit_BP}
		$('.display-address-pobox', element).empty();
		$('.display-address-pobox', element).text(address.pobox);

		// 6 Livraison : • • {Code_Postal} {Localite}
		$('.display-locality', element).empty();
		$('.display-locality', element).text(
				((address.postalCode == null) ? "" : address.postalCode) + ' '
						+ address.town);

		// iomari BTKBACKLOG-1955: ajout du pays sur l'adresse affichée
		// 7 Livraison : • {Pays}
		$('.display-country', element).empty();
		$('.display-country', element).text(address.country.name);
	};

	// znouaoui
	F6.UI.tunnelAchatPanierCoordonneesCallback = function(datas) {
		var txt = '';
		var delivery_address = datas.delivery_address;
		var billing_address = datas.billing_address;
		var supportedDeliveryModes = datas.supportedDeliveryModes;
		var eligibleDeliveryAddress = datas.eligibleDeliveryAddress;
		var colissimoFormObject = document.forms['coColissimoFormId'];

        // var arrayForm = Object.entries(datas.coColissimoForm).map(([key, value]) => ({key,value}));

				//IE polyfill for Object entries
				function _slicedToArray(arr, i) {
					return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();
				}

				function _nonIterableRest() {
					throw new TypeError("Invalid attempt to destructure non-iterable instance");
				}

				function _iterableToArrayLimit(arr, i) {
					if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === "[object Arguments]")) {
						return; }
					var _arr = [];
					var _n = true;
					var _d = false;
					var _e = undefined;

					try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
						_arr.push(_s.value); if (i && _arr.length === i) break; }
					}

					catch (err) { _d = true; _e = err; }

					finally {

						try { if (!_n && _i["return"] != null)
						_i["return"]();
						}

						finally {
							if (_d)
								throw _e;
						}
					}

						return _arr;
				}

				function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

				var arrayForm = Object.entries(datas.coColissimoForm).map(function (_ref) {
				  var _ref2 = _slicedToArray(_ref, 2),
				      key = _ref2[0],
				      value = _ref2[1];

				  return {
				    key: key,
				    value: value
				  };
				});

				//end poylifill Object entries

        /* BTKTMA-3203 / Sofyane MAKERRI : la fonction Array.map n'est pas supporté par IE remplacer, voici l'alternatif*/
        var arrayForm = [];
        var data = Object.entries(datas.coColissimoForm);
        for (var i = 0; i < data.length; i++) {
            mapped = {
                key: data[i][0],
                value: data[i][1]
                };
             arrayForm.push(mapped);
         }

		var delivery_element = $('.deliveryAddress .detailsAddress');
		var billing_element = $('.billingAddress .detailsAddress');

		if (delivery_address != null) {
			F6.UI.displayAddress(delivery_element, delivery_address);
		}
		if (billing_address != null) {
			F6.UI.displayAddress(billing_element, billing_address);
		}
		if (supportedDeliveryModes != null) {
			$("#ulModeShipping").empty();
			$('.so-colissimo-layer').hide();
			// iomari forcer le mode de livraison par defaut
			var defaultValue;
			if (supportedDeliveryModes.length == 1) {
			    // BTKTMA-920 :  S'il s'agit du mode colissimo, on ne le coche pas par défaut pour que le client puisse accéder au formulaire Colissimo
			    if(supportedDeliveryModes[0].code !== 'so-colissimo-gross'){
			        defaultValue = supportedDeliveryModes[0].code;
			    }
			} else {
				defaultValue = "standard-gross";
			}

			$.each(supportedDeliveryModes,
					function(index, deliveryMode) {

						F6.UI.displaySupportedDeliveryModes(deliveryMode,
								defaultValue);
					});

			F6.UI.onClickCoColissimoIframe();
			$('.type-radio').find('input:radio').off('change.soColissimo').on(
					'change.soColissimo', function() {
						if ($(this).attr('data-show-layer') != undefined) {
							$('.so-colissimo-layer').show();
						} else {
							$('.so-colissimo-layer').hide();
						}
					});

			// Display popin avec message
			if (!eligibleDeliveryAddress) {
				var prompt = true;
				var el_trigger = this;

				txt = '<div class="typo-din title3">Attention</div> La livraison à l’étranger n’est pas disponible pour les clients professionnels.';

				if (prompt) {
					$.prompt(txt, {
						buttons : {
							Ok : true
						},
						callback : function(e, v, m, f) {
							if (v) {
								$(el_trigger).focus();
								$('#successBoxTop').find('a').focus();
							}
						}
					});
				}//
			}
		}

	};

	// znouaoui
	F6.UI.displaySupportedDeliveryModes = function(deliveryMode, defaultValue) {

		var ulBlock = $("#ulModeShipping");
		// alert(deliveryMode.code+' '+ulBlock.html());
		var liElement = $('<li></li>');
		var spanElement = $('<span></span>');
		var labelElement = $('<label></label>');
		var inputElement = $('<input></input>');
		var descriptionElement = $('<p></p>');

		var labelClass;

		liElement.attr('id', deliveryMode.code);
		if (deliveryMode.code.indexOf("standard") >= 0) {
			liElement.addClass('standardM');
			labelClass = "mode-standard";
			inputElement.attr('id',
					'tunnel_achat_coordonnees_mode_livraison_standard');
			labelElement.attr('for',
					'tunnel_achat_coordonnees_mode_livraison_standard');
		} else if (deliveryMode.code.indexOf("colissimo") >= 0) {
			if (deliveryMode.code.indexOf("so-colissimo") >= 0) {
				liElement.addClass('so-colissimo');
				labelClass = "mode-prepaye";
				inputElement.attr('id',
						'tunnel_achat_coordonnees_mode_livraison_prepaye');
				labelElement.attr('for',
						'tunnel_achat_coordonnees_mode_livraison_prepaye');
			} else {
				liElement.addClass('colissimo');
				labelClass = "mode-colissimo";
				inputElement.attr('id',
						'tunnel_achat_coordonnees_mode_livraison_colissimo');
				labelElement.attr('for',
						'tunnel_achat_coordonnees_mode_livraison_colissimo');
			}
		} else if (deliveryMode.code.indexOf("chronopost") >= 0) {
			liElement.addClass('chronopost');
			labelClass = "mode-chronopost";
			inputElement.attr('id',
					'tunnel_achat_coordonnees_mode_livraison_chronopost');
			labelElement.attr('for',
					'tunnel_achat_coordonnees_mode_livraison_chronopost');
		}

		// span
		spanElement.addClass('type');

		// label
		labelElement.addClass(labelClass);
		labelElement.html(deliveryMode.name);
		labelElement
				.append('<span class="info">Frais de port : <span class="price">'
						+ deliveryMode.deliveryCost.formattedValue
						+ '</span></span>');
		// input

		inputElement.attr('name', 'modeLivraison');
		inputElement.attr('type', 'radio');
		inputElement.attr('value', deliveryMode.code);
		if (deliveryMode.code.indexOf(defaultValue) >= 0) {
			inputElement.attr('checked', 'checked');
		}
		if (deliveryMode.code.indexOf("so-colissimo") >= 0) {
			inputElement.attr('data-show-layer', '');
		}

		// description
		descriptionElement.addClass('DetailDeliveryMode');
		descriptionElement.html(deliveryMode.description);
		// Liaison des elements
		spanElement.append(labelElement);
		spanElement.append(inputElement);
		liElement.append(spanElement);
		liElement.append('<br><br><br>');
		liElement.append(descriptionElement);

		ulBlock.append(liElement);
	};

	// coColissimoIframeId
	F6.UI.onClickCoColissimoIframe = function() {
		$('#tunnel_achat_coordonnees_mode_livraison_prepaye').click(function() {
			$('#coColissimoFormId').submit();
		});
	};

	F6.UI.executeMozaikBeauxEvenement = function() {
		btn_close = '<a class="close-popin" href="#" title="'
				+ Globalize.localize("Fermer la fenêtre", "fr_FR")
				+ '"><img src="/_ui/eboutique/images/media/beaux_eve/close.jpg" width="13" height="13" alt="'
				+ Globalize.localize("Aller au contenu suivant", "fr_FR")
				+ '"></a>';
		$('.mozaik-description').append(btn_close);

		$('.mozaik-description').each(function() {
			content_inner = $('<div></div>');
			content_inner.addClass('inner');
			content_inner.html($(this).html())
			$(this).html('');
			$(this).append(content_inner);
		});

		// ajustement en fonction du css par rapport à la créa
		var ajust_top = 61;
		var ajust_left = 40;
		var num = 0;

		var top_right_corner = 0;
		var bottom_left_corner = 0;
		var extrem_bottom = 0;
		var extrem_right = 0;

		var slot_counter_zindex = 1000;
		var vignet_counter_zindex = 2000;
		var desc_counter_zindex = 3000;

		$('.slot')
				.each(
						function() {
							// positionnemnetn des vignettes
							pos_top = $(this).attr('data-top') * 1 + ajust_top
									+ 'px';
							pos_left = $(this).attr('data-left') * 1
									+ ajust_left + 'px';
							$(this).css({
								'top' : pos_top,
								'left' : pos_left
							});

							// déplacement des boites dans la structure HTML
							$(this).css('zIndex', slot_counter_zindex);
							el_a = $('a', this);
							el_a.css('zIndex', vignet_counter_zindex);
							$('img', el_a).css('zIndex',
									vignet_counter_zindex - 5);
							idx = $(el_a).attr('href');
							$(idx).css('zIndex', desc_counter_zindex)
									.insertAfter(el_a);

							slot_counter_zindex += 10;
							vignet_counter_zindex += 10;
							desc_counter_zindex += 10;

							// permet de voir une image ajouter
							if ($(this).attr('data-top') == '0'
									&& $(this).attr('data-left') == '0') {
								if (num > 0)
									$(this).hide();
								num++;
							}

							// calcul de la position haut droite
							if ($(this).hasClass('top-right-hand')) {
								top_right_corner = $('img', this).offset();
								extrem_right = top_right_corner.left
										+ $('img', this).width();
							}

							// calcul de la position bas gauche
							if ($(this).hasClass('bottom-left-hand')) {
								bottom_left_corner = $('img', this).offset();
								extrem_bottom = bottom_left_corner.top
										+ $('img', this).height();
							}

							// trigger sur les images dans le menu
							$('a', this)
									.bind(
											'click',
											function(e) {
												F6.stop(e);

												img_el = $('img', this);
												position = img_el.offset();
												var idx = $(this).attr('href');
												var box = $(idx);

												dim_w = box.width();
												dim_h = box.height();

												// mozaik_description_left_pos =
												// position.left -
												// bottom_left_corner.left +
												// ajust_left;
												// mozaik_description_top_pos =
												// position.top -
												// top_right_corner.top +
												// ajust_top;
												mozaik_description_left_pos = 0;
												mozaik_description_top_pos = 0;

												if ($('.descrip-active').length > 0) {
													var el_parent_li = $(
															'.descrip-active')
															.parent();
													$('.descrip-active')
															.fadeOut(200);
													if (typeof $(el_parent_li)
															.attr('data-zindex') !== 'undefined'
															&& $(el_parent_li)
																	.attr(
																			'data-zindex').length)
														$(el_parent_li)
																.css(
																		'zIndex',
																		$(
																				el_parent_li)
																				.attr(
																						'data-zindex'));
												}
												box.addClass('descrip-active');

												// si la boite sort à droite
												if (position.left + dim_w > extrem_right) {
													// mozaik_description_left_pos
													// = position.left - dim_w +
													// ajust_left -
													// bottom_left_corner.left +
													// img_el.width();
													mozaik_description_left_pos = img_el
															.width()
															- dim_w;
												}
												// si la boite sort en bas
												if (position.top + dim_h > extrem_bottom) {
													// mozaik_description_top_pos
													// = position.top -
													// top_right_corner.top +
													// ajust_top - dim_h +
													// img_el.height()
													mozaik_description_top_pos = img_el
															.height()
															- dim_h;
												}

												$('.close-popin', box)
														.bind(
																'click',
																{
																	'el_origin' : this
																},
																function(e) {
																	var el_parent = $(
																			e.data.el_origin)
																			.parent();

																	$(box)
																			.fadeOut(
																					200,
																					function() {
																						$(
																								el_parent)
																								.css(
																										'zIndex',
																										$(
																												el_parent)
																												.attr(
																														'data-zindex'));
																						$(
																								el_parent)
																								.next()
																								.find(
																										'a')
																								.eq(
																										0)
																								.focus();
																					});
																})

												// gestion des zIndex car la
												// description hérite du z-index
												// du LI (parent)
												z_index = $(this).parent().css(
														'zIndex');
												$(this).parent().attr(
														'data-zindex', z_index);
												$(this).parent().css('zIndex',
														5000);

												$('.mozaik-description')
														.fadeOut(200)
												box
														.css(
																{
																	'top' : mozaik_description_top_pos,
																	'left' : mozaik_description_left_pos
																}).addClass(
																'opened')
														.fadeIn(200);
											});
							$(this).hide();
						})

		$('.mozaik-description .close-popin').bind('click', function(e) {
			F6.stop(e);

		});
		num = 200;
		$('.slot').delay(300).each(function() {
			$(this).fadeIn(num)
			num += 100;
		})

	};
	F6.UI.executePopinMigrationPhilaposte = function() {
		$("#popup-migration-philaposte").fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### E');
                $('#fancybox-close', $('.t-catalogue')).off('click.fancyboxPart').on('click.fancyboxPart', function() {
                    $.fancybox.close(true);
                });
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()

            }
        });
	};
	F6.UI.executePopinTransfertPhilaposte = function() {
		$("#popup-transfert-philaposte").fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type : 'ajax',
            afterShow : function(instance) { console.log('### F');
                $('#fancybox-close', $('.t-catalogue')).off('click.fancyboxPart').on('click.fancyboxPart', function() {
                    $.fancybox.close(true);
                });
            },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template()
            }
        });
	};
	F6.UI.executePopinMigrationColissimo = function() {
		$("#popup-migration-colissimo").fancybox({
           src  : URLS.updatePath( $(this).attr('href') ),
           type : 'ajax',
            afterShow : function(instance) { console.log('### G');
                $('#fancybox-close', $('.t-catalogue')).off('click.fancyboxPart').on('click.fancyboxPart', function() {
                    $.fancybox.close(true);
                });
            },
           opts : {
               touch: false,
               momentum: false,
               smallBtn: false,
               clickOutside: false,
               baseTpl : Popup.template()
           }
        });
	};
	F6.UI.executePopinTransfertColissimo = function() {
		$("#popup-transfert-colissimo").fancybox({
           src  : URLS.updatePath( $(this).attr('href') ),
           type : 'ajax',
            afterShow : function(instance) { console.log('### H');
                $('#fancybox-close', $('.t-catalogue')).off('click.fancyboxPart').on('click.fancyboxPart', function() {
                    $.fancybox.close(true);
                });
            },
           opts : {
               touch: false,
               momentum: false,
               smallBtn: false,
               clickOutside: false,
               baseTpl : Popup.template()

           }
        });
	};
	F6.UI.executeCatalogueFicheproduit = function() {
		$('.ebkBtnBuyProduct').on(
				'click',
				function(e) {
					e.preventDefault();
					F6.AJAX.addToCart(
							$(e.currentTarget).parent().parent().parent().find(
									'input[name=productCodePost]').val(),
							parseInt($(e.currentTarget).parent().parent()
									.parent().find('.digits').val()));
				});



        $("#warning-me-date").click(function(event) {

            $.fancybox.open({
                src: URLS.updatePath($(this).data("href")),
                type: 'ajax',
                afterShow: function (instance) {
                    console.log('### I');
                    $('#fancybox-close', $('.t-catalogue')).off('click.fancyboxPart').on('click.fancyboxPart', function () {
                        $.fancybox.close(true);
                    });
                },
                opts: {
                    touch: false,
                    momentum: false,
                    smallBtn: false,
                    clickOutside: false,
                    baseTpl: Popup.template()

                }
            });
        });

		$("#knowMore").fancybox({
            src  : URLS.updatePath( $(this).attr('href') ),
            type: 'image',
            touch: false,
            momentum: false,
            smallBtn: false,
            clickOutside: "close",
            baseTpl : Popup.templateImage(),
            buttons: [
                "close"
            ],
            btnTpl: {
                close:
					'<button data-fancybox-close class="fancybox-close-small" title="{{CLOSE}}"></button>'
            },
            afterShow: function(){
                $('.fancybox-image-wrap').removeAttr('style');
            }
        });

		$('#a-add-favorite').click(function(e) {
			e.preventDefault();
			var code = $(this).attr("dir");
			F6.AJAX.addProductToFavoris(code);
		});

		$('.image-container a, a.zoom-icon').fancybox({
           src  : URLS.updatePath( $(this).attr('href') ),
           type : 'ajax',
            afterShow : function(instance) { console.log('### J');
                $('.fancybox-container').append('<div class="close"><a href="#" class="btn-cancel" title="Fermer l\'aperçu de l\'image Carnet de 12 timbres Marianne Rouge"><span>Fermer</span></a><div>');
                $('.fancybox-container .close a').bind('click', function(e) {
                    F6.stop(e);
                    $.fancybox.close();
                });
                $('.fancybox-container .close a').focus();
            },
        	opts : {
        		touch: false,
        		momentum: false,
        		smallBtn: false,
        		clickOutside: false,
        		baseTpl : Popup.template()

        	}
        });
		$('a.zoom-icon').bind('click', function() {
			splitString();
		});

		splitString = function() {
			var separator = ':';
			var titlestring = $('a.zoom-icon').find('img').attr('alt');
			var trimmed = titlestring.split(separator);

			$('.fancybox-slide').find('a.btn-cancel').attr('title',
					'Fermer l\'aperçu de l\'image : ' + trimmed[1]);
		}

	};

	/*
	 * ---------------------------------------------------------- COLLECTIONNEUR
	 * BEAUX TIMBRES ----------------------------------------------------------
	 */

	/** ****************** ACCORDION FILTRES BEAUX TIMBRES */
	F6.UI.filtres = function() {

		var label_open_i18n = Globalize.localize("Masquer les filtres sur",
				"fr_FR");
		var label_close_i18n = Globalize.localize("Afficher les filtres sur",
				"fr_FR");

		$('#filtres').dcAccordion({
			eventType : 'click',
			autoExpand : true,// If set to "true" all sub-menus of parent tags
			// with class 'classExpand' will expand on page
			// load
			classExpand : 'expand',
			autoClose : false,
			saveState : true,
			disableLink : true,
			speed : 'fast',
			classActive : 'open',
			showCount : false,
			label_open : label_open_i18n,
			label_close : label_close_i18n
		});
	};

	F6.UI.executeCollectionneurFiltreBeauxTimbres = function() {
		F6.UI.activeCollectionneurFiltreBeauxTimbres();
	};

	F6.UI.activeCollectionneurFiltreBeauxTimbres = function() {
		$('#collectionneur_timbres_filtres input[type="checkbox"]').bind(
				'change', F6.UI.sendCollectionneurFiltreBeauxTimbres);
		$('#collectionneur_timbres_ordre_tri').bind('change',
				F6.UI.sendCollectionneurFiltreBeauxTimbres);
	};

	F6.UI.sendCollectionneurFiltreBeauxTimbres = function(e) {
		var checked_element = $(this).attr('id');

		$('#collectionneur_timbres_filtres')
				.submit(
						function(e) {
							F6.stop(e);

							var orderValue = $(
									"#collectionneur_timbres_ordre_tri").val();
							var filter_saved = ''; // les filtres sauvegarder
							// dans l'URL
							var data_to_send = ''; // chaine sérialisée envoyée
							// en post
							var url_to = $('#collectionneur_timbres_filtres')
									.attr('action'); // url d'envoi pour
							// traitement
							var checked_list = $(':checked', this); // récupération
							// des
							// champs
							// cochés

							form = $(this).serializeArray();
							var hash = decodeURIComponent(window.location.hash);
							if (!window.location.hash.length
									|| hash.indexOf('=') < 0) {
								data_to_send = form;
							} else {
								filter_saved = hash.replace('#', ''); // récupération
								// des
								// champs
								// de
								// filtres
								// depuis
								// l'url
								if (!filter_saved
										.match('collectionneur_timbres'))
									filter_saved = $(
											'#collectionneur_timbres_ilter_save')
											.val();
								var filter_saved_array = []

								temp = filter_saved.split('&');
								reg = new RegExp("%5B([a-z_]+)%5D");
								for (index in temp) {
									raw_field = temp[index];

									submited = raw_field.split('=');

									if (submited.length == 2) {
										field_full_name = submited[0];
										field_value = submited[1];
										field_name_reg = field_full_name
												.match(reg);
										field_name = '';
										if (field_name_reg) {
											field_name = field_name_reg[1]
										}
										reg = new RegExp("%5B", "g");
										field_format = field_full_name.replace(
												reg, '[');
										reg = new RegExp("%5D", "g");
										field_format = field_format.replace(
												reg, ']');

										if (typeof field_format !== 'undefined'
												&& field_format != '') {
											filter_saved_array.push({
												name : field_format,
												value : field_value.replace(
														/\+/gi, ' ')
											})
										}
									}
								}

								/*
								 * ----------------------------------------------------------------------------------
								 * Nettoyage des filtres : - les filtres
								 * sélectionnés sont postés à chaque action sur
								 * une checkboc - le select du tri est posté à
								 * chaque submit => si le champ posté existe
								 * dans la sauvegarde en URL alors celui posté
								 * ecrase celui sauvegardé (ce qui permet de
								 * changer l'ordre de tri) sinon le champ est
								 * ajouté à la sauvegarde
								 *
								 * ----------------------------------------------------------------------------------
								 */

								var submited_field = '';
								var key_to_delete = null;
								var must_delete = false;
								var reset_saved_fields_id = [];
								var reset_saved_fields = [];
								for (key in form) {
									submited_field = '';
									filter_field = form[key];
									submited_field = filter_field.name;

									_
											.each(
													filter_saved_array,
													function(value_saved,
															key_saved) {
														if (value_saved.name == submited_field) {
															reset_saved_fields_id
																	.push(key_saved);
														}
													});

								}
								;

								for (idx in reset_saved_fields_id) {
									filter_saved_array[reset_saved_fields_id[idx]] = null;
								}

								// on ne garde que les objet différent de null
								_.each(filter_saved_array, function(
										value_saved, key_saved) {
									if (value_saved) {
										reset_saved_fields.push(value_saved)
									}
								})

								// comparer ce qui est posté avec ce qui est
								// dans l'url
								data_to_send = _
										.union(form, reset_saved_fields);

							}
							window.location.hash = encodeURIComponent($
									.param(data_to_send)); // ajout du hash :
							// serialize +
							// encodage pour URI
							$('#collectionneur_timbres_ilter_save').val(
									$.param(data_to_send));

							$
									.ajax({
										type : 'POST',
										url : url_to,
										data : data_to_send,
										dataType : 'html',
										success : function(message) {
											$('.beaux-timbres')
													.html(
															$('.beaux-timbres',
																	message)
																	.html());
											$(
													"#collectionneur_timbres_ordre_tri")
													.val(orderValue);
											F6.UI.activeUniform();
											F6.UI.filtres();
											F6.UI.executeProductPush();
											// accordion
											$(checked_list)
													.each(
															function() {
																$(
																		'#collectionneur_timbres_filtres #'
																				+ $(
																						this)
																						.attr(
																								'id'))
																		.attr(
																				'checked',
																				'checked');
															});

											$('#' + checked_element).focus();
											F6.UI
													.activeCollectionneurFiltreBeauxTimbres();
										}
									})
						}).submit();

	};

	F6.UI.activeSelectTri = function() {
		$('#timbre-ordre select').bind('change', function() {
			$('#timbre-ordre').trigger('submit');
		});
	};

}(jQuery, jsface));
/*
 * end Closure for namespace safety do not place jquery code below, due to
 * jquery namespace safety
 */

// mkaabi for /tags/*/tableauRetour.tag
function retourEnLigneValidation() {
	var arrayLignes = document.getElementById("tableProduitItemsReturn").rows;
	var longueur = arrayLignes.length;// on peut donc appliquer la propriété
	// length
	var errorMessage = "";
	var anyChecked = 0;
	for (var i = 0; i < longueur - 1; i++)// on peut directement définir la
	// variable i dans la boucle
	{
		var checkbox = document.getElementById("entriesNumbers[" + i + "]");
		if (checkbox != null && checkbox.checked == true) {
			if (document.getElementById("returnEntries[" + i
					+ "].returnedQuantity").value == '0') {
				errorMessage += "La sélection d'une quantité à retourner est obligatoire. <br> ";
			}
			if (document.getElementById("returnEntries[" + i
					+ "].returnReasonLabel").value == '0') {
				errorMessage += "La sélection d'un motif de retour est obligatoire. <br> ";
			}
			if (document.getElementById("returnEntries[" + i + "].notes").value == '') {
				errorMessage += "La saisie d’une remarque est obligatoire. <br> ";
			}
		}
		if (checkbox != null && checkbox.checked == false) {
			anyChecked += 1;
		}
		if (anyChecked == (longueur - 1)) {
			errorMessage = "​La sélection d'un produit est obligatoire pour faire une demande de retour.";
		}
	}
	if (errorMessage == "") {
		document.getElementById('retourEnLigne').submit();
	} else {
		document.getElementById('targetDiv').innerHTML = "";
		document.getElementById('targetDiv').innerHTML = errorMessage;
	}
}

// recommander produit physique
$(".panier .btn-basket").on(
		"click",
		function(e) {
			var productCodePost = $(e.currentTarget).parent().find(
					'input[type=hidden]:eq(0)').val();
			var qty = $(e.currentTarget).parent().find(
					'input[type=hidden]:eq(1)').val();
			e.preventDefault();
			F6.AJAX.addToCart(productCodePost, qty);
		});
// recommander un mtam
$(".mtam .btn-basket").on(
		"click",
		function(e) {
			var productCodePost = $(e.currentTarget).parent().find(
					'input[type=hidden]:eq(0)').val();
			var orderCode = $(e.currentTarget).parent().find(
					'input[type=hidden]:eq(1)').val();
			var qty = $(e.currentTarget).parent().find(
					'input[type=hidden]:eq(2)').val();
			e.preventDefault();
			F6.AJAX.recommanderMtam(productCodePost, orderCode, qty);
		});
// tout recommander
$(".recommandAll .btn-basket").on(
		"click",
		function(e) {
			e.preventDefault();
			var commandId = $(e.currentTarget).parent().find(
					'input[type=hidden]:eq(0)').val();
			F6.AJAX.recommandAll(commandId);
		});

    // mettre les selects du tableau retour en ligne au valeurs par défaut
    $("#button-reset-retour").on(
            "click",
            function(e) {
                var arrayLignes = document
                        .getElementById("tableProduitItemsReturn").rows;
                var longueur = arrayLignes.length;
                for (var i = 0; i < longueur - 1; i++) {
                    // var valueOf =
                    // document.getElementById("returnEntries["+i+"].returnedQuantity").innerHTML='Quantité';
                    var maxRetournable = document.getElementById("returnEntries["
                            + i + "].returnedQuantity").options[0].value;
                    $("#quantityDiv_" + i + " span").text(maxRetournable);
                    $("#motifDiv span").text('');
                }
            });

    // function showAdressBlockIfThereIsBindingError(){
    // var bindingErrorUL = document.getElementById("errorBindingUL");
    // if(bindingErrorUL != null && bindingErrorUL.children.length>0){
    // document.getElementById("block-address-form").style.display="block";
    // }
    // }

    $('input#AnnulerAdressePart').on("click", function(e) {
        if ($.uniform.update) {
            $.uniform.update("#tunnel_achat_coordonnees_select_delivry_address");
            $.uniform.update("#tunnel_achat_coordonnees_select_billing_address");
        }
        $.fancybox.close();
        // QC 3604
        $('div.selector').eq(1).find('span').remove()
        var cnt = $('div.selector').eq(1).contents();
        $('div.selector').eq(1).replaceWith(cnt);
        $('div.selector').eq(2).find('span').remove()
        var cn = $('div.selector').eq(2).contents();
        $('div.selector').eq(2).replaceWith(cn);
        F6.UI.activeUniform();
    });
//});

F6.UI.callbackCommandesUpdateStatut = function(data) {
	var table = "";
	if (data.listLsInfo.length == 0) {
		$('#' + data.orderCode + 'cSuiviServerError').removeClass(
				"noneDisplayToutDeatil");
		$('#' + data.orderCode + 'cSuiviServerError').addClass(
				"displayToutDeatil");
		$('#' + data.orderCode + 'ProgressBar')
				.removeClass("displayToutDeatil");
		$('#' + data.orderCode + 'ProgressBar').addClass(
				"noneDisplayToutDeatil");
		return;
	}
	for (i = 0; i < data.listLsInfo.length; i++) {
		table = table
				+ '<tr> '
				+ '<td headers="detailCmd1-c1" class="detailCol-1">'
				+ data.listLsInfo[i].numEtiquette
				+ '</td> '
				+ '<td headers="detailCmd1-c2" class="detailCol-2">'
				+ '<a target="_blank" href="'
				+ data.url
				+ '/index?id='
				+ data.listLsInfo[i].numSuivi
				+ '">'
				+ data.listLsInfo[i].numSuivi
				+ '</a>'
				+ '</td> '
				+ '<td headers="detailCmd1-c3" class="detailCol-3">'
				+ data.listLsInfo[i].date
				+ '</td> '
				+ '<td headers="detailCmd1-c4" class="detailCol-4" style="text-align:left">'
				+ data.listLsInfo[i].satut + '</td> ' + '</tr> ';
	}
	$('#' + data.orderCode + 'ProgressBar').removeClass("displayToutDeatil");
	$('#' + data.orderCode + 'ProgressBar').addClass("noneDisplayToutDeatil");
	$("#" + data.orderCode + " tbody").html(table);
}

$(document).ready(function() {
    $('#step2GetPdfVisualisation').on("click", function(e) {
        $('#impression-options').append('<input type="hidden" name="generer"/>');
        $("#impression-options").submit();
    });
    $('#step2GetPdfVisualisationlrel').on("click",function(e) {
        $('#impression-options-lrel').append('<input type="hidden" name="generer"/>');
        $("#impression-options-lrel").submit();
    });
});

F6.UI.LELUpdateDestinationOption = function(data) {
	if (data != undefined) {
		var selectedCountry = $("[name=destinationCountry]").val();
		var defaultCoubtry = true;
		$('#formDestination').empty();
		$('#formDestination').html("");
		for (i = 0; i < data.length; i++) {
			if (data[i].isocode == selectedCountry) {
				$('#formDestination').append(
						'<option value="' + data[i].isocode
								+ '" selected="selected">' + data[i].name
								+ '</option>');
				defaultCoubtry = false;
			} else {
				$('#formDestination').append(
						'<option value="' + data[i].isocode + '">'
								+ data[i].name + '</option>');
			}
		}
		if (defaultCoubtry === true) {
			$('#formDestination').parent().find('span').text('France');
		}
	}
}

F6.UI.deleteColisEnregistres = function(data, error) {
	if (error != null) {
		$("[id^=errorDeletecolissimo]").text(error);
	} else {
		// affichage popin de validation
		$.get("/delete-popin-validation", {
			"listColisSelected" : data.listColisEnregistresSelectedToDelete,
			"nbrColisSelected" : data.nbrColisToDelete
		},
				function(popupHtml) {

					$("#validationSuppressionPopin").html("");
					$("#validationSuppressionPopin").html(popupHtml);
					validationSuppressionPopin();
				});
	}
}
$(document).ready(function() {

	let removeButtonsColis = document.querySelectorAll('.blockrecap .removeColisRecap')
	console.log(removeButtonsColis);

	for (var i = 0; i < removeButtonsColis.length; i++) {
		removeButtonsColis[i].addEventListener('click', removeMeThat)
	}

	function removeMeThat(){
        var currentColisFavoris = $(this).closest(".blockdetailrecap"),
            colisSelectedId = currentColisFavoris.data("colis-favoris-id"),
            popinContent = $('#delete-confirmation-popin-template'),
            popinColisToDelete = popinContent.find('[data-confirmation-link]');

        //prepare popin
        popinColisToDelete.attr("href", popinColisToDelete.attr("href") + colisSelectedId);


        //show popin
        $.fancybox.open({
            //src  : '#delete-confirmation-popin-template',
            src  : popinContent[0].innerHTML,
            type : 'html',
            // afterShow : function(instance, current) { console.log('### K');
            //     console.log('TODO : sur opts');
            //     $('.fancybox-slide').unbind('mousewheel.fb');
            //     $("#fancybox-content .blockPopin form label:first").focus();
            //     F6.UI.executePopinLinks(instance);
            //     F6.UI.addessBookSelectList();
            // },
            opts : {
                touch: false,
                momentum: false,
                smallBtn: false,
                clickOutside: false,
                baseTpl : Popup.template(),
								afterClose: function() {
									console.log('popin closed');
									popinColisToDelete.attr("href", "/supprimer-colis-enregistres/")
								}
            }
        });


        //F6.AJAX.deleteColis(listcolisSelected, colisSelected.length);

    };
});

$(document).ready(function() {
					var $checkboxes = $('td#checkboxColisEnregistres input[type="checkbox"]');
					var valeurs = [];
					$checkboxes.change(function() {
								var totalCheckboxes = $('input:checkbox').length;
								var checkboxes;
								for (i = 0; i < totalCheckboxes; i++) {
									var $nameCheckbox = $('#colisNames' + i);
									var $nameColis = $nameCheckbox.val().split("__PK____NAME__")[1];
									if ($nameCheckbox.is(':checked')) {
										var found = $.inArray($nameColis,
												valeurs) > -1;
										if (found == false) {
											valeurs.push($nameColis);
										}
									} else {
										var index = valeurs.indexOf($nameColis);
										if (index > -1) {
											valeurs.splice(index, 1);
										}
									}
								}
								$("#deleteSelectedColis").attr(
										"title",
										'Supprimer le(s) colis enregistré(s) '
												+ valeurs);
							});
				});
// Afficher popin heure limite commande pour les vigntte
function executePopupUpdateVignetteDateBAL() {
	$.ajax({
		type : "GET",
		cache : false,
		url : EBK.config.contextPath+"/pre-payment/changementDateVignetteDepotBAL",
		data : null,
		success : function(data) {
			Popup.popinHTML(data);
		}

	});
	return false;
};
// Afficher popin heure limite commande pour les colis
function executePopupUpdateDateBAL() {
	$.ajax({
		type : "GET",
		cache : false,
		url : EBK.config.contextPath+"/pre-payment/changementDateDepotBAL",
		data : null,
		success : function(data) {
			Popup.popinHTML(data);
		}

	});
	return false;
};

function aelSendForm() {
	traitEmptyValue();
	$.ajax({
		type : "GET",
		cache : false,
		url : F6.UTILS.getColissimoLink()
				+ "/votre-colis/enregistrer-colis/authentification",
		data : $('#dlbi-colis').serialize(),
		success : function(data) {
			document.location.href = EBK.config.contextPath+'/authentification';
		}
	});
	return false;
};

function traitEmptyValue() {
	$.each($('#blocFormaliteDouaniere').find('.formalite-contenu-colis'),
			function(index) {
				var qt = $(this).find(':input.quantite')[0].value;
				var valUnit = $(this).find(':input.valeur-unitaire')[0].value;
				var poids = $(this).find(':input.poids-net-unitaire')[0].value;
				var desc = $(this).find(':input.desc-article')[0].value;
				if ((qt == null || qt == "")
						&& (valUnit == null || valUnit == "")
						&& (poids == null || poids == "")
						&& (desc == null || desc == "")) {
					$(this).remove();
				} else {
					if (qt == null || qt == "") {
						$(this).find(':input.quantite')[0].value = "0";
					}
					if (valUnit == null || valUnit == "") {
						$(this).find(':input.valeur-unitaire')[0].value = "0";
					}
				}
			});
};
// Demander Remboursement Colis V4.0
F6.UI.executePopinDemandesRemboursementColis = function() {
	F6.UI.sendJsActive();
	$(".demandesRemboursementColis").fancybox({
        src  : URLS.updatePath( $(this).attr('href') ),
        type : 'ajax',
        afterShow : function(instance) { console.log('### M');
            $('#fancybox-close', $('.t-catalogue')).off('click.fancyboxPart').on('click.fancyboxPart', function() {
                $.fancybox.close(true);
            });
        },
        opts : {
             touch: false,
             momentum: false,
             smallBtn: false,
             clickOutside: false,
             baseTpl : Popup.template()


        }
    });
};
F6.UI.executePopinDemandesEnregistrementColis = function() {
	F6.UI.sendJsActive();
	$("#popupEnregistrerColis").fancybox({
        src  : URLS.updatePath( $(this).attr('href') ),
        type : 'ajax',
        afterShow : function(instance) { console.log('### N');
            $('#fancybox-close', $('.t-catalogue')).off('click.fancyboxPart').on('click.fancyboxPart', function() {
                $.fancybox.close(true);
            });
        },
        opts : {
            touch: false,
            momentum: false,
            smallBtn: false,
            clickOutside: false,
            baseTpl : Popup.template()

        }
    });
};

// Demander suivre Remboursement Colis V4.0
/** Add parameter to all url containing 'sendJsActive' attribute */
F6.UI.sendJsActiveBis = function() {
	var _href = $(".sendJsActiveBis").attr("href");
	if (_href != null && _href.indexOf('jsActive') < 0) {
		var jsActive_href = "?jsActive=true"
		if (_href.indexOf('recap') >= 0) {
			var jsActive_href = "&jsActive=true"
		}
		$('.sendJsActiveBis').attr("href", _href + jsActive_href);
	}
};
F6.UI.executePopinSuivreDemandesRemboursementColis = function() {
	F6.UI.sendJsActiveBis();

	$(".suivreDemandesRemboursementColis").fancybox({
        src  : URLS.updatePath( $(this).attr('href') ),
        type : 'ajax',
        afterShow : function(instance) { console.log('### O');
            $('#fancybox-close', $('.t-catalogue')).off('click.fancyboxPart').on('click.fancyboxPart', function() {
                $.fancybox.close(true);
            });
        },
        opts : {
              touch: false,
              momentum: false,
              smallBtn: false,
              clickOutside: false,
              baseTpl : Popup.template()

        }
    });
};

// BBaaboa QC 5241
F6.UI.CalculusFormalitesHandel = function() {
	$('.valeur-unitaire')
			.keypress(
					function(event) {
						if ((event.which != 44 || $(this).val().indexOf(',') != -1)
								&& (event.which != 8
										&& (event.which < 48 || event.which > 57) && (event.which != 0))) {
							event.preventDefault();
						}
						if ((event.which) != 8 && (event.which != 0)) {
							if ($(this).val().indexOf(',') > -1) {
								if ((($(this).val().indexOf(',') <= 1) && ($(
										this).val().length >= 4))
										|| (($(this).val().indexOf(',') == 2) && ($(
												this).val().length >= 5))
										|| (($(this).val().indexOf(',') == 3) && ($(
												this).val().length >= 6))
										|| (($(this).val().indexOf(',') == 4) && ($(
												this).val().length >= 7))) {
									event.preventDefault();
									return false;
								}
							}
						}
						// var strLength= $(this).val().length * 2;
						// $(this).focus();
						// $(this)[0].setSelectionRange(strLength, strLength);

					});

	$('.valeur-unitaire').keyup(function(eve) {
		if ($(this).val().indexOf(',') == 0) {
			$(this).val($(this).val().substring(1));
		}
	});

	$('.valeur-unitaire').blur(function(eve) {
		if ($(this).val() == '') {
			$(this).val(0);
		}
		$(this).val(parseFloat($(this).val().toString().replace(',', '.')));
		if ($(this).val() == 0) {
			$(this).val('');
		}
		// $(this).val($(this).val().replace('.',','));

	});

	$('.weight-object').keypress(
			function(event) {
				var val = $(this).val();
				// Verifier si c'est un chiffre(accepter supprimer et vergule)
				if (event.which != 44 && event.which != 46
						&& (48 > event.which || event.which > 57)
						&& event.which != 8 && event.which != 0
						&& event.which != 0 && event.which != 37
						&& event.which != 39) {
					event.preventDefault();
					return false;
				}
				// Une seule virgule ou point
				if (((event.which == 46 || event.which == 44) && ((val
						.indexOf('.') != -1) || val.indexOf(',') != -1))) {
					event.preventDefault();
					return false;
				}
			});

	$('.weight-object').keyup(
			function(event) {
				var val = $(this).val();
				var isIE = /* @cc_on!@ */false || !!document.documentMode;
				var result;
				// ne pas lancer le traitemnt pour fleches et retour arrier et
				// suppr
				if (event.which != 0 && event.which != 37 && event.which != 39
						&& event.which != 46 && event.which != 8) {
					if (val.length > 2) {
						if (!isIE) {
							val = val.replace(',', '.');
							if ((val.length > 2 && val.indexOf('.') == -1)
									|| val.indexOf('.') > 2) {
								result = getSubstring(val, 2);
							} else if (val.indexOf('.') == 0) {
								result = getSubstring('0' + val, 3);
							} else if (val.indexOf('.') == 1) {
								result = getSubstring(val, 4);
							} else if (val.indexOf('.') == 2) {
								result = getSubstring(val, 5);
							}
							$(this).val(result.replace('.', ','));
						} else {
							val = val.replace(',', '.');
							$(this).val(val);
							if ((val.indexOf('.') == -1)
									|| val.indexOf('.') > 2) {
								result = getSubstring(val, 2);
							} else if (val.indexOf('.') == 0) {
								result = getSubstring('0' + val, 3);
							} else if (val.indexOf('.') == 1) {
								result = getSubstring(val, 4);
							}
							$(this).val(result.replace('.', ','));
						}
					}
				}
			});

	$('.numero-tarifaire').keypress(
			function(event) {
				var val = $(this).val();
				// Verifier si c'est un chiffre
				if ((48 > event.which || event.which > 57) && event.which != 8
						&& event.which != 0) {
					event.preventDefault();
					return false;
				}

			});
};

F6.UI.extractDiscountMsg = function(reduc_msg_discount) {
	var firstIndex = reduc_msg_discount.indexOf("(");
	var secondIndex = reduc_msg_discount.indexOf(")");
	var currencyIndex = reduc_msg_discount.indexOf("€");
	if (currencyIndex >= 0) {
		return reduc_msg_discount.substr(currencyIndex + 1,
				reduc_msg_discount.length + 1);
	} else if (firstIndex >= 0 && secondIndex >= 0) {
		return "<br>" + reduc_msg_discount.substr(firstIndex, secondIndex);
	} else
		return "";

}

F6.ProcessCancelBAL = function(entryPk) {

	var checkedRadio = $("input[name=annulationDepotVrel]:checked");
	if (checkedRadio.length > 0 && checkedRadio.attr('id') == "annuldepotr0") {
		$("#demandesAnnulationDepot").addClass("disabledRefund");
		//$.fancybox.showActivity()
		$.ajax({
			type : "POST",
			cache : false,
			url : "/vrel/annuler-depot-bal?entryPk=" + entryPk,
			success : function(data, textStatus, jqXHR) {
				var prestationResponse = data.indexOf("success");
				if (prestationResponse >= 0) {
					location.reload();
					$.fancybox.close();
				} else {
					Popup.popinHTML(data);
				}

			}
		});
	} else if (checkedRadio.length > 0) {
		$.fancybox.close();
	} else {
		var siPrestaError = document.getElementById("errorAnnulationKo");
		if (siPrestaError != undefined) {
			siPrestaError.style.display = 'none';
		}
		document.getElementById("errorUncheckedRadio").style.display = 'block';
	}

}

// envois donne du questionaire ajax
$(document)
		.ready(
				function() {
					$(
							'input[type=radio][name=labanquepostale], input[type=radio][name=lapostemobile]')
							.change(
									function() {
										var lapostemobile = $(
												'input[name=lapostemobile]:checked')
												.val();
										var labanquepostale = $(
												'input[name=labanquepostale]:checked')
												.val();
										if (lapostemobile != null
												&& labanquepostale != null) {
											F6.AJAX.QuestionnaireInfoAjax();
											$("#questions-dashboard").hide();
											$("#questions-dashboard-response")
													.removeAttr("style");
										}
									});
				});

$(document).ready(function() {
	$('#questions-dashboard-close').on("click", function(e) {
		F6.AJAX.QuestionnaireInfoAjax();
		$('#questions-dashboard').delay(3000).fadeOut('slow');
		$("#questions-dashboard").hide();
	});
	if ($('#service_STICKER_SUIVI_MTEL').hasClass('stickerSuiviMtelPanier')) {
		$(".stickerSuiviMtelPanier").parent().prev().addClass("mtelAddSuivi")
	}
});

$(document).ready(function() {
	$('#questions-dashboard-close-response').on("click", function(e) {
		$("#questions-dashboard-response").hide();
	});
});

$(document).ready(function() {
	$('.demoColissimoMargin h2').css('margin-bottom', '2%');
});

$(document).ready(function() {
	if ($('#lrel_etape4_ajouter_adresse').is(':visible')) {
		document.location.href = "#lrel_etape4_ajouter_adresse"
	}
});

F6.UI.ActivateEboutiqueHeader = function(data) {
	// console.log("get in F6.UI.ActivateEboutiqueHeader function ===>"+data);
	if (data == "Anonymous") {
		// console.log("ShowConnectedHeader start");
		// call ajax to verfy if we have to relaod page
		F6.AJAX.ShowConnectedHeader();
		// console.log("ShowConnectedHeader end");
	} else {
		F6.AJAX.removeSessionParam_ShowConnectedHeader();
	}
};

F6.UI.callBackShowConnectedHeader = function(data) {
	// console.log("get in F6.UI.callBackShowConnectedHeader function
	// ====>"+data);
	if (data == "refresh") {
		$(".oauthload").load("/inscription/confirmation .oauthload");
	} else {
		// console.log("boost F6.UI.ActivateEboutiqueHeader() call");
		setTimeout(function() {
			F6.UI.ActivateEboutiqueHeader(data);
		}, 2000);
	}
};

/*
 * Libelle de voie n'est pas facultative quand cedex est present dans localite
 * iomari 19/02/2016
 */
F6.UI.applyCedexRule = function(localitePath, libellePath) {
	var input = $(localitePath);
	var numLibelleVoie = $(libellePath);
	var updateLibelleVoie = function(localite, numLibelleVoie) {

		if (localite.val() != null
				&& localite.val().toLowerCase().indexOf("cedex") >= 0) {
			// remove de la voie *
			numLibelleVoie.text("N° et libellé de la voie");
		} else {
			// add it
			numLibelleVoie.text("N° et libellé de la voie*");
		}
	};
	if (input != null) {
		updateLibelleVoie(input, numLibelleVoie);
		input.on('input', function() {
			updateLibelleVoie(input, numLibelleVoie);
		});
	}
};

F6.UI.validationLrel = function() {

	var target = $('.btn-send').on('click', function() {

						var exp = $(".exp").length > 0;
						var dest = $(".dest").length > 0;
						var msgGlobal = false;
						var expediteurExist = $(".myaddress").length > 0;
						var lrtelDestinatiareBloc = $(".lrtelDestinatiare").length > 0;
						var errFirstName = $("label[for='firstName'][generated='true']").length > 0;
						var errLastName = $("label[for='lastName'][generated='true']").length > 0;
						var errEmailPar = $("label[for='emailPar'][generated='true']").length > 0;

						if (!expediteurExist && exp) {

							var msg = "Vous devez renseigner une adresse expéditeur.";
							$(".exp").addClass("error actived");

							$(".exp.error.actived").html(msg);
							msgGlobal = true;
						}

	});
}



//this variable will store the fancybox object that will be used in the postPopin() function
var fancyBoxInstance;

function showPopin() {
    var urlToBeUsed = "/post-payment/showPopin";

    //$.fancybox.showActivity()
    $.ajax({
        type : "GET",
        cache : false,
        url : urlToBeUsed ,
        data : null,
        success : function(data) {
            Popup.popinHTML(data);
        }
    });
    fancyBoxInstance = $.fancybox;
    return false;
}

function postPopin() {

    var philOui= false;
    if ($('#appetencePhilatelieoui').is(":checked")) {
        philOui=true ;
    }else if($('#appetencePhilatelienon').is(":checked")){
        philOui =false ;
    } else {
        philOui = "";
    }

    var urlUsed = "/post-payment/postPopin";

    $.ajax({
        type : "GET",
        cache : false,
        url : urlUsed +"?philOui=" + philOui ,
        data : null,
        success : function(data) {
            // $.fancybox.close();
            fancyBoxInstance.close();
        }
    });
}

/*
 * Tronquage des titres produit en rayon
 * Ghazi Kerfahi
 */
$(document).ready(function() {
	var titleList = document.querySelectorAll('.product-push .product-slot .product-description a > span:not(.ellipsized)');
    for (var i = 0, len = titleList.length ; i < len ;  i++) {
        var el = titleList[i];
        var wordArray = el.innerHTML.split(' ');
        while(el.scrollHeight > el.offsetHeight) {
            wordArray.pop();
            el.innerHTML = wordArray.join(' ') + '...';
        }
        el.classList.add("ellipsized");
	}

    var titleList1 = document.querySelectorAll('p.ellipsy:not(.ellipsized)');
    for (var i = 0, len = titleList1.length ; i < len ;  i++) {
        var el = titleList1[i];
        var wordArray = el.innerHTML.split(' ');
        while(el.scrollHeight > (el.offsetHeight + 2)) {
            wordArray.pop();
            el.innerHTML = wordArray.join(' ') + '...';
        }
        el.classList.add("ellipsized");
	}

    var showpopin= $("#showpopin").val();

    if(showpopin == 'true'){
    showPopin() ;
  }
});

/*
 * Letter Model Accordéant
 */
$(document).ready(function() {
$("#accordion > li >div").click(function(){
if(false == $(this).next().is(':visible')) {
		$("#accordion > li >div").next().slideUp(300);
		$(this).next().slideToggle(300);
		$("#accordion > li >div").parent().removeClass("visible");
		$(this).parent().toggleClass("visible");
}
else{
		($("#accordion > li > div").parent().parent()).removeClass("visible");
		$(this).parent().removeClass("visible");
		$(this).next().slideToggle(300);
}
});
});
